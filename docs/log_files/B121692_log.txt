

	####### B121692 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 2
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
library(interactions, quietly = T)
[1] 3
 [1] "interactions" "car"          "carData"      "psych"        "readr"        "stats"        "graphics"     "grDevices"   
 [9] "utils"        "datasets"     "methods"      "base"        
data <- read_csv("~/Desktop/rms2/code_check/RMS2_report_1920.csv")
[1] 4
View(data)
[1] 5
str(data)
[1] 6
Classes ‘spec_tbl_df’, ‘tbl_df’, ‘tbl’ and 'data.frame':	200 obs. of  6 variables:
 $ subject  : num  1 2 3 4 5 6 7 8 9 10 ...
 $ incidents: num  0.667 0.333 0.333 0.417 0.5 ...
 $ training : num  2 2 2 2 2 2 2 2 2 2 ...
 $ feedback : num  2 1 2 1 2 1 2 1 2 1 ...
 $ empathy  : num  11 10 10 9 12 11 13 14 12 12 ...
 $ years    : num  10 7 5 7 12 10 8 10 7 9 ...
 - attr(*, "spec")=
  .. cols(
  ..   subject = col_double(),
  ..   incidents = col_double(),
  ..   training = col_double(),
  ..   feedback = col_double(),
  ..   empathy = col_double(),
  ..   years = col_double()
  .. )
NULL
data$training <- factor(data$training)
[1] 7
data$feedback <- factor(data$feedback)
[1] 8
is.factor(data$training)
[1] 9
[1] TRUE
is.factor(data$feedback)
[1] 10
[1] TRUE
data$incidents <- (data$incidents * 100)
[1] 11
table(data$incidents)
[1] 12

 8.3333333 16.6666667         25 33.3333333 41.6666667         50 58.3333333 66.6666667         75 83.3333333 91.6666667 
         3         12         14         31         45         28         24         19         12          6          6 
data$training <- factor(data$training, labels = c("No training", 
    "Training"))
[1] 13
levels(data$training)
[1] 14
[1] "No training" "Training"   
table(data$training)
[1] 15

No training    Training 
        100         100 
data$feedback <- factor(data$feedback, labels = c("No feedback", 
    "Feedback"))
[1] 16
levels(data$feedback)
[1] 17
[1] "No feedback" "Feedback"   
table(data$feedback)
[1] 18

No feedback    Feedback 
        100         100 
summary(data)
[1] 19
    subject         incidents             training          feedback      empathy          years      
 Min.   :  1.00   Min.   : 8.333   No training:100   No feedback:100   Min.   : 3.00   Min.   : 1.00  
 1st Qu.: 50.75   1st Qu.:33.333   Training   :100   Feedback   :100   1st Qu.: 9.00   1st Qu.: 6.00  
 Median :100.50   Median :41.667                                       Median :10.00   Median : 8.00  
 Mean   :100.50   Mean   :47.500                                       Mean   :10.18   Mean   : 8.13  
 3rd Qu.:150.25   3rd Qu.:58.333                                       3rd Qu.:12.00   3rd Qu.:10.00  
 Max.   :200.00   Max.   :91.667                                       Max.   :16.00   Max.   :19.00  
table(data$subject)
[1] 20

 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 
 1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 
42 43 44 45 46 47 48 49 50 
 1  1  1  1  1  1  1  1  1 
 [ reached getOption("max.print") -- omitted 150 entries ]
table(data$incidents)
[1] 21

 8.3333333 16.6666667         25 33.3333333 41.6666667         50 58.3333333 66.6666667         75 83.3333333 91.6666667 
         3         12         14         31         45         28         24         19         12          6          6 
table(data$empathy)
[1] 22

 3  5  6  7  8  9 10 11 12 13 14 15 16 
 4  5  5 20  9 26 38 31 33 11 10  6  2 
table(data$years)
[1] 23

 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 18 19 
 2  3  3  9 21 24 34 21 21 23 11 11  5  6  4  1  1 
describe(data)
[1] 24
          vars   n  mean    sd median trimmed   mad  min    max  range skew kurtosis   se
subject      1 200 100.5 57.88 100.50  100.50 74.13 1.00 200.00 199.00 0.00    -1.22 4.09
incidents    2 200  47.5 18.66  41.67   46.88 12.36 8.33  91.67  83.33 0.32    -0.31 1.32
training*    3 200   1.5  0.50   1.50    1.50  0.74 1.00   2.00   1.00 0.00    -2.01 0.04
 [ reached 'max' / getOption("max.print") -- omitted 3 rows ]
describe(data)[c(2, 5, 6), c(2:4, 8, 9, 11)]
[1] 25
            n  mean    sd  min   max  skew
incidents 200 47.50 18.66 8.33 91.67  0.32
empathy   200 10.18  2.54 3.00 16.00 -0.37
years     200  8.13  3.08 1.00 19.00  0.52
hist(data$incidents, main = "Histogram of incidents that teachers intervened in", 
    ylab = "Frequency, n=200", xlab = "Intervened incidents, %", 
    pch = 16)
[1] 26
abline(v = mean(data$incidents), col = "red", lwd = 3)
[1] 27
hist(data$years, main = "Histogram of years of teaching experience", 
    ylab = "Frequency, n=200", xlab = "Years rounded to whole number", 
    pch = 16)
[1] 28
abline(v = mean(data$years), col = "red", lwd = 3)
[1] 29
hist(data$empathy, main = "Histogram of baseline empathy measure", 
    ylab = "Frequency, n=200", xlab = "Empathy (1=low empathy, 20=high empathy)", 
    pch = 16)
[1] 30
abline(v = mean(data$empathy), col = "red", lwd = 3)
[1] 31
boxplot_training <- boxplot(data$incidents ~ data$training, main = "Boxplots of Incidents and 'Training' or 'No training' conditions", 
    ylab = "Incidents reported, %", xlab = "Training condition - 'No training' n=100, 'Training' n=100", 
    col = "darkslategray2")
[1] 32
boxplot_feedback <- boxplot(data$incidents ~ data$feedback, main = "Boxplots of Incidents and 'Feedback' or 'No feedback' conditions", 
    ylab = "Incidents reported, %", xlab = "Feedback condition - 'No feedback' n=100, 'Feedback' n=100", 
    col = "darkslategray2")
[1] 33
Results1 <- lm(empathy ~ years, data = data)
[1] 34
summary(Results1)
[1] 35

Call:
lm(formula = empathy ~ years, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.5399 -1.5160  0.0708  1.6357  5.8533 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  8.40625    0.49085  17.126  < 2e-16 ***
years        0.21756    0.05648   3.852 0.000158 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 2.453 on 198 degrees of freedom
Multiple R-squared:  0.06972,	Adjusted R-squared:  0.06502 
F-statistic: 14.84 on 1 and 198 DF,  p-value: 0.0001582

qqPlot(Results1)
[1] 36
hist(Results1$residuals, main = "Histogram of empathy and years", 
    xlab = "Residuals")
[1] 37
abline(v = mean(Results1$residuals), col = "red", lwd = 3)
[1] 38
shapiro.test(Results1$residuals)
[1] 39

	Shapiro-Wilk normality test

data:  Results1$residuals
W = 0.98911, p-value = 0.1321

residualPlots(Results1)
[1] 40
ncvTest(Results1)
[1] 41
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.9815033, Df = 1, p = 0.32183
plot(data$empathy, data$years, main = "Scatterplot of Baseline empathy measure and Years of teaching", 
    ylab = "Years teaching, 0-30", xlab = "Emphaty (1=low empathy, 20=high empathy)", 
    pch = 16)
[1] 42
abline(Results1)
[1] 43
lines(lowess(data$empathy ~ data$years))
[1] 44
durbinWatsonTest(Results1)
[1] 45
 lag Autocorrelation D-W Statistic p-value
   1       0.1017162      1.769879   0.116
 Alternative hypothesis: rho != 0
data$years_centred <- data$years - mean(data$years)
[1] 46
data$empathy_centred <- data$empathy - mean(data$empathy)
[1] 47
Results1_centred <- lm(data$empathy_centred ~ data$years_centred + 
    I(years_centred^2), data = data)
[1] 48
summary(Results1_centred)
[1] 49

Call:
lm(formula = data$empathy_centred ~ data$years_centred + I(years_centred^2), 
    data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.5069 -1.4011 -0.0835  1.1707  6.0622 

Coefficients:
                    Estimate Std. Error t value Pr(>|t|)    
(Intercept)         0.977696   0.167423   5.840 2.13e-08 ***
data$years_centred  0.383236   0.047986   7.986 1.13e-13 ***
I(years_centred^2) -0.103645   0.009861 -10.510  < 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.969 on 197 degrees of freedom
Multiple R-squared:  0.404,	Adjusted R-squared:  0.3979 
F-statistic: 66.75 on 2 and 197 DF,  p-value: < 2.2e-16

qqPlot(Results1_centred, main = "QQplot of centred 'empathy' and 'years' model", 
    ylab = "Studentized Residuals")
[1] 50
hist(Results1_centred$residuals)
[1] 51
abline(v = mean(Results1_centred$residuals), col = "red", lwd = 3)
[1] 52
shapiro.test(Results1_centred$residuals)
[1] 53

	Shapiro-Wilk normality test

data:  Results1_centred$residuals
W = 0.9941, p-value = 0.6155

residualPlots(Results1_centred, main = "Residual plots for centred 'years' and 'empathy'")
[1] 54
ncvTest(Results1_centred)
[1] 55
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.5107658, Df = 1, p = 0.47481
crPlots(Results1_centred, ylab = "Component+Residual(empathy)")
[1] 56
durbinWatsonTest(Results1_centred)
[1] 57
 lag Autocorrelation D-W Statistic p-value
   1      0.01288905      1.973855   0.866
 Alternative hypothesis: rho != 0
describeBy(data$incidents, data$training)
[1] 58

 Descriptive statistics by group 
group: No training
   vars   n  mean    sd median trimmed   mad min   max range skew kurtosis   se
X1    1 100 54.17 17.51     50   53.02 24.71  25 91.67 66.67 0.39    -0.73 1.75
--------------------------------------------------------------------------------------------- 
group: Training
   vars   n  mean    sd median trimmed   mad  min   max range skew kurtosis   se
X1    1 100 40.83 17.43  41.67    39.9 12.36 8.33 91.67 83.33 0.38    -0.05 1.74
Results2 <- lm(incidents ~ training + empathy + years, data = data)
[1] 59
summary(Results2)
[1] 60

Call:
lm(formula = incidents ~ training + empathy + years, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-35.648 -12.270  -1.474  10.105  53.180 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)       40.7320     5.1814   7.861 2.48e-13 ***
trainingTraining -15.2427     2.3166  -6.580 4.20e-10 ***
empathy            2.5396     0.4735   5.363 2.29e-07 ***
years             -1.4085     0.3889  -3.622 0.000372 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16.21 on 196 degrees of freedom
Multiple R-squared:  0.2565,	Adjusted R-squared:  0.2451 
F-statistic: 22.53 on 3 and 196 DF,  p-value: 1.408e-12

qqPlot(Results2)
[1] 61
hist(new_Results2$residuals)
[1] 62
abline(v = mean(Results2$residuals), col = "red", lwd = 3)
[1] 63
shapiro.test(Results2$residuals)
[1] 64

	Shapiro-Wilk normality test

data:  Results2$residuals
W = 0.97994, p-value = 0.005838

residualPlots(Results2)
[1] 65
ncvTest(Results2)
[1] 66
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.0293323, Df = 1, p = 0.86401
crPlots(Results2)
[1] 67
durbinWatsonTest(Results2)
[1] 68
 lag Autocorrelation D-W Statistic p-value
   1      -0.1072849      2.199897    0.21
 Alternative hypothesis: rho != 0
vif(Results2)
[1] 69
training  empathy    years 
1.020633 1.092467 1.085089 
plot(cooks.distance(Results2))
[1] 70
abline(h = cooks.distance(Results2) > (4/(200 - 3 - 1)), col = "red")
[1] 71
which(cooks.distance(Results2) > (4/(200 - 3 - 1)))
[1] 72
 13  35  74 137 165 
 13  35  74 137 165 
stdz <- MASS::studres(Results2)
[1] 73
head(stdz, 20)
[1] 74
         1          2          3          4          5          6          7          8          9         10         11 
 1.7039666 -0.4759818 -0.6519659  0.1968240  0.6801599 -0.8893909  2.2672645 -0.3290103  0.2412298 -1.6591914  1.8757093 
        12         13         14         15         16         17         18         19         20 
 0.0298675  3.3861502  0.2412298  1.2329081 -1.0885527 -0.8362148 -0.3189418  1.9495174  0.4777973 
which(abs(stdz) > 2)
[1] 75
  7  13  35  74 159 165 176 181 
  7  13  35  74 159 165 176 181 
which(hats > 2 * mean(hats))
[1] 76
[1] "Error in which(hats > 2 * mean(hats)) : object 'hats' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in which(hats > 2 * mean(hats)): object 'hats' not found>


####################################################################################################

[1] "Error in which(hats > 2 * mean(hats)) : object 'hats' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in which(hats > 2 * mean(hats)): object 'hats' not found>
####################################################################################################


hats <- hatvalues(Results2)
[1] 77
Results2_feedback <- lm(incidents ~ training + feedback + empathy + 
    years, data = data)
[1] 78
summary(Results2_feedback)
[1] 79

Call:
lm(formula = incidents ~ training + feedback + empathy + years, 
    data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-31.626 -10.096  -0.949   9.165  46.650 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)       33.1953     4.8708   6.815 1.15e-10 ***
trainingTraining -15.3824     2.1128  -7.281 7.98e-12 ***
feedbackFeedback  13.3715     2.0968   6.377 1.28e-09 ***
empathy            2.7191     0.4328   6.283 2.12e-09 ***
years             -1.5199     0.3551  -4.281 2.92e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.79 on 195 degrees of freedom
Multiple R-squared:  0.3848,	Adjusted R-squared:  0.3721 
F-statistic: 30.49 on 4 and 195 DF,  p-value: < 2.2e-16

residualPlots(Results2_feedback, main = "Assumption check for Homoscedasticity")
[1] 80
ncvTest(Results2_feedback)
[1] 81
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 3.684027, Df = 1, p = 0.054936
crPlots(Results2_feedback, main = "Assumption check for linearity", 
    ylab = "Incidents")
[1] 82
durbinWatsonTest(Results2_feedback)
[1] 83
 lag Autocorrelation D-W Statistic p-value
   1      0.07303546      1.841386    0.27
 Alternative hypothesis: rho != 0
vif(Results2_feedback)
[1] 84
training feedback  empathy    years 
1.020743 1.005320 1.097109 1.087722 
confint(Results2_feedback)
[1] 85
                      2.5 %      97.5 %
(Intercept)       23.589084  42.8014650
trainingTraining -19.549291 -11.2155017
feedbackFeedback   9.236165  17.5067553
empathy            1.865573   3.5726020
years             -2.220122  -0.8196122
Results3 <- lm(incidents ~ feedback + years + empathy, data = data)
[1] 86
summary(Results3)
[1] 87

Call:
lm(formula = incidents ~ feedback + years + empathy, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-35.580 -11.148  -1.097  11.092  53.552 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)       27.6161     5.4108   5.104 7.84e-07 ***
feedbackFeedback  13.2132     2.3585   5.602 7.09e-08 ***
years             -1.2689     0.3975  -3.192  0.00165 ** 
empathy            2.3187     0.4829   4.802 3.11e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16.63 on 196 degrees of freedom
Multiple R-squared:  0.2175,	Adjusted R-squared:  0.2055 
F-statistic: 18.16 on 3 and 196 DF,  p-value: 1.933e-10

qqPlot(Results3, main = "Plot for normally distributed errors")
[1] 88
hist(Results3$residuals)
[1] 89
abline(v = mean(Results3$residuals), col = "red", lwd = 3)
[1] 90
shapiro.test(Results3$residuals)
[1] 91

	Shapiro-Wilk normality test

data:  Results3$residuals
W = 0.98772, p-value = 0.08174

residualPlots(Results3, main = "Plots of Homoscedasticity")
[1] 92
ncvTest(Results3)
[1] 93
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.01731234, Df = 1, p = 0.89532
crPlots(Results3, ylab = "Incidents")
[1] 94
durbinWatsonTest(Results3)
[1] 95
 lag Autocorrelation D-W Statistic p-value
   1       0.2738264      1.444081       0
 Alternative hypothesis: rho != 0
datanew <- data[order(runif(nrow(data))), ]
[1] 96
Results3_order <- lm(incidents ~ feedback + years + empathy, 
    data = datanew)
[1] 97
summary(Results3_order)
[1] 98

Call:
lm(formula = incidents ~ feedback + years + empathy, data = datanew)

Residuals:
    Min      1Q  Median      3Q     Max 
-35.580 -11.148  -1.097  11.092  53.552 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)       27.6161     5.4108   5.104 7.84e-07 ***
feedbackFeedback  13.2132     2.3585   5.602 7.09e-08 ***
years             -1.2689     0.3975  -3.192  0.00165 ** 
empathy            2.3187     0.4829   4.802 3.11e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16.63 on 196 degrees of freedom
Multiple R-squared:  0.2175,	Adjusted R-squared:  0.2055 
F-statistic: 18.16 on 3 and 196 DF,  p-value: 1.933e-10

durbinWatsonTest(Results3_order)
[1] 99
 lag Autocorrelation D-W Statistic p-value
   1     -0.03588538      2.069475   0.656
 Alternative hypothesis: rho != 0
View(datanew)
[1] 100
vif(Results3)
[1] 101
feedback    years  empathy 
1.005211 1.077467 1.079397 
confint(Results3)
[1] 102
                     2.5 %     97.5 %
(Intercept)      16.945259 38.2869109
feedbackFeedback  8.561885 17.8644455
years            -2.052811 -0.4849104
empathy           1.366456  3.2710219
AIC(Results2_feedback, Results3)
[1] 103
                  df      AIC
Results2_feedback  6 1652.018
Results3           5 1698.109
BIC(Results2_feedback, Results3)
[1] 104
                  df      BIC
Results2_feedback  6 1671.808
Results3           5 1714.601
Results5 <- lm(incidents ~ training + feedback + training * feedback, 
    data = data)
[1] 105
summary(Results5)
[1] 106

Call:
lm(formula = incidents ~ training + feedback + training * feedback, 
    data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-40.000 -10.500   0.000   8.333  43.333 

Coefficients:
                                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)                         49.333      2.314  21.323  < 2e-16 ***
trainingTraining                   -16.000      3.272  -4.890 2.09e-06 ***
feedbackFeedback                     9.667      3.272   2.954  0.00352 ** 
trainingTraining:feedbackFeedback    5.333      4.627   1.153  0.25047    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16.36 on 196 degrees of freedom
Multiple R-squared:  0.2431,	Adjusted R-squared:  0.2315 
F-statistic: 20.99 on 3 and 196 DF,  p-value: 7.827e-12

interaction.plot(data$training, data$feedback, data$incidents, 
    main = "Interaction plot between 'training' and 'feedback'")
[1] 107
qqPlot(Results5)
[1] 108
hist(Results5$residuals)
[1] 109
abline(v = mean(Results5$residuals), col = "red", lwd = 3)
[1] 110
shapiro.test(Results5$residuals)
[1] 111

	Shapiro-Wilk normality test

data:  Results5$residuals
W = 0.9767, p-value = 0.002072

ncvTest(Results5)
[1] 112
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 1.881673, Df = 1, p = 0.17014
durbinWatsonTest(Results5)
[1] 113
 lag Autocorrelation D-W Statistic p-value
   1       0.1114255      1.770733   0.134
 Alternative hypothesis: rho != 0
vif(Results5)
[1] 114
         training          feedback training:feedback 
                2                 2                 3 
