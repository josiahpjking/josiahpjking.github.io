

	####### B111496 R script #######

rm(list = ls())
[1] 1
setwd("~/Library/Mobile Documents/com~apple~CloudDocs/Uni/Third Year/RMS/RMS 2/Coursework")
[1] 2
data <- read.csv("~/Desktop/rms2/code_check/RMS2_report_1920.csv")
[1] 3
library(psych, quietly = T)
[1] 4
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 5
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
library(interactions, quietly = T)
[1] 6
 [1] "interactions" "car"          "carData"      "psych"        "readr"        "stats"        "graphics"     "grDevices"   
 [9] "utils"        "datasets"     "methods"      "base"        
par(mfrow = c(2, 2))
[1] 7
$mfrow
[1] 1 3

describe(data)
[1] 8
          vars   n   mean    sd median trimmed   mad  min    max  range skew kurtosis   se
subject      1 200 100.50 57.88 100.50  100.50 74.13 1.00 200.00 199.00 0.00    -1.22 4.09
incidents    2 200   0.48  0.19   0.42    0.47  0.12 0.08   0.92   0.83 0.32    -0.31 0.01
training     3 200   1.50  0.50   1.50    1.50  0.74 1.00   2.00   1.00 0.00    -2.01 0.04
 [ reached 'max' / getOption("max.print") -- omitted 3 rows ]
describe(data)[, c(2:4, 8, 9, 11)]
[1] 9
            n   mean    sd  min    max  skew
subject   200 100.50 57.88 1.00 200.00  0.00
incidents 200   0.48  0.19 0.08   0.92  0.32
training  200   1.50  0.50 1.00   2.00  0.00
feedback  200   1.50  0.50 1.00   2.00  0.00
empathy   200  10.18  2.54 3.00  16.00 -0.37
years     200   8.13  3.08 1.00  19.00  0.52
str(data)
[1] 10
'data.frame':	200 obs. of  6 variables:
 $ subject  : int  1 2 3 4 5 6 7 8 9 10 ...
 $ incidents: num  0.667 0.333 0.333 0.417 0.5 ...
 $ training : int  2 2 2 2 2 2 2 2 2 2 ...
 $ feedback : int  2 1 2 1 2 1 2 1 2 1 ...
 $ empathy  : int  11 10 10 9 12 11 13 14 12 12 ...
 $ years    : int  10 7 5 7 12 10 8 10 7 9 ...
NULL
data$training <- as.factor(data$training)
[1] 11
data$feedback <- as.factor(data$feedback)
[1] 12
str(data)
[1] 13
'data.frame':	200 obs. of  6 variables:
 $ subject  : int  1 2 3 4 5 6 7 8 9 10 ...
 $ incidents: num  0.667 0.333 0.333 0.417 0.5 ...
 $ training : Factor w/ 2 levels "1","2": 2 2 2 2 2 2 2 2 2 2 ...
 $ feedback : Factor w/ 2 levels "1","2": 2 1 2 1 2 1 2 1 2 1 ...
 $ empathy  : int  11 10 10 9 12 11 13 14 12 12 ...
 $ years    : int  10 7 5 7 12 10 8 10 7 9 ...
NULL
str(data$training)
[1] 14
 Factor w/ 2 levels "1","2": 2 2 2 2 2 2 2 2 2 2 ...
NULL
summary(data$training)
[1] 15
  1   2 
100 100 
data$training <- factor(data$training, labels = c("No training", 
    "Training"))
[1] 16
levels(data$training)
[1] 17
[1] "No training" "Training"   
summary(data$training)
[1] 18
No training    Training 
        100         100 
str(data$feedback)
[1] 19
 Factor w/ 2 levels "1","2": 2 1 2 1 2 1 2 1 2 1 ...
NULL
summary(data$feedback)
[1] 20
  1   2 
100 100 
data$feedback <- factor(data$feedback, labels = c("No feedback", 
    "Feedback"))
[1] 21
summary(data$feedback)
[1] 22
No feedback    Feedback 
        100         100 
data$empathy <- scale(data$empathy)
[1] 23
plot(data$empathy, ylab = "Empathy")
[1] 24
before <- lm(incidents ~ training + feedback + empathy + years, 
    data = data)
[1] 25
summary(before)
[1] 26

Call:
lm(formula = incidents ~ training + feedback + empathy + years, 
    data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.31626 -0.10096 -0.00949  0.09165  0.46650 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.608620   0.034515  17.634  < 2e-16 ***
trainingTraining -0.153824   0.021128  -7.281 7.98e-12 ***
feedbackFeedback  0.133715   0.020968   6.377 1.28e-09 ***
empathy           0.068984   0.010980   6.283 2.12e-09 ***
years            -0.015199   0.003551  -4.281 2.92e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1479 on 195 degrees of freedom
Multiple R-squared:  0.3848,	Adjusted R-squared:  0.3721 
F-statistic: 30.49 on 4 and 195 DF,  p-value: < 2.2e-16

cooks <- cooks.distance(before)
[1] 27
names(which(cooks > (4/195)))
[1] 28
 [1] "13"  "35"  "74"  "117" "131" "137" "141" "156" "160" "176"
plot(before, which = 4)
[1] 29
after <- lm(incidents ~ training + feedback + empathy + years, 
    data = data[-c(13, 137, 176), ])
[1] 30
summary(after)
[1] 31

Call:
lm(formula = incidents ~ training + feedback + empathy + years, 
    data = data[-c(13, 137, 176), ])

Residuals:
     Min       1Q   Median       3Q      Max 
-0.31479 -0.10102 -0.00300  0.09041  0.35676 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.619020   0.033412  18.527  < 2e-16 ***
trainingTraining -0.153003   0.020113  -7.607 1.22e-12 ***
feedbackFeedback  0.132020   0.019981   6.607 3.76e-10 ***
empathy           0.073938   0.010573   6.993 4.34e-11 ***
years            -0.017169   0.003489  -4.921 1.85e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.14 on 192 degrees of freedom
Multiple R-squared:  0.4232,	Adjusted R-squared:  0.4112 
F-statistic: 35.22 on 4 and 192 DF,  p-value: < 2.2e-16

hats <- hatvalues(before)
[1] 32
head(hats, 20)
[1] 33
         1          2          3          4          5          6          7          8          9         10         11 
0.01712163 0.01549576 0.02001541 0.01701625 0.02394476 0.01751286 0.02125280 0.02488761 0.01874782 0.01688360 0.01833535 
        12         13         14         15         16         17         18         19         20 
0.02484967 0.01655041 0.01759398 0.01655041 0.04465575 0.03320873 0.01701625 0.02001541 0.02623618 
which(hats > 2 * mean(hats))
[1] 34
 61  88  89  92 137 141 154 175 200 
 61  88  89  92 137 141 154 175 200 
after2 <- lm(incidents ~ training + feedback + empathy + years, 
    data = data[-c(13, 61, 88, 89, 92, 137, 141, 154, 175, 176, 
        200), ])
[1] 35
summary(after2)
[1] 36

Call:
lm(formula = incidents ~ training + feedback + empathy + years, 
    data = data[-c(13, 61, 88, 89, 92, 137, 141, 154, 175, 176, 
        200), ])

Residuals:
     Min       1Q   Median       3Q      Max 
-0.32233 -0.09934 -0.00664  0.08943  0.35847 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.625018   0.037258  16.776  < 2e-16 ***
trainingTraining -0.153011   0.020815  -7.351 6.24e-12 ***
feedbackFeedback  0.137953   0.020620   6.690 2.60e-10 ***
empathy           0.075181   0.012256   6.134 5.12e-09 ***
years            -0.018121   0.004032  -4.494 1.23e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.141 on 184 degrees of freedom
Multiple R-squared:  0.3975,	Adjusted R-squared:  0.3844 
F-statistic: 30.35 on 4 and 184 DF,  p-value: < 2.2e-16

m1 <- lm(empathy ~ years, data = data)
[1] 37
summary(m1)
[1] 38

Call:
lm(formula = empathy ~ years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.97192 -0.59754  0.02792  0.64474  2.30713 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) -0.69717    0.19347  -3.603 0.000397 ***
years        0.08575    0.02226   3.852 0.000158 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.9669 on 198 degrees of freedom
Multiple R-squared:  0.06972,	Adjusted R-squared:  0.06502 
F-statistic: 14.84 on 1 and 198 DF,  p-value: 0.0001582

plot(data$years, data$empathy, main = "Relationship Between Empathy and Years", 
    xlab = "Number of years", ylab = "Empathy")
[1] 39
abline(m1, col = "blue")
[1] 40
lines(lowess(data$years, data$empathy))
[1] 41
plot(m1, 1)
[1] 42
data$z = data$years^2
[1] 43
quadratic = lm(data$empathy ~ data$years + data$z)
[1] 44
summary(quadratic)
[1] 45

Call:
lm(formula = data$empathy ~ data$years + data$z)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.77645 -0.55225 -0.03293  0.46143  2.38949 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) -3.542969   0.312115  -11.35   <2e-16 ***
data$years   0.815324   0.071676   11.38   <2e-16 ***
data$z      -0.040853   0.003887  -10.51   <2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.776 on 197 degrees of freedom
Multiple R-squared:  0.404,	Adjusted R-squared:  0.3979 
F-statistic: 66.75 on 2 and 197 DF,  p-value: < 2.2e-16

confint(quadratic, level = 0.95)
[1] 46
                  2.5 %      97.5 %
(Intercept) -4.15848502 -2.92745274
data$years   0.67397298  0.95667546
data$z      -0.04851815 -0.03318759
summary(m1)
[1] 47

Call:
lm(formula = empathy ~ years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.97192 -0.59754  0.02792  0.64474  2.30713 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) -0.69717    0.19347  -3.603 0.000397 ***
years        0.08575    0.02226   3.852 0.000158 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.9669 on 198 degrees of freedom
Multiple R-squared:  0.06972,	Adjusted R-squared:  0.06502 
F-statistic: 14.84 on 1 and 198 DF,  p-value: 0.0001582

plot(data$empathy ~ data$years, main = "Relationship Between Empathy and Years", 
    xlab = "Years", ylab = "Empathy")
[1] 48
points(data$years, fitted(quadratic), col = "red", pch = 20)
[1] 49
NULL
lines(sort(data$years), fitted(quadratic)[order(data$years)], 
    col = "red", type = "b")
[1] 50
qqPlot(quadratic)
[1] 51
shapiro.test(quadratic$residuals)
[1] 52

	Shapiro-Wilk normality test

data:  quadratic$residuals
W = 0.9941, p-value = 0.6155

hist(quadratic$residuals, xlab = "Residuals", main = "Histogram of Residuals")
[1] 53
ncvTest(quadratic)
[1] 54
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.5107658, Df = 1, p = 0.47481
plot(quadratic, 3)
[1] 55
durbinWatsonTest(quadratic)
[1] 56
 lag Autocorrelation D-W Statistic p-value
   1      0.01288905      1.973855   0.856
 Alternative hypothesis: rho != 0
vif(quadratic)
[1] 57
data$years     data$z 
   16.0978    16.0978 
levels(data$training)
[1] 58
[1] "No training" "Training"   
plot(data$training, data$incidents, xlab = "Training", ylab = "Amount of Intervention")
[1] 59
m2 <- lm(incidents ~ training + empathy + years, data = data)
[1] 60
summary(m2)
[1] 61

Call:
lm(formula = incidents ~ training + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.35648 -0.12270 -0.01474  0.10105  0.53180 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.665721   0.036551  18.214  < 2e-16 ***
trainingTraining -0.152427   0.023166  -6.580 4.20e-10 ***
empathy           0.064430   0.012014   5.363 2.29e-07 ***
years            -0.014085   0.003889  -3.622 0.000372 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1621 on 196 degrees of freedom
Multiple R-squared:  0.2565,	Adjusted R-squared:  0.2451 
F-statistic: 22.53 on 3 and 196 DF,  p-value: 1.408e-12

qqPlot(m2)
[1] 62
hist(m2$residuals, xlab = "Residuals", main = "Histogram of Residuals")
[1] 63
shapiro.test(m2$residuals)
[1] 64

	Shapiro-Wilk normality test

data:  m2$residuals
W = 0.97994, p-value = 0.005838

log.incidents <- log(data$incidents + (-1 * min(data$incidents) + 
    1))
[1] 65
summary(log.incidents)
[1] 66
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.2231  0.2877  0.3216  0.4055  0.6061 
m3 <- lm(log.incidents ~ training + empathy + years, data = data)
[1] 67
summary(m3)
[1] 68

Call:
lm(formula = log.incidents ~ training + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.27676 -0.08678 -0.00271  0.07438  0.35035 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.460852   0.026028  17.706  < 2e-16 ***
trainingTraining -0.111288   0.016497  -6.746 1.67e-10 ***
empathy           0.047061   0.008555   5.501 1.17e-07 ***
years            -0.010283   0.002769  -3.713 0.000266 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1155 on 196 degrees of freedom
Multiple R-squared:  0.2661,	Adjusted R-squared:  0.2549 
F-statistic: 23.69 on 3 and 196 DF,  p-value: 3.963e-13

shapiro.test(m3$residuals)
[1] 69

	Shapiro-Wilk normality test

data:  m3$residuals
W = 0.9905, p-value = 0.2109

hist(m3$residuals, xlab = "Residuals", main = "Histogram of Residuals")
[1] 70
plot(m3, 1)
[1] 71
crPlots(m3)
[1] 72
ncvTest(m3)
[1] 73
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 1.036059, Df = 1, p = 0.30874
plot(m3, 3)
[1] 74
durbinWatsonTest(m3)
[1] 75
 lag Autocorrelation D-W Statistic p-value
   1       -0.116516      2.217742   0.132
 Alternative hypothesis: rho != 0
vif(m3)
[1] 76
training  empathy    years 
1.020633 1.092467 1.085089 
plot(data$feedback, data$incidents, xlab = "Feedback", ylab = "Amount of Intervention")
[1] 77
m4 <- lm(log.incidents ~ feedback + empathy + years, data = data)
[1] 78
summary(m4)
[1] 79

Call:
lm(formula = log.incidents ~ feedback + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.27663 -0.07576 -0.00237  0.08302  0.35261 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.349057   0.025597  13.637  < 2e-16 ***
feedbackFeedback  0.095615   0.016841   5.677 4.87e-08 ***
empathy           0.042942   0.008748   4.909 1.92e-06 ***
years            -0.009257   0.002839  -3.261  0.00131 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1188 on 196 degrees of freedom
Multiple R-squared:  0.2235,	Adjusted R-squared:  0.2116 
F-statistic:  18.8 on 3 and 196 DF,  p-value: 9.283e-11

qqPlot(m4)
[1] 80
shapiro.test(m4$residuals)
[1] 81

	Shapiro-Wilk normality test

data:  m4$residuals
W = 0.99572, p-value = 0.8487

plot(m4, 1)
[1] 82
crPlots(m4)
[1] 83
plot(m4, 3)
[1] 84
ncvTest(m4)
[1] 85
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.6746094, Df = 1, p = 0.41145
durbinWatsonTest(m4)
[1] 86
 lag Autocorrelation D-W Statistic p-value
   1       0.2794347      1.431864   0.002
 Alternative hypothesis: rho != 0
vif(m4)
[1] 87
feedback  empathy    years 
1.005211 1.079397 1.077467 
BIC(m3, m4)
[1] 88
   df       BIC
m3  5 -273.4824
m4  5 -262.1757
summary(m3)
[1] 89

Call:
lm(formula = log.incidents ~ training + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.27676 -0.08678 -0.00271  0.07438  0.35035 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.460852   0.026028  17.706  < 2e-16 ***
trainingTraining -0.111288   0.016497  -6.746 1.67e-10 ***
empathy           0.047061   0.008555   5.501 1.17e-07 ***
years            -0.010283   0.002769  -3.713 0.000266 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1155 on 196 degrees of freedom
Multiple R-squared:  0.2661,	Adjusted R-squared:  0.2549 
F-statistic: 23.69 on 3 and 196 DF,  p-value: 3.963e-13

summary(m4)
[1] 90

Call:
lm(formula = log.incidents ~ feedback + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.27663 -0.07576 -0.00237  0.08302  0.35261 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.349057   0.025597  13.637  < 2e-16 ***
feedbackFeedback  0.095615   0.016841   5.677 4.87e-08 ***
empathy           0.042942   0.008748   4.909 1.92e-06 ***
years            -0.009257   0.002839  -3.261  0.00131 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1188 on 196 degrees of freedom
Multiple R-squared:  0.2235,	Adjusted R-squared:  0.2116 
F-statistic:  18.8 on 3 and 196 DF,  p-value: 9.283e-11

m5 <- lm(log.incidents ~ training + feedback + training * feedback, 
    data = data)
[1] 91
summary(m5)
[1] 92

Call:
lm(formula = log.incidents ~ training + feedback + training * 
    feedback, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.32886 -0.07357  0.00614  0.07068  0.27727 

Coefficients:
                                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)                        0.33701    0.01649  20.442  < 2e-16 ***
trainingTraining                  -0.12001    0.02332  -5.147  6.4e-07 ***
feedbackFeedback                   0.06653    0.02332   2.853  0.00479 ** 
trainingTraining:feedbackFeedback  0.04534    0.03297   1.375  0.17072    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1166 on 196 degrees of freedom
Multiple R-squared:  0.252,	Adjusted R-squared:  0.2405 
F-statistic: 22.01 on 3 and 196 DF,  p-value: 2.515e-12

qqPlot(m5)
[1] 93
shapiro.test(m5$residuals)
[1] 94

	Shapiro-Wilk normality test

data:  m5$residuals
W = 0.98649, p-value = 0.05345

hist(m5$residuals)
[1] 95
plot(m5, 3)
[1] 96
ncvTest(m5)
[1] 97
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.04011943, Df = 1, p = 0.84125
cat_plot(m5, pred = training, modx = feedback, data = data, point.shape = T)
[1] 98
cat_plot(m5, pred = training, modx = feedback, data = data, plot.points = T)
[1] 99
interaction.plot(data$training, data$feedback, log.incidents, 
    main = "Interaction of IVs", xlab = "Training", ylab = "Mean of logged incidents")
[1] 100
