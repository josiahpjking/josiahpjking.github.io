

	####### B110329 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 2
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
data <- read.csv("~/Desktop/rms2/code_check/RMS2_report_1920.csv")
[1] 3
summary(data)
[1] 4
    subject         incidents          training      feedback      empathy          years      
 Min.   :  1.00   Min.   :0.08333   Min.   :1.0   Min.   :1.0   Min.   : 3.00   Min.   : 1.00  
 1st Qu.: 50.75   1st Qu.:0.33333   1st Qu.:1.0   1st Qu.:1.0   1st Qu.: 9.00   1st Qu.: 6.00  
 Median :100.50   Median :0.41667   Median :1.5   Median :1.5   Median :10.00   Median : 8.00  
 Mean   :100.50   Mean   :0.47500   Mean   :1.5   Mean   :1.5   Mean   :10.18   Mean   : 8.13  
 3rd Qu.:150.25   3rd Qu.:0.58333   3rd Qu.:2.0   3rd Qu.:2.0   3rd Qu.:12.00   3rd Qu.:10.00  
 Max.   :200.00   Max.   :0.91667   Max.   :2.0   Max.   :2.0   Max.   :16.00   Max.   :19.00  
str(data)
[1] 5
'data.frame':	200 obs. of  6 variables:
 $ subject  : int  1 2 3 4 5 6 7 8 9 10 ...
 $ incidents: num  0.667 0.333 0.333 0.417 0.5 ...
 $ training : int  2 2 2 2 2 2 2 2 2 2 ...
 $ feedback : int  2 1 2 1 2 1 2 1 2 1 ...
 $ empathy  : int  11 10 10 9 12 11 13 14 12 12 ...
 $ years    : int  10 7 5 7 12 10 8 10 7 9 ...
NULL
data$feedback <- as.factor(data$feedback)
[1] 6
data$training <- as.factor(data$training)
[1] 7
data$feedback <- factor(data$feedback, labels = c("No feedback", 
    "Feedback"))
[1] 8
str(data$feedback)
[1] 9
 Factor w/ 2 levels "No feedback",..: 2 1 2 1 2 1 2 1 2 1 ...
NULL
levels(data$feedback)
[1] 10
[1] "No feedback" "Feedback"   
data$training <- factor(data$training, labels = c("No training", 
    "Training"))
[1] 11
levels(data$training)
[1] 12
[1] "No training" "Training"   
hist(data$empathy)
[1] 13
data$empathy <- data$empathy - mean(data$empathy)
[1] 14
hist(data$empathy)
[1] 15
summary(data$empathy)
[1] 16
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 -7.175  -1.175  -0.175   0.000   1.825   5.825 
summary(data$incidents)
[1] 17
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.08333 0.33333 0.41667 0.47500 0.58333 0.91667 
summary(data$training)
[1] 18
No training    Training 
        100         100 
summary(data$feedback)
[1] 19
No feedback    Feedback 
        100         100 
summary(data$years)
[1] 20
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1.00    6.00    8.00    8.13   10.00   19.00 
describe(data)[c(2:6), c(2:4, 8, 9, 11, 12)]
[1] 21
            n mean   sd   min   max  skew kurtosis
incidents 200 0.48 0.19  0.08  0.92  0.32    -0.31
training* 200 1.50 0.50  1.00  2.00  0.00    -2.01
feedback* 200 1.50 0.50  1.00  2.00  0.00    -2.01
empathy   200 0.00 2.54 -7.18  5.82 -0.37     0.23
years     200 8.13 3.08  1.00 19.00  0.52     0.48
hist(data$years)
[1] 22
hist(data$empathy)
[1] 23
plot(data$empathy, data$years, xlab = "Measure of Empathy", ylab = "Years of Teaching Experience", 
    main = "Teaching and Empathy")
[1] 24
lines(lowess(data$empathy, data$years))
[1] 25
shapiro.test(data$years)
[1] 26

	Shapiro-Wilk normality test

data:  data$years
W = 0.97276, p-value = 0.0006279

shapiro.test(data$empathy)
[1] 27

	Shapiro-Wilk normality test

data:  data$empathy
W = 0.97073, p-value = 0.0003477

spearman <- cor(data$empathy, data$years, method = "spearman")
[1] 28
spearman

[1] 0.3071045


t <- (spearman * sqrt(200 - 2))/sqrt(1 - (spearman^2))
[1] 30
t

[1] 4.540772


qt(p = 1 - (0.001)/2, df = 200 - 2)
[1] 32
[1] 3.34034
M1 <- (lm(incidents ~ training + empathy + years, data = data))
[1] 33
summary(M1)
[1] 34

Call:
lm(formula = incidents ~ training + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.35648 -0.12270 -0.01474  0.10105  0.53180 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.665721   0.036551  18.214  < 2e-16 ***
trainingTraining -0.152427   0.023166  -6.580 4.20e-10 ***
empathy           0.025396   0.004735   5.363 2.29e-07 ***
years            -0.014085   0.003889  -3.622 0.000372 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1621 on 196 degrees of freedom
Multiple R-squared:  0.2565,	Adjusted R-squared:  0.2451 
F-statistic: 22.53 on 3 and 196 DF,  p-value: 1.408e-12

library(lm.beta, quietly = T)
[1] 35
 [1] "lm.beta"   "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
summary(lm.beta(M1))
[1] 36

Call:
lm(formula = incidents ~ training + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.35648 -0.12270 -0.01474  0.10105  0.53180 

Coefficients:
                  Estimate Standardized Std. Error t value Pr(>|t|)    
(Intercept)       0.665721     0.000000   0.036551  18.214  < 2e-16 ***
trainingTraining -0.152427    -0.409414   0.023166  -6.580 4.20e-10 ***
empathy           0.025396     0.345246   0.004735   5.363 2.29e-07 ***
years            -0.014085    -0.232381   0.003889  -3.622 0.000372 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1621 on 196 degrees of freedom
Multiple R-squared:  0.2565,	Adjusted R-squared:  0.2451 
F-statistic: 22.53 on 3 and 196 DF,  p-value: 1.408e-12

cooks <- cooks.distance(M1)
[1] 37
plot(M1, which = 4)
[1] 38
qqplot(M1$residuals, M1$fitted.values)
[1] 39
hist(M1$residuals, xlab = "Residual Terms", main = "Histogram of M1 Residuals")
[1] 40
shapiro.test(M1$residuals)
[1] 41

	Shapiro-Wilk normality test

data:  M1$residuals
W = 0.97994, p-value = 0.005838

summary(M1$residuals)
[1] 42
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-0.35648 -0.12270 -0.01474  0.00000  0.10105  0.53180 
summary(data$incidents)
[1] 43
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.08333 0.33333 0.41667 0.47500 0.58333 0.91667 
log.incidents <- log(data$incidents + (-1 * min(data$incidents) + 
    1))
[1] 44
summary(log.incidents)
[1] 45
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.2231  0.2877  0.3216  0.4055  0.6061 
M1fixed <- (lm(log.incidents ~ training + empathy + years, data = data))
[1] 46
qqplot(M1fixed$residuals, M1fixed$fitted.values)
[1] 47
hist(M1fixed$residuals, xlab = "Residual Terms", main = "Histogram of Residuals")
[1] 48
shapiro.test(M1fixed$residuals)
[1] 49

	Shapiro-Wilk normality test

data:  M1fixed$residuals
W = 0.9905, p-value = 0.2109

vif(M1fixed)
[1] 50
training  empathy    years 
1.020633 1.092467 1.085089 
crPlots(M1fixed)
[1] 51
durbinWatsonTest(M1fixed)
[1] 52
 lag Autocorrelation D-W Statistic p-value
   1       -0.116516      2.217742   0.146
 Alternative hypothesis: rho != 0
residualPlot(M1fixed)
[1] 53
scatterplot(M1fixed$residuals, M1fixed$fitted.values)
[1] 54
ncvTest(M1fixed)
[1] 55
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 1.036059, Df = 1, p = 0.30874
M1fixed <- (lm(log.incidents ~ data$training + data$empathy + 
    data$years))
[1] 56
summary(M1fixed)
[1] 57

Call:
lm(formula = log.incidents ~ data$training + data$empathy + data$years)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.27676 -0.08678 -0.00271  0.07438  0.35035 

Coefficients:
                       Estimate Std. Error t value Pr(>|t|)    
(Intercept)            0.460852   0.026028  17.706  < 2e-16 ***
data$trainingTraining -0.111288   0.016497  -6.746 1.67e-10 ***
data$empathy           0.018550   0.003372   5.501 1.17e-07 ***
data$years            -0.010283   0.002769  -3.713 0.000266 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1155 on 196 degrees of freedom
Multiple R-squared:  0.2661,	Adjusted R-squared:  0.2549 
F-statistic: 23.69 on 3 and 196 DF,  p-value: 3.963e-13

M2 <- lm(log.incidents ~ feedback + empathy + years + training, 
    data = data)
[1] 58
summary(M2)
[1] 59

Call:
lm(formula = log.incidents ~ feedback + empathy + years + training, 
    data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.234240 -0.070140  0.002096  0.068112  0.303086 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.419527   0.024494  17.128  < 2e-16 ***
feedbackFeedback  0.096771   0.014880   6.503 6.45e-10 ***
empathy           0.019849   0.003071   6.463 8.04e-10 ***
years            -0.011090   0.002520  -4.401 1.77e-05 ***
trainingTraining -0.112299   0.014994  -7.490 2.34e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1049 on 195 degrees of freedom
Multiple R-squared:  0.3969,	Adjusted R-squared:  0.3846 
F-statistic: 32.09 on 4 and 195 DF,  p-value: < 2.2e-16

vif(M2)
[1] 60
feedback  empathy    years training 
1.005320 1.097109 1.087722 1.020743 
crPlots(M2)
[1] 61
durbinWatsonTest(M2)
[1] 62
 lag Autocorrelation D-W Statistic p-value
   1      0.06913766      1.848087   0.272
 Alternative hypothesis: rho != 0
scatterplot(M2$residuals, M2$fitted.values, xlab = "M2 residuals", 
    ylab = "M2 fitted values")
[1] 63
ncvTest(M2)
[1] 64
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.4125777, Df = 1, p = 0.52066
qqplot(M2$residuals, M2$fitted.values)
[1] 65
shapiro.test(M2$residuals)
[1] 66

	Shapiro-Wilk normality test

data:  M2$residuals
W = 0.9947, p-value = 0.7054

summary(M2)
[1] 67

Call:
lm(formula = log.incidents ~ feedback + empathy + years + training, 
    data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.234240 -0.070140  0.002096  0.068112  0.303086 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.419527   0.024494  17.128  < 2e-16 ***
feedbackFeedback  0.096771   0.014880   6.503 6.45e-10 ***
empathy           0.019849   0.003071   6.463 8.04e-10 ***
years            -0.011090   0.002520  -4.401 1.77e-05 ***
trainingTraining -0.112299   0.014994  -7.490 2.34e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1049 on 195 degrees of freedom
Multiple R-squared:  0.3969,	Adjusted R-squared:  0.3846 
F-statistic: 32.09 on 4 and 195 DF,  p-value: < 2.2e-16

BIC(M1, M2)
[1] 68
   df       BIC
M1  5 -137.6738
M2  6 -307.4437
library(interactions, quietly = T)
[1] 69
 [1] "interactions" "lm.beta"      "car"          "carData"      "psych"        "readr"        "stats"        "graphics"    
 [9] "grDevices"    "utils"        "datasets"     "methods"      "base"        
M3 <- lm(log.incidents ~ training + feedback + empathy + years + 
    training * feedback, data = data)
[1] 70
summary(M3)
[1] 71

Call:
lm(formula = log.incidents ~ training + feedback + empathy + 
    years + training * feedback, data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.226383 -0.071808 -0.000811  0.069089  0.284822 

Coefficients:
                                   Estimate Std. Error t value Pr(>|t|)    
(Intercept)                        0.442504   0.025673  17.236  < 2e-16 ***
trainingTraining                  -0.151903   0.021123  -7.191 1.36e-11 ***
feedbackFeedback                   0.058376   0.020716   2.818  0.00533 ** 
empathy                            0.021048   0.003060   6.878 8.14e-11 ***
years                             -0.011505   0.002488  -4.625 6.84e-06 ***
trainingTraining:feedbackFeedback  0.077604   0.029583   2.623  0.00940 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1034 on 194 degrees of freedom
Multiple R-squared:  0.4176,	Adjusted R-squared:  0.4026 
F-statistic: 27.82 on 5 and 194 DF,  p-value: < 2.2e-16

vif(M3)
[1] 72
         training          feedback           empathy             years training:feedback 
         2.086826          2.007327          1.122147          1.092150          3.070068 
durbinWatsonTest(M3)
[1] 73
 lag Autocorrelation D-W Statistic p-value
   1      0.09726586      1.794988   0.174
 Alternative hypothesis: rho != 0
scatterplot(M3$residuals, M3$fitted.values)
[1] 74
ncvTest(M3)
[1] 75
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.577295, Df = 1, p = 0.44737
qqplot(M3$residuals, M3$fitted.values)
[1] 76
shapiro.test(M3$residuals)
[1] 77

	Shapiro-Wilk normality test

data:  M3$residuals
W = 0.99434, p-value = 0.6515

cat_plot(M3, pred = training, modx = feedback, plot.points = TRUE, 
    x.label = "Training", y.label = "Percentage of Intervention")
[1] 78
