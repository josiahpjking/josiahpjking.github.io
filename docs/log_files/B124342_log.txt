

	####### B124342 R script #######

rm(list = ls())
[1] 1
library(broom)
[1] 2
[1] "broom"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(readr, quietly = T)
[1] 3
[1] "broom"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 4
 [1] "psych"     "broom"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[10] "base"     
library(car, quietly = T)
[1] 5
 [1] "car"       "carData"   "psych"     "broom"     "readr"     "stats"     "graphics"  "grDevices" "utils"    
[10] "datasets"  "methods"   "base"     
library(ggpubr, quietly = T)
[1] 6
 [1] "ggpubr"    "magrittr"  "ggplot2"   "car"       "carData"   "psych"     "broom"     "readr"     "stats"    
[10] "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(mgcv, quietly = T)
[1] 7
 [1] "mgcv"      "nlme"      "ggpubr"    "magrittr"  "ggplot2"   "car"       "carData"   "psych"     "broom"    
[10] "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
BaseData <- read_csv("../RMS2_report_1920.csv")
[1] 8
BaseData$training_d <- BaseData$training - 1
[1] 9
BaseData$feedback_d <- BaseData$feedback - 1
[1] 10
BaseData$empathy_m <- BaseData$empathy - mean(BaseData$empathy)
[1] 11
BaseData$incidents_s <- BaseData$incidents * 100
[1] 12
describe(BaseData)
[1] 13
          vars   n   mean    sd median trimmed   mad  min    max  range skew kurtosis   se
subject      1 200 100.50 57.88 100.50  100.50 74.13 1.00 200.00 199.00 0.00    -1.22 4.09
incidents    2 200   0.48  0.19   0.42    0.47  0.12 0.08   0.92   0.83 0.32    -0.31 0.01
training     3 200   1.50  0.50   1.50    1.50  0.74 1.00   2.00   1.00 0.00    -2.01 0.04
 [ reached 'max' / getOption("max.print") -- omitted 7 rows ]
shapiro.test(BaseData$empathy_m)
[1] 14

	Shapiro-Wilk normality test

data:  BaseData$empathy_m
W = 0.97073, p-value = 0.0003477

ggplot(BaseData, aes(years, empathy_m)) + geom_point() + stat_smooth()
[1] 15
summary(m0 <- gam(empathy_m ~ s(years), data = BaseData))
[1] 16

Family: gaussian 
Link function: identity 

Formula:
empathy_m ~ s(years)

Parametric coefficients:
              Estimate Std. Error t value Pr(>|t|)
(Intercept) -8.086e-16  1.392e-01       0        1

Approximate significance of smooth terms:
           edf Ref.df     F p-value    
s(years) 3.631  4.538 28.01  <2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

R-sq.(adj) =  0.398   Deviance explained = 40.9%
GCV = 3.9665  Scale est. = 3.8747    n = 200
lm1 <- lm(empathy_m ~ years, data = BaseData)
[1] 17
crPlots(lm1)
[1] 18
ggscatter(BaseData, x = "years", y = "empathy_m", add = "reg.line", 
    conf.int = TRUE, cor.coef = TRUE, cor.method = "spearman")
[1] 19
cooksd <- cooks.distance(lm1)
[1] 20
sample_size <- nrow(BaseData)
[1] 21
plot(cooksd, pch = "*", main = "Influential Obs by Cooks distance")
[1] 22
abline(h = 4/(sample_size - 2), col = "red")
[1] 23
influential <- as.numeric(names(cooksd)[(cooksd > (4/(sample_size - 
    2)))])
[1] 24
noninf <- BaseData[-influential, ]
[1] 25
shapiro.test(noninf$empathy)
[1] 26

	Shapiro-Wilk normality test

data:  noninf$empathy
W = 0.97233, p-value = 0.0009492

shapiro.test(noninf$years)
[1] 27

	Shapiro-Wilk normality test

data:  noninf$years
W = 0.96818, p-value = 0.0003066

ggscatter(noninf, x = "years", y = "empathy_m", add = "reg.line", 
    conf.int = TRUE, cor.coef = TRUE, cor.method = "spearman")
[1] 28
ggplot(noninf, aes(years, empathy_m)) + geom_point() + stat_smooth()
[1] 29
lmx <- lm(empathy_m ~ years, data = noninf)
[1] 30
summary(lmx)
[1] 31

Call:
lm(formula = empathy_m ~ years, data = noninf)

Residuals:
   Min     1Q Median     3Q    Max 
-4.681 -1.378  0.008  1.307  5.532 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) -1.80527    0.49518  -3.646 0.000347 ***
years        0.26223    0.05804   4.518 1.11e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 2.064 on 184 degrees of freedom
Multiple R-squared:  0.09986,	Adjusted R-squared:  0.09497 
F-statistic: 20.41 on 1 and 184 DF,  p-value: 1.114e-05

crPlots(lmx)
[1] 32
pm1 <- lm(empathy_m ~ poly(years, 3), data = BaseData)
[1] 33
summary(pm1)
[1] 34

Call:
lm(formula = empathy_m ~ poly(years, 3), data = BaseData)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.4411 -1.2904  0.0682  1.1612  5.9942 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)     -6.872e-16  1.392e-01   0.000    1.000    
poly(years, 3)1  9.450e+00  1.968e+00   4.800 3.13e-06 ***
poly(years, 3)2 -2.069e+01  1.968e+00 -10.511  < 2e-16 ***
poly(years, 3)3  1.993e+00  1.968e+00   1.013    0.313    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.968 on 196 degrees of freedom
Multiple R-squared:  0.4071,	Adjusted R-squared:  0.398 
F-statistic: 44.85 on 3 and 196 DF,  p-value: < 2.2e-16

pm2 <- lm(empathy_m ~ poly(years, 2), data = BaseData)
[1] 35
summary(pm2)
[1] 36

Call:
lm(formula = empathy_m ~ poly(years, 2), data = BaseData)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.5069 -1.4011 -0.0835  1.1707  6.0622 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)     -6.843e-16  1.392e-01    0.00        1    
poly(years, 2)1  9.450e+00  1.969e+00    4.80 3.13e-06 ***
poly(years, 2)2 -2.069e+01  1.969e+00  -10.51  < 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.969 on 197 degrees of freedom
Multiple R-squared:  0.404,	Adjusted R-squared:  0.3979 
F-statistic: 66.75 on 2 and 197 DF,  p-value: < 2.2e-16

shapiro.test(pm2$residuals)
[1] 37

	Shapiro-Wilk normality test

data:  pm2$residuals
W = 0.9941, p-value = 0.6155

ncvTest(pm2)
[1] 38
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.5107658, Df = 1, p = 0.47481
crPlots(pm2)
[1] 39
dwt(pm2)
[1] 40
 lag Autocorrelation D-W Statistic p-value
   1      0.01288905      1.973855   0.804
 Alternative hypothesis: rho != 0
lm2 <- lm(incidents_s ~ training_d + empathy_m + years, data = BaseData)
[1] 41
summary(lm2)
[1] 42

Call:
lm(formula = incidents_s ~ training_d + empathy_m + years, data = BaseData)

Residuals:
    Min      1Q  Median      3Q     Max 
-35.648 -12.270  -1.474  10.105  53.180 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  66.5721     3.6551  18.214  < 2e-16 ***
training_d  -15.2427     2.3166  -6.580 4.20e-10 ***
empathy_m     2.5396     0.4735   5.363 2.29e-07 ***
years        -1.4085     0.3889  -3.622 0.000372 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16.21 on 196 degrees of freedom
Multiple R-squared:  0.2565,	Adjusted R-squared:  0.2451 
F-statistic: 22.53 on 3 and 196 DF,  p-value: 1.408e-12

ncvTest(lm2)
[1] 43
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.0293323, Df = 1, p = 0.86401
crPlots(lm2)
[1] 44
dwt(lm2)
[1] 45
 lag Autocorrelation D-W Statistic p-value
   1      -0.1072849      2.199897   0.196
 Alternative hypothesis: rho != 0
vif(lm2)
[1] 46
training_d  empathy_m      years 
  1.020633   1.092467   1.085089 
lm3 <- lm(incidents_s ~ feedback_d + empathy_m + years, data = BaseData)
[1] 47
summary(lm3)
[1] 48

Call:
lm(formula = incidents_s ~ feedback_d + empathy_m + years, data = BaseData)

Residuals:
    Min      1Q  Median      3Q     Max 
-35.580 -11.148  -1.097  11.092  53.552 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  51.2093     3.5846  14.286  < 2e-16 ***
feedback_d   13.2132     2.3585   5.602 7.09e-08 ***
empathy_m     2.3187     0.4829   4.802 3.11e-06 ***
years        -1.2689     0.3975  -3.192  0.00165 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16.63 on 196 degrees of freedom
Multiple R-squared:  0.2175,	Adjusted R-squared:  0.2055 
F-statistic: 18.16 on 3 and 196 DF,  p-value: 1.933e-10

ncvTest(lm3)
[1] 49
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.01731234, Df = 1, p = 0.89532
crPlots(lm3)
[1] 50
dwt(lm3)
[1] 51
 lag Autocorrelation D-W Statistic p-value
   1       0.2738264      1.444081       0
 Alternative hypothesis: rho != 0
vif(lm3)
[1] 52
feedback_d  empathy_m      years 
  1.005211   1.079397   1.077467 
lm4 <- lm(incidents_s ~ feedback_d + training_d + empathy_m + 
    years, data = BaseData)
[1] 53
summary(lm4)
[1] 54

Call:
lm(formula = incidents_s ~ feedback_d + training_d + empathy_m + 
    years, data = BaseData)

Residuals:
    Min      1Q  Median      3Q     Max 
-31.626 -10.096  -0.949   9.165  46.650 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  60.8620     3.4515  17.634  < 2e-16 ***
feedback_d   13.3715     2.0968   6.377 1.28e-09 ***
training_d  -15.3824     2.1128  -7.281 7.98e-12 ***
empathy_m     2.7191     0.4328   6.283 2.12e-09 ***
years        -1.5199     0.3551  -4.281 2.92e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.79 on 195 degrees of freedom
Multiple R-squared:  0.3848,	Adjusted R-squared:  0.3721 
F-statistic: 30.49 on 4 and 195 DF,  p-value: < 2.2e-16

ncvTest(lm4)
[1] 55
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 3.684027, Df = 1, p = 0.054936
crPlots(lm4)
[1] 56
dwt(lm4)
[1] 57
 lag Autocorrelation D-W Statistic p-value
   1      0.07303546      1.841386   0.266
 Alternative hypothesis: rho != 0
vif(lm4)
[1] 58
feedback_d training_d  empathy_m      years 
  1.005320   1.020743   1.097109   1.087722 
lm5 <- lm(incidents_s ~ feedback_d + training_d + empathy_m + 
    years + feedback_d:training_d, data = BaseData)
[1] 59
summary(lm5)
[1] 60

Call:
lm(formula = incidents_s ~ feedback_d + training_d + empathy_m + 
    years + feedback_d:training_d, data = BaseData)

Residuals:
    Min      1Q  Median      3Q     Max 
-30.367 -10.365  -0.795   8.806  44.359 

Coefficients:
                      Estimate Std. Error t value Pr(>|t|)    
(Intercept)            63.7438     3.6309  17.556  < 2e-16 ***
feedback_d              8.5558     2.9299   2.920  0.00391 ** 
training_d            -20.3496     2.9874  -6.812 1.18e-10 ***
empathy_m               2.8695     0.4328   6.630 3.25e-10 ***
years                  -1.5720     0.3518  -4.468 1.34e-05 ***
feedback_d:training_d   9.7334     4.1840   2.326  0.02103 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.62 on 194 degrees of freedom
Multiple R-squared:  0.4015,	Adjusted R-squared:  0.386 
F-statistic: 26.02 on 5 and 194 DF,  p-value: < 2.2e-16

ncvTest(lm5)
[1] 61
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 4.398557, Df = 1, p = 0.035969
w <- 1/lm(abs(lm5$residuals) ~ lm5$fitted.values)$fitted.values^2
[1] 62
lm5 <- lm(incidents_s ~ feedback_d + training_d + empathy_m + 
    years + feedback_d:training_d, data = BaseData, weights = w)
[1] 63
dwt(lm5)
[1] 64
 lag Autocorrelation D-W Statistic p-value
   1      0.09230733      1.805249   0.192
 Alternative hypothesis: rho != 0
vif(lm5)
[1] 65
           feedback_d            training_d             empathy_m                 years feedback_d:training_d 
             2.288302              1.875862              1.101294              1.082240              3.063917 
ncvTest(lm5)
[1] 66
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.2010084, Df = 1, p = 0.65391
glance(lm0)
[1] 67
[1] "Error in glance(lm0) : object 'lm0' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in glance(lm0): object 'lm0' not found>


####################################################################################################

[1] "Error in glance(lm0) : object 'lm0' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in glance(lm0): object 'lm0' not found>
####################################################################################################


glance(lm2)
[1] 68
# A tibble: 1 x 11
  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual
      <dbl>         <dbl> <dbl>     <dbl>    <dbl> <int>  <dbl> <dbl> <dbl>    <dbl>       <int>
1     0.256         0.245  16.2      22.5 1.41e-12     4  -839. 1688. 1704.   51532.         196
glance(lm3)
[1] 69
# A tibble: 1 x 11
  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual
      <dbl>         <dbl> <dbl>     <dbl>    <dbl> <int>  <dbl> <dbl> <dbl>    <dbl>       <int>
1     0.218         0.206  16.6      18.2 1.93e-10     4  -844. 1698. 1715.   54230.         196
glance(lm4)
[1] 70
# A tibble: 1 x 11
  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual
      <dbl>         <dbl> <dbl>     <dbl>    <dbl> <int>  <dbl> <dbl> <dbl>    <dbl>       <int>
1     0.385         0.372  14.8      30.5 1.04e-19     5  -820. 1652. 1672.   42639.         195
glance(lm5)
[1] 71
# A tibble: 1 x 11
  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance df.residual
      <dbl>         <dbl> <dbl>     <dbl>    <dbl> <int>  <dbl> <dbl> <dbl>    <dbl>       <int>
1     0.439         0.424  1.26      30.3 9.87e-23     6  -814. 1642. 1665.     308.         194
