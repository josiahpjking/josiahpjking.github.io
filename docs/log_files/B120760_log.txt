

	####### B120760 R script #######

install.packages("car")
[1] 1
install.packages("lm.beta")
[1] 2
library(car, quietly = T)
[1] 3
 [1] "car"       "carData"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[10] "base"     
library(psych, quietly = T)
[1] 4
 [1] "psych"     "car"       "carData"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[10] "methods"   "base"     
setwd("~/Desktop/Year 3/RMS 2/RMS 2 report")
[1] 5
data <- read.csv("../RMS2_report_1920.csv", header = T)
[1] 6
describe(data)
[1] 7
          vars   n   mean    sd median trimmed   mad  min    max  range skew kurtosis   se
subject      1 200 100.50 57.88 100.50  100.50 74.13 1.00 200.00 199.00 0.00    -1.22 4.09
incidents    2 200   0.48  0.19   0.42    0.47  0.12 0.08   0.92   0.83 0.32    -0.31 0.01
training     3 200   1.50  0.50   1.50    1.50  0.74 1.00   2.00   1.00 0.00    -2.01 0.04
 [ reached 'max' / getOption("max.print") -- omitted 3 rows ]
data$training <- as.factor(data$training)
[1] 8
data$training <- factor(data$training, labels = c("no training", 
    "training"))
[1] 9
summary(data$training)
[1] 10
no training    training 
        100         100 
data$feedback <- as.factor(data$feedback)
[1] 11
data$feedback <- factor(data$feedback, labels = c("no feedback", 
    "feedback"))
[1] 12
data$feedback
[1] 13
 [1] feedback    no feedback feedback    no feedback feedback    no feedback feedback    no feedback feedback   
[10] no feedback feedback    no feedback feedback    no feedback feedback    no feedback feedback    no feedback
[19] feedback    no feedback feedback    no feedback feedback    no feedback feedback    no feedback feedback   
[28] no feedback feedback    no feedback feedback    no feedback feedback    no feedback feedback    no feedback
[37] feedback    no feedback feedback    no feedback feedback    no feedback feedback    no feedback feedback   
[46] no feedback feedback    no feedback feedback    no feedback
 [ reached getOption("max.print") -- omitted 150 entries ]
Levels: no feedback feedback
summary(data$feedback)
[1] 14
no feedback    feedback 
        100         100 
plot(data$years, data$empathy, main = "Scatterplot for Q1", xlab = "Years", 
    ylab = "Empathy", pch = 16)
[1] 15
plot(data$training, data$incidents, main = "Boxplot for Q2", 
    xlab = "Training", ylab = "Percentage of incidents with intervention by teachers")
[1] 16
plot(data$feedback, data$incidents, main = "Boxplot for Q3", 
    xlab = "Feedback", ylab = "Percentage of incidents with intervention by teachers")
[1] 17
M1 <- lm(empathy ~ years, data = data)
[1] 18
summary(M1)
[1] 19

Call:
lm(formula = empathy ~ years, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.5399 -1.5160  0.0708  1.6357  5.8533 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  8.40625    0.49085  17.126  < 2e-16 ***
years        0.21756    0.05648   3.852 0.000158 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 2.453 on 198 degrees of freedom
Multiple R-squared:  0.06972,	Adjusted R-squared:  0.06502 
F-statistic: 14.84 on 1 and 198 DF,  p-value: 0.0001582

library(lm.beta, quietly = T)
[1] 20
 [1] "lm.beta"   "psych"     "car"       "carData"   "readr"     "stats"     "graphics"  "grDevices" "utils"    
[10] "datasets"  "methods"   "base"     
M1_stan <- lm.beta(M1)
[1] 21
summary(M1_stan)
[1] 22

Call:
lm(formula = empathy ~ years, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.5399 -1.5160  0.0708  1.6357  5.8533 

Coefficients:
            Estimate Standardized Std. Error t value Pr(>|t|)    
(Intercept)  8.40625      0.00000    0.49085  17.126  < 2e-16 ***
years        0.21756      0.26404    0.05648   3.852 0.000158 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 2.453 on 198 degrees of freedom
Multiple R-squared:  0.06972,	Adjusted R-squared:  0.06502 
F-statistic: 14.84 on 1 and 198 DF,  p-value: 0.0001582

cooks <- cooks.distance(M1)
[1] 23
names(which(cooks > (4/(200 - 1 - 1))))
[1] 24
 [1] "16"  "61"  "88"  "89"  "94"  "108" "137" "141" "154" "163" "171" "175" "192" "200"
plot(M1, which = 4)
[1] 25
M1a <- lm(empathy ~ years, data = data[-c(88, 137, 154)])
[1] 26
summary(lm.beta(M1a))
[1] 27

Call:
lm(formula = empathy ~ years, data = data[-c(88, 137, 154)])

Residuals:
    Min      1Q  Median      3Q     Max 
-7.5399 -1.5160  0.0708  1.6357  5.8533 

Coefficients:
            Estimate Standardized Std. Error t value Pr(>|t|)    
(Intercept)  8.40625      0.00000    0.49085  17.126  < 2e-16 ***
years        0.21756      0.26404    0.05648   3.852 0.000158 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 2.453 on 198 degrees of freedom
Multiple R-squared:  0.06972,	Adjusted R-squared:  0.06502 
F-statistic: 14.84 on 1 and 198 DF,  p-value: 0.0001582

qqPlot(M1_stan, main = "QQ Plot for Q1", xlab = "Theoretical quantiles", 
    ylab = "Sample quantiles")
[1] 28
hist(M1_stan$residuals, main = "Histogram of M1 residuals")
[1] 29
shapiro.test(M1_stan$residuals)
[1] 30

	Shapiro-Wilk normality test

data:  M1_stan$residuals
W = 0.98911, p-value = 0.1321

residualPlots(M1_stan)
[1] 31
ncvTest(M1_stan)
[1] 32
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.9815033, Df = 1, p = 0.32183
crPlots(M1_stan)
[1] 33
durbinWatsonTest(M1_stan)
[1] 34
 lag Autocorrelation D-W Statistic p-value
   1       0.1017162      1.769879    0.12
 Alternative hypothesis: rho != 0
M1b <- lm(empathy ~ years + I(years^2), data = data)
[1] 35
crPlots(M1b)
[1] 36
qqPlot(M1b, main = "QQ Plot for Q1", xlab = "Theoretical quantiles", 
    ylab = "Sample quantiles")
[1] 37
hist(M1b$residuals, main = "Histogram of M1 residuals")
[1] 38
shapiro.test(M1b$residuals)
[1] 39

	Shapiro-Wilk normality test

data:  M1b$residuals
W = 0.9941, p-value = 0.6155

residualPlots(M1b)
[1] 40
ncvTest(M1b)
[1] 41
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.5107658, Df = 1, p = 0.47481
durbinWatsonTest(M1b)
[1] 42
 lag Autocorrelation D-W Statistic p-value
   1      0.01288905      1.973855   0.884
 Alternative hypothesis: rho != 0
summary(M1b)
[1] 43

Call:
lm(formula = empathy ~ years + I(years^2), data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.5069 -1.4011 -0.0835  1.1707  6.0622 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.186356   0.791848   1.498    0.136    
years        2.068508   0.181845  11.375   <2e-16 ***
I(years^2)  -0.103645   0.009861 -10.510   <2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.969 on 197 degrees of freedom
Multiple R-squared:  0.404,	Adjusted R-squared:  0.3979 
F-statistic: 66.75 on 2 and 197 DF,  p-value: < 2.2e-16

M2 <- lm(incidents ~ training + empathy + years, data = data)
[1] 44
summary(M2)
[1] 45

Call:
lm(formula = incidents ~ training + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.35648 -0.12270 -0.01474  0.10105  0.53180 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.407320   0.051814   7.861 2.48e-13 ***
trainingtraining -0.152427   0.023166  -6.580 4.20e-10 ***
empathy           0.025396   0.004735   5.363 2.29e-07 ***
years            -0.014085   0.003889  -3.622 0.000372 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1621 on 196 degrees of freedom
Multiple R-squared:  0.2565,	Adjusted R-squared:  0.2451 
F-statistic: 22.53 on 3 and 196 DF,  p-value: 1.408e-12

qqPlot(M2, main = "QQ Plot for Q2", xlab = "Theoretical quantiles", 
    ylab = "Sample quantiles")
[1] 46
hist(M2$residuals, main = "Histogram of M2 residuals")
[1] 47
shapiro.test(M2$residuals)
[1] 48

	Shapiro-Wilk normality test

data:  M2$residuals
W = 0.97994, p-value = 0.005838

residualPlots(M2)
[1] 49
ncvTest(M2)
[1] 50
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.0293323, Df = 1, p = 0.86401
crPlots(M2)
[1] 51
durbinWatsonTest(M2)
[1] 52
 lag Autocorrelation D-W Statistic p-value
   1      -0.1072849      2.199897   0.186
 Alternative hypothesis: rho != 0
vif(M2)
[1] 53
training  empathy    years 
1.020633 1.092467 1.085089 
Q2_data <- subset(data, select = c("empathy", "years", "training", 
    "incidents"))
[1] 54
Q2_data$incidents <- logb(Q2_data$incidents)
[1] 55
describe(Q2_data)
[1] 56
          vars   n  mean   sd median trimmed  mad min max range  skew kurtosis   se
empathy      1 200 10.18 2.54   10.0   10.24 2.97   3  16    13 -0.37     0.23 0.18
years        2 200  8.13 3.08    8.0    7.97 2.97   1  19    18  0.52     0.48 0.22
training*    3 200  1.50 0.50    1.5    1.50 0.74   1   2     1  0.00    -2.01 0.04
 [ reached 'max' / getOption("max.print") -- omitted 1 rows ]
M2a <- lm(incidents ~ training + empathy + years, data = Q2_data)
[1] 57
summary(M2a)
[1] 58

Call:
lm(formula = incidents ~ training + empathy + years, data = Q2_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.23509 -0.23391  0.04258  0.25072  0.97572 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)      -1.004980   0.124409  -8.078 6.59e-14 ***
trainingtraining -0.386312   0.055624  -6.945 5.43e-11 ***
empathy           0.065246   0.011370   5.738 3.59e-08 ***
years            -0.036951   0.009337  -3.957 0.000106 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3893 on 196 degrees of freedom
Multiple R-squared:  0.2809,	Adjusted R-squared:  0.2699 
F-statistic: 25.52 on 3 and 196 DF,  p-value: 5.564e-14

crPlots(M2a)
[1] 59
qqPlot(M2a, main = "QQ Plot for Q2", xlab = "Theoretical quantiles", 
    ylab = "Sample quantiles")
[1] 60
hist(M2a$residuals, main = "Histogram of M2 residuals")
[1] 61
shapiro.test(M2a$residuals)
[1] 62

	Shapiro-Wilk normality test

data:  M2a$residuals
W = 0.98378, p-value = 0.02105

residualPlots(M2a)
[1] 63
ncvTest(M2a)
[1] 64
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 24.55162, Df = 1, p = 7.2345e-07
durbinWatsonTest(M2a)
[1] 65
 lag Autocorrelation D-W Statistic p-value
   1      -0.1326562      2.250839   0.106
 Alternative hypothesis: rho != 0
vif(M2a)
[1] 66
training  empathy    years 
1.020633 1.092467 1.085089 
cooks <- cooks.distance(M2)
[1] 67
names(which(cooks > (4/(200 - 3 - 1))))
[1] 68
[1] "13"  "35"  "74"  "137" "165"
plot(M1, which = 4)
[1] 69
M2b <- lm(incidents ~ training + empathy + years, data = Q2_data[-c(88, 
    137, 154)])
[1] 70
summary(M2b)
[1] 71

Call:
lm(formula = incidents ~ training + empathy + years, data = Q2_data[-c(88, 
    137, 154)])

Residuals:
     Min       1Q   Median       3Q      Max 
-1.23509 -0.23391  0.04258  0.25072  0.97572 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)      -1.004980   0.124409  -8.078 6.59e-14 ***
trainingtraining -0.386312   0.055624  -6.945 5.43e-11 ***
empathy           0.065246   0.011370   5.738 3.59e-08 ***
years            -0.036951   0.009337  -3.957 0.000106 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3893 on 196 degrees of freedom
Multiple R-squared:  0.2809,	Adjusted R-squared:  0.2699 
F-statistic: 25.52 on 3 and 196 DF,  p-value: 5.564e-14

M3 <- lm(incidents ~ feedback + empathy + years, data = data)
[1] 72
summary(M3)
[1] 73

Call:
lm(formula = incidents ~ feedback + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.35580 -0.11148 -0.01097  0.11092  0.53552 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.276161   0.054108   5.104 7.84e-07 ***
feedbackfeedback  0.132132   0.023585   5.602 7.09e-08 ***
empathy           0.023187   0.004829   4.802 3.11e-06 ***
years            -0.012689   0.003975  -3.192  0.00165 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1663 on 196 degrees of freedom
Multiple R-squared:  0.2175,	Adjusted R-squared:  0.2055 
F-statistic: 18.16 on 3 and 196 DF,  p-value: 1.933e-10

qqPlot(M3, main = "QQ Plot for Q3", xlab = "Theoretical quantiles", 
    ylab = "Sample quantiles")
[1] 74
hist(M3$residuals, main = "Histogram of M2 residuals")
[1] 75
shapiro.test(M3$residuals)
[1] 76

	Shapiro-Wilk normality test

data:  M3$residuals
W = 0.98772, p-value = 0.08174

residualPlots(M3)
[1] 77
ncvTest(M3)
[1] 78
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.01731234, Df = 1, p = 0.89532
crPlots(M3)
[1] 79
durbinWatsonTest(M3)
[1] 80
 lag Autocorrelation D-W Statistic p-value
   1       0.2738264      1.444081   0.004
 Alternative hypothesis: rho != 0
vif(M3)
[1] 81
feedback  empathy    years 
1.005211 1.079397 1.077467 
summary(M2a)
[1] 82

Call:
lm(formula = incidents ~ training + empathy + years, data = Q2_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.23509 -0.23391  0.04258  0.25072  0.97572 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)      -1.004980   0.124409  -8.078 6.59e-14 ***
trainingtraining -0.386312   0.055624  -6.945 5.43e-11 ***
empathy           0.065246   0.011370   5.738 3.59e-08 ***
years            -0.036951   0.009337  -3.957 0.000106 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3893 on 196 degrees of freedom
Multiple R-squared:  0.2809,	Adjusted R-squared:  0.2699 
F-statistic: 25.52 on 3 and 196 DF,  p-value: 5.564e-14

summary(M3)
[1] 83

Call:
lm(formula = incidents ~ feedback + empathy + years, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.35580 -0.11148 -0.01097  0.11092  0.53552 

Coefficients:
                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.276161   0.054108   5.104 7.84e-07 ***
feedbackfeedback  0.132132   0.023585   5.602 7.09e-08 ***
empathy           0.023187   0.004829   4.802 3.11e-06 ***
years            -0.012689   0.003975  -3.192  0.00165 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1663 on 196 degrees of freedom
Multiple R-squared:  0.2175,	Adjusted R-squared:  0.2055 
F-statistic: 18.16 on 3 and 196 DF,  p-value: 1.933e-10

contrasts(data$training)
[1] 84
            training
no training        0
training           1
contrasts(data$feedback)
[1] 85
            feedback
no feedback        0
feedback           1
M5 <- lm(incidents ~ training + feedback + training * feedback, 
    data = data)
[1] 86
summary(M5)
[1] 87

Call:
lm(formula = incidents ~ training + feedback + training * feedback, 
    data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.40000 -0.10500  0.00000  0.08333  0.43333 

Coefficients:
                                  Estimate Std. Error t value Pr(>|t|)    
(Intercept)                        0.49333    0.02314  21.323  < 2e-16 ***
trainingtraining                  -0.16000    0.03272  -4.890 2.09e-06 ***
feedbackfeedback                   0.09667    0.03272   2.954  0.00352 ** 
trainingtraining:feedbackfeedback  0.05333    0.04627   1.153  0.25047    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1636 on 196 degrees of freedom
Multiple R-squared:  0.2431,	Adjusted R-squared:  0.2315 
F-statistic: 20.99 on 3 and 196 DF,  p-value: 7.827e-12

qqPlot(M5, main = "QQ Plot for Q5", xlab = "Theoretical quantiles", 
    ylab = "Sample quantiles")
[1] 88
hist(M5$residuals, main = "Histogram of M5 residuals")
[1] 89
shapiro.test(M5$residuals)
[1] 90

	Shapiro-Wilk normality test

data:  M5$residuals
W = 0.9767, p-value = 0.002072

ncvTest(M5)
[1] 91
Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 1.881673, Df = 1, p = 0.17014
durbinWatsonTest(M5)
[1] 92
 lag Autocorrelation D-W Statistic p-value
   1       0.1114255      1.770733   0.104
 Alternative hypothesis: rho != 0
vif(M5)
[1] 93
         training          feedback training:feedback 
                2                 2                 3 
