<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JK, BM">

<title>dg_paper</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="dg_paper_files/libs/clipboard/clipboard.min.js"></script>
<script src="dg_paper_files/libs/quarto-html/quarto.js"></script>
<script src="dg_paper_files/libs/quarto-html/popper.min.js"></script>
<script src="dg_paper_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="dg_paper_files/libs/quarto-html/anchor.min.js"></script>
<link href="dg_paper_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="dg_paper_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="dg_paper_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="dg_paper_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="dg_paper_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">dg_paper</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>JK, BM </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>Population rates are frequently in the news, and comparisons of rates — either across time or between populations — are often used to support introduction of policies or as evidence of policy successes (or failures). The comparison of two or more rates, however, do not always reflect actual differences in, e.g., prevalence or incidence of the event in question. Instead, rate differences may be directly or indirectly influenced by underlying differences in the populations’ characteristics.</p>
<p>For a simple motivating example, suppose that we have two populations — or rather, a population at two different timepoints — Scottish offenders in 2006, and Scottish offenders in 2016, and we are concerned with the prevalance of reconvictions. In 2006, 32.4% of offenders had a reconviction, and in 2016 that number was 27.2%:</p>
<div class="cell">
<div id="tbl-egc" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-egc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Two populations and their crude rates
</figcaption>
<div aria-describedby="tbl-egc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="odyfslzwaf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#odyfslzwaf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#odyfslzwaf thead, #odyfslzwaf tbody, #odyfslzwaf tfoot, #odyfslzwaf tr, #odyfslzwaf td, #odyfslzwaf th {
  border-style: none;
}

#odyfslzwaf p {
  margin: 0;
  padding: 0;
}

#odyfslzwaf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#odyfslzwaf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#odyfslzwaf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#odyfslzwaf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#odyfslzwaf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#odyfslzwaf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#odyfslzwaf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#odyfslzwaf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#odyfslzwaf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#odyfslzwaf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#odyfslzwaf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#odyfslzwaf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#odyfslzwaf .gt_spanner_row {
  border-bottom-style: hidden;
}

#odyfslzwaf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#odyfslzwaf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#odyfslzwaf .gt_from_md > :first-child {
  margin-top: 0;
}

#odyfslzwaf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#odyfslzwaf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#odyfslzwaf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#odyfslzwaf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#odyfslzwaf .gt_row_group_first td {
  border-top-width: 2px;
}

#odyfslzwaf .gt_row_group_first th {
  border-top-width: 2px;
}

#odyfslzwaf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#odyfslzwaf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#odyfslzwaf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#odyfslzwaf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#odyfslzwaf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#odyfslzwaf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#odyfslzwaf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#odyfslzwaf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#odyfslzwaf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#odyfslzwaf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#odyfslzwaf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#odyfslzwaf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#odyfslzwaf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#odyfslzwaf .gt_left {
  text-align: left;
}

#odyfslzwaf .gt_center {
  text-align: center;
}

#odyfslzwaf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#odyfslzwaf .gt_font_normal {
  font-weight: normal;
}

#odyfslzwaf .gt_font_bold {
  font-weight: bold;
}

#odyfslzwaf .gt_font_italic {
  font-style: italic;
}

#odyfslzwaf .gt_super {
  font-size: 65%;
}

#odyfslzwaf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#odyfslzwaf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#odyfslzwaf .gt_indent_1 {
  text-indent: 5px;
}

#odyfslzwaf .gt_indent_2 {
  text-indent: 10px;
}

#odyfslzwaf .gt_indent_3 {
  text-indent: 15px;
}

#odyfslzwaf .gt_indent_4 {
  text-indent: 20px;
}

#odyfslzwaf .gt_indent_5 {
  text-indent: 25px;
}

#odyfslzwaf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#odyfslzwaf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="year" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">year</th>
<th id="offenders" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">offenders</th>
<th id="reconvicted" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">reconvicted</th>
<th id="crude_rate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">crude_rate</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="year">2006</td>
<td class="gt_row gt_left" headers="offenders">53305</td>
<td class="gt_row gt_right" headers="reconvicted">17272</td>
<td class="gt_row gt_right" headers="crude_rate">0.324</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="year">2016</td>
<td class="gt_row gt_left" headers="offenders">40606</td>
<td class="gt_row gt_right" headers="reconvicted">11035</td>
<td class="gt_row gt_right" headers="crude_rate">0.272</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="year"></td>
<td class="gt_row gt_left" headers="offenders">difference</td>
<td class="gt_row gt_right" headers="reconvicted"></td>
<td class="gt_row gt_right" headers="crude_rate">0.052</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>However, these two populations may differ in their age distributions. To keep things simple, splitting the populations into those above/below 30 years old, we can see that the 2006 population is made up of proportionally a lot more younger offenders (for which reconvictions are more common):</p>
<div class="cell">
<div id="tbl-eg1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-eg1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Two populations and their age specific rates
</figcaption>
<div aria-describedby="tbl-eg1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="lpdcdcbwye" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lpdcdcbwye table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lpdcdcbwye thead, #lpdcdcbwye tbody, #lpdcdcbwye tfoot, #lpdcdcbwye tr, #lpdcdcbwye td, #lpdcdcbwye th {
  border-style: none;
}

#lpdcdcbwye p {
  margin: 0;
  padding: 0;
}

#lpdcdcbwye .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lpdcdcbwye .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lpdcdcbwye .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lpdcdcbwye .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lpdcdcbwye .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lpdcdcbwye .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lpdcdcbwye .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lpdcdcbwye .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lpdcdcbwye .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lpdcdcbwye .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lpdcdcbwye .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lpdcdcbwye .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lpdcdcbwye .gt_spanner_row {
  border-bottom-style: hidden;
}

#lpdcdcbwye .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lpdcdcbwye .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lpdcdcbwye .gt_from_md > :first-child {
  margin-top: 0;
}

#lpdcdcbwye .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lpdcdcbwye .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lpdcdcbwye .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lpdcdcbwye .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lpdcdcbwye .gt_row_group_first td {
  border-top-width: 2px;
}

#lpdcdcbwye .gt_row_group_first th {
  border-top-width: 2px;
}

#lpdcdcbwye .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lpdcdcbwye .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lpdcdcbwye .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lpdcdcbwye .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lpdcdcbwye .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lpdcdcbwye .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lpdcdcbwye .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lpdcdcbwye .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lpdcdcbwye .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lpdcdcbwye .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lpdcdcbwye .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lpdcdcbwye .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lpdcdcbwye .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lpdcdcbwye .gt_left {
  text-align: left;
}

#lpdcdcbwye .gt_center {
  text-align: center;
}

#lpdcdcbwye .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lpdcdcbwye .gt_font_normal {
  font-weight: normal;
}

#lpdcdcbwye .gt_font_bold {
  font-weight: bold;
}

#lpdcdcbwye .gt_font_italic {
  font-style: italic;
}

#lpdcdcbwye .gt_super {
  font-size: 65%;
}

#lpdcdcbwye .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lpdcdcbwye .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lpdcdcbwye .gt_indent_1 {
  text-indent: 5px;
}

#lpdcdcbwye .gt_indent_2 {
  text-indent: 10px;
}

#lpdcdcbwye .gt_indent_3 {
  text-indent: 15px;
}

#lpdcdcbwye .gt_indent_4 {
  text-indent: 20px;
}

#lpdcdcbwye .gt_indent_5 {
  text-indent: 25px;
}

#lpdcdcbwye .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#lpdcdcbwye div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Age" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Age</th>
<th id="offenders" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">offenders</th>
<th id="age_prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age_prop</th>
<th id="reconvicted" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">reconvicted</th>
<th id="prev" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">prev</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="5" id="2006" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">2006</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="2006  Age">under 30</td>
<td class="gt_row gt_right" headers="2006  offenders">31937</td>
<td class="gt_row gt_right" headers="2006  age_prop">0.599</td>
<td class="gt_row gt_right" headers="2006  reconvicted">11897</td>
<td class="gt_row gt_right" headers="2006  prev">0.373</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="2006  Age">over 30</td>
<td class="gt_row gt_right" headers="2006  offenders">21368</td>
<td class="gt_row gt_right" headers="2006  age_prop">0.401</td>
<td class="gt_row gt_right" headers="2006  reconvicted">5375</td>
<td class="gt_row gt_right" headers="2006  prev">0.252</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="5" id="2016" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">2016</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_left" headers="2016  Age">under 30</td>
<td class="gt_row gt_right" headers="2016  offenders">18159</td>
<td class="gt_row gt_right" headers="2016  age_prop">0.447</td>
<td class="gt_row gt_right" headers="2016  reconvicted">5466</td>
<td class="gt_row gt_right" headers="2016  prev">0.301</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="2016  Age">over 30</td>
<td class="gt_row gt_right" headers="2016  offenders">22447</td>
<td class="gt_row gt_right" headers="2016  age_prop">0.553</td>
<td class="gt_row gt_right" headers="2016  reconvicted">5569</td>
<td class="gt_row gt_right" headers="2016  prev">0.248</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>For social scientists, demographers, economists and those working in public health, two related methods — standardisation and decomposition — are frequently employed in order to separate out differences in rates from differences in the compositional factors that make up the populations (or that make up the calculation of the rate itself).</p>
<p>Standardisation and decomposition are broad terms to capture methods that attempt to answer two questions: What would the rate be if these populations were the same with respect to X? (standardisation), and how much of the difference in rates between two populations is due to the populations differing in X? (decomposition).</p>
<p>In the context of our example, we might ask what the rate of reconvictions would be in 2016 if the population had the same age distribution as 2006, or vice versa, or even what the rate of reconvictions would be in both years if the populations were the same (at the average) in age distributions. Similarly, we could ask how much of the crude difference in rates of <span class="math inline">\(0.324-0.272 = 0.052\)</span> is due to differences in the age distributions between the two populations. Note that these two tasks of standardisation and decomposition are implicitly linked — for example, if <em>all</em> of the difference is due to age-distribution differences (<a href="#tbl-stddec" class="quarto-xref">Table&nbsp;3</a>), then any “age-standardised rates” would be identical in both populations.</p>
<div class="cell">
<div id="tbl-stddec" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-stddec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: If the rates of reconvictions for each age-group were the same for both populations, differences in age-distributions can still lead to differences in crude rates
</figcaption>
<div aria-describedby="tbl-stddec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="efknflycnf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#efknflycnf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#efknflycnf thead, #efknflycnf tbody, #efknflycnf tfoot, #efknflycnf tr, #efknflycnf td, #efknflycnf th {
  border-style: none;
}

#efknflycnf p {
  margin: 0;
  padding: 0;
}

#efknflycnf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#efknflycnf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#efknflycnf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#efknflycnf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#efknflycnf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#efknflycnf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#efknflycnf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#efknflycnf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#efknflycnf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#efknflycnf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#efknflycnf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#efknflycnf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#efknflycnf .gt_spanner_row {
  border-bottom-style: hidden;
}

#efknflycnf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#efknflycnf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#efknflycnf .gt_from_md > :first-child {
  margin-top: 0;
}

#efknflycnf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#efknflycnf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#efknflycnf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#efknflycnf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#efknflycnf .gt_row_group_first td {
  border-top-width: 2px;
}

#efknflycnf .gt_row_group_first th {
  border-top-width: 2px;
}

#efknflycnf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#efknflycnf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#efknflycnf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#efknflycnf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#efknflycnf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#efknflycnf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#efknflycnf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#efknflycnf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#efknflycnf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#efknflycnf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#efknflycnf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#efknflycnf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#efknflycnf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#efknflycnf .gt_left {
  text-align: left;
}

#efknflycnf .gt_center {
  text-align: center;
}

#efknflycnf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#efknflycnf .gt_font_normal {
  font-weight: normal;
}

#efknflycnf .gt_font_bold {
  font-weight: bold;
}

#efknflycnf .gt_font_italic {
  font-style: italic;
}

#efknflycnf .gt_super {
  font-size: 65%;
}

#efknflycnf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#efknflycnf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#efknflycnf .gt_indent_1 {
  text-indent: 5px;
}

#efknflycnf .gt_indent_2 {
  text-indent: 10px;
}

#efknflycnf .gt_indent_3 {
  text-indent: 15px;
}

#efknflycnf .gt_indent_4 {
  text-indent: 20px;
}

#efknflycnf .gt_indent_5 {
  text-indent: 25px;
}

#efknflycnf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#efknflycnf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Age" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Age</th>
<th id="offenders" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">offenders</th>
<th id="age_prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age_prop</th>
<th id="reconvicted" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">reconvicted</th>
<th id="prev" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">prev</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="5" id="2006" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">2006</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="2006  Age">under 30</td>
<td class="gt_row gt_right" headers="2006  offenders">31937</td>
<td class="gt_row gt_right" headers="2006  age_prop">0.599</td>
<td class="gt_row gt_right" headers="2006  reconvicted">11897</td>
<td class="gt_row gt_right" headers="2006  prev">0.373</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="2006  Age">over 30</td>
<td class="gt_row gt_right" headers="2006  offenders">21368</td>
<td class="gt_row gt_right" headers="2006  age_prop">0.401</td>
<td class="gt_row gt_right" headers="2006  reconvicted">5375</td>
<td class="gt_row gt_right" headers="2006  prev">0.252</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="2006  Age">Total (Crude)</td>
<td class="gt_row gt_right" headers="2006  offenders">53305</td>
<td class="gt_row gt_right" headers="2006  age_prop">1.000</td>
<td class="gt_row gt_right" headers="2006  reconvicted">17272</td>
<td class="gt_row gt_right" headers="2006  prev">0.324</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="5" id="2016" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">2016</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="2016  Age">under 30</td>
<td class="gt_row gt_right" headers="2016  offenders">18159</td>
<td class="gt_row gt_right" headers="2016  age_prop">0.447</td>
<td class="gt_row gt_right" headers="2016  reconvicted">6764</td>
<td class="gt_row gt_right" headers="2016  prev">0.373</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="2016  Age">over 30</td>
<td class="gt_row gt_right" headers="2016  offenders">22447</td>
<td class="gt_row gt_right" headers="2016  age_prop">0.553</td>
<td class="gt_row gt_right" headers="2016  reconvicted">5646</td>
<td class="gt_row gt_right" headers="2016  prev">0.252</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="2016  Age">Total (Crude)</td>
<td class="gt_row gt_right" headers="2016  offenders">40606</td>
<td class="gt_row gt_right" headers="2016  age_prop">1.000</td>
<td class="gt_row gt_right" headers="2016  reconvicted">12410</td>
<td class="gt_row gt_right" headers="2016  prev">0.306</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="tbl-stddec2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-stddec2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: In the case that the two age distributions are equal, then none of the difference in crude rates can be attributable to age distribution differences
</figcaption>
<div aria-describedby="tbl-stddec2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="kzjhdayvlm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kzjhdayvlm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kzjhdayvlm thead, #kzjhdayvlm tbody, #kzjhdayvlm tfoot, #kzjhdayvlm tr, #kzjhdayvlm td, #kzjhdayvlm th {
  border-style: none;
}

#kzjhdayvlm p {
  margin: 0;
  padding: 0;
}

#kzjhdayvlm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kzjhdayvlm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kzjhdayvlm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kzjhdayvlm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kzjhdayvlm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kzjhdayvlm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kzjhdayvlm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kzjhdayvlm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kzjhdayvlm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kzjhdayvlm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kzjhdayvlm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kzjhdayvlm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kzjhdayvlm .gt_spanner_row {
  border-bottom-style: hidden;
}

#kzjhdayvlm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kzjhdayvlm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kzjhdayvlm .gt_from_md > :first-child {
  margin-top: 0;
}

#kzjhdayvlm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kzjhdayvlm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kzjhdayvlm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kzjhdayvlm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kzjhdayvlm .gt_row_group_first td {
  border-top-width: 2px;
}

#kzjhdayvlm .gt_row_group_first th {
  border-top-width: 2px;
}

#kzjhdayvlm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kzjhdayvlm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kzjhdayvlm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kzjhdayvlm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kzjhdayvlm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kzjhdayvlm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kzjhdayvlm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kzjhdayvlm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kzjhdayvlm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kzjhdayvlm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kzjhdayvlm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kzjhdayvlm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kzjhdayvlm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kzjhdayvlm .gt_left {
  text-align: left;
}

#kzjhdayvlm .gt_center {
  text-align: center;
}

#kzjhdayvlm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kzjhdayvlm .gt_font_normal {
  font-weight: normal;
}

#kzjhdayvlm .gt_font_bold {
  font-weight: bold;
}

#kzjhdayvlm .gt_font_italic {
  font-style: italic;
}

#kzjhdayvlm .gt_super {
  font-size: 65%;
}

#kzjhdayvlm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kzjhdayvlm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kzjhdayvlm .gt_indent_1 {
  text-indent: 5px;
}

#kzjhdayvlm .gt_indent_2 {
  text-indent: 10px;
}

#kzjhdayvlm .gt_indent_3 {
  text-indent: 15px;
}

#kzjhdayvlm .gt_indent_4 {
  text-indent: 20px;
}

#kzjhdayvlm .gt_indent_5 {
  text-indent: 25px;
}

#kzjhdayvlm .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kzjhdayvlm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Age" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Age</th>
<th id="offenders" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">offenders</th>
<th id="age_prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age_prop</th>
<th id="reconvicted" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">reconvicted</th>
<th id="prev" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">prev</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="5" id="2006" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">2006</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="2006  Age">under 30</td>
<td class="gt_row gt_right" headers="2006  offenders">31937</td>
<td class="gt_row gt_right" headers="2006  age_prop">0.599</td>
<td class="gt_row gt_right" headers="2006  reconvicted">11897</td>
<td class="gt_row gt_right" headers="2006  prev">0.373</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="2006  Age">over 30</td>
<td class="gt_row gt_right" headers="2006  offenders">21368</td>
<td class="gt_row gt_right" headers="2006  age_prop">0.401</td>
<td class="gt_row gt_right" headers="2006  reconvicted">5375</td>
<td class="gt_row gt_right" headers="2006  prev">0.252</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="2006  Age">Total (Crude)</td>
<td class="gt_row gt_right" headers="2006  offenders">53305</td>
<td class="gt_row gt_right" headers="2006  age_prop">1.000</td>
<td class="gt_row gt_right" headers="2006  reconvicted">17272</td>
<td class="gt_row gt_right" headers="2006  prev">0.324</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="5" id="2016" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">2016</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="2016  Age">under 30</td>
<td class="gt_row gt_right" headers="2016  offenders">18159</td>
<td class="gt_row gt_right" headers="2016  age_prop">0.599</td>
<td class="gt_row gt_right" headers="2016  reconvicted">5466</td>
<td class="gt_row gt_right" headers="2016  prev">0.301</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="2016  Age">over 30</td>
<td class="gt_row gt_right" headers="2016  offenders">12150</td>
<td class="gt_row gt_right" headers="2016  age_prop">0.401</td>
<td class="gt_row gt_right" headers="2016  reconvicted">3014</td>
<td class="gt_row gt_right" headers="2016  prev">0.248</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="2016  Age">Total (Crude)</td>
<td class="gt_row gt_right" headers="2016  offenders">30309</td>
<td class="gt_row gt_right" headers="2016  age_prop">1.000</td>
<td class="gt_row gt_right" headers="2016  reconvicted">8480</td>
<td class="gt_row gt_right" headers="2016  prev">0.280</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>There are two broad approaches to the task of decomposition, and these are largely determined by the type of data available. Regression based methods of decomposition use unit level data, regressing rates (or binary events) onto a set of explanatory factors, and then estimating the counterfactual had each unit been in the alternative population. One such regression based decomposition method is widely referred to as Oaxaca-Blinder decomposition <span class="citation" data-cites="Oaxaca1973-ef Blinder1973-ig">(<a href="#ref-Oaxaca1973-ef" role="doc-biblioref">R. Oaxaca 1973</a>; <a href="#ref-Blinder1973-ig" role="doc-biblioref">Blinder 1973</a>)</span>, but as a whole these techniques can more generally be achieved by following the logic of the excellent <strong>{{marginaleffects}}</strong> package workflow, in that aggregating unit-level observed and counterfactual outcomes up to the level of the two populations in different ways can provide the relevant average predictions (for standardised rates) and comparisons (for decomposition of the crude difference in the two rates).</p>
<p>The second approach to decomposition can be traced back to Kitagawa <span class="citation" data-cites="Kitagawa1955-sa">(<a href="#ref-Kitagawa1955-sa" role="doc-biblioref">1955</a>)</span>, who used population level data to separate differences between two rates into differences between population characteristics vs differences between rates of occurrence. The terms “Oaxaca-Blinder decomposition” and “Kitagawa decomposition” are often used interchangeably, and the confusion is perhaps understandable given that the two are equivalent in the special case of a binary outcome and a linear probability model. The difference here is that Kitagawa’s approach needs only population proportions, and not the individual unit level data. The equivalence in this special case is demonstrated in detail in Oaxaca <span class="citation" data-cites="Oaxaca2023-gt">(<a href="#ref-Oaxaca2023-gt" role="doc-biblioref">R. L. Oaxaca and Sierminska 2023</a>)</span>, and the idea is not dissimilar to how regression models can be estimated from the sample moments (i.e.&nbsp;how path tracing rules allow us to estimate regression models from covariance matrices alone).</p>
<p>In practice Kitagawa’s starting point is a population level table such as that in <a href="#tbl-eg1" class="quarto-xref">Table&nbsp;2</a>. The decomposition of the crude rates here is relatively straightforward in that it can be split into two parts: the proportions in each age-group, and the age-group-specific rates. In our example, this is just that the 2016 rate of <span class="math inline">\(0.272 = (0.301 \cdot 0.447) + (0.248 \cdot 0.553)\)</span>. We can write this more generally for an arbitrary number of sub-groups as:</p>
<p><span id="eq-rab"><span class="math display">\[
\begin{align}
r &amp;= \sum\limits_{i}a_ib_i \\
\text{where:}&amp; \\
a &amp;= \text{group specific rate} \\
b &amp;= \text{proportion of population in group} \\
\end{align}
\tag{1}\]</span></span></p>
<p>In this formulation, it is straightforward to compute “standardised rates” by calculating the rates <span class="math inline">\(\sum\limits_{i}a_ib_i\)</span> under different counterfactuals such as e.g., if the 2016 population had the same age distribution as 2006, giving <span class="math inline">\((0.301 \cdot 0.599) + (0.248 \cdot 0.401) = 0.280\)</span>, or where the age distribution was held at the average of the two populations (<a href="#eq-manage" class="quarto-xref">Equation&nbsp;3</a>).<br>
<span id="eq-manage1"><span class="math display">\[
\begin{align}
\text{age-standardised-}r^{2006} = \left( 0.373 \cdot \frac{0.599 + 0.447}{2} \right) + \left( 0.252 \cdot \frac{0.401 + 0.553}{2} \right) &amp;= 0.315 \\
\quad \\
\end{align}
\tag{2}\]</span></span> <span id="eq-manage"><span class="math display">\[
\begin{align}
\text{age-standardised-}r^{2016}  = \left( 0.301 \cdot \frac{0.599 + 0.447}{2} \right) + \left( 0.248 \cdot \frac{0.401 + 0.553}{2} \right) &amp;= 0.276 \\
\quad \\
\text{difference} &amp;= 0.039 \\
\end{align}
\tag{3}\]</span></span></p>
<p>Standardisation holding the compositional factors at their average allows us to consider the decomposition question: If the two populations had the same age distribution, how much would they differ in their rates? The difference between standardised rates (0.039), taken as a proportion of the difference between crude rates (0.052), this allows us to attribute 75% of the difference in crude rates as being due to differences in the group-specific rates in the populations (and their other stray causes), with 25% being explained by differences in the age distribution. We can similarly see this by substituting in the averages of the group-specific rates instead of the averages of the group proportions, for which we get <span class="math inline">\(0.302\)</span> and <span class="math inline">\(0.289\)</span>, and a difference of <span class="math inline">\(0.013\)</span> — 25% of the crude rate difference (<a href="#eq-manrate" class="quarto-xref">Equation&nbsp;5</a>).</p>
<p><span id="eq-manrate1"><span class="math display">\[
\begin{align}
\text{rate-standardised-}r_{2006} = \left( \frac{0.373 + 0.301}{2} \cdot 0.599 \right) + \left( \frac{0.252 + 0.248}{2} \cdot 0.401 \right) &amp;= 0.302 \\
\quad \\
\end{align}
\tag{4}\]</span></span> <span id="eq-manrate"><span class="math display">\[
\begin{align}
\text{rate-standardised-}r_{2016}  = \left( \frac{0.373 + 0.301}{2} \cdot 0.447 \right) + \left( \frac{0.252 + 0.248}{2} \cdot 0.553 \right) &amp;= 0.289 \\
\quad \\
\text{difference} &amp;= 0.013 \\
\end{align}
\tag{5}\]</span></span></p>
<p>We can express this method of standardisation and decomposition using letters to differentiate the compositional factors that make up the rate (age-group proportions, age-group specific rates) across each sub-population <span class="math inline">\(i\)</span>, with superscripts to distinguish these factors from each of two populations <span class="math inline">\(p\)</span> and <span class="math inline">\(p'\)</span>:</p>
<p><span id="eq-kgwstd1"><span class="math display">\[
\begin{align}
b\text{-standardised-}r^p &amp;= \sum\limits_{i}\frac{b^p_i+b^{p'}_i}{2} a^p_i \quad\quad\quad a\text{-standardised-}r^p = \sum\limits_{i}\frac{a^p_i+a^{p'}_i}{2} b^p_i \\
\end{align}
\tag{6}\]</span></span> <span id="eq-kgwstd"><span class="math display">\[
\begin{align}
b\text{-standardised-}r^{p'} &amp;= \sum\limits_{i}\frac{b^p_i+b^{p'}_i}{2} a^{p'}_i \quad\quad\quad a\text{-standardised-}r^{p'} = \sum\limits_{i}\frac{a^p_i+a^{p'}_i}{2} b^{p'}_i \\
\end{align}
\tag{7}\]</span></span></p>
<p><span id="eq-kgw"><span class="math display">\[
\Delta\text{crude-}r = \sum\limits_{i}\frac{b^p_i+b^{p'}_i}{2} (a^p_i-a^{p'}_i) + \sum\limits_{i}\frac{a^p_i+a^{p'}_i}{2} (b^p_i-b^{p'}_i)
\tag{8}\]</span></span></p>
<!-- $$ -->
<!-- \begin{align} -->
<!-- ab - AB &= \frac{b+B}{2} (a-A) + \frac{a+A}{2} (b-B) \\ -->
<!-- 2(ab - AB) &= (b+B) (a-A) + (a+A)(b-B) \\ -->
<!-- 0 &= (b+B) (a-A) + (a+A)(b-B) - 2(ab - AB) \\ -->
<!-- 0 &= ba-bA+Ba-BA + ba-Ba+bA-BA - 2(ab - AB) \\ -->
<!-- 0 &= 2ba-2BA - 2(ab - AB) \\ -->
<!-- 0 &= 0 \\ -->
<!-- \end{align} -->
<!-- $$ -->
<p>Note that the neatness of decomposing differences in crude rates into the sum of differences in standardised rates cannot be achieved when using one population as the standard because of the interaction between the factors. In <a href="#eq-p1s" class="quarto-xref">Equation&nbsp;9</a>, the first two terms represent the differences in <span class="math inline">\(b-\)</span> and <span class="math inline">\(a-\)</span>standardised rates using population <span class="math inline">\(p'\)</span> as the standard, but to equate this to the difference in crude rates requires the addition of the interaction term. In contrast, Kitagawa’s formulation in <a href="#eq-kgw" class="quarto-xref">Equation&nbsp;8</a> divides the interaction term equally between the two sets of standardised rates.</p>
<p><span id="eq-p1s"><span class="math display">\[
\Delta\text{crude-}r = \sum\limits_{i}b^{p'}_i(a^p_i-a^{p'}_i) \quad + \quad \sum\limits_{i}a^{p'}_i(b^p_i-b^{p'}_i) \quad + \quad \sum\limits_{i}(a^p_i-a^{p'}_i)(b^p_i-b^{p'}_i)
\tag{9}\]</span></span></p>
<p>When extended to greater numbers of compositional factors, algebraically manipulating differences in weighted averages becomes cumbersome as interaction terms proliferate. In a series of articles <span class="citation" data-cites="Das-Gupta1978-er Das-Gupta1989-no Das-Gupta1991-qu Das-Gupta1993-ie Das-Gupta1994-fl">(<a href="#ref-Das-Gupta1978-er" role="doc-biblioref">1978</a>, <a href="#ref-Das-Gupta1989-no" role="doc-biblioref">1989</a>, <a href="#ref-Das-Gupta1993-ie" role="doc-biblioref">1993</a>, <a href="#ref-Das-Gupta1994-fl" role="doc-biblioref">1994</a>; <a href="#ref-Das-Gupta1991-qu" role="doc-biblioref">1991</a>)</span>, Das Gupta extended Kitagawa’s work to a generalised form for any number of factors, and then followed this with standardisation across more than two populations. Das Gupta’s approach is essentially a combinatorics problem — to compute the rate were only one factor to differ between the two populations, the calculation of the rate is averaged over all possible counterfactuals (different combinations of other factors changing vs being held equal). These are weighted relative to the number of factors varied/held equal, meaning that their importance is lessened the farther the counterfactual is from an actual population.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Das Gupta’s general solution for the decomposition of two rates can be written as:</p>
<p><span id="eq-dg1"><span class="math display">\[
\Delta\text{crude-}r = \sum\limits_{\vec{\alpha} \in K}Q(\vec{\alpha}^p) - Q(\vec{\alpha}^{p'})
\tag{10}\]</span></span></p>
<p>Where <span class="math inline">\(K\)</span> is the set of factors <span class="math inline">\(\alpha, \beta, ..., \kappa\)</span>, which may take the form of vectors over sub-populations. <span class="math inline">\(Q(\vec{\alpha}^p)\)</span> denotes the rate in population <span class="math inline">\(p\)</span> holding <span class="math inline">\(K \setminus \{\alpha\}\)</span> (all factors other than <span class="math inline">\(\alpha\)</span>), standardised across populations <span class="math inline">\(p\)</span> and <span class="math inline">\(p'\)</span>. The total crude rate difference is the sum of all standardised rate differences, and the standardisation <span class="math inline">\(Q\)</span> is expressed as:</p>
<!-- $$ -->
<!-- Q(\vec{\alpha}) = \sum\limits^{|K|-1}_{j=1} \frac{ f({K \setminus \{\alpha\} \choose j-1}, \vec{\alpha}) } { |K| {|K|-1\choose j-1} } -->
<!-- $$ -->
<!-- $f({K \setminus \{\alpha\} \choose j-1}, \alpha)$ is the sum of, for all possible sets of $j-1$ factors from $K\setminus\{\alpha\}$, the rate function calculated with $j$ factors from population $0$ and the rest from population $1$.  -->
<!-- $$ -->
<!-- Q(\vec{\alpha}^p) = \sum\limits_{j=1}^{\begin{cases}  -->
<!-- |K|\,/\,2 & \text{if }|K|\text{ is even} \\ -->
<!-- (|K|-1)\,/\,2 & \text{if }|K|\text{ is odd} \ -->
<!-- \end{cases}} \frac{ \sum\limits_{L \in {K \setminus \{\alpha\} \choose j-1}}f(\{L^p,(K\setminus L)^{p'},\vec{\alpha}^p\}) + f(\{L^{p'},(K\setminus L)^p,\vec{\alpha}^p\})} { |K| {|K|-1\choose j-1} } -->
<!-- $$ -->
<!-- $$ -->
<!-- Q(\vec{\alpha}^p) = \sum\limits^{|K|-1}_{j=1} \frac{ \sum\limits_{L \in {K \setminus \{\alpha\} \choose j-1}}f(\{L^p,(K\setminus L)^{p'},\vec{\alpha}^p\}) + f(\{L^{p'},(K\setminus L)^p,\vec{\alpha}^p\})} { |K| {|K|-1\choose j-1} } -->
<!-- $$ -->
<p><span id="eq-dg2"><span class="math display">\[
Q(\vec{\alpha}^p) = \sum\limits_{j=1}^{\lceil \frac{|K|}{2} \rceil} \frac{ \sum\limits_{L \in {K \setminus \{\alpha\} \choose j-1}}f(\{L^p,(K\setminus L)^{p'},\vec{\alpha}^p\}) + f(\{L^{p'},(K\setminus L)^p,\vec{\alpha}^p\})} { |K| {|K|-1\choose j-1} }
\tag{11}\]</span></span></p>
<p>Where <span class="math inline">\(f(K)\)</span> is the function that defines the calculation of the rate (this could be the simple sum of products such as the reconvictions example above, or something arbitrarily complex that returns a single real value).</p>
<p>For example, when there are 5 factors, <span class="math inline">\(K = {a, b, c, d, e}\)</span>, and the rate is calculated as the simple product, then:</p>
<p><span class="math display">\[
\begin{align}
Q(a) =&amp; \frac{abcde + ab'c'd'e'}{5} + \\
&amp; \frac{abcde' + abcd'e + abc'de +ab'cde + ab'c'd'e + ab'c'de' + ab'cd'e' +abc'd'e'}{20} + \\
&amp; \frac{abcd'e' + abc'de' + abc'd'e + ab'c'de + ab'cd'e + ab'cde'}{30}\\
\end{align}
\]</span></p>
<!-- For example, when there are 3 factors, $K = {a, b, c}$, and the rate is calculated as the simple product:   -->
<!-- $$ -->
<!-- \begin{align} -->
<!-- \Delta\text{crude-}r =&  \left( \frac{bc+b'c'}{3} + \frac{bc'+b'c}{6} \right) (a-a') \quad + \\ -->
<!-- & \quad \left( \frac{ac+a'c'}{3} + \frac{ac'+a'c}{6} \right) (b-b') \quad + \\ -->
<!-- & \quad \left( \frac{ab+a'b'}{3} + \frac{ab'+a'b}{6} \right) (c-c') -->
<!-- \end{align} -->
<!-- $$ -->
<p>As with how Kitagawa approached the scenario with two compositional factors, Das Gupta’s method distributed interactions equally across all factors, meaning that standardised rates and decompositions equate to average treatment effects at the level of populations. Where <span class="math inline">\(Y\)</span> is a binary outcome, and <span class="math inline">\(P\)</span> the binary population indicator (note we switch from <span class="math inline">\(p\)</span> and <span class="math inline">\(p'\)</span> to using <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> in line with the conventional counterfactual notation), using <span class="math inline">\(Y^0\)</span> to denote the random variable of outcomes under population <span class="math inline">\(0\)</span>, and <span class="math inline">\(Y^1\)</span> as the outcomes under population <span class="math inline">\(1\)</span>, we can express crude rates as the expected value of observed outcomes for each population, and the crude rate difference can be written as the straightforward contrast :</p>
<p><span id="eq-cf1"><span class="math display">\[
\Delta\text{crude-}r = \mathbb{E}[Y^1|P=1] - \mathbb{E}[Y^0|P=0]
\tag{12}\]</span></span></p>
<p>Das Gupta’s methodology estimates, for instance, what the population level rates would be if every factor included in the decomposition was held equal (thereby isolating the differences due to rates rather than population characteristics). The term “held equal” here is, crucially, averaged across the two populations, meaning it is invariant to differences in size between the two populations, and equates to the counterfactual statement in <a href="#eq-cf_pmrate" class="quarto-xref">Equation&nbsp;13</a>. Similarly, we could consider how the rates would differ if the probability of the rate event were equal in the two populations but they differed in their compositional structure (<a href="#eq-cf_pmall" class="quarto-xref">Equation&nbsp;14</a>). In the case of the two factor decomposition, the statements in <a href="#eq-cf_pmrate" class="quarto-xref">Equation&nbsp;13</a> and <a href="#eq-cf_pmall" class="quarto-xref">Equation&nbsp;14</a>, when estimated from individual-level data correspond to the standardised rates as would be calculated from <a href="#eq-manrate" class="quarto-xref">Equation&nbsp;5</a> and <a href="#eq-manage" class="quarto-xref">Equation&nbsp;3</a> on population level proportions (see supplementary for demonstration in R). When more factors are included in the decomposition, this second is broken down further to counterfactual statements of the expected rates were the populations to differ in each factor separately, while holding all others equal.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p><span id="eq-cf_pmrate"><span class="math display">\[
\mathbb{E} [ \mathbb{E}[Y^1|P=0], \mathbb{E}[Y^1|P=1] ] - \mathbb{E} [ \mathbb{E}[Y^0|P=0], \mathbb{E}[Y^0|P=1] ]
\tag{13}\]</span></span> <span id="eq-cf_pmall"><span class="math display">\[
\mathbb{E} [ \mathbb{E}[Y^0|P=1], \mathbb{E}[Y^1|P=1] ] - \mathbb{E} [ \mathbb{E}[Y^0|P=0], \mathbb{E}[Y^1|P=0] ]
\tag{14}\]</span></span></p>
<!-- $$ -->
<!-- \Delta \text{crude-}r = \mathbb{E} [R^1|P=1] -  \mathbb{E} [R^0|P=0] \\ -->
<!-- \Delta \text{P-rate-standardised-}r = \mathbb{E} [R^1 - R^0] \\ -->
<!-- \Delta \text{P-a-standardised-}r = \mathbb{E} [R^1 - R^0] \\ -->
<!-- $$ -->
<p>While the regression based approach to decomposition brings with it a lot of the flexibility of regression modelling in general, the drawback of the Kitagawa/Das Gupta approach to decomposition is also its clear benefit — while the decomposition (being algebraic) is restricted to fully cross-classified data (i.e., specifying sub-population rates for the full joint distribution of all variables, with no missing values), all that is needed is the aggregated data (which is often all that researchers can get from various official statistics). Furthermore, the arbitrary complexity of the rate function in Das Gupta’s approach extends its utility to scenarios where we may want to decompose something other than prevalence/incidence..</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>TODO (not sure about this. there’s a bit of a question mark over all of DG for me in that if we’re working with population level data, surely we can just ‘uncount’ it to get back individual level data, and then use regression methods of decomposition (i.e.&nbsp;the bit shown in the supplementary)).</p>
<p>so what’s the advantage of DG, now that computers make uncounting so easy?</p>
</div></div><p>While Kitagawa’s decomposition technique is well used (citations increasing), references to Das Gupta have not seen the same popularity. This is quite possibly due to the computational complexity involved with calculating all permutations of counterfactual population states. Das Gupta himself provided code in Fortran for examples of his method <span class="citation" data-cites="Das-Gupta1993-ie">(<a href="#ref-Das-Gupta1993-ie" role="doc-biblioref">1993</a>)</span>, and, somewhat more recently, standalone Windows executables <span class="citation" data-cites="Wang2000-hc">(<a href="#ref-Wang2000-hc" role="doc-biblioref">Wang et al. 2000</a>)</span> and packages in Stata <span class="citation" data-cites="Li2017-kj">(<a href="#ref-Li2017-kj" role="doc-biblioref">Li 2017</a>)</span> have been produced.</p>
<p>Here we present the <strong>{{DasGuptR}}</strong> package for R that implements the full functionality described in Das Gupta’s 1993 manual for standardising and decomposing rates as a function of a set of <span class="math inline">\(K\)</span> vectors across <span class="math inline">\(N\)</span> populations. Associated package vignettes provide examples of how this can be adapted in order to bootstrap standard errors for decomposition effects <span class="citation" data-cites="Wang2000-hc">(as in <a href="#ref-Wang2000-hc" role="doc-biblioref">Wang et al. 2000</a>)</span>, and how to use standardised cell-specific rates in order to decompose rate differences in to effects for each category of a compositional variable (e.g., allowing us to ask if the difference is driven by change in one specific age-group more than others), as described by <span class="citation" data-cites="Chevan2009-dt">Chevan and Sutherland (<a href="#ref-Chevan2009-dt" role="doc-biblioref">2009</a>)</span>.</p>
<section id="the-dasguptr-package" class="level1">
<h1>The DasGuptR package</h1>
<p>For a full explanation of Das Gupta’s methodology of standardisation and decomposition, see <span class="citation" data-cites="Das-Gupta1993-ie">P. Das Gupta (<a href="#ref-Das-Gupta1993-ie" role="doc-biblioref">1993</a>)</span>, from which examples below are taken. We follow the same exposition: building up the number of factors, factors as vectors, different rate functions, cross-classified population structures, and finally extensions to more than just 2 populations.</p>
<section id="package-workflow" class="level2">
<h2 class="anchored" data-anchor-id="package-workflow">package workflow</h2>
<p>The DasGuptR workflow requires data to be in long format, with variables denoting the population and each compositional factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DasGuptR)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>eg.dg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">c</span>(<span class="st">"pop1"</span>,<span class="st">"pop2"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fu">c</span>(.<span class="dv">6</span>,.<span class="dv">3</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(.<span class="dv">5</span>,.<span class="dv">45</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>eg.dg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   pop alpha beta
1 pop1   0.6 0.50
2 pop2   0.3 0.45</code></pre>
</div>
</div>
<p>The workhorse of the DasGuptR package is <code>dgnpop()</code>, which computes the crude rates and the standardised rates for <span class="math inline">\(K\)</span> factors across <span class="math inline">\(N\)</span> populations.</p>
<p>It’s crucial to be aware that the factors referred to in the outputs of DasGuptR are those that are <strong>not</strong> being held constant in the standardisation. Very often when standardisation is done over a smaller number of factors — say <span class="math inline">\(x,y,z\)</span> — researchers use “<span class="math inline">\(xy\)</span>-standardised rates” to refer to rates were both <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> held constant across the two populations (similar to the names used in <a href="#eq-manage1" class="quarto-xref">Equation&nbsp;2</a> to <strong>?@eq-manrate2</strong>). In DasGuptR, these would be presented as the “<span class="math inline">\(K-z\)</span>-standardised rates”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg.dg, <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>,<span class="st">"beta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = alpha*beta</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    rate  pop std.set factor
1 0.3000 pop1    &lt;NA&gt;  crude
2 0.1350 pop2    &lt;NA&gt;  crude
3 0.2850 pop1    pop2  alpha
4 0.1425 pop2    pop1  alpha
5 0.2250 pop1    pop2   beta
6 0.2025 pop2    pop1   beta</code></pre>
</div>
</div>
<p>These can be quickly turned into a wide table of ‘decomposition effects’ in the style of Das Gupta using <code>dg_table()</code>, which — when working with just two populations — calculates and displays differences in standardised rate and also expresses these as a percentage of the crude rate difference:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg.dg, <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>,<span class="st">"beta"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = alpha*beta</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       pop1   pop2    diff decomp
alpha 0.285 0.1425 -0.1425  86.36
beta  0.225 0.2025 -0.0225  13.64
crude 0.300 0.1350 -0.1650 100.00</code></pre>
</div>
</div>
</section>
<section id="more-factors" class="level2">
<h2 class="anchored" data-anchor-id="more-factors">more factors</h2>
<p>The addition of more factors into the composition of a population rate is handled in <code>dgnpop()</code> by simply adding to the <code>factors</code> argument. The default behaviour will take the rate to be the product of all factors specified.</p>
<p><strong>Example 2.3:</strong> Percentage having non-marital live births as the product of four factors for white women aged 15 to 19 in the United States, in the years 1971 and 1979.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>eg2<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">c</span>(<span class="dv">1971</span>, <span class="dv">1979</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># non-marital live births x 100 / non-marital pregnancies</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_preg =</span> <span class="fu">c</span>(<span class="fl">25.3</span>, <span class="fl">32.7</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># non-marital pregnancies / sexually active single women</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">preg_actw =</span> <span class="fu">c</span>(.<span class="dv">214</span>, .<span class="dv">290</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sexually active single women / total single women</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">actw_prop =</span> <span class="fu">c</span>(.<span class="dv">279</span>, .<span class="dv">473</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># total single women / total women</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">w_prop =</span> <span class="fu">c</span>(.<span class="dv">949</span>, .<span class="dv">986</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg2<span class="fl">.3</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"birth_preg"</span>, <span class="st">"preg_actw"</span>, <span class="st">"actw_prop"</span>, <span class="st">"w_prop"</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = birth_preg*preg_actw*actw_prop*w_prop</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>               1971     1979      diff decomp
birth_preg 2.355434 3.044375 0.6889411  23.05
preg_actw  2.287936 3.100474 0.8125381  27.18
actw_prop  1.988818 3.371723 1.3829055  46.26
w_prop     2.686817 2.791572 0.1047547   3.50
crude      1.433523 4.422663 2.9891394 100.00</code></pre>
</div>
</div>
</section>
<section id="factors-as-vectors" class="level2">
<h2 class="anchored" data-anchor-id="factors-as-vectors">factors as vectors</h2>
<p>It is often the case that we have data for each compositional factor on a set of sub-populations, and the crude rates for the population are the aggregated cell-specific rates.</p>
<p>In these cases, <code>dgnpop()</code> requires the user to provide an appropriate rate function that aggregates up to a summary value for each population. For instance, in the example below, the cell-specific rates are calculated as the product of 3 factors, and the population rate is the sum of the cell-specific rates, so the user would specify <code>ratefunction = "sum(a*b*c)"</code>.</p>
<p><strong>Example 4.3:</strong> Crude birth rate per 1000 as a function of three vector factors in Taiwan, in the years 1960 and 1970:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>eg4<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">agegroup =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">2</span>),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">1960</span>), <span class="at">e =</span> <span class="dv">7</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number of births in age-group x 1000 / number of married women in age-group</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">bm =</span> <span class="fu">c</span>(<span class="dv">488</span>, <span class="dv">452</span>, <span class="dv">338</span>, <span class="dv">156</span>, <span class="dv">63</span>, <span class="dv">22</span>, <span class="dv">3</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="dv">393</span>, <span class="dv">407</span>, <span class="dv">369</span>, <span class="dv">274</span>, <span class="dv">184</span>, <span class="dv">90</span>, <span class="dv">16</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number of married women in-age group / total women in age-group</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mw =</span> <span class="fu">c</span>(.<span class="dv">082</span>, .<span class="dv">527</span>, .<span class="dv">866</span>, .<span class="dv">941</span>, .<span class="dv">942</span>, .<span class="dv">923</span>, .<span class="dv">876</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>         .<span class="dv">122</span>, .<span class="dv">622</span>, .<span class="dv">903</span>, .<span class="dv">930</span>, .<span class="dv">916</span>, .<span class="dv">873</span>, .<span class="dv">800</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># total women in age-group / total population</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">wp =</span> <span class="fu">c</span>(.<span class="dv">058</span>, .<span class="dv">038</span>, .<span class="dv">032</span>, .<span class="dv">030</span>, .<span class="dv">026</span>, .<span class="dv">023</span>, .<span class="dv">019</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>         .<span class="dv">043</span>, .<span class="dv">041</span>, .<span class="dv">036</span>, .<span class="dv">032</span>, .<span class="dv">026</span>, .<span class="dv">020</span>, .<span class="dv">018</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg4<span class="fl">.3</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"bm"</span>, <span class="st">"mw"</span>, <span class="st">"wp"</span>),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratefunction =</span> <span class="st">"sum(bm*mw*wp)"</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = sum(bm*mw*wp)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          1960     1970       diff decomp
bm    36.72867 29.44304  -7.285632  62.96
mw    34.47028 31.74965  -2.720633  23.51
wp    33.83095 32.26577  -1.565181  13.53
crude 38.77463 27.20318 -11.571446 100.00</code></pre>
</div>
</div>
<p>For most purposes when working with vector factors it is the population-level rates that are of interest, and providing an appropriate rate function will suffice for the decomposition. If the rate function provided does not aggregate up to a summary value, then <code>dgnpop()</code> will return an array of standardised cell-specific rates of the same length as the number of sub-populations. In order for this to work, the user is also required to specify the variable(s) indicating the sub-population in <code>id_vars</code> argument.[In the simple case where there is only one variable indicating a single set of sub-populations (e.g., different age-groups), then these could also be calculated by running <code>dgnpop()</code> on the data for each sub-population separately.]</p>
<p>Aggregating these post-hoc will simply retrieve the population-level standardised rates, but cell-specific standardisation may be of use for those looking to calculate <em>category effects</em> as detailed in <a href="https://doi.org/10.1353/dem.0.0060" target="_blank">Chevan &amp; Sutherland 2009</a> to examine the amount to which a difference in rates is attributable to differences in <em>specific</em> sub-populations (see associated vignette with <code>vignette("category_effects", package="DasGuptR")</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg4<span class="fl">.3</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"bm"</span>, <span class="st">"mw"</span>, <span class="st">"wp"</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="fu">c</span>(<span class="st">"agegroup"</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratefunction =</span> <span class="st">"bm*mw*wp"</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          rate  pop std.set factor agegroup</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   2.4892880 1970    1960     bm        1</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  10.2678580 1970    1960     bm        2</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  10.1688427 1970    1960     bm        3</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   4.5237920 1970    1960     bm        4</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5   1.5217020 1970    1960     bm        5</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6   0.4250290 1970    1960     bm        6</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7   0.0465280 1970    1960     bm        7</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8   2.0046930 1960    1970     bm        1</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9   9.2456155 1960    1970     bm        2</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ..  ...       ...     ...      ...     ...</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ..  ...       ...     ...      ...     ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rate-functions" class="level2">
<h2 class="anchored" data-anchor-id="rate-functions">rate functions</h2>
<p>Das Gupta’s methodology generalises to rates that are not simply products of the set of factors. The <code>ratefunction</code> argument of <code>dgnpop()</code> allows the user to define a custom rate function (function <span class="math inline">\(f()\)</span> in <a href="#eq-dg2" class="quarto-xref">Equation&nbsp;11</a>). This may be as simple as a subtraction <code>a-b</code> (Example 3.1 below), or something more complicated that aggregates over different combinations of factors <code>sum(a*b)/sum(a*b*c)</code> (Example 4.4 below).</p>
<p><strong>Example 3.1:</strong> Crude rate of natural increase, US in years 1940 and 1960</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>eg3<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">c</span>(<span class="dv">1940</span>, <span class="dv">1960</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># births x 1000 / total population</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">crude_birth =</span> <span class="fu">c</span>(<span class="fl">19.4</span>, <span class="fl">23.7</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># deaths x 1000 / total population</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">crude_death =</span> <span class="fu">c</span>(<span class="fl">10.8</span>, <span class="fl">9.5</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg3<span class="fl">.1</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"crude_birth"</span>, <span class="st">"crude_death"</span>),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratefunction =</span> <span class="st">"crude_birth-crude_death"</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = crude_birth-crude_death</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             1940  1960 diff decomp
crude_birth  9.25 13.55  4.3  76.79
crude_death 10.75 12.05  1.3  23.21
crude        8.60 14.20  5.6 100.00</code></pre>
</div>
</div>
<p><strong>Example 4.4:</strong> Illegitimacy Ratio as a function of four vector factors: United States, 1963 and 1983</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>eg4<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1963</span>, <span class="dv">1983</span>), <span class="at">e =</span> <span class="dv">6</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">agegroup =</span> <span class="fu">c</span>(<span class="st">"15-19"</span>, <span class="st">"20-24"</span>, <span class="st">"25-29"</span>, <span class="st">"30-34"</span>, <span class="st">"35-39"</span>, <span class="st">"40-44"</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number of women in age-group / total women</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(.<span class="dv">200</span>, .<span class="dv">163</span>, .<span class="dv">146</span>, .<span class="dv">154</span>, .<span class="dv">168</span>, .<span class="dv">169</span>, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        .<span class="dv">169</span>, .<span class="dv">195</span>, .<span class="dv">190</span>, .<span class="dv">174</span>, .<span class="dv">150</span>, .<span class="dv">122</span>),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number of unmarried women in age-group / number of women in age-group</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">c</span>(.<span class="dv">866</span>, .<span class="dv">325</span>, .<span class="dv">119</span>, .<span class="dv">099</span>, .<span class="dv">099</span>, .<span class="dv">121</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        .<span class="dv">931</span>, .<span class="dv">563</span>, .<span class="dv">311</span>, .<span class="dv">216</span>, .<span class="dv">199</span>, .<span class="dv">191</span>),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># births to unmarried women in age-group / number of unmarried women in age-group</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(.<span class="dv">007</span>, .<span class="dv">021</span>, .<span class="dv">023</span>, .<span class="dv">015</span>, .<span class="dv">008</span>, .<span class="dv">002</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        .<span class="dv">018</span>, .<span class="dv">026</span>, .<span class="dv">023</span>, .<span class="dv">016</span>, .<span class="dv">008</span>, .<span class="dv">002</span>),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># births to married women in age-group / married women in age-group</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="fu">c</span>(.<span class="dv">454</span>, .<span class="dv">326</span>, .<span class="dv">195</span>, .<span class="dv">107</span>, .<span class="dv">051</span>, .<span class="dv">015</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        .<span class="dv">380</span>, .<span class="dv">201</span>, .<span class="dv">149</span>, .<span class="dv">079</span>, .<span class="dv">025</span>, .<span class="dv">006</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg4<span class="fl">.4</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"agegroup"</span>, <span class="at">ratefunction =</span> <span class="st">"sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))"</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>            1963       1983        diff decomp
A     0.07770985 0.07150487 -0.00620498  -6.59
B     0.04742107 0.09608261  0.04866154  51.64
C     0.05924498 0.08630419  0.02705922  28.72
D     0.05962676 0.08433604  0.02470928  26.22
crude 0.03094957 0.12517462  0.09422505 100.00</code></pre>
</div>
</div>
<p>The <code>ratefunction</code> argument can be given any string that when parsed and evaluated will return a summary value for a rate. At the point at which the string is evaluated, each factor (or vector-factor) is stored in a named list, meaning the function must simply refer to those factors by name. It is possible, for instance, to define a custom function in the user’s environment, and provide a call to that function to the <code>ratefunction</code> argument of <code>dgnpop()</code>. Example 4.4 above can also be achieved using the code below. There is no real limit to the complexity of the rate function the user wishes to specify, and Das Gupta provides one such example in which the rate is obtained iteratively via Newton-Raphson (See Example 4.1 in the supplementary of additional examples).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>myratef <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b, c, d) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sum</span>(a <span class="sc">*</span> b <span class="sc">*</span> c) <span class="sc">/</span> (<span class="fu">sum</span>(a <span class="sc">*</span> b <span class="sc">*</span> c) <span class="sc">+</span> <span class="fu">sum</span>(a <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> b) <span class="sc">*</span> d)))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg4<span class="fl">.4</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"agegroup"</span>, <span class="at">ratefunction =</span> <span class="st">"myratef(A,B,C,D)"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="population-structures-and-cross-classified-data" class="level2">
<h2 class="anchored" data-anchor-id="population-structures-and-cross-classified-data">population structures and cross-classified data</h2>
<p>Very often, we have data on factors across a set of sub-populations because we are interested specifically in effects of the sub-population structure differences between two populations — i.e.&nbsp;separating out how much the crude rate differences are due to differences in the structure of the populations vs differences in the cell-specific rates.</p>
<p>To do this, we require data on the sizes (or relative sizes) of each sub-population. The simplest case here would be if we had data on a single set of sub-populations (e.g., age-groups), and had the group-specific rates and group sizes. The crude rates for the population would be simply the sum of all the group-specific rates weighted by the relative size of the group.</p>
<p><strong>Example 5.1:</strong> Household Headship Rates per 100: United States, years 1970 and 1985</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>eg5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"15-19"</span>, <span class="st">"20-24"</span>, <span class="st">"25-29"</span>, <span class="st">"30-34"</span>, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"35-39"</span>, <span class="st">"40-44"</span>, <span class="st">"45-49"</span>, <span class="st">"50-54"</span>, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"55-59"</span>, <span class="st">"60-64"</span>, <span class="st">"65-69"</span>, <span class="st">"70-74"</span>, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"75+"</span>), <span class="dv">2</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">1985</span>), <span class="at">e =</span> <span class="dv">13</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number in age-group / total population * 100</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">c</span>(</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="fl">12.9</span>, <span class="fl">10.9</span>, <span class="fl">9.5</span>, <span class="fl">8.0</span>, <span class="fl">7.8</span>, <span class="fl">8.4</span>, <span class="fl">8.6</span>, <span class="fl">7.8</span>, <span class="fl">7.0</span>, <span class="fl">5.9</span>, <span class="fl">4.7</span>, <span class="fl">3.6</span>, <span class="fl">4.9</span>, </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10.1</span>, <span class="fl">11.2</span>, <span class="fl">11.6</span>, <span class="fl">10.9</span>, <span class="fl">9.4</span>, <span class="fl">7.7</span>, <span class="fl">6.3</span>, <span class="fl">6.0</span>, <span class="fl">6.3</span>, <span class="fl">5.9</span>, <span class="fl">5.1</span>, <span class="fl">4.0</span>, <span class="fl">5.5</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># age-group specific rate</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">c</span>(</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.9</span>, <span class="fl">25.8</span>, <span class="fl">45.7</span>, <span class="fl">49.6</span>, <span class="fl">51.2</span>, <span class="fl">51.6</span>, <span class="fl">51.8</span>, <span class="fl">54.9</span>, <span class="fl">58.7</span>, <span class="fl">60.4</span>, <span class="fl">62.8</span>, <span class="fl">66.6</span>, <span class="fl">66.8</span>, </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="fl">2.2</span>, <span class="fl">24.3</span>, <span class="fl">45.8</span>, <span class="fl">52.5</span>, <span class="fl">56.1</span>, <span class="fl">55.6</span>, <span class="fl">56.0</span>, <span class="fl">57.4</span>, <span class="fl">57.2</span>, <span class="fl">61.2</span>, <span class="fl">63.9</span>, <span class="fl">68.6</span>, <span class="fl">72.2</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, we can decompose this into the rate-standardised and age-standardised rates in various ways.</p>
<ol type="1">
<li>Given that the rate is defined as a weighted sum <span class="math inline">\(\sum\limits_iw_ir_i\)</span>, by creating a new column of weights, we can simply include this in the set of compositional factors as previously. As the weights are simply the proportions of the population in each age-group, and we have percentages, we can simply divide by 100:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>eg5<span class="fl">.1</span><span class="sc">$</span>age_str <span class="ot">&lt;-</span> eg5<span class="fl">.1</span><span class="sc">$</span>size <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg5<span class="fl">.1</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"age_str"</span>, <span class="st">"rate"</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"age_group"</span>, <span class="at">ratefunction =</span> <span class="st">"sum(age_str*rate)"</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = sum(age_str*rate)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>           1970    1985   diff decomp
age_str 45.5876 46.8145 1.2269  41.35
rate    45.3309 47.0712 1.7403  58.65
crude   44.7268 47.6940 2.9672 100.00</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Alternatively, we could include the conversion to proportions <em>inside</em> the rate function, including the original cell sizes variable in the factors. Because the inputs to the rate function here are the set of vector factors for each population, internal calls to <code>sum(size)</code> will give us the total population size, and <code>size/sum(size)</code> will give us our proportions:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg5<span class="fl">.1</span>,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"size"</span>, <span class="st">"rate"</span>),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"age_group"</span>, <span class="at">ratefunction =</span> <span class="st">"sum( (size/sum(size))*rate )"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = sum( (size/sum(size))*rate )</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         1970    1985   diff decomp
size  45.5876 46.8145 1.2269  41.35
rate  45.3309 47.0712 1.7403  58.65
crude 44.7268 47.6940 2.9672 100.00</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Finally, we can instead provide the variable indicating the size of each sub-population into the <code>crossclassified</code> argument of <code>dgnpop()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg5<span class="fl">.1</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"rate"</span>),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"age_group"</span>, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">crossclassified =</span> <span class="st">"size"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = rate</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                    1970    1985   diff decomp
age_group_struct 45.5876 46.8145 1.2269  41.35
rate             45.3309 47.0712 1.7403  58.65
crude            44.7268 47.6940 2.9672 100.00</code></pre>
</div>
</div>
<p>This latter approach can be extended to situations in which we have cross-classified data - i.e.&nbsp;individual sub-populations are defined by the combination of multiple variables such as age and race, as Example 5.3 below.</p>
<p>In these cases, defining weights as <code>size/sum(size)</code> will collapse the two cross-classified factors that make up the structure of the population (age and race), thereby getting us only part of the way. This allows us to decompose rate differences into “rate” vs “age-and-race” differences, but leaves us unable to separate out differences in age distributions from differences in race distributions. Instead, providing the cell-specific sizes to the <code>crossclassified</code> argument will re-express the proportion of the population in a given cell as the product of symmetrical expressions corresponding to each of the cross-classified variables.</p>
<p>Using <span class="math inline">\(i\)</span> to donote a specific sub-population that is uniquely identified through the set of cross-classified variables <span class="math inline">\(K: \{\alpha,\beta,...,\kappa\}\)</span>, and <span class="math inline">\(i_\kappa\)</span> to denote the specific level of <span class="math inline">\(\kappa\)</span> for sub-population <span class="math inline">\(i\)</span>, we can indicate the size of sub-population <span class="math inline">\(i\)</span> with <span class="math inline">\(N_{\forall \kappa \in K, \kappa = i_\kappa}\)</span>, and the expression <span class="math inline">\(N_{\forall \kappa \in K, \kappa = .}\)</span> denotes the total population size, summed across all levels of all variables. The Das Gupta methodology expresses the proportion of the population in sub-population <span class="math inline">\(i\)</span> as a product of <span class="math inline">\(|K|\)</span> variables (<a href="#eq-popstr1" class="quarto-xref">Equation&nbsp;15</a>).</p>
<p><span id="eq-popstr1"><span class="math display">\[
\frac{N_{\forall \kappa \in K, \kappa = i_\kappa}}
{N_{\forall \kappa \in K, \kappa = .}} =
\hat\alpha_{\forall \kappa \in K, \kappa = i_\kappa} \hat\beta_{\forall \kappa \in K, \kappa = i_\kappa} ... \hat\kappa_{\forall \kappa \in K, \kappa = i_\kappa}  
\tag{15}\]</span></span></p>
<p>These are defined as the product of ratios that aggregate over different combinations of the cross-classified variables (<a href="#eq-popstr2" class="quarto-xref">Equation&nbsp;16</a>), which are then standardised via the method described earlier (<a href="#eq-dg1" class="quarto-xref">Equation&nbsp;10</a>, <a href="#eq-dg2" class="quarto-xref">Equation&nbsp;11</a>), and multiplied by the average cell-specific rates (i.e., <span class="math inline">\(\frac{r_i + r_i'}{2}\)</span>) and aggregated up to the population level to obtain <span class="math inline">\(\alpha\ldots\kappa\)</span>-standardised rates.</p>
<p><span id="eq-popstr2"><span class="math display">\[
\hat\alpha_{\forall \kappa \in K, \kappa = i_\kappa} = \prod\limits_{j=0}^{|K|-1} \left( \prod\limits_{L\in {K \setminus \{\alpha\} \choose j}} \frac{N_{\forall \kappa \in K,\ \kappa = \begin{cases} i_\kappa &amp; \text{if } \kappa \in \{\alpha, L\} \\ . &amp; \text{otherwise} \end{cases}} }{N_{\forall \kappa \in K,\ \kappa = \begin{cases} i_\kappa &amp; \text{if } \kappa \in L \\ . &amp; \text{otherwise} \end{cases}} }\right)^{\frac{1}{|K|{|K|-1 \choose j}}}
\tag{16}\]</span></span></p>
<p><br></p>
<!-- $$ -->
<!-- \begin{equation} -->
<!-- \hat\alpha_{\forall \kappa \in K, \kappa = i_\kappa} = \prod\limits_{j=0}^{|K|-1}  -->
<!-- \left( \prod\limits_{L\in {K \setminus \{\alpha\} \choose j}} -->
<!-- \frac{N_{ -->
<!-- \forall \kappa \in K,\ \kappa = -->
<!-- \begin{cases} i_\kappa & \text{if } \kappa \in \{\alpha, L\} \\ . & \text{otherwise} \end{cases}} -->
<!-- } -->
<!-- {N_{\forall \kappa \in K,\ \kappa = \begin{cases} i_\kappa & \text{if } \kappa \in L \\ . & \text{otherwise} \end{cases}} -->
<!-- } -->
<!-- \right)^{\frac{1}{|K|{|K|-1 \choose j}}} -->
<!-- \end{equation} -->
<!-- $$ -->
<p><strong>Example 5.3:</strong> Death rates per 1000: United States, years 1970 and 1985</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>eg5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">race =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">e =</span> <span class="dv">11</span>), <span class="dv">2</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, <span class="dv">2</span>), <span class="dv">2</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1985</span>, <span class="dv">1970</span>), <span class="at">e =</span> <span class="dv">22</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number of people in age-race-group</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">c</span>(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3041</span>, <span class="dv">11577</span>, <span class="dv">27450</span>, <span class="dv">32711</span>, <span class="dv">35480</span>, <span class="dv">27411</span>, <span class="dv">19555</span>, <span class="dv">19795</span>, <span class="dv">15254</span>, <span class="dv">8022</span>, </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2472</span>, <span class="dv">707</span>, <span class="dv">2692</span>, <span class="dv">6473</span>, <span class="dv">6841</span>, <span class="dv">6547</span>, <span class="dv">4352</span>, <span class="dv">3034</span>, <span class="dv">2540</span>, <span class="dv">1749</span>, <span class="dv">804</span>, <span class="dv">236</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2968</span>, <span class="dv">11484</span>, <span class="dv">34614</span>, <span class="dv">30992</span>, <span class="dv">21983</span>, <span class="dv">20314</span>, <span class="dv">20928</span>, <span class="dv">16897</span>, <span class="dv">11339</span>, <span class="dv">5720</span>, </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1315</span>, <span class="dv">535</span>, <span class="dv">2162</span>, <span class="dv">6120</span>, <span class="dv">4781</span>, <span class="dv">3096</span>, <span class="dv">2718</span>, <span class="dv">2363</span>, <span class="dv">1767</span>, <span class="dv">1149</span>, <span class="dv">448</span>, <span class="dv">117</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># death rate in age-race-group</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">c</span>(</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="fl">9.163</span>, <span class="fl">0.462</span>, <span class="fl">0.248</span>, <span class="fl">0.929</span>, <span class="fl">1.084</span>, <span class="fl">1.810</span>, <span class="fl">4.715</span>, <span class="fl">12.187</span>, <span class="fl">27.728</span>, <span class="fl">64.068</span>, <span class="fl">157.570</span>, </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="fl">17.208</span>, <span class="fl">0.738</span>, <span class="fl">0.328</span>, <span class="fl">1.103</span>, <span class="fl">2.045</span>, <span class="fl">3.724</span>, <span class="fl">8.052</span>, <span class="fl">17.812</span>, <span class="fl">34.128</span>, <span class="fl">68.276</span>, <span class="fl">125.161</span>, </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="fl">18.469</span>, <span class="fl">0.751</span>, <span class="fl">0.391</span>, <span class="fl">1.146</span>, <span class="fl">1.287</span>, <span class="fl">2.672</span>, <span class="fl">6.636</span>, <span class="fl">15.691</span>, <span class="fl">34.723</span>, <span class="fl">79.763</span>, <span class="fl">176.837</span>, </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="fl">36.993</span>, <span class="fl">1.352</span>,<span class="fl">0.541</span>, <span class="fl">2.040</span>, <span class="fl">3.523</span>, <span class="fl">6.746</span>, <span class="fl">12.967</span>, <span class="fl">24.471</span>, <span class="fl">45.091</span>, <span class="fl">74.902</span>, <span class="fl">123.205</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg5<span class="fl">.3</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"rate"</span>),</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="fu">c</span>(<span class="st">"race"</span>, <span class="st">"age"</span>), <span class="at">crossclassified =</span> <span class="st">"size"</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = rate</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                 1970     1985       diff  decomp
age_struct   8.385332 9.907067  1.5217347 -221.76
race_struct  9.136312 9.156087  0.0197749   -2.88
rate        10.257368 8.029643 -2.2277254  324.64
crude        9.421833 8.735618 -0.6862158  100.00</code></pre>
</div>
</div>
</section>
<section id="n-populations" class="level2">
<h2 class="anchored" data-anchor-id="n-populations">N populations</h2>
<p>When standardising across more than two populations, computing the standardisation across all pairs of populations returns <span class="math inline">\(N-1\)</span> sets of standardised rates for each population, and the decomposition between populations are internally inconsistent — i.e.&nbsp;differences in standardised rates between populations 1 and 2, and between 2 and 3, should (but do not) sum to the difference between 1 and 3.</p>
<p>Das Gupta <span class="citation" data-cites="Das-Gupta1993-ie">(<a href="#ref-Das-Gupta1993-ie" role="doc-biblioref">1993</a>)</span> provided a secondary procedure that takes sets of pairwise standardised rates and resolves these problems. This is presented in <a href="#eq-npop" class="quarto-xref">Equation&nbsp;17</a>, with <span class="math inline">\(\bar r_{x|y}\)</span> denoting a standardised rate in population <span class="math inline">\(x\)</span> that is standardised across populations <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. When given more than two populations, <code>dgnpop()</code> will automatically undertake this procedure. The resulting standardised across all N populations and can be used as previously with <code>dg_table()</code> and <code>dg_plot()</code>.</p>
<p><span id="eq-npop"><span class="math display">\[
\bar r_{1|23\ldots N} = \frac{\sum\limits_{i=2}^{N}\bar r_{1|i}}{N-1} +
\frac{\sum\limits_{i=2}^{N}
    \sum\limits_{j\neq1,i}^{N}
        \bar r_{i|j} - (N-2) \bar r_{i|1} }{N(N-1)}
\tag{17}\]</span></span></p>
<p><strong>Example 6.5:</strong> Illegitimacy Ratio as a function of four vector factors: United States, years 1963, 1968, 1973, 1978, and 1983</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>eg6<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1963</span>, <span class="dv">1968</span>, <span class="dv">1973</span>, <span class="dv">1978</span>, <span class="dv">1983</span>), <span class="at">e =</span> <span class="dv">6</span>),</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">agegroup =</span> <span class="fu">c</span>(<span class="st">"15-19"</span>, <span class="st">"20-24"</span>, <span class="st">"25-29"</span>, <span class="st">"30-34"</span>, <span class="st">"35-39"</span>, <span class="st">"40-44"</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number of women in age-group / total women</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">200</span>, .<span class="dv">163</span>, .<span class="dv">146</span>, .<span class="dv">154</span>, .<span class="dv">168</span>, .<span class="dv">169</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">215</span>, .<span class="dv">191</span>, .<span class="dv">156</span>, .<span class="dv">137</span>, .<span class="dv">144</span>, .<span class="dv">157</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">218</span>, .<span class="dv">203</span>, .<span class="dv">175</span>, .<span class="dv">144</span>, .<span class="dv">127</span>, .<span class="dv">133</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">205</span>, .<span class="dv">200</span>, .<span class="dv">181</span>, .<span class="dv">162</span>, .<span class="dv">134</span>, .<span class="dv">118</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">169</span>, .<span class="dv">195</span>, .<span class="dv">190</span>, .<span class="dv">174</span>, .<span class="dv">150</span>, .<span class="dv">122</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># number of unmarried women in age-group / number of women in age-group</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">c</span>(</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">866</span>, .<span class="dv">325</span>, .<span class="dv">119</span>, .<span class="dv">099</span>, .<span class="dv">099</span>, .<span class="dv">121</span>,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">891</span>, .<span class="dv">373</span>, .<span class="dv">124</span>, .<span class="dv">100</span>, .<span class="dv">107</span>, .<span class="dv">127</span>,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">870</span>, .<span class="dv">396</span>, .<span class="dv">158</span>, .<span class="dv">125</span>, .<span class="dv">113</span>, .<span class="dv">129</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">900</span>, .<span class="dv">484</span>, .<span class="dv">243</span>, .<span class="dv">176</span>, .<span class="dv">155</span>, .<span class="dv">168</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">931</span>, .<span class="dv">563</span>, .<span class="dv">311</span>, .<span class="dv">216</span>, .<span class="dv">199</span>, .<span class="dv">191</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># births to unmarried women in age-group / number of unmarried women in age-group</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">007</span>, .<span class="dv">021</span>, .<span class="dv">023</span>, .<span class="dv">015</span>, .<span class="dv">008</span>, .<span class="dv">002</span>,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">010</span>, .<span class="dv">023</span>, .<span class="dv">023</span>, .<span class="dv">015</span>, .<span class="dv">008</span>, .<span class="dv">002</span>,</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">011</span>, .<span class="dv">016</span>, .<span class="dv">017</span>, .<span class="dv">011</span>, .<span class="dv">006</span>, .<span class="dv">002</span>,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">014</span>, .<span class="dv">019</span>, .<span class="dv">015</span>, .<span class="dv">010</span>, .<span class="dv">005</span>, .<span class="dv">001</span>,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">018</span>, .<span class="dv">026</span>, .<span class="dv">023</span>, .<span class="dv">016</span>, .<span class="dv">008</span>, .<span class="dv">002</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># births to married women in age-group / married women in age-group</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="fu">c</span>(</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">454</span>, .<span class="dv">326</span>, .<span class="dv">195</span>, .<span class="dv">107</span>, .<span class="dv">051</span>, .<span class="dv">015</span>,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">433</span>, .<span class="dv">249</span>, .<span class="dv">159</span>, .<span class="dv">079</span>, .<span class="dv">037</span>, .<span class="dv">011</span>,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">314</span>, .<span class="dv">181</span>, .<span class="dv">133</span>, .<span class="dv">063</span>, .<span class="dv">023</span>, .<span class="dv">006</span>,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">313</span>, .<span class="dv">191</span>, .<span class="dv">143</span>, .<span class="dv">069</span>, .<span class="dv">021</span>, .<span class="dv">004</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    .<span class="dv">380</span>, .<span class="dv">201</span>, .<span class="dv">149</span>, .<span class="dv">079</span>, .<span class="dv">025</span>, .<span class="dv">006</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- As an illustration, standardisation independently across pairs of populations above returns decomposition effects below.  -->
<!-- ```{r} -->
<!-- #| echo: false -->
<!-- #| message: false -->
<!-- p12 <- dgnpop(eg6.5[eg6.5$pop %in% c(1963, 1968), ], -->
<!--   pop = "pop", factors = c("A", "B", "C", "D"), -->
<!--   id_vars = "agegroup", -->
<!--   ratefunction = "1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))" -->
<!-- ) |> -->
<!--   dg_table() -->
<!-- p23 <- dgnpop(eg6.5[eg6.5$pop %in% c(1968, 1973), ], -->
<!--   pop = "pop", factors = c("A", "B", "C", "D"), -->
<!--   id_vars = "agegroup", -->
<!--   ratefunction = "1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))" -->
<!-- ) |> -->
<!--   dg_table() -->
<!-- p13 <- dgnpop(eg6.5[eg6.5$pop %in% c(1963, 1973), ], -->
<!--   pop = "pop", factors = c("A", "B", "C", "D"), -->
<!--   id_vars = "agegroup", -->
<!--   ratefunction = "1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))" -->
<!-- ) |> -->
<!--   dg_table() -->
<!-- tibble( -->
<!--   ` ` = c(LETTERS[1:4], "Crude"), -->
<!--   `1963 v 1968` = p12$diff, -->
<!--   `1968 v 1973` = p23$diff, -->
<!--   `1963 v 1973` = p13$diff -->
<!-- ) |> knitr::kable() -->
<!-- ``` -->
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg6<span class="fl">.5</span>,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"agegroup"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratefunction =</span> <span class="st">"1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))"</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = 1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          1963     1968     1973     1978      1983
A     72.77031 74.65254 73.83625 71.36001  64.60057
B     53.28255 56.63216 59.52972 79.49763 104.38728
C     62.17750 69.61231 60.48031 68.54219  94.17361
D     54.83361 64.43823 81.24203 79.60288  74.12756
crude 30.94957 53.22084 62.97390 86.88830 125.17462</code></pre>
</div>
</div>
<p>Because using <code>dg_table()</code> with multiple populations will return standardised rates for each population, it will not return decomposition effects unless only two populations are specified:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg6<span class="fl">.5</span>,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"agegroup"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratefunction =</span> <span class="st">"1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))"</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>(<span class="at">pop1 =</span> <span class="dv">1963</span>, <span class="at">pop2 =</span> <span class="dv">1968</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = 1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          1963     1968      diff decomp
A     72.77031 74.65254  1.882236   8.45
B     53.28255 56.63216  3.349606  15.04
C     62.17750 69.61231  7.434806  33.38
D     54.83361 64.43823  9.604628  43.13
crude 30.94957 53.22084 22.271276 100.00</code></pre>
</div>
</div>
<!-- Alternatively, the decomposition effects are returned by `dgnpop()` in the `diffs` entry:  -->
<!-- ```{r} -->
<!-- #| eval: false -->
<!-- dgnpop(eg6.5, -->
<!--   pop = "pop", factors = c("A", "B", "C", "D"), -->
<!--   id_vars = "agegroup", -->
<!--   ratefunction = "1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))", -->
<!--   diffs = TRUE -->
<!-- )$diffs -->
<!-- #>           diff  pop diff.calc        std.set factor -->
<!-- #> 1    1.8822361 1963 1963-1968 1973.1978.1983      A -->
<!-- #> 2    1.0659408 1963 1963-1973 1968.1978.1983      A -->
<!-- #> 3   -1.4102979 1963 1963-1978 1968.1973.1983      A -->
<!-- #> 4   -8.1697336 1963 1963-1983 1968.1973.1978      A -->
<!-- #> 5   -0.8162953 1968 1968-1973 1963.1978.1983      A -->
<!-- #> 6   -3.2925340 1968 1968-1978 1963.1973.1983      A -->
<!-- #> ...  ...       ...  ...       ...                 .. -->
<!-- #> ...  ...       ...  ...       ...                 .. -->
<!-- ``` -->
<p>When working with multiple populations in a time series, we can get quick rough and ready plots of the standardised rates using <code>dg_plot()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg6<span class="fl">.5</span>,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"agegroup"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratefunction =</span> <span class="st">"1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))"</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = 1000*sum(A*B*C) / (sum(A*B*C) + sum(A*(1-B)*D))</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dg_paper_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Example 6.6:</strong> Birthrates by Nine Age-Sex groups: United States, 1940 to 1990</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(uspop)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># birthrate = births per 1000 for age-sex group</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># thous = population in thousands of age-sex group</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(uspop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year agebin thous birthrate
1 1940  10-14  5777       0.7
2 1940  15-19  6145      54.1
3 1940  20-24  5907     135.6
4 1940  25-29  5665     122.8
5 1940  30-34  5192      83.4
6 1940  35-39  4823      46.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>dgo_us <span class="ot">&lt;-</span> <span class="fu">dgnpop</span>(uspop,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"year"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"birthrate"</span>),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"agebin"</span>, <span class="at">crossclassified =</span> <span class="st">"thous"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dg_plot</span>(dgo_us)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dg_paper_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Example S.R:</strong> Prevalence of reconvictions by Age and Sex: Scotland, 2004 to 2016</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(reconv)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># prev_rate = number of reconvicted individuals for age-sex group / number of offenders in age-sex group</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># offenders = number of offenders in age-sex group</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(reconv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year    Sex      Age convicted_population offenders reconvicted reconvictions
1 2004 Female 21 to 25                49351      1650         576          1145
2 2004 Female 26 to 30                49351      1268         420           786
3 2004 Female 31 to 40                49351      2238         558           963
4 2004 Female  over 40                49351      1198         212           361
5 2004 Female under 21                49351      1488         424           858
6 2004   Male 21 to 25                49351      8941        3285          6330
  prev_rate
1 0.3490909
2 0.3312303
3 0.2493298
4 0.1769616
5 0.2849462
6 0.3674086</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dg_srec <span class="ot">&lt;-</span> <span class="fu">dgnpop</span>(reconv,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"year"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"prev_rate"</span>),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="fu">c</span>(<span class="st">"Sex"</span>, <span class="st">"Age"</span>), <span class="at">crossclassified =</span> <span class="st">"offenders"</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dg_plot</span>(dg_srec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dg_paper_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dg_table</span>(dg_srec, <span class="dv">2006</span>, <span class="dv">2016</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                2006      2016          diff decomp
Age_struct 0.3083118 0.2885508 -0.0197609477  37.81
prev_rate  0.3139788 0.2822378 -0.0317409448  60.73
Sex_struct 0.2999392 0.2991769 -0.0007623759   1.46
crude      0.3240221 0.2717579 -0.0522642685 100.00</code></pre>
</div>
</div>
</section>
</section>
<section id="supplementary---standardisation-and-decomposition-with-marginaleffects" class="level1">
<h1>Supplementary - Standardisation and decomposition with marginaleffects</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">### population level data ---</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> DasGuptR<span class="sc">::</span>reconv <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2006</span>,<span class="dv">2016</span>)) <span class="sc">|&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">ifelse</span>(Age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"under 21"</span>,<span class="st">"21 to 25"</span>,<span class="st">"26 to 30"</span>),<span class="st">"under 30"</span>,<span class="st">"over 30"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,Age) <span class="sc">|&gt;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">offenders =</span> <span class="fu">sum</span>(offenders),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">reconvicted =</span> <span class="fu">sum</span>(reconvicted),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">prev =</span> reconvicted<span class="sc">/</span>offenders</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Das Gupta method on population level data:  </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(pop_data, <span class="at">pop =</span> <span class="st">"year"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"prev"</span>), <span class="at">id_vars =</span> <span class="st">"Age"</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">crossclassified =</span> <span class="st">"offenders"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = prev</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                2006      2016        diff decomp
Age_struct 0.3019097 0.2887001 -0.01320960  25.27
prev       0.3148322 0.2757775 -0.03905466  74.73
crude      0.3240221 0.2717579 -0.05226427 100.00</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">### individual level data ---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>indiv_data <span class="ot">&lt;-</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  pop_data <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>prev) <span class="sc">|&gt;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">not_reconvicted =</span> offenders <span class="sc">-</span> reconvicted) <span class="sc">|&gt;</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(value) <span class="sc">|&gt;</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> (name <span class="sc">==</span> <span class="st">"reconvicted"</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="do">## linear probability model:  </span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>modl <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> Age<span class="sc">*</span>year, <span class="at">data =</span> indiv_data)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="do">## E[Y^?|P=0]</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>atu <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(modl, <span class="at">variables =</span> <span class="st">"year"</span>, </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(indiv_data, year <span class="sc">==</span> <span class="dv">2006</span>))<span class="sc">$</span>estimate</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="do">## E[Y^?|P=1]</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>att <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(modl, <span class="at">variables =</span> <span class="st">"year"</span>, </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(indiv_data, year <span class="sc">==</span> <span class="dv">2016</span>))<span class="sc">$</span>estimate</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Crude rates ---</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(indiv_data, <span class="fu">mean</span>(outcome[year <span class="sc">==</span> <span class="dv">2006</span>]))</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(indiv_data, <span class="fu">mean</span>(outcome[year <span class="sc">==</span> <span class="dv">2016</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3240221
[1] 0.2717579</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">### rate-standardised rates: ---</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2006</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(atu[<span class="dv">1</span>], att[<span class="dv">1</span>]))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2016</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(atu[<span class="dv">2</span>], att[<span class="dv">2</span>]))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># decomp</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(atu[<span class="dv">2</span>], att[<span class="dv">2</span>])) <span class="sc">-</span> <span class="fu">mean</span>(<span class="fu">c</span>(atu[<span class="dv">1</span>], att[<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3148322
[1] 0.2757775
[1] -0.03905466</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">### age-standardised rates: ---</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2006</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(atu)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2016</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(att)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># decomp</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(att) <span class="sc">-</span> <span class="fu">mean</span>(atu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3019097
[1] 0.2887001
[1] -0.0132096</code></pre>
</div>
</div>
</section>
<section id="supplementary---additional-examples-from-das-gupta-1991" class="level1">
<h1>Supplementary - Additional examples from Das Gupta 1991</h1>
<p><strong>Example 2.1:</strong> Mean earnings as product of two factors for black males and white males 18 years and over, US 1980</p>
<pre><code>- Crude Rate = total earnings / total population
- `avg_earnings` = total earnings / persons who earned
- `earner_prop` = persons who earned / total population</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>eg2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>),</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_earnings =</span> <span class="fu">c</span>(<span class="dv">10930</span>, <span class="dv">16591</span>),</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">earner_prop =</span> <span class="fu">c</span>(.<span class="dv">717892</span>, .<span class="dv">825974</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg2<span class="fl">.1</span>, <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"avg_earnings"</span>, <span class="st">"earner_prop"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = avg_earnings*earner_prop</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                black    white     diff decomp
avg_earnings 8437.228 12807.14 4369.913  74.61
earner_prop  9878.553 11365.82 1487.262  25.39
crude        7846.560 13703.73 5857.175 100.00</code></pre>
</div>
</div>
<p><strong>Example 2.2:</strong> Birth rate as the product of three factors: Austria and Chile, 1981.</p>
<pre><code>- Crude Rate = births x 1000 / total population
- `birthsw1549` = births x 1000 / women aged 15-49
- `propw1549` = women aged 15-49 / total women
- `propw` = total women / total population</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>eg2<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">c</span>(<span class="st">"austria"</span>, <span class="st">"chile"</span>),</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">birthsw1549 =</span> <span class="fu">c</span>(<span class="fl">51.78746</span>, <span class="fl">84.90502</span>),</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">propw1549 =</span> <span class="fu">c</span>(.<span class="dv">45919</span>, .<span class="dv">75756</span>),</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">propw =</span> <span class="fu">c</span>(.<span class="dv">52638</span>, .<span class="dv">51065</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg2<span class="fl">.2</span>, <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"birthsw1549"</span>, <span class="st">"propw1549"</span>, <span class="st">"propw"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = birthsw1549*propw1549*propw</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             austria    chile       diff decomp
birthsw1549 16.31618 26.75021 10.4340333  51.33
propw1549   16.25309 26.81394 10.5608476  51.95
propw       22.32040 21.65339 -0.6670084  -3.28
crude       12.51747 32.84534 20.3278726 100.00</code></pre>
</div>
</div>
<p><strong>Example 2.4:</strong> Total fertility rate as product of five factors: South Korea, 1960 and 1970</p>
<pre><code>- `prop_m` = index of proportion married
- `noncontr` = index of noncontraception
- `abort` = index of induced abortion
- `lact` = index of lactational infecundability
- `fecund` = total fecundity rate</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>eg2<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">1980</span>),</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prop_m =</span> <span class="fu">c</span>(.<span class="dv">58</span>, .<span class="dv">72</span>),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">noncontr =</span> <span class="fu">c</span>(.<span class="dv">76</span>, .<span class="dv">97</span>),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">abort =</span> <span class="fu">c</span>(.<span class="dv">84</span>, .<span class="dv">97</span>),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lact =</span> <span class="fu">c</span>(.<span class="dv">66</span>, .<span class="dv">56</span>),</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fecund =</span> <span class="fu">c</span>(<span class="fl">16.573</span>, <span class="fl">16.158</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg2<span class="fl">.4</span>,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"prop_m"</span>, <span class="st">"noncontr"</span>, <span class="st">"abort"</span>, <span class="st">"lact"</span>, <span class="st">"fecund"</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = prop_m*noncontr*abort*lact*fecund</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             1970     1980       diff decomp
prop_m   4.519768 5.610746  1.0909785  52.46
noncontr 4.450863 5.680707  1.2298438  59.13
abort    4.702966 5.430806  0.7278399  35.00
lact     5.543146 4.703276 -0.8398707 -40.38
fecund   5.152352 5.023334 -0.1290187  -6.20
crude    4.050102 6.129875  2.0797729 100.00</code></pre>
</div>
</div>
<p><strong>Example 4.1:</strong> Female intrinsic growth rate per person as a function of two vector factors: United States, 1980 and 1985</p>
<pre><code>- `Lx` = stationary female population
- `Mx` = fertility rate</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>eg4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="fu">c</span>(<span class="st">"10-15"</span>, <span class="st">"15-20"</span>, <span class="st">"20-25"</span>, <span class="st">"25-30"</span>, <span class="st">"30-35"</span>, <span class="st">"35-40"</span>, <span class="st">"40-45"</span>, <span class="st">"45-50"</span>, <span class="st">"50-55"</span>),</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1965</span>, <span class="dv">1960</span>), <span class="at">e =</span> <span class="dv">9</span>),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lx =</span> <span class="fu">c</span>(<span class="dv">486446</span>, <span class="dv">485454</span>, <span class="dv">483929</span>, <span class="dv">482046</span>, <span class="dv">479522</span>, <span class="dv">475844</span>, <span class="dv">470419</span>, <span class="dv">462351</span>, <span class="dv">450468</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>         <span class="dv">485434</span>, <span class="dv">484410</span>, <span class="dv">492905</span>, <span class="dv">481001</span>, <span class="dv">478485</span>, <span class="dv">474911</span>, <span class="dv">469528</span>, <span class="dv">461368</span>, <span class="dv">449349</span>),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mx =</span> <span class="fu">c</span>(.<span class="dv">00041</span>, .<span class="dv">03416</span>, .<span class="dv">09584</span>, .<span class="dv">07915</span>, .<span class="dv">04651</span>, .<span class="dv">02283</span>, .<span class="dv">00631</span>, .<span class="dv">00038</span>, .<span class="dv">00000</span>,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>         .<span class="dv">00040</span>, .<span class="dv">04335</span>, .<span class="dv">12581</span>, .<span class="dv">09641</span>, .<span class="dv">05504</span>, .<span class="dv">02760</span>, .<span class="dv">00756</span>, .<span class="dv">00045</span>, .<span class="dv">00000</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rate function:</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>RF4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B) {</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(A))</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  mu0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(A <span class="sc">*</span> B <span class="sc">/</span> <span class="dv">100000</span>)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  mu1 <span class="ot">&lt;-</span> <span class="fu">sum</span>((<span class="dv">5</span> <span class="sc">*</span> idx <span class="sc">+</span> <span class="fl">7.5</span>) <span class="sc">*</span> A <span class="sc">*</span> B <span class="sc">/</span> <span class="dv">100000</span>)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  r1 <span class="ot">&lt;-</span> <span class="fu">log</span>(mu0) <span class="sc">*</span> (mu0 <span class="sc">/</span> mu1)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    Nr1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    Dr1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    Nr1 <span class="ot">&lt;-</span> Nr1 <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span>r1 <span class="sc">*</span> (<span class="dv">5</span> <span class="sc">*</span> idx <span class="sc">+</span> <span class="fl">7.5</span>)) <span class="sc">*</span> A <span class="sc">*</span> (B <span class="sc">/</span> <span class="dv">100000</span>))</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    Dr1 <span class="ot">&lt;-</span> Dr1 <span class="sc">-</span> <span class="fu">sum</span>((<span class="dv">5</span> <span class="sc">*</span> idx <span class="sc">+</span> <span class="fl">7.5</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>r1 <span class="sc">*</span> (<span class="dv">5</span> <span class="sc">*</span> idx <span class="sc">+</span> <span class="fl">7.5</span>)) <span class="sc">*</span> A <span class="sc">*</span> (B <span class="sc">/</span> <span class="dv">100000</span>))</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    r2 <span class="ot">&lt;-</span> r1 <span class="sc">-</span> ((Nr1 <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> Dr1)</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(r2 <span class="sc">-</span> r1) <span class="sc">&lt;=</span> .<span class="dv">0000001</span>) {</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>    r1 <span class="ot">&lt;-</span> r2</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(r2)</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a><span class="co"># crude rates:</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="fu">RF4.1</span>(<span class="at">A =</span> eg4<span class="fl">.1</span><span class="sc">$</span>Lx[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">B =</span> eg4<span class="fl">.1</span><span class="sc">$</span>mx[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01213679</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RF4.1</span>(<span class="at">A =</span> eg4<span class="fl">.1</span><span class="sc">$</span>Lx[<span class="dv">10</span><span class="sc">:</span><span class="dv">18</span>], <span class="at">B =</span> eg4<span class="fl">.1</span><span class="sc">$</span>mx[<span class="dv">10</span><span class="sc">:</span><span class="dv">18</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02107187</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># decomposition:</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dgnpop</span>(eg4<span class="fl">.1</span>,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pop =</span> <span class="st">"pop"</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">"Lx"</span>, <span class="st">"mx"</span>),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_vars =</span> <span class="st">"age_group"</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratefunction =</span> <span class="st">"RF4.1(Lx,mx)"</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dg_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
DG decomposition being conducted with R = RF4.1(Lx,mx)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>            1960       1965          diff decomp
Lx    0.01670319 0.01649246 -0.0002107251   2.36
mx    0.02096000 0.01223564 -0.0087243576  97.64
crude 0.02107187 0.01213679 -0.0089350827 100.00</code></pre>
</div>
</div>
<!-- # Supplementary - Re-expression of population structures -->
<!-- When working with cross-classified data, Das Gupta developed a method of specifying group proportions as set of symmetric proportions indicating the contribution of each structural variable.   -->
<!-- Returning to the example above, we can compute these manually for the case of 2 cross-classified variables as so:   -->
<!-- ```{r} -->
<!-- eg5.3a <- -->
<!--   eg5.3 |> -->
<!--   group_by(pop) |> -->
<!--   mutate(n_tot = sum(size)) |> -->
<!--   group_by(pop, age) |> -->
<!--   mutate(n_age = sum(size)) |> -->
<!--   group_by(pop, race) |> -->
<!--   mutate(n_race = sum(size)) |> -->
<!--   ungroup() |> -->
<!--   mutate( -->
<!--     A = ((size / n_race) * (n_age / n_tot))^(1 / 2), -->
<!--     B = ((size / n_age) * (n_race / n_tot))^(1 / 2), -->
<!--   ) -->
<!-- ``` -->
<!-- The product of variables `A` and `B` above will return the individual group proportions:  -->
<!-- ```{r} -->
<!-- eg5.3a |> -->
<!--   mutate( -->
<!--     AB = A * B, -->
<!--     prop = size / n_tot -->
<!--   ) |> -->
<!--   head() -->
<!-- ``` -->
<!-- Internally, `dgnpop()` will do this provided `id_vars` and `crossclassified` are specified as detailed above. However, should users wish, this intermediary step in the decomposition can be done using `dgcc()`:   -->
<!-- ```{r} -->
<!-- dgcc(eg5.3, -->
<!--   pop = "pop", id_vars = c("age", "race"), -->
<!--   crossclassified = "size" -->
<!-- ) |> -->
<!--   head() -->
<!-- ``` -->

</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Blinder1973-ig" class="csl-entry" role="listitem">
Blinder, Alan S. 1973. <span>“Wage Discrimination: Reduced Form and Structural Estimates.”</span> <em>J. Hum. Resour.</em> 8 (4): 436.
</div>
<div id="ref-Chevan2009-dt" class="csl-entry" role="listitem">
Chevan, Albert, and Michael Sutherland. 2009. <span>“Revisiting Das Gupta: Refinement and Extension of Standardization and Decomposition.”</span> <em>Demography</em> 46 (3): 429–49.
</div>
<div id="ref-Das-Gupta1978-er" class="csl-entry" role="listitem">
Das Gupta, P. 1978. <span>“A General Method of Decomposing a Difference Between Two Rates into Several Components.”</span> <em>Demography</em> 15 (1): 99–112.
</div>
<div id="ref-Das-Gupta1989-no" class="csl-entry" role="listitem">
———. 1989. <span>“Methods of Decomposing the Difference Between Two Rates with Applications to Race-Sex Inequality in Earnings.”</span> <em>Math. Popul. Stud.</em> 2 (1): 15–36, 89.
</div>
<div id="ref-Das-Gupta1993-ie" class="csl-entry" role="listitem">
———. 1993. <em>Standardization and Decomposition of Rates: A User’s Manual</em>.
</div>
<div id="ref-Das-Gupta1994-fl" class="csl-entry" role="listitem">
———. 1994. <span>“Standardization and Decomposition of Rates from Cross-Classified Data.”</span> <em>Genus</em> 50 (3-4): 171–96.
</div>
<div id="ref-Das-Gupta1991-qu" class="csl-entry" role="listitem">
Das Gupta, Prithwis. 1991. <span>“Decomposition of the Difference Between Two Rates and Its Consistency When More Than Two Populations Are Involved.”</span> <em>Math. Popul. Stud.</em> 3 (2): 105–25.
</div>
<div id="ref-Kitagawa1955-sa" class="csl-entry" role="listitem">
Kitagawa, Evelyn M. 1955. <span>“Components of a Difference Between Two Rates.”</span> <em>J. Am. Stat. Assoc.</em> 50 (272): 1168.
</div>
<div id="ref-Li2017-kj" class="csl-entry" role="listitem">
Li, Jinjing. 2017. <span>“Rate Decomposition for Aggregate Data Using Das Gupta’s Method.”</span> <em>Stata J.</em> 17 (2): 490–502.
</div>
<div id="ref-Oaxaca1973-ef" class="csl-entry" role="listitem">
Oaxaca, Ronald. 1973. <span>“Male-Female Wage Differentials in Urban Labor Markets.”</span> <em>Int. Econ. Rev. (Philadelphia)</em> 14 (3): 693.
</div>
<div id="ref-Oaxaca2023-gt" class="csl-entry" role="listitem">
Oaxaca, Ronald L, and Eva Sierminska. 2023. <span>“Oaxaca-Blinder Meets Kitagawa: What Is the Link?”</span> <em>SSRN Electron. J.</em>
</div>
<div id="ref-Wang2000-hc" class="csl-entry" role="listitem">
Wang, J, A Rahman, H A Siegal, and J H Fisher. 2000. <span>“Standardization and Decomposition of Rates: Useful Analytic Techniques for Behavior and Health Studies.”</span> <em>Behav. Res. Methods Instrum. Comput.</em> 32 (2): 357–66.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>does that make any sense at all?? “importance of the specific factor gradually fades when further changes to other factors are introduced in the counterfactual.”<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>started to write “It is important to note that rate decomposition methods are focused at the level of the population, not the individuals within them, so estimands are more easily written at this level rather than in terms of expectations of population averaged individual-level effects)”. and thought about <span class="math inline">\(\Delta \text{crude-}r = \mathbb{E} [R^1|P=1] -  \mathbb{E} [R^0|P=0]\)</span> and <span class="math inline">\(\Delta \text{P-rate-standardised-}r = \mathbb{E} [R^1 - R^0]]\)</span>, but it doesn’t quite work i don’t think<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>