

	####### B156834 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 2
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
library(lsr, quietly = T)
[1] 3
 [1] "lsr"       "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
library(plyr, quietly = T)
[1] 4
 [1] "plyr"      "lsr"       "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"    
[11] "datasets"  "methods"   "base"     
library(ggplot2, quietly = T)
[1] 5
 [1] "ggplot2"   "plyr"      "lsr"       "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices"
[11] "utils"     "datasets"  "methods"   "base"     
library(doBy, quietly = T)
[1] 6
 [1] "doBy"      "ggplot2"   "plyr"      "lsr"       "car"       "carData"   "psych"     "readr"     "stats"     "graphics" 
[11] "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 7
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 8
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
summary(officer_inc)
[1] 9
 officer     incident_id 
 AS  :116   inc_1  :  1  
 IT  : 66   inc_10 :  1  
 NP  : 67   inc_100:  1  
 NA's:  1   inc_101:  1  
            inc_102:  1  
            inc_103:  1  
            (Other):244  
d <- merge(drinkdriving, officer_inc, all = T)
[1] 10
summary(d)
[1] 11
 incident_id             age          nighttime         prior_offence          speed             bac           outcome         
 Length:250         Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250        
 Class :character   1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character  
 Mode  :character   Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character  
                    Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                     
                    3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                     
                    Max.   :297.00                                         Max.   :120.34   Max.   :65.764                     
 officer   
 AS  :116  
 IT  : 66  
 NP  : 67  
 NA's:  1  
           
           
 [ reached getOption("max.print") -- omitted 1 row ]
outliers <- function(obs, x = 2.5) {
    return(abs(obs - mean(obs, na.rm = T)) > (sd(obs, na.rm = T) * 
        x))
}
[1] 12
class(d$age)
[1] 13
[1] "numeric"
d$age <- as.integer(d$age)
[1] 14
which(outliers(d$age))
[1] 15
[1]  18 140 198
d$age[c(18, 140, 198)] <- NA
[1] 16
d$age[d$age < 17] <- NA
[1] 17
which(outliers(d$speed))
[1] 18
[1]   2  14  62  70 196 218
d$speed[c(2, 14, 62, 70, 196, 218)] <- NA
[1] 19
class(d$speed)
[1] 20
[1] "numeric"
which(outliers(d$bac))
[1] 21
[1]  14  62 198
d$bac[c(14, 62, 198)] <- NA
[1] 22
d$bac <- d$bac/100
[1] 23
class(d$bac)
[1] 24
[1] "numeric"
table(d$nighttime)
[1] 25

18:25  2:05   day night 
    1     2    78   169 
d$nighttime[d$nighttime == "2:05"] <- "night"
[1] 26
d$nighttime[d$nighttime == "18:25"] <- "day"
[1] 27
class(d$nighttime)
[1] 28
[1] "character"
d$nighttime <- as.factor(d$nighttime)
[1] 29
levels(d$nighttime)
[1] 30
[1] "day"   "night"
table(d$outcome)
[1] 31

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
d$outcome[d$outcome == "FINE"] <- "fine"
[1] 32
d$outcome[d$outcome == "Fine"] <- "fine"
[1] 33
d$outcome[d$outcome == "WARNING"] <- "warning"
[1] 34
d$outcome[d$outcome == "Warning"] <- "warning"
[1] 35
class(d$outcome)
[1] 36
[1] "character"
d$outcome <- as.factor(d$outcome)
[1] 37
levels(d$outcome)
[1] 38
[1] "fine"    "warning"
class(d$incident_id)
[1] 39
[1] "character"
d$incident_id <- as.factor(d$incident_id)
[1] 40
table(d$prior_offence)
[1] 41

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
d$prior_offence <- revalue(d$prior_offence, c(CD10 = "CD", CD60 = "CD", 
    `CD60,CD10,DR80` = "CD,DR80", `CD60,CD60` = "CD", DD20 = NA, 
    PL10 = "PL", SP50 = "SP", SP60 = "SP", TS70 = "TS", `TS70,DR50` = "TS,DR50"))
[1] 42
class(d$prior_offence)
[1] 43
[1] "character"
d$prior_offence <- as.factor(d$prior_offence)
[1] 44
m1 <- lm(bac ~ age, data = d)
[1] 45
summary(m1)
[1] 46

Call:
lm(formula = bac ~ age, data = d)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.151959 -0.041261 -0.008169  0.040809  0.147662 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2811832  0.0115626  24.318  < 2e-16 ***
age         -0.0012660  0.0002479  -5.107 7.37e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05834 on 208 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1114,	Adjusted R-squared:  0.1072 
F-statistic: 26.09 on 1 and 208 DF,  p-value: 7.366e-07

with(drinkdriving, plot(d$age, d$bac, xlab = "Age", ylab = "Blood Alcohol Content", 
    bty = "n", font = 2, font.lab = 2, abline(m1, col = "red")))
[1] 47
plot(m1, which = 1)
[1] 48
plot(m1, which = 2)
[1] 49
plot(m1, which = 3)
[1] 50
plot(m1, which = 4)
[1] 51
fiftybac <- data.frame(age = 50)
[1] 52
predict(m1, newdata = fiftybac)
[1] 53
        1 
0.2178828 
hist(x = residuals(m1))
[1] 54
plot(density(residuals(m1)), bty = "n")
[1] 55
plot(m1, which = 2)
[1] 56
shapiro.test(residuals(m1))
[1] 57

	Shapiro-Wilk normality test

data:  residuals(m1)
W = 0.99315, p-value = 0.4415

m2 <- lm(bac ~ age + nighttime, data = d)
[1] 58
summary(m2)
[1] 59

Call:
lm(formula = bac ~ age + nighttime, data = d)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.165793 -0.047183  0.003282  0.037481  0.143344 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2506303  0.0127764  19.617  < 2e-16 ***
age            -0.0011738  0.0002369  -4.954 1.50e-06 ***
nighttimenight  0.0389448  0.0082547   4.718 4.38e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05557 on 207 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1977,	Adjusted R-squared:   0.19 
F-statistic: 25.51 on 2 and 207 DF,  p-value: 1.254e-10

m3 <- lm(bac ~ age + speed, data = d)
[1] 60
summary(m3)
[1] 61

Call:
lm(formula = bac ~ age + speed, data = d)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.152503 -0.039663 -0.006632  0.038675  0.141797 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2364084  0.0303200   7.797 3.25e-13 ***
age         -0.0009604  0.0003347  -2.869  0.00455 ** 
speed        0.0007943  0.0004777   1.663  0.09790 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05821 on 203 degrees of freedom
  (44 observations deleted due to missingness)
Multiple R-squared:  0.1308,	Adjusted R-squared:  0.1222 
F-statistic: 15.27 on 2 and 203 DF,  p-value: 6.639e-07

par(mfrow = c(2, 2))
[1] 62
$mfrow
[1] 1 1

plot(m2, which = 1:4)
[1] 63
par(mfrow = c(2, 2))
[1] 64
$mfrow
[1] 2 2

plot(m3, which = 1:4)
[1] 65
model_everything <- lm(bac ~ age + nighttime + speed, data = d)
[1] 66
summary(model_everything)
[1] 67

Call:
lm(formula = bac ~ age + nighttime + speed, data = d)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.151302 -0.043461  0.003672  0.036329  0.141756 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2125537  0.0294780   7.211 1.09e-11 ***
age            -0.0008990  0.0003203  -2.807   0.0055 ** 
nighttimenight  0.0372808  0.0083312   4.475 1.28e-05 ***
speed           0.0006916  0.0004573   1.512   0.1320    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05566 on 202 degrees of freedom
  (44 observations deleted due to missingness)
Multiple R-squared:  0.2092,	Adjusted R-squared:  0.1974 
F-statistic: 17.81 on 3 and 202 DF,  p-value: 2.697e-10

independentSamplesTTest(formula = speed ~ nighttime, data = d)
[1] 68

   Welch's independent samples t-test 

Outcome variable:   speed 
Grouping variable:  nighttime 

Descriptive statistics: 
               day  night
   mean     38.473 41.650
   std dev. 11.212 13.712

Hypotheses: 
   null:        population means equal for both groups
   alternative: different population means in each group

Test results: 
   t-statistic:  -1.917 
   degrees of freedom:  181.441 
   p-value:  0.057 

Other information: 
   two-sided 95% confidence interval:  [-6.445, 0.093] 
   estimated effect size (Cohen's d):  0.254 

boxplot(d$speed ~ d$nighttime, main = "Boxplot of Test Means", 
    xlab = "Time of the day", ylab = "Speed")
[1] 69
d$new.outcome <- ifelse(d$outcome == "fine", 1, 0)
[1] 70
d$new.outcome <- as.factor(d$new.outcome)
[1] 71
contrasts(d$new.outcome)
[1] 72
  1
0 0
1 1
m4 <- glm(new.outcome ~ bac + speed + age + nighttime + prior_offence, 
    family = binomial, data = d)
[1] 73
summary(m4)
[1] 74

Call:
glm(formula = new.outcome ~ bac + speed + age + nighttime + prior_offence, 
    family = binomial, data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.2751   0.0054   0.0466   0.2266   1.8122  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)          2.35199    3.59329   0.655 0.512756    
bac                 29.18933    7.67594   3.803 0.000143 ***
speed                0.13517    0.05047   2.678 0.007403 ** 
age                 -0.14163    0.03817  -3.710 0.000207 ***
nighttimenight      -0.39783    0.74771  -0.532 0.594686    
prior_offenceDR50   -1.25731    2.18202  -0.576 0.564471    
prior_offenceDR80   -8.26010    2.95876  -2.792 0.005242 ** 
prior_offenceN      -3.66958    1.92317  -1.908 0.056380 .  
prior_offencePL     -1.67290   43.63321  -0.038 0.969417    
prior_offenceSP     -8.83035    2.89997  -3.045 0.002327 ** 
 [ reached getOption("max.print") -- omitted 1 row ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 192.370  on 201  degrees of freedom
Residual deviance:  63.269  on 191  degrees of freedom
  (48 observations deleted due to missingness)
AIC: 85.269

Number of Fisher Scoring iterations: 15

m5 <- glm(outcome ~ scale(bac), family = binomial, data = d)
[1] 75
summary(m5)
[1] 76

Call:
glm(formula = outcome ~ scale(bac), family = binomial, data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.6523  -0.6493  -0.4071  -0.2110   2.9764  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  -1.8779     0.2214  -8.482  < 2e-16 ***
scale(bac)   -1.3043     0.2210  -5.901 3.61e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 235.39  on 241  degrees of freedom
Residual deviance: 186.78  on 240  degrees of freedom
  (8 observations deleted due to missingness)
AIC: 190.78

Number of Fisher Scoring iterations: 5

anova(m5, test = "Chisq")
[1] 77
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


           Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                         241     235.39              
scale(bac)  1   48.607       240     186.78 3.127e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m6 <- glm(outcome ~ scale(speed), family = binomial, data = d)
[1] 78
summary(m6)
[1] 79

Call:
glm(formula = outcome ~ scale(speed), family = binomial, data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8321  -0.5255  -0.2571  -0.0921   3.4656  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.4805     0.3108  -7.981 1.45e-15 ***
scale(speed)  -2.0543     0.3156  -6.509 7.55e-11 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 230.28  on 243  degrees of freedom
Residual deviance: 153.22  on 242  degrees of freedom
  (6 observations deleted due to missingness)
AIC: 157.22

Number of Fisher Scoring iterations: 6

anova(m6, test = "Chisq")
[1] 80
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


             Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                           243     230.28              
scale(speed)  1   77.067       242     153.22 < 2.2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
d$drinking.offence <- ifelse(d$prior_offence == "DR50", 1, 0)
[1] 81
d$drinking.offence[d$prior_offence == "N"] <- NA
[1] 82
d$drinking.offence <- as.factor(d$drinking.offence)
[1] 83
m7 <- glm(new.outcome ~ drinking.offence, family = binomial, 
    data = d)
[1] 84
summary(m7)
[1] 85

Call:
glm(formula = new.outcome ~ drinking.offence, family = binomial, 
    data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3076   0.3803   0.3803   0.3803   0.9005  

Coefficients:
                  Estimate Std. Error z value Pr(>|z|)  
(Intercept)         0.6931     0.5000   1.386    0.166  
drinking.offence1   1.8971     0.7800   2.432    0.015 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 51.047  on 60  degrees of freedom
Residual deviance: 44.676  on 59  degrees of freedom
  (189 observations deleted due to missingness)
AIC: 48.676

Number of Fisher Scoring iterations: 5

exp(1.9)
[1] 86
[1] 6.685894
d$any.offence <- ifelse(d$prior_offence != "N", 1, 0)
[1] 87
d$any.offence <- as.factor(d$any.offence)
[1] 88
m8 <- glm(outcome ~ any.offence, family = binomial, data = d)
[1] 89
summary(m8)
[1] 90

Call:
glm(formula = outcome ~ any.offence, family = binomial, data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.6681  -0.6681  -0.6681  -0.5650   1.9564  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -1.3863     0.1838  -7.542 4.62e-14 ***
any.offence1  -0.3677     0.4051  -0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

new.data.frame <- with(d, data.frame(age = sort(unique(d$age)), 
    nighttime = as.factor("day"), speed = 30, bac = 0, prior_offence = "N", 
    na.rm = TRUE))
[1] 91
predicted.prob <- glm(d$new.outcome ~ age + prior_offence + nighttime + 
    speed + bac, data = d, family = binomial)
[1] 92
predicted.data <- predict(predicted.prob, newdata = new.data.frame, 
    type = "response")
[1] 93
plot(new.data.frame$age, predicted.data, ylab = "Predicted Probability for Fine", 
    xlab = "Age", bty = "n", lty = 2, type = "l", font.lab = 2)
[1] 94
biased.model <- glm(new.outcome ~ officer * age, data = d, family = binomial)
[1] 95
summary(biased.model)
[1] 96

Call:
glm(formula = new.outcome ~ officer * age, family = binomial, 
    data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0757   0.3183   0.5638   2.4075  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    9.55712    2.00043   4.778 1.77e-06 ***
officerIT     -5.14843    2.41761  -2.130   0.0332 *  
officerNP     -4.67258    2.49279  -1.874   0.0609 .  
age           -0.16102    0.03474  -4.635 3.57e-06 ***
officerIT:age  0.09792    0.04290   2.283   0.0225 *  
officerNP:age  0.09345    0.04412   2.118   0.0342 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 218.83  on 216  degrees of freedom
Residual deviance: 146.22  on 211  degrees of freedom
  (33 observations deleted due to missingness)
AIC: 158.22

Number of Fisher Scoring iterations: 6

exp(-0.16)
[1] 97
[1] 0.8521438
exp(0.1)
[1] 98
[1] 1.105171
d <- d[complete.cases(d), ]
[1] 99
results <- summaryBy(age ~ outcome + officer, data = d, FUN = mean, 
    keep.names = TRUE)
[1] 100
ggplot(results, aes(x = officer, y = age, fill = outcome)) + 
    geom_bar(stat = "identity", position = "dodge") + geom_label(aes(label = round(results$age, 
    2)))
[1] 101
