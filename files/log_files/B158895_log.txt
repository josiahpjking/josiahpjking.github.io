

	####### B158895 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 2
[1] "drinkdriving" "officer_inc" 
describe(drinkdriving)
[1] 3
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
describe(officer_inc)
[1] 4
             vars   n  mean    sd median trimmed   mad min max range skew kurtosis   se
officer*        1 249   1.8  0.84    2.0    1.76  1.48   1   3     2 0.38    -1.47 0.05
incident_id*    2 250 125.5 72.31  125.5  125.50 92.66   1 250   249 0.00    -1.21 4.57
outliers <- function(obs, x = 2.5) {
    return(which(abs(scale(obs)) > mean(scale(obs), na.rm = T) + 
        x * sd(scale(obs), na.rm = T)))
}
[1] 5
drinkdriving$age[outliers(drinkdriving$age)] <- NA
[1] 6
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 7
levels(drinkdriving$nighttime)
[1] 8
[1] "18:25" "2:05"  "day"   "night"
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "day"
[1] 9
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 10
drinkdriving$nighttime <- droplevels(drinkdriving$nighttime)
[1] 11
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 12
summary(drinkdriving$prior_offence)
[1] 13
          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 14
levels(drinkdriving$prior_offence) <- c(levels(drinkdriving$prior_offence), 
    "CD", "SP")
[1] 15
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60,CD60"] <- "CD"
[1] 16
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD10"] <- "CD"
[1] 17
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60"] <- "CD"
[1] 18
drinkdriving$prior_offence[drinkdriving$prior_offence == "SP50"] <- "SP"
[1] 19
drinkdriving$prior_offence[drinkdriving$prior_offence == "SP60"] <- "SP"
[1] 20
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60,CD10,DR80"] <- "CD"
[1] 21
drinkdriving$prior_offence[drinkdriving$prior_offence == "TS70,DR50"] <- "DR50"
[1] 22
drinkdriving$prior_offence <- droplevels(drinkdriving$prior_offence)
[1] 23
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 24
summary(drinkdriving$outcome)
[1] 25
   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 26
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 27
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 28
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 29
drinkdriving$outcome <- droplevels(drinkdriving$outcome)
[1] 30
drinkdriving$speed[outliers(drinkdriving$speed)] <- NA
[1] 31
summary(drinkdriving$speed)
[1] 32
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  11.23   31.56   40.68   40.63   48.75   75.87       6 
drinkdriving$bac[outliers(drinkdriving$bac)] <- NA
[1] 33
summary(drinkdriving$bac)
[1] 34
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  5.453  19.317  23.557  23.372  27.843  36.138       8 
df <- merge(drinkdriving, officer_inc, all.x = T)
[1] 35
m1 <- lm(bac ~ age, data = drinkdriving, na.action = na.exclude)
[1] 36
plot(m1)
[1] 37
plot(m1, 1, main = "Linear Relationship in Model One")
[1] 38
plot(m1, 2, main = "Normality Distribution of Model One")
[1] 39
plot(m1, 3, main = "Homogeneity of Variables in Model One")
[1] 40
summary(m1)
[1] 41

Call:
lm(formula = bac ~ age, data = drinkdriving, na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

predicting_age <- data.frame(age = 50)
[1] 42
predict(m1, newdata = predicting_age)
[1] 43
       1 
21.81983 
plot(m1, 2, main = "Normality Distribution of Model One")
[1] 44
m2 <- lm(bac ~ age + nighttime, data = df, na.action = na.exclude)
[1] 45
anova(m2)
[1] 46
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14  38.345 2.969e-09 ***
nighttime   1  721.4  721.42  23.783 2.096e-06 ***
Residuals 215 6521.7   30.33                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2)
[1] 47

Call:
lm(formula = bac ~ age + nighttime, data = df, na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.5254  -4.6056   0.3152   3.7847  14.3450 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    25.60505    1.19731  21.386  < 2e-16 ***
age            -0.12800    0.02225  -5.752 3.01e-08 ***
nighttimenight  3.92560    0.80496   4.877 2.10e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.508 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2242,	Adjusted R-squared:  0.217 
F-statistic: 31.06 on 2 and 215 DF,  p-value: 1.409e-12

m3 <- lm(bac ~ age + speed, data = df, na.action = na.exclude)
[1] 48
anova(m3)
[1] 49
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1224.1 1224.12 36.7909 6.001e-09 ***
speed       1  113.5  113.52  3.4118   0.06613 .  
Residuals 211 7020.5   33.27                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m3)
[1] 50

Call:
lm(formula = bac ~ age + speed, data = df, na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4289  -3.6417  -0.6605   3.8871  14.2922 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 23.84391    2.91735   8.173 2.76e-14 ***
age         -0.10325    0.03208  -3.219  0.00149 ** 
speed        0.08457    0.04578   1.847  0.06613 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.768 on 211 degrees of freedom
  (36 observations deleted due to missingness)
Multiple R-squared:   0.16,	Adjusted R-squared:  0.1521 
F-statistic:  20.1 on 2 and 211 DF,  p-value: 1.022e-08

t.test(speed ~ nighttime, df, na.action = na.exclude)
[1] 51

	Welch Two Sample t-test

data:  speed by nighttime
t = -1.9173, df = 181.44, p-value = 0.05677
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -6.44500648  0.09251201
sample estimates:
  mean in group day mean in group night 
           38.47328            41.64953 

df$outcome_coded <- ifelse(df$outcome == "fine", 1, 0)
[1] 52
outcome_model <- glm(outcome_coded ~ age + nighttime + relevel(prior_offence, 
    "N") + speed + bac, data = df, family = binomial(link = "logit"), 
    na.action = na.exclude)
[1] 53
summary(outcome_model)
[1] 54

Call:
glm(formula = outcome_coded ~ age + nighttime + relevel(prior_offence, 
    "N") + speed + bac, family = binomial(link = "logit"), data = df, 
    na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.2752   0.0049   0.0434   0.2152   1.8122  

Coefficients:
                                  Estimate Std. Error z value Pr(>|z|)    
(Intercept)                       -1.31741    3.15381  -0.418 0.676152    
age                               -0.14164    0.03817  -3.711 0.000206 ***
nighttimenight                    -0.39785    0.74773  -0.532 0.594669    
relevel(prior_offence, "N")DR50    2.41231    1.25098   1.928 0.053812 .  
relevel(prior_offence, "N")DR80   -4.59078    2.04978  -2.240 0.025113 *  
relevel(prior_offence, "N")PL10    1.99676   43.61336   0.046 0.963483    
relevel(prior_offence, "N")TS70   17.84651 1434.66488   0.012 0.990075    
relevel(prior_offence, "N")CD      3.66976    1.92315   1.908 0.056366 .  
relevel(prior_offence, "N")SP     -5.16106    1.91847  -2.690 0.007141 ** 
speed                              0.13517    0.05047   2.678 0.007401 ** 
 [ reached getOption("max.print") -- omitted 1 row ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 195.538  on 209  degrees of freedom
Residual deviance:  63.269  on 199  degrees of freedom
  (40 observations deleted due to missingness)
AIC: 85.269

Number of Fisher Scoring iterations: 15

exp(confint(outcome_model))
[1] 55
                                       2.5 %       97.5 %
(Intercept)                     4.265920e-04 1.185195e+02
age                             7.976102e-01 9.286651e-01
nighttimenight                  1.448233e-01 2.841819e+00
relevel(prior_offence, "N")DR50 1.402004e+00 2.467630e+02
relevel(prior_offence, "N")DR80 1.466315e-04 5.949980e-01
relevel(prior_offence, "N")PL10 1.181071e-03 6.410149e+04
relevel(prior_offence, "N")TS70 4.291102e-90           NA
relevel(prior_offence, "N")CD   8.439532e-01 2.336579e+03
relevel(prior_offence, "N")SP   8.758151e-05 2.650520e-01
speed                           1.046258e+00 1.278774e+00
bac                             1.169172e+00 1.585548e+00
outcome_scaled <- glm(outcome_coded ~ scale(speed) + scale(bac), 
    data = df, family = binomial)
[1] 56
summary(outcome_scaled)
[1] 57

Call:
glm(formula = outcome_coded ~ scale(speed) + scale(bac), family = binomial, 
    data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0363   0.0589   0.2013   0.4598   1.9298  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    2.8008     0.3665   7.643 2.13e-14 ***
scale(speed)   1.8276     0.3551   5.146 2.66e-07 ***
scale(bac)     1.1357     0.2728   4.163 3.14e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 221.82  on 237  degrees of freedom
Residual deviance: 129.34  on 235  degrees of freedom
  (12 observations deleted due to missingness)
AIC: 135.34

Number of Fisher Scoring iterations: 6

outcome_offence <- glm(outcome_coded ~ relevel(prior_offence, 
    "N"), data = df, family = binomial)
[1] 58
summary(outcome_offence)
[1] 59

Call:
glm(formula = outcome_coded ~ relevel(prior_offence, "N"), family = binomial, 
    data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1899   0.4366   0.6681   0.6681   1.1774  

Coefficients:
                                  Estimate Std. Error z value Pr(>|z|)    
(Intercept)                      1.386e+00  1.838e-01   7.542 4.62e-14 ***
relevel(prior_offence, "N")DR50  9.163e-01  5.556e-01   1.649   0.0991 .  
relevel(prior_offence, "N")DR80 -2.877e-01  1.169e+00  -0.246   0.8056    
relevel(prior_offence, "N")PL10 -1.386e+00  1.426e+00  -0.972   0.3310    
relevel(prior_offence, "N")TS70 -6.931e-01  1.238e+00  -0.560   0.5757    
relevel(prior_offence, "N")CD    7.469e-15  1.133e+00   0.000   1.0000    
relevel(prior_offence, "N")SP   -6.931e-01  1.238e+00  -0.560   0.5757    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 231.87  on 239  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 245.87

Number of Fisher Scoring iterations: 4

t.test(df$outcome_coded ~ df$prior_offence == "N", na.action = na.exclude)
[1] 60

	Welch Two Sample t-test

data:  df$outcome_coded by df$prior_offence == "N"
t = 0.96328, df = 113.72, p-value = 0.3375
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.05542654  0.16034457
sample estimates:
mean in group FALSE  mean in group TRUE 
           0.852459            0.800000 

model <- data.frame(age = rep(df$age), nighttime = "day", prior_offence = "N", 
    speed = 30, bac = 0)
[1] 61
model$model_predicted <- predict(outcome_model, newdata = model, 
    type = "response")
[1] 62
plot(model$model_predicted ~ model$age, xlab = "Age", ylab = "Receiving Fine", 
    main = "Likelihood of Receiving a Fine Given the Age", col = "red")
[1] 63
bias <- glm(outcome ~ age * officer, data = df, family = binomial, 
    na.action = na.exclude)
[1] 64
anova(bias, test = "Chisq")
[1] 65
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


            Df Deviance Resid. Df Resid. Dev Pr(>Chi)    
NULL                          224     222.38             
age          1   67.728       223     154.65  < 2e-16 ***
officer      2    0.861       221     153.79  0.65013    
age:officer  2    7.383       219     146.41  0.02494 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(bias)
[1] 66

Call:
glm(formula = outcome ~ age * officer, family = binomial, data = df, 
    na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4089  -0.5454  -0.2741  -0.0642   2.7179  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -9.56920    1.99554  -4.795 1.62e-06 ***
age            0.16122    0.03466   4.652 3.29e-06 ***
officerIT      5.04535    2.39610   2.106   0.0352 *  
officerNP      4.68465    2.48887   1.882   0.0598 .  
age:officerIT -0.09612    0.04254  -2.260   0.0238 *  
age:officerNP -0.09365    0.04405  -2.126   0.0335 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

exp(coefficients(bias))
[1] 67
  (Intercept)           age     officerIT     officerNP age:officerIT age:officerNP 
 6.984753e-05  1.174947e+00  1.552992e+02  1.082727e+02  9.083530e-01  9.105991e-01 
