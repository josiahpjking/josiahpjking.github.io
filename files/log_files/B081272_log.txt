

	####### B081272 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 2
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
library(ggplot2, quietly = T)
[1] 3
 [1] "ggplot2"   "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
drinkdriving2 <- merge(drinkdriving, officer_inc, all = T)
[1] 5
drinkdriving2$outcome <- as.factor(drinkdriving2$outcome)
[1] 6
drinkdriving2$nighttime <- as.factor(drinkdriving2$nighttime)
[1] 7
drinkdriving2$officer <- as.factor(drinkdriving2$officer)
[1] 8
summary(drinkdriving2)
[1] 9
 incident_id             age         nighttime   prior_offence          speed             bac            outcome    officer   
 Length:250         Min.   : 14.00   18:25:  1   Length:250         Min.   :  0.00   Min.   : 3.987   fine   :191   AS  :116  
 Class :character   1st Qu.: 30.00   2:05 :  2   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Fine   :  2   IT  : 66  
 Mode  :character   Median : 40.50   day  : 78   Mode  :character   Median : 40.64   Median :23.609   FINE   :  9   NP  : 67  
                    Mean   : 46.00   night:169                      Mean   : 40.49   Mean   :23.605   warning: 43   NA's:  1  
                    3rd Qu.: 55.25                                  3rd Qu.: 48.84   3rd Qu.:27.898   Warning:  2             
                    Max.   :297.00                                  Max.   :120.34   Max.   :65.764   WARNING:  3             
 [ reached getOption("max.print") -- omitted 1 row ]
drinkdriving2$age[drinkdriving2$age > 90] <- NA
[1] 10
drinkdriving2$bac[drinkdriving2$bac > 40] <- NA
[1] 11
drinkdriving2$nighttime[drinkdriving2$nighttime == "18:25"] <- "day"
[1] 12
drinkdriving2$nighttime[drinkdriving2$nighttime == "2:05"] <- "night"
[1] 13
drinkdriving2$outcome[drinkdriving2$outcome == "Fine"] <- "fine"
[1] 14
drinkdriving2$outcome[drinkdriving2$outcome == "FINE"] <- "fine"
[1] 15
drinkdriving2$outcome[drinkdriving2$outcome == "Warning"] <- "warning"
[1] 16
drinkdriving2$outcome[drinkdriving2$outcome == "WARNING"] <- "warning"
[1] 17
drinkdriving2$prior_offence[drinkdriving2$prior_offence == "DD20"] <- NA
[1] 18
summary(drinkdriving2)
[1] 19
 incident_id             age        nighttime   prior_offence          speed             bac            outcome    officer   
 Length:250         Min.   :14.00   18:25:  0   Length:250         Min.   :  0.00   Min.   : 3.987   fine   :202   AS  :116  
 Class :character   1st Qu.:30.00   2:05 :  0   Class :character   1st Qu.: 30.92   1st Qu.:19.215   Fine   :  0   IT  : 66  
 Mode  :character   Median :40.00   day  : 79   Mode  :character   Median : 40.64   Median :23.504   FINE   :  0   NP  : 67  
                    Mean   :42.68   night:171                      Mean   : 40.49   Mean   :23.292   warning: 48   NA's:  1  
                    3rd Qu.:55.00                                  3rd Qu.: 48.84   3rd Qu.:27.789   Warning:  0             
                    Max.   :90.00                                  Max.   :120.34   Max.   :36.138   WARNING:  0             
 [ reached getOption("max.print") -- omitted 1 row ]
m1 <- lm(bac ~ age, data = drinkdriving2)
[1] 20
summary(m1)
[1] 21

Call:
lm(formula = bac ~ age, data = drinkdriving2)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

plot(drinkdriving2$age, drinkdriving2$bac, pch = 16, cex = 1.3, 
    col = "blue", main = "BAC plotted against Age", xlab = "Age (years)", 
    ylab = "BAC (%)")
[1] 22
abline(m1, col = "red")
[1] 23
par(mfrow = c(2, 2))
[1] 24
$mfrow
[1] 1 3

plot(m1, which = c(1:4))
[1] 25
new.age <- data.frame(age = c(50))
[1] 26
predict(m1, newdata = new.age)
[1] 27
       1 
21.81983 
par(mfrow = c(1, 1))
[1] 28
$mfrow
[1] 2 2

hist(resid(m1), main = "Histogram of Model 1 Residuals", xlab = "Model 1 Residuals", 
    col = "blue")
[1] 29
plot(density(residuals(m1)), main = "Density Plot for Model 1", 
    col = "blue")
[1] 30
plot(m1, 2, main = "Q-Q plot for Model 1 (BAC~Age)")
[1] 31
m2 <- lm(bac ~ age + nighttime, data = drinkdriving2)
[1] 32
summary(m2)
[1] 33

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving2)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.5254  -4.6056   0.3152   3.7847  14.3450 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    25.60505    1.19731  21.386  < 2e-16 ***
age            -0.12800    0.02225  -5.752 3.01e-08 ***
nighttimenight  3.92560    0.80496   4.877 2.10e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.508 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2242,	Adjusted R-squared:  0.217 
F-statistic: 31.06 on 2 and 215 DF,  p-value: 1.409e-12

anova(m2)
[1] 34
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14  38.345 2.969e-09 ***
nighttime   1  721.4  721.42  23.783 2.096e-06 ***
Residuals 215 6521.7   30.33                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m3 <- lm(bac ~ age + speed, data = drinkdriving2)
[1] 35
summary(m3)
[1] 36

Call:
lm(formula = bac ~ age + speed, data = drinkdriving2)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4118  -3.8926  -0.6094   4.1298  14.4229 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.08699    2.74183   9.514  < 2e-16 ***
age         -0.11540    0.03156  -3.656 0.000322 ***
speed        0.04320    0.04198   1.029 0.304616    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.79 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.574e-08

anova(m3)
[1] 37
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14 34.6961 1.471e-08 ***
speed       1   35.5   35.50  1.0589    0.3046    
Residuals 215 7207.6   33.52                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
par(mfrow = c(2, 2))
[1] 38
$mfrow
[1] 1 1

plot(m2)
[1] 39
plot(m3)
[1] 40
m4 <- lm(bac ~ age + speed + nighttime, data = drinkdriving2)
[1] 41
summary(m4)
[1] 42

Call:
lm(formula = bac ~ age + speed + nighttime, data = drinkdriving2)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.7811  -4.6224   0.5195   3.7225  14.2190 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    22.99435    2.68293   8.571 2.06e-15 ***
age            -0.10600    0.03007  -3.525 0.000518 ***
speed           0.04340    0.03992   1.087 0.278151    
nighttimenight  3.92649    0.80461   4.880 2.07e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

t.test(speed ~ nighttime, data = drinkdriving2)
[1] 43

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.71535, df = 158.46, p-value = 0.4754
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.371172  2.514895
sample estimates:
  mean in group day mean in group night 
           39.50953            40.93767 

describeBy(drinkdriving2$speed, drinkdriving2$nighttime)
[1] 44

 Descriptive statistics by group 
group: 18:25
NULL
----------------------------------------------------------------------------------------------------- 
group: 2:05
NULL
----------------------------------------------------------------------------------------------------- 
group: day
   vars  n  mean    sd median trimmed   mad   min    max  range skew kurtosis   se
X1    1 79 39.51 14.45  39.49   38.92 11.72 12.81 120.34 107.52    2    10.33 1.63
----------------------------------------------------------------------------------------------------- 
group: night
   vars   n  mean    sd median trimmed   mad min   max range  skew kurtosis   se
X1    1 171 40.94 15.14  41.01   41.05 13.59   0 81.03 81.03 -0.11     0.11 1.16
drinkdriving2$newoutcome <- "0"
[1] 45
drinkdriving2$newoutcome[drinkdriving2$outcome == "fine"] <- "1"
[1] 46
drinkdriving2$newoutcome <- as.factor(drinkdriving2$newoutcome)
[1] 47
m5 <- glm(newoutcome ~ speed + nighttime + bac + age + prior_offence, 
    data = drinkdriving2, family = binomial)
[1] 48
summary(m5)
[1] 49

Call:
glm(formula = newoutcome ~ speed + nighttime + bac + age + prior_offence, 
    family = binomial, data = drinkdriving2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.9572   0.0001   0.0039   0.0533   2.0824  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)              25.24283 4257.82867   0.006 0.995270    
speed                     0.20475    0.06244   3.279 0.001041 ** 
nighttimenight           -0.25410    1.00664  -0.252 0.800714    
bac                       0.47639    0.12462   3.823 0.000132 ***
age                      -0.24897    0.07275  -3.422 0.000621 ***
prior_offenceCD60       -54.24974 7789.34642  -0.007 0.994443    
prior_offenceDR50       -23.18877 4257.82679  -0.005 0.995655    
prior_offenceDR80       -34.00856 4257.82860  -0.008 0.993627    
prior_offenceN          -26.40078 4257.82677  -0.006 0.995053    
prior_offencePL10       -22.61348 4313.16164  -0.005 0.995817    
 [ reached getOption("max.print") -- omitted 4 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.086  on 213  degrees of freedom
Residual deviance:  35.984  on 200  degrees of freedom
  (36 observations deleted due to missingness)
AIC: 63.984

Number of Fisher Scoring iterations: 17

m6 <- glm(newoutcome ~ scale(speed) + scale(bac), data = drinkdriving2, 
    family = binomial)
[1] 50
summary(m6)
[1] 51

Call:
glm(formula = newoutcome ~ scale(speed) + scale(bac), family = binomial, 
    data = drinkdriving2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0812   0.0489   0.1875   0.4458   1.9536  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    2.8061     0.3647   7.694 1.43e-14 ***
scale(speed)   2.1932     0.3850   5.697 1.22e-08 ***
scale(bac)     1.1486     0.2737   4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 130.13  on 240  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 6

drinkdriving2$drinkoffence[drinkdriving2$prior_offence != "N"] <- "N"
[1] 52
drinkdriving2$drinkoffence[drinkdriving2$prior_offence == "DR50"] <- "Y"
[1] 53
drinkdriving2$drinkoffence[drinkdriving2$prior_offence == "TS70,DR50"] <- "Y"
[1] 54
chisq.test(drinkdriving2$newoutcome, drinkdriving2$drinkoffence)
[1] 55

	Pearson's Chi-squared test with Yates' continuity correction

data:  drinkdriving2$newoutcome and drinkdriving2$drinkoffence
X-squared = 2.5724, df = 1, p-value = 0.1087

drinkdriving2$anyoffence[drinkdriving2$prior_offence == "N"] <- "N"
[1] 56
drinkdriving2$anyoffence[drinkdriving2$prior_offence != "N"] <- "Y"
[1] 57
chisq.test(drinkdriving2$newoutcome, drinkdriving2$anyoffence)
[1] 58

	Pearson's Chi-squared test with Yates' continuity correction

data:  drinkdriving2$newoutcome and drinkdriving2$anyoffence
X-squared = 0.52118, df = 1, p-value = 0.4703

df <- data.frame(age = c(14:100), nighttime = factor(c("day")), 
    speed = c(30), bac = c(0), prior_offence = factor(c("N")))
[1] 59
predict(m5, type = "response")
[1] 60
           1            2            3            4            5            6            7            8            9           10 
9.992046e-01 1.479620e-02 2.998989e-04 9.638920e-01 9.902303e-01 9.963218e-01 9.999774e-01 9.999343e-01 1.000000e+00 1.000000e+00 
          11           12           13           15           16           17           19           20           21           23 
9.999905e-01 1.000000e+00 9.996023e-01 9.857673e-01 5.363162e-01 9.999788e-01 1.054235e-06 3.952632e-03 4.156953e-04 9.998682e-01 
          24           25           27           28           30           31           32           34           35           36 
9.999784e-01 8.646869e-09 9.906247e-01 3.340727e-01 1.000000e+00 9.453474e-01 9.822168e-01 9.999937e-01 9.999626e-01 9.954090e-01 
          37           38           39           42           43           44           45           46           47           48 
9.999850e-01 9.435490e-01 9.998561e-01 2.556605e-02 8.646869e-09 9.999766e-01 9.999998e-01 9.999918e-01 9.999999e-01 6.163911e-01 
          50           51           52           53           54           55           56           57           58           59 
9.985489e-01 9.999997e-01 1.000000e+00 9.999850e-01 9.999999e-01 9.999976e-01 2.302136e-03 9.996606e-01 9.999998e-01 8.867524e-01 
 [ reached getOption("max.print") -- omitted 164 entries ]
df$model_prediction <- predict(m5, type = "response", newdata = df)
[1] 61
par(mfrow = c(1, 1))
[1] 62
$mfrow
[1] 2 2

plot(df$age, df$model_prediction, main = "Predicted probabilities", 
    xlab = "Age (years)", ylab = "Probability of receiving a fine", 
    col = "blue", type = "l", lwd = 2)
[1] 63
m7 <- glm(newoutcome ~ age, data = drinkdriving2, family = binomial, 
    na.action = na.exclude)
[1] 64
with(drinkdriving2, plot(fitted(m7)[order(age)] ~ age[order(age)], 
    type = "l", lwd = 2, main = "Bias towards older people in giving fines", 
    xlab = "Age", ylab = "Chances of getting a fine", col = "blue"))
[1] 65
qplot(data = drinkdriving2[!is.na(drinkdriving2$officer), ], 
    officer, fill = outcome, main = "Number of fines and warnings by Officers", 
    xlab = "Officer")
[1] 66
bias <- ggplot(data = drinkdriving2[!is.na(drinkdriving2$officer), 
    ], aes(x = officer, y = age, col = outcome))
[1] 67
bias + geom_point() + theme_minimal() + labs(title = "Plot of outcome depending on age by officers", 
    x = "Officer", y = "Age (years)")
[1] 68
m8 <- glm(outcome ~ officer * age, data = drinkdriving2, family = binomial)
[1] 69
summary(m8)
[1] 70

Call:
glm(formula = outcome ~ officer * age, family = binomial, data = drinkdriving2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4089  -0.5454  -0.2741  -0.0642   2.7179  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -9.56920    1.99554  -4.795 1.62e-06 ***
officerIT      5.04535    2.39610   2.106   0.0352 *  
officerNP      4.68465    2.48887   1.882   0.0598 .  
age            0.16122    0.03466   4.652 3.29e-06 ***
officerIT:age -0.09612    0.04254  -2.260   0.0238 *  
officerNP:age -0.09365    0.04405  -2.126   0.0335 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

contrasts(drinkdriving2$officer)
[1] 71
   IT NP
AS  0  0
IT  1  0
NP  0  1
contrasts(drinkdriving2$officer) <- cbind(ASvITNP = c(2/3, -1/3, 
    -1/3), ITvNP = c(0, 1/2, -1/2))
[1] 72
m9 <- glm(outcome ~ officer * age, data = drinkdriving2, family = binomial)
[1] 73
summary(m9)
[1] 74

Call:
glm(formula = outcome ~ officer * age, family = binomial, data = drinkdriving2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4089  -0.5454  -0.2741  -0.0642   2.7179  

Coefficients:
                   Estimate Std. Error z value Pr(>|z|)    
(Intercept)        -6.32586    0.94007  -6.729 1.71e-11 ***
officerASvITNP     -4.86500    2.23048  -2.181   0.0292 *  
officerITvNP        0.36070    1.99283   0.181   0.8564    
age                 0.09796    0.01683   5.821 5.84e-09 ***
officerASvITNP:age  0.09489    0.03922   2.419   0.0155 *  
officerITvNP:age   -0.00247    0.03671  -0.067   0.9464    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

