

	####### B148350 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(scatterplot3d, quietly = T)
[1] 2
 [1] "scatterplot3d" "ggplot2"       "readr"         "stats"         "graphics"      "grDevices"     "utils"         "datasets"     
 [9] "methods"       "base"         
library(plot3D, quietly = T)
[1] 3
 [1] "plot3D"        "scatterplot3d" "ggplot2"       "readr"         "stats"         "graphics"      "grDevices"     "utils"        
 [9] "datasets"      "methods"       "base"         
library(plotly, quietly = T)
[1] 4
 [1] "plotly"        "plot3D"        "scatterplot3d" "ggplot2"       "readr"         "stats"         "graphics"      "grDevices"    
 [9] "utils"         "datasets"      "methods"       "base"         
library(car, quietly = T)
[1] 5
 [1] "car"           "carData"       "plotly"        "plot3D"        "scatterplot3d" "ggplot2"       "readr"         "stats"        
 [9] "graphics"      "grDevices"     "utils"         "datasets"      "methods"       "base"         
library(lsr, quietly = T)
[1] 6
 [1] "lsr"           "car"           "carData"       "plotly"        "plot3D"        "scatterplot3d" "ggplot2"       "readr"        
 [9] "stats"         "graphics"      "grDevices"     "utils"         "datasets"      "methods"       "base"         
load(url("https://edin.ac/2QCZNVu"))
[1] 7
[1] "drinkdriving" "officer_inc" 
drinkdriving <- data.frame(merge(drinkdriving, officer_inc, all = T))
[1] 8
sapply(drinkdriving, class)
[1] 9
  incident_id           age     nighttime prior_offence         speed           bac       outcome       officer 
  "character"     "numeric"   "character"   "character"     "numeric"     "numeric"   "character"      "factor" 
sum(!complete.cases(drinkdriving))
[1] 10
[1] 27
drinkdriving$age[drinkdriving$age >= 90] <- NA
[1] 11
drinkdriving$nighttime[drinkdriving$nighttime != "day" & drinkdriving$nighttime != 
    "night"] <- NA
[1] 12
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 13
drinkdriving$outcome <- ifelse(drinkdriving$outcome == "fine", 
    1, 0)
[1] 14
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 15
drinkdriving$bac <- drinkdriving$bac/100
[1] 16
drinkdriving$bac[drinkdriving$bac > 0.4] <- NA
[1] 17
drinkdriving[sapply(drinkdriving, is.character)] <- lapply(drinkdriving[sapply(drinkdriving, 
    is.character)], as.factor)
[1] 18
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 19
summary(m1)
[1] 20

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153136 -0.041562 -0.005184  0.041111  0.146857 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2839522  0.0107724  26.359  < 2e-16 ***
age         -0.0012941  0.0002364  -5.475 1.22e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05763 on 215 degrees of freedom
  (33 observations deleted due to missingness)
Multiple R-squared:  0.1223,	Adjusted R-squared:  0.1183 
F-statistic: 29.97 on 1 and 215 DF,  p-value: 1.217e-07

p.bac <- predict(m1, interval = "confidence")
[1] 21
head(p.bac)
[1] 22
        fit       lwr       upr
1 0.2334836 0.2256052 0.2413619
2 0.2063081 0.1950722 0.2175440
3 0.1959556 0.1817762 0.2101350
4 0.2386598 0.2302010 0.2471186
5 0.2231310 0.2151347 0.2311273
6 0.2308954 0.2231539 0.2386370
bac_pred <- merge(drinkdriving, p.bac, by = "row.names")
[1] 23
bac_pred_ordered <- bac_pred[order(bac_pred$age), ]
[1] 24
bac_pred_ordered

    Row.names incident_id age nighttime prior_offence    speed       bac outcome officer       fit       lwr       upr
3         100     inc_189  14     night             N 74.39489 0.3304056       1      AS 0.2658352 0.2504956 0.2811748
12        110     inc_198  15       day             N 54.06914 0.2364318       1      AS 0.2645412 0.2496025 0.2794799
98        197      inc_50  15     night          DR50 64.65983 0.3435662       1      IT 0.2645412 0.2496025 0.2794799
188        67     inc_159  15       day             N 56.75640 0.2751168       1      IT 0.2645412 0.2496025 0.2794799
 [ reached 'max' / getOption("max.print") -- omitted 213 rows ]


with(drinkdriving, plot(age, bac, xlab = "- age -", ylab = "bac", 
    main = "*", col = c("slateblue"), bty = "n", pch = 20))
[1] 26
with(bac_pred_ordered, lines(age, fit))
[1] 27
with(bac_pred_ordered, lines(age, lwr))
[1] 28
with(bac_pred_ordered, lines(age, upr))
[1] 29
abline(m1)
[1] 30
ggplot(bac_pred, aes(x = age)) + geom_point(aes(y = bac), col = "slateblue") + 
    geom_line(aes(y = fit)) + geom_ribbon(aes(ymin = lwr, ymax = upr), 
    fill = "orange", alpha = 0.4) + theme_minimal() + labs(x = "Age", 
    y = "BAC")
[1] 31
predict(m1, data.frame(age = 50))
[1] 32
        1 
0.2192488 
par(mfrow = c(2, 2))
[1] 33
$mfrow
[1] 1 1

plot(m1, which = 1)
[1] 34
qqnorm(resid(m1))
[1] 35
$x
 [1] -0.99863333  0.64220925 -1.57521263 -2.83321105 -0.20944434 -0.71492663 -1.03742213  0.29291745  0.68540632  1.37057682
[11]  1.43224495  0.51910627  0.62807636  0.36610636  0.97979172  1.49989905 -2.14119812 -1.88147131 -0.03466079  0.08094729
[21]  0.55918295  0.28088078 -1.14199470 -1.31372106  0.76041827 -0.68540632  0.03466079  0.34151104 -1.70842450 -0.35378195
[31]  0.16242937 -0.51910627  0.74508357 -2.27274627  0.20944434  0.53236959 -1.12009610  1.16445509 -0.61406783 -0.44131333
[41] -1.46523379  1.57521263  1.34160686 -0.82365037  1.28682101 -0.77593389 -1.23564685 -0.45408231  0.00000000  0.02310462
 [ reached getOption("max.print") -- omitted 167 entries ]

$y
           1            2            3            4            5            6            7            8            9           10 
-0.056346197  0.037885552 -0.090984396 -0.153135627 -0.015567493 -0.043084285 -0.057520919  0.020483099  0.041297330  0.085864599 
          11           12           13           15           16           17           20           21           22           23 
 0.087006532  0.029995805  0.037192308  0.022652786  0.057816002  0.090380552 -0.110038813 -0.100368937 -0.009926306  0.005444702 
          24           25           27           28           30           31           32           34           35           36 
 0.033681950  0.019341957 -0.062770469 -0.078028822  0.045252766 -0.042041386 -0.004095636  0.020977597 -0.094292475 -0.025164388 
          37           38           39           42           43           44           45           46           47           48 
 0.010999224 -0.031659105  0.044616197 -0.119812801  0.013221181  0.030684930 -0.062617140  0.069102120 -0.039036731 -0.028649179 
          50           51           52           53           54           55           56           57           58           59 
-0.087265662  0.093468676  0.082406202 -0.046878535  0.082057896 -0.045544865 -0.065811099 -0.029667756 -0.005184049 -0.004332556 
 [ reached getOption("max.print") -- omitted 167 entries ]

qqline(resid(m1))
[1] 36
m2 <- lm(bac ~ scale(age) + scale(speed), data = drinkdriving)
[1] 37
m3 <- lm(bac ~ scale(age) + nighttime, data = drinkdriving)
[1] 38
anova(m2)
[1] 39
Analysis of Variance Table

Response: bac
              Df  Sum Sq  Mean Sq F value    Pr(>F)    
scale(age)     1 0.09955 0.099552 29.9802 1.218e-07 ***
scale(speed)   1 0.00354 0.003537  1.0652    0.3032    
Residuals    214 0.71061 0.003321                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
anova(m3)
[1] 40
Analysis of Variance Table

Response: bac
            Df  Sum Sq  Mean Sq F value    Pr(>F)    
scale(age)   1 0.11240 0.112395  38.458 2.886e-09 ***
nighttime    1 0.06598 0.065978  22.575 3.723e-06 ***
Residuals  212 0.61958 0.002923                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m1)
[1] 41

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153136 -0.041562 -0.005184  0.041111  0.146857 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2839522  0.0107724  26.359  < 2e-16 ***
age         -0.0012941  0.0002364  -5.475 1.22e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05763 on 215 degrees of freedom
  (33 observations deleted due to missingness)
Multiple R-squared:  0.1223,	Adjusted R-squared:  0.1183 
F-statistic: 29.97 on 1 and 215 DF,  p-value: 1.217e-07

summary(m2)
[1] 42

Call:
lm(formula = bac ~ scale(age) + scale(speed), data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153983 -0.038102 -0.005924  0.040759  0.141611 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)   0.229809   0.003990  57.603  < 2e-16 ***
scale(age)   -0.017750   0.005237  -3.389 0.000834 ***
scale(speed)  0.006432   0.006232   1.032 0.303204    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05762 on 214 degrees of freedom
  (33 observations deleted due to missingness)
Multiple R-squared:  0.1267,	Adjusted R-squared:  0.1185 
F-statistic: 15.52 on 2 and 214 DF,  p-value: 5.069e-07

summary(m3)
[1] 43

Call:
lm(formula = bac ~ scale(age) + nighttime, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.164413 -0.043999  0.003425  0.037030  0.142578 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.202870   0.006566  30.895  < 2e-16 ***
scale(age)     -0.021651   0.003702  -5.849 1.86e-08 ***
nighttimenight  0.037766   0.007948   4.751 3.72e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05406 on 212 degrees of freedom
  (35 observations deleted due to missingness)
Multiple R-squared:  0.2235,	Adjusted R-squared:  0.2162 
F-statistic: 30.52 on 2 and 212 DF,  p-value: 2.253e-12

par(mfrow = c(2, 2))
[1] 44
$mfrow
[1] 2 2

plot(m3, which = c(1:4))
[1] 45
t.test(speed ~ nighttime, drinkdriving)
[1] 46

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.7709, df = 156.78, p-value = 0.4419
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.513418  2.417929
sample estimates:
  mean in group day mean in group night 
           39.30514            40.85289 

drinkdriving$prior <- ifelse(drinkdriving$prior_offence == "N", 
    0, 1)
[1] 47
drinkdriving$prior <- as.factor(drinkdriving$prior)
[1] 48
drinkdriving$prior_offence <- as.character(drinkdriving$prior_offence)
[1] 49
glm_outcome <- glm(outcome ~ scale(speed) + scale(age) + scale(bac) + 
    nighttime + officer + prior, data = drinkdriving, family = "binomial")
[1] 50
summary(glm_outcome)
[1] 51

Call:
glm(formula = outcome ~ scale(speed) + scale(age) + scale(bac) + 
    nighttime + officer + prior, family = "binomial", data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.6909   0.0371   0.1502   0.3900   2.2714  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)     3.07728    0.68024   4.524 6.07e-06 ***
scale(speed)    2.02462    0.49867   4.060 4.91e-05 ***
scale(age)     -0.75492    0.33702  -2.240  0.02509 *  
scale(bac)      1.29032    0.34924   3.695  0.00022 ***
nighttimenight -0.03552    0.57914  -0.061  0.95110    
officerIT      -0.03100    0.59796  -0.052  0.95865    
officerNP       0.42790    0.63335   0.676  0.49929    
prior1          0.37369    0.60653   0.616  0.53783    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 212.37  on 214  degrees of freedom
Residual deviance: 105.23  on 207  degrees of freedom
  (35 observations deleted due to missingness)
AIC: 121.23

Number of Fisher Scoring iterations: 7

exp(coef(glm_outcome))
[1] 52
   (Intercept)   scale(speed)     scale(age)     scale(bac) nighttimenight      officerIT      officerNP         prior1 
    21.6993387      7.5732073      0.4700488      3.6339432      0.9651045      0.9694760      1.5340332      1.4530841 
drinkdriving$drink_offense <- ifelse(drinkdriving$prior_offence == 
    "DR50", 1, 0)
[1] 53
drinkdriving$drink_offense[drinkdriving$prior_offence == "N"] <- NA
[1] 54
outcome_table <- xtabs(~drinkdriving$outcome + drinkdriving$drink_offense)
[1] 55
addmargins(outcome_table)
[1] 56
                    drinkdriving$drink_offense
drinkdriving$outcome  0  1 Sum
                 0    8  3  11
                 1   14 40  54
                 Sum 22 43  65
chisq.test(outcome_table)
[1] 57

	Pearson's Chi-squared test with Yates' continuity correction

data:  outcome_table
X-squared = 6.9717, df = 1, p-value = 0.008281

model_any_offense <- glm(outcome ~ prior, data = drinkdriving, 
    family = binomial)
[1] 58
summary(model_any_offense)
[1] 59

Call:
glm(formula = outcome ~ prior, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8849   0.6089   0.6681   0.6681   0.6681  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)   1.3863     0.1838   7.542 4.62e-14 ***
prior1        0.2048     0.3784   0.541    0.588    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 244.26  on 248  degrees of freedom
AIC: 248.26

Number of Fisher Scoring iterations: 4

anova(model_any_offense, test = "Chisq")
[1] 60
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


      Df Deviance Resid. Df Resid. Dev Pr(>Chi)
NULL                    249     244.56         
prior  1  0.29974       248     244.25    0.584
spec_pro <- ggplot(data = drinkdriving, aes(x = speed, y = prior, 
    colour = drink_offense))
[1] 61
spec_pro + geom_point() + theme_minimal() + facet_grid(. ~ outcome)
[1] 62
glm_q4 <- glm(outcome ~ scale(speed) + scale(age) + scale(bac) + 
    nighttime + as.factor(prior), data = drinkdriving, family = "binomial")
[1] 63
q4.data <- data.frame(age = 14:90, nighttime = "day", speed = 30, 
    bac = 0, prior = 0, model_prediction = "?")
[1] 64
summary(glm_q4)
[1] 65

Call:
glm(formula = outcome ~ scale(speed) + scale(age) + scale(bac) + 
    nighttime + as.factor(prior), family = "binomial", data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.6049   0.0345   0.1449   0.3915   2.2030  

Coefficients:
                  Estimate Std. Error z value Pr(>|z|)    
(Intercept)         3.2674     0.6116   5.342 9.17e-08 ***
scale(speed)        2.0205     0.5013   4.031 5.56e-05 ***
scale(age)         -0.7721     0.3391  -2.277 0.022785 *  
scale(bac)          1.3072     0.3489   3.746 0.000179 ***
nighttimenight     -0.1411     0.5639  -0.250 0.802357    
as.factor(prior)1   0.3773     0.6078   0.621 0.534726    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 212.37  on 214  degrees of freedom
Residual deviance: 105.81  on 209  degrees of freedom
  (35 observations deleted due to missingness)
AIC: 117.81

Number of Fisher Scoring iterations: 7

q4.predict <- predict(glm_q4, newdata = q4.data, type = "response")
[1] 66
qplot(data = q4.data, age, q4.predict) + labs(title = "Likelihood of receiving a fine by age", 
    x = "Age in Years", y = "Probability of Fine")
[1] 67
drinkdriving <- drinkdriving[complete.cases(drinkdriving$age), 
    ]
[1] 68
drinkdriving <- drinkdriving[-121, ]
[1] 69
spec_pro <- ggplot(data = drinkdriving, aes(x = age, y = outcome, 
    colour = officer))
[1] 70
spec_pro + geom_jitter() + theme_minimal() + facet_grid(. ~ officer)
[1] 71
bias_glm <- glm(formula = outcome ~ age * officer, data = drinkdriving, 
    family = binomial)
[1] 72
summary(bias_glm)
[1] 73

Call:
glm(formula = outcome ~ age * officer, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0645   0.2741   0.5525   2.4063  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    9.55388    1.99948   4.778 1.77e-06 ***
age           -0.16094    0.03475  -4.631 3.63e-06 ***
officerIT     -5.09217    2.40037  -2.121   0.0339 *  
officerNP     -4.66934    2.49203  -1.874   0.0610 .  
age:officerIT  0.09682    0.04261   2.272   0.0231 *  
age:officerNP  0.09337    0.04413   2.116   0.0344 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 218.67  on 222  degrees of freedom
Residual deviance: 146.21  on 217  degrees of freedom
AIC: 158.21

Number of Fisher Scoring iterations: 7

bias_glm_relevel <- glm(formula = outcome ~ age * relevel(officer, 
    "IT"), data = drinkdriving, family = binomial)
[1] 74
summary(bias_glm_relevel)
[1] 75

Call:
glm(formula = outcome ~ age * relevel(officer, "IT"), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0645   0.2741   0.5525   2.4063  

Coefficients:
                              Estimate Std. Error z value Pr(>|z|)    
(Intercept)                   4.461717   1.328102   3.359 0.000781 ***
age                          -0.064113   0.024661  -2.600 0.009329 ** 
relevel(officer, "IT")AS      5.092165   2.400372   2.121 0.033888 *  
relevel(officer, "IT")NP      0.422826   1.994028   0.212 0.832071    
age:relevel(officer, "IT")AS -0.096824   0.042611  -2.272 0.023070 *  
age:relevel(officer, "IT")NP -0.003458   0.036711  -0.094 0.924948    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 218.67  on 222  degrees of freedom
Residual deviance: 146.21  on 217  degrees of freedom
AIC: 158.21

Number of Fisher Scoring iterations: 7

mean_age <- mean(drinkdriving$age[drinkdriving$outcome == "1"])
[1] 76
it <- mean(drinkdriving$age[drinkdriving$outcome == "1" & drinkdriving$officer == 
    "IT"])
[1] 77
as <- mean(drinkdriving$age[drinkdriving$outcome == "1" & drinkdriving$officer == 
    "AS"])
[1] 78
np <- mean(drinkdriving$age[drinkdriving$outcome == "1" & drinkdriving$officer == 
    "NP"])
[1] 79
mean_age

[1] 38.35


it

[1] 41.55556


as

[1] 34.84884


np

[1] 41.55102


