

	####### B082020 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(lsr, quietly = T)
[1] 2
 [1] "lsr"       "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(stringr, quietly = T)
[1] 3
 [1] "stringr"   "lsr"       "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
library(psych, quietly = T)
[1] 4
 [1] "psych"     "stringr"   "lsr"       "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
library(sm, quietly = T)
[1] 5
 [1] "sm"        "psych"     "stringr"   "lsr"       "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"    
[11] "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 6
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 7
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
describe(drinkdriving)
[1] 8
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
for (i in 1:ncol(drinkdriving)) {
    print(table(drinkdriving[, i]))
}
[1] 9

14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 
 1  5  2  3  1  2  3  6  2  5  8  3  2  2  5  4  4  4  6  5  9  8  3  4  2 10  5  6  5  3  2  3  4  5  2  3  3  3  6  3  5  4  3  4  4 
59 60 61 62 63 
 1  5  3  3  2 
 [ reached getOption("max.print") -- omitted 15 entries ]

18:25  2:05   day night 
    1     2    78   169 

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 

               0 1.01214942316415 1.94581782932169 2.53346827328845  11.225704630299 12.2462058630265 12.8128465751594 
               1                1                1                1                1                1                1 
12.9030158165279 12.9155695510693 13.0698049123235 14.3668291368723 15.5710258293839 17.0590138838127  17.221097497513 
               1                1                1                1                1                1                1 
18.2934932399405 19.0089940620951 19.2697316282316 20.2107015627382 21.3069195145607 21.4908339004998 21.8064434744078 
               1                1                1                1                1                1                1 
 22.568562604335 22.5952898516689 22.6424298724575  23.182415928645 23.5805503449787 23.5994274112678 24.4877988273931 
               1                1                1                1                1                1                1 
24.5215840561896 24.5611037960359 24.8285320808304 24.9172566024629 24.9907200841348 25.0453443973611 25.0548611219096 
               1                1                1                1                1                1                1 
25.2710211226397 25.5417854203194 25.5936767268247 25.7485090547557 25.9105706027961   25.98459487588 26.2055631685057 
               1                1                1                1                1                1                1 
 26.414446768112 26.6813905027214 26.6979134850146 27.0661842358492 28.5530416886726 28.6993802422867 28.7242755318064 
               1                1                1                1                1                1                1 
28.8107670431613 
               1 
 [ reached getOption("max.print") -- omitted 200 entries ]

3.98678518191804 5.45295079276351 5.61849660215689 6.39815180420771 6.45232354218363 8.55241944417923 9.16715954067682 
               1                1                1                1                1                1                1 
9.25348198083096 9.49752435423211 9.81747807144744 10.0454646939566 10.2699286970084 10.4971185812798 10.6649017352481 
               1                1                1                1                1                1                1 
 11.199644560097 11.8177151563139  12.383382856562 12.7426098538045 13.5320753875597 13.8631845587114 14.1159208271656 
               1                1                1                1                1                1                1 
14.2071322668145 14.3140134442539  14.817899748919 14.9946701515397 15.2439189096081 15.5051277092158  15.989616149418 
               1                1                1                1                1                1                1 
16.0452635279057 16.0927774247029 16.1947203748598 16.2228619659442 16.3696120796151 16.4455909694064 16.6523626858628 
               1                1                1                1                1                1                1 
16.8576234110825 17.1063627259339 17.3301216655205 17.4520816674849 17.6730177261954 17.7137353516994 17.7755921387512 
               1                1                1                1                1                1                1 
17.8183606022586 17.8201747803163 17.8501485665444 17.9707079305316 17.9844835229676 18.0186086871637 18.0696136795774 
               1                1                1                1                1                1                1 
 18.247052539074 
               1 
 [ reached getOption("max.print") -- omitted 191 entries ]

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 

  inc_1  inc_10 inc_100 inc_101 inc_102 inc_103 inc_104 inc_105 inc_106 inc_107 inc_108 inc_109  inc_11 inc_110 inc_111 inc_112 
      1       1       1       1       1       1       1       1       1       1       1       1       1       1       1       1 
inc_113 inc_114 inc_115 inc_116 inc_117 inc_118 inc_119  inc_12 inc_120 inc_121 inc_122 inc_123 inc_124 inc_125 inc_126 inc_127 
      1       1       1       1       1       1       1       1       1       1       1       1       1       1       1       1 
inc_128 inc_129  inc_13 inc_130 inc_131 inc_132 inc_133 inc_134 inc_135 inc_136 inc_137 inc_138 inc_139  inc_14 inc_140 inc_141 
      1       1       1       1       1       1       1       1       1       1       1       1       1       1       1       1 
inc_142 inc_143 
      1       1 
 [ reached getOption("max.print") -- omitted 200 entries ]
NULL
drinkdriving$age[drinkdriving$age > 110] <- NA
[1] 10
par(mar = c(1, 5, 1, 1), mfrow = c(1, 2))
[1] 11
$mar
[1] 5.1 4.1 4.1 2.1

$mfrow
[1] 1 1

boxplot(drinkdriving$speed, ylab = "speed (mph)")
[1] 12
drinkdriving$speed[(0 >= drinkdriving$speed) | (drinkdriving$speed > 
    100)] <- NA
[1] 13
boxplot(drinkdriving$bac, ylab = "blood alcohol content (%)")
[1] 14
drinkdriving$bac[drinkdriving$bac > 50] <- NA
[1] 15
drinkdriving$nighttime[!(drinkdriving$nighttime %in% c("day", 
    "night"))] <- NA
[1] 16
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 17
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 18
par(mar = c(4, 4, 2, 1))
[1] 19
$mar
[1] 1 5 1 1

with(drinkdriving, plot(x = age, y = bac, xlab = "Age (Years)", 
    ylab = "Blood Alcohol Content (%)", xlim = c(14, 90)))
[1] 20
abline(m1)
[1] 21
summary(m1)
[1] 22

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

par(mar = c(4, 4, 2, 1))
[1] 23
$mar
[1] 4 4 2 1

qqnorm(resid(m1))
[1] 24
$x
 [1] -1.001647727 -0.382844772  1.538799668 -0.132618105  1.344152486 -0.763854208  0.631791795  0.779339391  0.005749179  0.660123917
[11]  0.617815071  0.576584484 -1.662910885  1.144796229 -0.445493297  0.826965033 -0.523081655  1.020820585 -0.121026905  0.179177710
[21] -0.297538989 -0.893555746 -0.237941322  1.040376237  0.523081655 -0.028749697 -0.946219392 -1.316299930 -2.463430222  0.121026905
[31]  0.358213579  0.748550062 -1.080731619 -0.964366153  0.982836177  1.122928435 -0.226129222  0.261667263  1.618733633  0.590215963
[41]  0.190874584 -0.432830912 -0.395247080  0.273584861 -0.928378997  0.549636371  0.144227152  1.213939986 -0.202597632  0.910829301
 [ reached getOption("max.print") -- omitted 168 entries ]

$y
          1           2           3           4           5           6           7           8           9          10          11 
 -5.6164416  -2.7061199   9.3219145  -1.2067674   8.3713491  -4.6149176   3.8137826   4.8408865  -0.4971646   3.9725724   3.6505407 
         12          13          14          15          16          18          19          20          21          23          24 
  3.4021673  -9.5374231   6.8968016  -2.9485975   4.9866754  -3.1670646   6.0527338  -1.1821753   1.1501205  -2.0872582  -4.8525541 
         25          26          27          28          29          30          31          32          33          34          35 
 -1.6624856   6.0653929   3.1181753  -0.8582260  -5.4502221  -7.8052568 -15.1311484   0.9128686   2.2998112   4.4500379  -6.2411043 
         36          37          38          39          40          41          42          43          44          45          46 
 -5.5070512   5.9712832   6.8377377  -1.6328441   1.7343306   9.4838911   3.4082885   1.1788939  -2.8400983  -2.7094846   1.9032137 
         47          48          49          50          52          53 
 -5.2275125   3.3597630   1.0200350   7.7311460  -1.5946564   5.4335810 
 [ reached getOption("max.print") -- omitted 168 entries ]

hist(resid(m1), xlab = "Model Residuals", main = "Histogram of Residuals")
[1] 25
age_50 <- data.frame(age = c(50))
[1] 26
predict(m1, newdata = age_50)
[1] 27
       1 
21.81983 
m2 <- lm(bac ~ age + speed, data = drinkdriving)
[1] 28
m3 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 29
summary(m2)
[1] 30

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4126  -3.9597  -0.5979   4.0894  14.3787 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 25.69629    2.81054   9.143  < 2e-16 ***
age         -0.11272    0.03188  -3.536 0.000498 ***
speed        0.04991    0.04329   1.153 0.250202    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.798 on 214 degrees of freedom
  (33 observations deleted due to missingness)
Multiple R-squared:  0.1442,	Adjusted R-squared:  0.1362 
F-statistic: 18.03 on 2 and 214 DF,  p-value: 5.782e-08

anova(m2)
[1] 31
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1167.7 1167.70 34.7384 1.452e-08 ***
speed       1   44.7   44.69  1.3294    0.2502    
Residuals 214 7193.4   33.61                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m3)
[1] 32

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3421  -4.3987   0.2997   3.7390  14.4090 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    26.00346    1.18497  21.944  < 2e-16 ***
age            -0.13690    0.02209  -6.199 2.91e-09 ***
nighttimenight  3.86857    0.79364   4.874 2.13e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.417 on 213 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.2422,	Adjusted R-squared:  0.235 
F-statistic: 34.03 on 2 and 213 DF,  p-value: 1.498e-13

anova(m3)
[1] 33
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1300.0 1299.99  44.298 2.349e-10 ***
nighttime   1  697.3  697.27  23.760 2.131e-06 ***
Residuals 213 6250.8   29.35                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 34
var(drinkdriving$speed[drinkdriving$nighttime == "day"], na.rm = TRUE)
[1] 35
[1] 123.5271
var(drinkdriving$speed[drinkdriving$nighttime == "night"], na.rm = TRUE)
[1] 36
[1] 221.2257
ggplot(subset(drinkdriving, !is.na(nighttime)), aes(speed, colour = nighttime, 
    group = nighttime)) + geom_density(size = 1) + xlab("Speed (mph)") + 
    ylab("Density")
[1] 37
t.test(drinkdriving$speed ~ drinkdriving$nighttime)
[1] 38

	Welch Two Sample t-test

data:  drinkdriving$speed by drinkdriving$nighttime
t = -1.6636, df = 192.84, p-value = 0.09782
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -6.2142330  0.5276782
sample estimates:
  mean in group day mean in group night 
           38.25278            41.09606 

getodds <- function(x, print = TRUE) {
    result <- exp(coef(x))
    return(result)
}
[1] 39
drinkdriving$wasfined <- (drinkdriving$outcome == "fine")
[1] 40
drinkdriving.binom <- glm(wasfined ~ scale(bac) + scale(speed) + 
    scale(age) + nighttime, data = drinkdriving, family = binomial)
[1] 41
summary(drinkdriving.binom)
[1] 42

Call:
glm(formula = wasfined ~ scale(bac) + scale(speed) + scale(age) + 
    nighttime, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.5237   0.0343   0.1562   0.3754   2.3215  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)     3.28895    0.60082   5.474 4.40e-08 ***
scale(bac)      1.29036    0.34559   3.734 0.000189 ***
scale(speed)    1.87326    0.47557   3.939 8.18e-05 ***
scale(age)     -0.78619    0.34003  -2.312 0.020772 *  
nighttimenight -0.09311    0.55638  -0.167 0.867099    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 212.37  on 214  degrees of freedom
Residual deviance: 106.10  on 210  degrees of freedom
  (35 observations deleted due to missingness)
AIC: 116.1

Number of Fisher Scoring iterations: 7

getodds(drinkdriving.binom)
[1] 43
   (Intercept)     scale(bac)   scale(speed)     scale(age) nighttimenight 
    26.8146345      3.6341110      6.5095033      0.4555794      0.9110960 
drinkdriving$prevdrink <- str_detect(drinkdriving$prior_offence, 
    "DR50")
[1] 44
drinkdriving.binom <- glm(wasfined ~ scale(bac) + scale(speed) + 
    scale(age) + nighttime + prevdrink, data = drinkdriving, 
    family = binomial)
[1] 45
summary(drinkdriving.binom)
[1] 46

Call:
glm(formula = wasfined ~ scale(bac) + scale(speed) + scale(age) + 
    nighttime + prevdrink, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.4661   0.0323   0.1414   0.3792   2.4409  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)      3.2549     0.6163   5.281 1.28e-07 ***
scale(bac)       1.4262     0.3666   3.891 9.99e-05 ***
scale(speed)     1.8155     0.4897   3.707 0.000209 ***
scale(age)      -0.8240     0.3581  -2.301 0.021395 *  
nighttimenight  -0.3593     0.5895  -0.609 0.542214    
prevdrinkTRUE    2.1210     1.0660   1.990 0.046616 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 212.37  on 214  degrees of freedom
Residual deviance: 100.31  on 209  degrees of freedom
  (35 observations deleted due to missingness)
AIC: 112.31

Number of Fisher Scoring iterations: 7

getodds(drinkdriving.binom)
[1] 47
   (Intercept)     scale(bac)   scale(speed)     scale(age) nighttimenight  prevdrinkTRUE 
    25.9173804      4.1630524      6.1442053      0.4386915      0.6981582      8.3395972 
drinkdriving$prevoffence <- (drinkdriving$prior_offence != "N")
[1] 48
drinkdriving.binom <- glm(wasfined ~ prevoffence, data = drinkdriving, 
    family = binomial)
[1] 49
summary(drinkdriving.binom)
[1] 50

Call:
glm(formula = wasfined ~ prevoffence, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8849   0.6089   0.6681   0.6681   0.6681  

Coefficients:
                Estimate Std. Error z value Pr(>|z|)    
(Intercept)       1.3863     0.1838   7.542 4.62e-14 ***
prevoffenceTRUE   0.2048     0.3784   0.541    0.588    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 244.26  on 248  degrees of freedom
AIC: 248.26

Number of Fisher Scoring iterations: 4

getodds(drinkdriving.binom)
[1] 51
    (Intercept) prevoffenceTRUE 
       4.000000        1.227273 
drinkdriving.binom <- glm(wasfined ~ bac + speed + age + prevdrink, 
    data = drinkdriving, family = binomial)
[1] 52
drinkdriving.predict <- data.frame(age = c(14:90, 14:90, 14:90), 
    nighttime = "day", speed = 30, bac = 0, prevdrink = FALSE)
[1] 53
drinkdriving.predict$fine_prob <- predict(drinkdriving.binom, 
    drinkdriving.predict)
[1] 54
drinkdriving.predict$fine_prob <- exp(drinkdriving.predict$fine_prob)/(1 + 
    exp(drinkdriving.predict$fine_prob))
[1] 55
predict.plot <- ggplot(data = drinkdriving.predict, aes(x = age, 
    y = fine_prob)) + geom_point() + geom_smooth() + xlab("Age (Years)") + 
    ylab("Probability of Fine")
[1] 56
predict.plot



drinkdriving <- merge(drinkdriving, officer_inc)
[1] 58
drinkdriving.binom <- glm(wasfined ~ bac + speed + prevdrink + 
    age * relevel(officer, "IT"), data = drinkdriving, family = binomial)
[1] 59
drinkdriving.predict <- data.frame(age = c(14:90, 14:90, 14:90), 
    nighttime = "day", speed = 30, bac = 0, prevdrink = FALSE, 
    officer = c("AS", "NP", "IT"))
[1] 60
drinkdriving.predict$fine_prob <- predict(drinkdriving.binom, 
    drinkdriving.predict)
[1] 61
drinkdriving.predict$fine_prob <- exp(drinkdriving.predict$fine_prob)/(1 + 
    exp(drinkdriving.predict$fine_prob))
[1] 62
predict.plot <- ggplot(data = drinkdriving.predict, aes(x = age, 
    y = fine_prob)) + geom_line(aes(colour = officer, linetype = officer), 
    size = 1.5)
[1] 63
predict.plot + xlab("Age (Years)") + ylab("Probability of Fine")
[1] 64
summary(drinkdriving.binom)
[1] 65

Call:
glm(formula = wasfined ~ bac + speed + prevdrink + age * relevel(officer, 
    "IT"), family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.3966   0.0071   0.0913   0.2896   2.3595  

Coefficients:
                               Estimate Std. Error z value Pr(>|z|)    
(Intercept)                  -10.201349   3.189234  -3.199  0.00138 ** 
bac                            0.234785   0.056998   4.119  3.8e-05 ***
speed                          0.155944   0.040536   3.847  0.00012 ***
prevdrinkTRUE                  2.648464   1.073832   2.466  0.01365 *  
age                            0.017370   0.033285   0.522  0.60177    
relevel(officer, "IT")AS       9.333164   3.578728   2.608  0.00911 ** 
relevel(officer, "IT")NP       1.127706   2.470313   0.457  0.64803    
age:relevel(officer, "IT")AS  -0.168827   0.062415  -2.705  0.00683 ** 
age:relevel(officer, "IT")NP  -0.005052   0.046435  -0.109  0.91337    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 213.24  on 216  degrees of freedom
Residual deviance:  87.03  on 208  degrees of freedom
  (33 observations deleted due to missingness)
AIC: 105.03

Number of Fisher Scoring iterations: 8

getodds(drinkdriving.binom)
[1] 66
                 (Intercept)                          bac                        speed                prevdrinkTRUE 
                3.712020e-05                 1.264637e+00                 1.168760e+00                 1.413231e+01 
                         age     relevel(officer, "IT")AS     relevel(officer, "IT")NP age:relevel(officer, "IT")AS 
                1.017522e+00                 1.130685e+04                 3.088564e+00                 8.446548e-01 
age:relevel(officer, "IT")NP 
                9.949612e-01 
