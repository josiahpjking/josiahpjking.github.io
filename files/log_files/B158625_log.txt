

	####### B158625 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 2
 [1] "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
head(drinkdriving)
[1] 4
# A tibble: 6 x 7
    age nighttime prior_offence speed   bac outcome incident_id
  <dbl> <chr>     <chr>         <dbl> <dbl> <chr>   <chr>      
1    39 night     N             48.0   17.7 fine    inc_1      
2    28 day       N             43.8   22.1 fine    inc_2      
3    38 night     DR50          47.3   32.8 fine    inc_3      
4    51 night     N             17.2   20.5 warning inc_4      
5    56 night     N              1.95  29.4 warning inc_5      
6    36 day       N             41.4   19.1 fine    inc_6      
outliers_1 <- function(obs, x = 2.5) {
    return(obs - mean(obs, na.rm = T) > (sd(obs, na.rm = T) * 
        x))
}
[1] 5
outliers_2 <- function(obs, x = 2.5) {
    return(abs(obs - mean(obs, na.rm = T)) > (sd(obs, na.rm = T) * 
        x))
}
[1] 6
table(drinkdriving$age)
[1] 7

14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 
 1  5  2  3  1  2  3  6  2  5  8  3  2  2  5  4  4  4  6  5  9  8  3  4  2 10  5  6  5  3  2  3  4  5  2  3  3  3  6  3  5  4  3  4  4 
59 60 61 62 63 
 1  5  3  3  2 
 [ reached getOption("max.print") -- omitted 15 entries ]
drinkdriving$age[drinkdriving$age < 17] <- NA
[1] 8
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 9
table(drinkdriving$nighttime)
[1] 10

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "night"
[1] 11
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 12
levels(drinkdriving$nighttime)
[1] 13
NULL
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 14
class(drinkdriving$nighttime)
[1] 15
[1] "factor"
table(drinkdriving$prior_offence)
[1] 16

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 17
drinkdriving$prior_offence <- factor(drinkdriving$prior_offence)
[1] 18
boxplot(drinkdriving$speed)
[1] 19
summary(drinkdriving$speed)
[1] 20
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00   30.92   40.64   40.49   48.84  120.34 
which(outliers_1(drinkdriving$speed))
[1] 21
[1] 110 154
boxplot(drinkdriving$bac)
[1] 22
summary(drinkdriving$bac)
[1] 23
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  3.987  19.264  23.609  23.605  27.898  65.764       5 
drinkdriving$bac[outliers_2(drinkdriving$bac)]
[1] 24
[1]  3.986785        NA        NA 57.330000        NA        NA 65.764000        NA
drinkdriving$bac[which(outliers_2(drinkdriving$bac))] <- NA
[1] 25
table(drinkdriving$outcome)
[1] 26

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome <- apply(drinkdriving[, 6], 2, tolower)
[1] 27
levels(drinkdriving$outcome)
[1] 28
NULL
drinkdriving$outcome <- factor(drinkdriving$outcome)
[1] 29
class(drinkdriving$incident_id)
[1] 30
[1] "character"
drinkdriving$incident_id <- factor(drinkdriving$incident_id)
[1] 31
levels(officer_inc$officer)
[1] 32
[1] "AS" "IT" "NP"
class(officer_inc$officer)
[1] 33
[1] "factor"
sum(is.na(drinkdriving))
[1] 34
[1] 45
sum(is.na(drinkdriving$age))
[1] 35
[1] 33
sum(is.na(drinkdriving$bac))
[1] 36
[1] 8
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 37
with(drinkdriving, cor.test(bac, age))
[1] 38

	Pearson's product-moment correlation

data:  bac and age
t = -5.1075, df = 208, p-value = 7.366e-07
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.4489240 -0.2078259
sample estimates:
       cor 
-0.3338234 

summary(m1)
[1] 39

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.1959  -4.1261  -0.8169   4.0809  14.7662 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.11832    1.15626  24.318  < 2e-16 ***
age         -0.12660    0.02479  -5.107 7.37e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.834 on 208 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1114,	Adjusted R-squared:  0.1072 
F-statistic: 26.09 on 1 and 208 DF,  p-value: 7.366e-07

m1_data = na.omit(drinkdriving)
[1] 40
m1_plot <- ggplot(data = m1_data)
[1] 41
m1_plot + geom_point(aes(x = age, y = bac)) + geom_smooth(method = "lm", 
    aes(x = age, y = bac), se = FALSE) + labs(title = "Relationship Between BAC and Age", 
    x = "Age (year)", y = "BAC (%)")
[1] 42
head(predict(m1))
[1] 43
       1        2        3        4        5        6 
23.18089 24.57350 23.30749 21.66168 21.02868 23.56069 
bac_predict <- data.frame(age = 50)
[1] 44
predict(m1, bac_predict)
[1] 45
       1 
21.78828 
plot(m1)
[1] 46
m2 <- lm(bac ~ age + nighttime + speed, data = drinkdriving, 
    na.action = na.exclude)
[1] 47
summary(m2)
[1] 48

Call:
lm(formula = bac ~ age + nighttime + speed, data = drinkdriving, 
    na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.9430  -4.5540   0.3923   3.6445  14.2265 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    22.86227    2.77937   8.226 2.17e-14 ***
age            -0.09904    0.03138  -3.156  0.00184 ** 
nighttimenight  3.89429    0.82588   4.715 4.44e-06 ***
speed           0.03693    0.04141   0.892  0.37358    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.559 on 206 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.2008,	Adjusted R-squared:  0.1892 
F-statistic: 17.25 on 3 and 206 DF,  p-value: 4.942e-10

summary(m2)$coefficient
[1] 49
                  Estimate Std. Error    t value     Pr(>|t|)
(Intercept)    22.86226582 2.77936665  8.2257106 2.172455e-14
age            -0.09903791 0.03138121 -3.1559621 1.839359e-03
nighttimenight  3.89428747 0.82588227  4.7153058 4.443411e-06
speed           0.03693029 0.04141432  0.8917276 3.735794e-01
par(mfrow = c(2, 2))
[1] 50
$mfrow
[1] 2 2

plot(m2)
[1] 51
plot(m2, which = c(1:4))
[1] 52
m2_refit <- lm(bac ~ nighttime + speed + age, data = drinkdriving[-31, 
    ], na.action = na.exclude)
[1] 53
anova(m2_refit)
[1] 54
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
nighttime   1  866.2  866.19  29.084   1.9e-07 ***
speed       1  374.0  373.99  12.557 0.0004887 ***
age         1  326.2  326.18  10.952 0.0011044 ** 
Residuals 205 6105.3   29.78                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2_refit)
[1] 55

Call:
lm(formula = bac ~ nighttime + speed + age, data = drinkdriving[-31, 
    ], na.action = na.exclude)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.3964  -4.6575   0.4222   3.6496  14.2418 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    23.57645    2.73893   8.608 1.96e-15 ***
nighttimenight  4.02298    0.81187   4.955 1.51e-06 ***
speed           0.02124    0.04100   0.518   0.6049    
age            -0.10200    0.03082  -3.309   0.0011 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.457 on 205 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.2042,	Adjusted R-squared:  0.1925 
F-statistic: 17.53 on 3 and 205 DF,  p-value: 3.599e-10

contrasts(drinkdriving$nighttime)
[1] 56
      night
day       0
night     1
m2_3 <- lm(speed ~ nighttime, data = drinkdriving, na.action = na.exclude)
[1] 57
anova(m2_3)
[1] 58
Analysis of Variance Table

Response: speed
           Df Sum Sq Mean Sq F value Pr(>F)
nighttime   1    158  158.19  0.7103 0.4002
Residuals 248  55231  222.71               
summary(m2_3)
[1] 59

Call:
lm(formula = speed ~ nighttime, data = drinkdriving, na.action = na.exclude)

Residuals:
    Min      1Q  Median      3Q     Max 
-41.022  -9.380   0.086   8.311  81.032 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      39.305      1.690  23.261   <2e-16 ***
nighttimenight    1.717      2.037   0.843      0.4    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.92 on 248 degrees of freedom
Multiple R-squared:  0.002856,	Adjusted R-squared:  -0.001165 
F-statistic: 0.7103 on 1 and 248 DF,  p-value: 0.4002

ggplot(drinkdriving, aes(x = nighttime, y = speed, color = nighttime)) + 
    geom_boxplot() + labs(title = "Relationship Between Speed and Age", 
    x = "Age (year)", y = "Speed (mph)")
[1] 60
summary(drinkdriving$speed[drinkdriving$nighttime == "night"])
[1] 61
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00   31.26   41.28   41.02   50.05   81.03 
summary(drinkdriving$speed[drinkdriving$nighttime == "day"])
[1] 62
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  12.81   30.94   39.02   39.31   45.65  120.34 
m3 <- glm(outcome ~ speed + bac + age + nighttime + prior_offence, 
    data = drinkdriving, family = binomial, na.action = na.exclude)
[1] 63
summary(m3)
[1] 64

Call:
glm(formula = outcome ~ speed + bac + age + nighttime + prior_offence, 
    family = binomial, data = drinkdriving, na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0824  -0.0577  -0.0050  -0.0001   3.9572  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)             -25.23844 4248.49337  -0.006 0.995260    
speed                    -0.20475    0.06244  -3.279 0.001041 ** 
bac                      -0.47639    0.12462  -3.823 0.000132 ***
age                       0.24897    0.07275   3.422 0.000621 ***
nighttimenight            0.25410    1.00664   0.252 0.800714    
prior_offenceCD60        54.24535 7784.24746   0.007 0.994440    
prior_offenceDR50        23.18438 4248.49149   0.005 0.995646    
prior_offenceDR80        34.00417 4248.49330   0.008 0.993614    
prior_offenceN           26.39639 4248.49147   0.006 0.995043    
prior_offencePL10        22.60908 4303.94624   0.005 0.995809    
 [ reached getOption("max.print") -- omitted 4 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 205.610  on 205  degrees of freedom
Residual deviance:  35.984  on 192  degrees of freedom
  (44 observations deleted due to missingness)
AIC: 63.984

Number of Fisher Scoring iterations: 17

m3_1 <- glm(outcome ~ scale(bac) + scale(speed), data = drinkdriving, 
    family = binomial, na.action = na.exclude)
[1] 65
exp(coef(m3_1))
[1] 66
 (Intercept)   scale(bac) scale(speed) 
  0.05995009   0.32607889   0.11216489 
with_prior <- subset(drinkdriving, prior_offence != "N")
[1] 67
with_prior$prior_offence <- as.character(with_prior$prior_offence)
[1] 68
with_prior$prior_offence[with_prior$prior_offence == "TS70,DR50"] <- "DR50"
[1] 69
table(with_prior$prior_offence)
[1] 70

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DR50           DR80           PL10           SP50           SP60 
             2              1              1              1             44              4              2              2              1 
          TS70 
             3 
with_prior$prior_offence <- ifelse(with_prior$prior_offence == 
    "DR50", 0, 1)
[1] 71
table(with_prior$prior_offence)
[1] 72

 0  1 
44 17 
class(with_prior$prior_offence)
[1] 73
[1] "numeric"
with_prior$prior_offence <- as.factor(with_prior$prior_offence)
[1] 74
class(with_prior$outcome)
[1] 75
[1] "factor"
m3_2 <- glm(outcome ~ prior_offence, data = with_prior, family = binomial, 
    na.action = na.exclude)
[1] 76
summary(m3_2)
[1] 77

Call:
glm(formula = outcome ~ prior_offence, family = binomial, data = with_prior, 
    na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.8346  -0.4366  -0.4366  -0.4366   2.1899  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)     -2.3026     0.5244  -4.391 1.13e-05 ***
prior_offence1   1.4271     0.7472   1.910   0.0561 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 51.047  on 60  degrees of freedom
Residual deviance: 47.405  on 59  degrees of freedom
AIC: 51.405

Number of Fisher Scoring iterations: 5

anova(m3_2, test = "Chisq")
[1] 78
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


              Df Deviance Resid. Df Resid. Dev Pr(>Chi)  
NULL                             60     51.047           
prior_offence  1   3.6421        59     47.405  0.05633 .
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
qplot(data = with_prior, prior_offence, fill = outcome) + labs(title = "Prior Offence vs Outcome", 
    y = "numbers of drivers")
[1] 79
drinkdriving$motor_offence <- ifelse(drinkdriving$prior_offence == 
    "N", 0, 1)
[1] 80
table(drinkdriving$motor_offence)
[1] 81

  0   1 
185  61 
m3_3 <- glm(outcome ~ motor_offence, data = drinkdriving, family = binomial, 
    na.action = na.exclude)
[1] 82
anova(m3_3, test = "Chisq")
[1] 83
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


              Df Deviance Resid. Df Resid. Dev Pr(>Chi)
NULL                            245     237.06         
motor_offence  1  0.86504       244     236.20   0.3523
summary(m3_3)
[1] 84

Call:
glm(formula = outcome ~ motor_offence, family = binomial, data = drinkdriving, 
    na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.6681  -0.6681  -0.6681  -0.5650   1.9564  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    -1.3863     0.1838  -7.542 4.62e-14 ***
motor_offence  -0.3677     0.4051  -0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

test_data <- data.frame(age = c(17:100), nighttime = "day", speed = 30, 
    bac = 0, prior_offence = "N")
[1] 85
m_4 <- glm(outcome ~ age + nighttime + speed + bac + prior_offence, 
    data = drinkdriving, family = binomial, na.action = na.exclude)
[1] 86
m_age <- glm(outcome ~ age, data = drinkdriving, family = binomial, 
    na.action = na.exclude)
[1] 87
summary(m_age)
[1] 88

Call:
glm(formula = outcome ~ age, family = binomial, data = drinkdriving, 
    na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1710  -0.5373  -0.3166  -0.1663   3.0285  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept) -6.38439    0.88337  -7.227 4.93e-13 ***
age          0.10048    0.01588   6.329 2.46e-10 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 218.83  on 216  degrees of freedom
Residual deviance: 154.53  on 215  degrees of freedom
  (33 observations deleted due to missingness)
AIC: 158.53

Number of Fisher Scoring iterations: 5

pred_outcome <- predict(m_4, test_data, type = "response")
[1] 89
pred_outcome_1 <- (1 - pred_outcome) * 100
[1] 90
pred_outcome_fw <- ifelse(pred_outcome_1 > 0.5, "fine", "warning")
[1] 91
with(test_data, plot(age, pred_outcome_1, main = "Age vs. Predicted Outcome"))
[1] 92
q5_data = na.omit(drinkdriving)
[1] 93
merge_data <- merge(q5_data, officer_inc, by = "incident_id")
[1] 94
levels(merge_data$officer)
[1] 95
[1] "AS" "IT" "NP"
contrasts(merge_data$officer)
[1] 96
   IT NP
AS  0  0
IT  1  0
NP  0  1
officer_AS <- subset(merge_data, officer == "AS")
[1] 97
officer_IT <- subset(merge_data, officer == "IT")
[1] 98
officer_NP <- subset(merge_data, officer == "NP")
[1] 99
m_as <- glm(outcome ~ nighttime + speed + bac, data = officer_AS, 
    family = binomial)
[1] 100
m_as_age <- glm(outcome ~ nighttime + speed + bac + age, data = officer_AS, 
    family = binomial)
[1] 101
anova(m_as, m_as_age, test = "Chisq")
[1] 102
Analysis of Deviance Table

Model 1: outcome ~ nighttime + speed + bac
Model 2: outcome ~ nighttime + speed + bac + age
  Resid. Df Resid. Dev Df Deviance  Pr(>Chi)    
1        95     32.352                          
2        94     17.176  1   15.176 9.792e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m_it <- glm(outcome ~ nighttime + speed + bac, data = officer_IT, 
    family = binomial)
[1] 103
m_it_age <- glm(outcome ~ nighttime + speed + bac + age, data = officer_IT, 
    family = binomial)
[1] 104
anova(m_it, m_it_age, test = "Chisq")
[1] 105
Analysis of Deviance Table

Model 1: outcome ~ nighttime + speed + bac
Model 2: outcome ~ nighttime + speed + bac + age
  Resid. Df Resid. Dev Df Deviance Pr(>Chi)
1        46     27.981                     
2        45     27.864  1  0.11715   0.7321
m_np <- glm(outcome ~ nighttime + speed + bac, data = officer_NP, 
    family = binomial)
[1] 106
m_np_age <- glm(outcome ~ nighttime + speed + bac + age, data = officer_NP, 
    family = binomial)
[1] 107
anova(m_np, m_np_age, test = "Chisq")
[1] 108
Analysis of Deviance Table

Model 1: outcome ~ nighttime + speed + bac
Model 2: outcome ~ nighttime + speed + bac + age
  Resid. Df Resid. Dev Df Deviance Pr(>Chi)
1        53     27.623                     
2        52     26.562  1   1.0618   0.3028
ggplot(merge_data, aes(x = age, fill = outcome)) + geom_density(alpha = 0.4) + 
    facet_wrap(~officer) + labs(title = "Age Distribution by Outcome")
[1] 109
