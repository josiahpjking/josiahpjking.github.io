

	####### B154263 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 2
[1] "drinkdriving" "officer_inc" 
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 3
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 4
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 5
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 6
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "day"
[1] 7
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 8
drinkdriving$age[drinkdriving$age > 200] <- NA
[1] 9
drinkdriving$age[drinkdriving$age > mean(drinkdriving$age, na.rm = TRUE) + 
    2.5 * sd(drinkdriving$age, na.rm = TRUE) | drinkdriving$age < 
    mean(drinkdriving$age, na.rm = TRUE) - 2.5 * sd(drinkdriving$age, 
        na.rm = TRUE)] <- NA
[1] 10
drinkdriving$bac[drinkdriving$bac > mean(drinkdriving$bac, na.rm = TRUE) + 
    2.5 * sd(drinkdriving$bac, na.rm = TRUE) | drinkdriving$bac < 
    mean(drinkdriving$bac, na.rm = TRUE) - 2.5 * sd(drinkdriving$bac, 
        na.rm = TRUE)] <- NA
[1] 11
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 12
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60,CD60"] <- "CD60"
[1] 13
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 14
summary(m1)
[1] 15

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3494  -4.1073  -0.4885   4.0081  14.6227 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.32547    1.09139   25.95  < 2e-16 ***
age         -0.12751    0.02424   -5.26 3.51e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.713 on 213 degrees of freedom
  (35 observations deleted due to missingness)
Multiple R-squared:  0.1149,	Adjusted R-squared:  0.1108 
F-statistic: 27.66 on 1 and 213 DF,  p-value: 3.508e-07

LRE = -0.0846 * (50) + 26.84806
[1] 16
LRE

[1] 22.61806


AgeNA <- subset(drinkdriving, drinkdriving$age != "NA")
[1] 18
bacNA <- subset(AgeNA, AgeNA$bac != "NA")
[1] 19
plot(m1, which = c(1:4))
[1] 20
drinkdriving$nighttime[drinkdriving$nighttime == "night"] <- 1
[1] 21
drinkdriving$nighttime[drinkdriving$nighttime == "day"] <- 0
[1] 22
drinkdriving$nighttime <- as.numeric(drinkdriving$nighttime)
[1] 23
m1_daytime <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 24
summary(m1_daytime)
[1] 25

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.5965  -4.4792   0.3336   3.6867  14.0523 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 25.54139    1.21172  21.079  < 2e-16 ***
age         -0.12115    0.02324  -5.212 4.42e-07 ***
nighttime    3.65605    0.80658   4.533 9.73e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.468 on 212 degrees of freedom
  (35 observations deleted due to missingness)
Multiple R-squared:  0.1931,	Adjusted R-squared:  0.1855 
F-statistic: 25.37 on 2 and 212 DF,  p-value: 1.32e-10

m1_speed <- lm(bac ~ age + speed, data = drinkdriving)
[1] 26
summary(m1_speed)
[1] 27

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3845  -3.8091  -0.7028   4.0135  14.1443 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.01790    2.74776   9.469  < 2e-16 ***
age         -0.10776    0.03247  -3.319  0.00106 ** 
speed        0.03811    0.04165   0.915  0.36115    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.715 on 212 degrees of freedom
  (35 observations deleted due to missingness)
Multiple R-squared:  0.1184,	Adjusted R-squared:  0.1101 
F-statistic: 14.24 on 2 and 212 DF,  p-value: 1.575e-06

summary(m1_daytime)
[1] 28

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.5965  -4.4792   0.3336   3.6867  14.0523 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 25.54139    1.21172  21.079  < 2e-16 ***
age         -0.12115    0.02324  -5.212 4.42e-07 ***
nighttime    3.65605    0.80658   4.533 9.73e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.468 on 212 degrees of freedom
  (35 observations deleted due to missingness)
Multiple R-squared:  0.1931,	Adjusted R-squared:  0.1855 
F-statistic: 25.37 on 2 and 212 DF,  p-value: 1.32e-10

summary(m1_speed)
[1] 29

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3845  -3.8091  -0.7028   4.0135  14.1443 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.01790    2.74776   9.469  < 2e-16 ***
age         -0.10776    0.03247  -3.319  0.00106 ** 
speed        0.03811    0.04165   0.915  0.36115    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.715 on 212 degrees of freedom
  (35 observations deleted due to missingness)
Multiple R-squared:  0.1184,	Adjusted R-squared:  0.1101 
F-statistic: 14.24 on 2 and 212 DF,  p-value: 1.575e-06

ttest <- t.test(speed ~ nighttime, data = drinkdriving, alternative = "greater")
[1] 30
ttest


	Welch Two Sample t-test

data:  speed by nighttime
t = -0.71535, df = 158.46, p-value = 0.7623
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 -4.731275       Inf
sample estimates:
mean in group 0 mean in group 1 
       39.50953        40.93767 



drinkdriving <- subset(drinkdriving, drinkdriving$bac != "NA")
[1] 32
drinkdriving$outcome[drinkdriving$outcome == "warning"] <- 0
[1] 33
drinkdriving$outcome[drinkdriving$outcome == "fine"] <- 1
[1] 34
drinkdriving$outcome <- as.numeric(drinkdriving$outcome)
[1] 35
drinkdriving$bac <- as.numeric(drinkdriving$bac)
[1] 36
drinkdriving$speed <- as.numeric(drinkdriving$speed)
[1] 37
Outcome_Contribution <- glm(outcome ~ scale(bac) + scale(speed), 
    data = drinkdriving, family = binomial)
[1] 38
summary(Outcome_Contribution)
[1] 39

Call:
glm(formula = outcome ~ scale(bac) + scale(speed), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0730   0.0514   0.1905   0.4475   1.9446  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    2.7513     0.3582   7.682 1.57e-14 ***
scale(bac)     1.1206     0.2717   4.125 3.72e-05 ***
scale(speed)   2.0194     0.3551   5.687 1.29e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 235.39  on 241  degrees of freedom
Residual deviance: 130.02  on 239  degrees of freedom
AIC: 136.02

Number of Fisher Scoring iterations: 6

exp(coef(Outcome_Contribution))
[1] 40
 (Intercept)   scale(bac) scale(speed) 
   15.662458     3.066743     7.533658 
sd(drinkdriving$bac)
[1] 41
[1] 6.55634
sd(drinkdriving$speed)
[1] 42
[1] 13.76657
0.011118 * 7.485585
[1] 43
[1] 0.08322473
0.10836 * 14.87575
[1] 44
[1] 1.611936
drink_driving_1 <- drinkdriving
[1] 45
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "DR80"] <- 0
[1] 46
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "CD60"] <- 0
[1] 47
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "CD10"] <- 0
[1] 48
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "SP50"] <- 0
[1] 49
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "SP60"] <- 0
[1] 50
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "TS70"] <- 0
[1] 51
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "PL10"] <- 0
[1] 52
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "DR50"] <- 1
[1] 53
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "TS70,DR50"] <- 1
[1] 54
drink_driving_1$prior_offence[drink_driving_1$prior_offence == 
    "N"] <- NA
[1] 55
drink_driving_1$prior_offence <- as.numeric(drink_driving_1$prior_offence)
[1] 56
drink_driving_1$outcome <- as.numeric(drink_driving_1$outcome)
[1] 57
m1_drink_nodrink <- glm(outcome ~ prior_offence, data = drink_driving_1, 
    family = binomial)
[1] 58
summary(m1_drink_nodrink)
[1] 59

Call:
glm(formula = outcome ~ prior_offence, family = binomial, data = drink_driving_1)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1686   0.4474   0.4474   0.4474   0.9005  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)  
(Intercept)     0.6931     0.5477   1.266   0.2057  
prior_offence   1.5581     0.7591   2.053   0.0401 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 49.723  on 56  degrees of freedom
Residual deviance: 45.513  on 55  degrees of freedom
  (185 observations deleted due to missingness)
AIC: 49.513

Number of Fisher Scoring iterations: 4

summary(m1_drink_nodrink)
[1] 60

Call:
glm(formula = outcome ~ prior_offence, family = binomial, data = drink_driving_1)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1686   0.4474   0.4474   0.4474   0.9005  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)  
(Intercept)     0.6931     0.5477   1.266   0.2057  
prior_offence   1.5581     0.7591   2.053   0.0401 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 49.723  on 56  degrees of freedom
Residual deviance: 45.513  on 55  degrees of freedom
  (185 observations deleted due to missingness)
AIC: 49.513

Number of Fisher Scoring iterations: 4

offense_driving <- drinkdriving
[1] 61
offense_driving$prior_offence[offense_driving$prior_offence == 
    "DR80"] <- 1
[1] 62
offense_driving$prior_offence[offense_driving$prior_offence == 
    "CD60"] <- 1
[1] 63
offense_driving$prior_offence[offense_driving$prior_offence == 
    "CD10"] <- 1
[1] 64
offense_driving$prior_offence[offense_driving$prior_offence == 
    "SP50"] <- 1
[1] 65
offense_driving$prior_offence[offense_driving$prior_offence == 
    "SP60"] <- 1
[1] 66
offense_driving$prior_offence[offense_driving$prior_offence == 
    "TS70"] <- 1
[1] 67
offense_driving$prior_offence[offense_driving$prior_offence == 
    "PL10"] <- 1
[1] 68
offense_driving$prior_offence[offense_driving$prior_offence == 
    "DR50"] <- 1
[1] 69
offense_driving$prior_offence[offense_driving$prior_offence == 
    "TS70"] <- 1
[1] 70
offense_driving$prior_offence[offense_driving$prior_offence == 
    "TS70,DR50"] <- 1
[1] 71
offense_driving$prior_offence[offense_driving$prior_offence == 
    "N"] <- 0
[1] 72
offense_driving$prior_offence <- as.numeric(offense_driving$prior_offence)
[1] 73
offense_driving$outcome <- as.numeric(offense_driving$outcome)
[1] 74
m1_offense_outcome <- glm(outcome ~ prior_offence, data = offense_driving, 
    family = binomial)
[1] 75
summary(m1_offense_outcome)
[1] 76

Call:
glm(formula = outcome ~ prior_offence, family = binomial, data = offense_driving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9214   0.5863   0.6556   0.6556   0.6556  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)     1.4283     0.1882   7.589 3.23e-14 ***
prior_offence   0.2457     0.4091   0.601    0.548    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 227.86  on 237  degrees of freedom
Residual deviance: 227.49  on 236  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 231.49

Number of Fisher Scoring iterations: 4

Question4_model_GLM <- glm(outcome ~ age + bac + speed + prior_offence + 
    nighttime, data = drinkdriving, family = binomial)
[1] 77
drinkdriving$outcome <- as.numeric(drinkdriving$outcome)
[1] 78
Question4_model_WITH <- with(drinkdriving, data.frame(age = c(14:81), 
    bac = 0, speed = 30, prior_offence = "N", nighttime = 0))
[1] 79
Question4_model_PREDICT <- predict(Question4_model_GLM, newdata = Question4_model_WITH, 
    type = "response")
[1] 80
plot(Question4_model_PREDICT, xlab = "Age", ylab = "Outcome (0=Warning, 1=Fine)")
[1] 81
Question4_model_PREDICT

           1            2            3            4            5            6            7            8            9           10 
8.174083e-01 7.772852e-01 7.312442e-01 6.796085e-01 6.231646e-01 5.631685e-01 5.012651e-01 4.393229e-01 3.792150e-01 3.225992e-01 
          11           12           13           14           15           16           17           18           19           20 
2.707495e-01 2.244718e-01 1.841071e-01 1.496007e-01 1.206057e-01 9.659201e-02 7.694136e-02 6.101842e-02 4.821858e-02 3.799511e-02 
          21           22           23           24           25           26           27           28           29           30 
2.987123e-02 2.344202e-02 1.837037e-02 1.437981e-02 1.124618e-02 8.789338e-03 6.865490e-03 5.360465e-03 4.183976e-03 3.264849e-03 
          31           32           33           34           35           36           37           38           39           40 
2.547118e-03 1.986855e-03 1.549636e-03 1.208513e-03 9.424110e-04 7.348587e-04 5.729906e-04 4.467614e-04 3.483306e-04 2.715803e-04 
          41           42           43           44           45           46           47           48           49           50 
2.117374e-04 1.650787e-04 1.287005e-04 1.003381e-04 7.822557e-05 6.098591e-05 4.754542e-05 3.706692e-05 2.889770e-05 2.252887e-05 
 [ reached getOption("max.print") -- omitted 18 entries ]


mergeddata <- merge(drinkdriving, officer_inc)
[1] 83
mergeddata

  incident_id age nighttime prior_offence     speed       bac outcome officer
1       inc_1  39         1             N 47.957110 17.713735       1      AS
2      inc_10  60         1             N  2.533468 24.419368       0      AS
3     inc_100  68         1             N 25.541785 10.497119       0      AS
4     inc_101  35         0             N 44.357546  8.552419       1      NP
5     inc_102  47         0             N 37.070612 20.756351       1      AS
6     inc_103  41         1             N 40.412547 18.781113       1      NP
 [ reached 'max' / getOption("max.print") -- omitted 236 rows ]


Question_5_INTERACTION <- glm(outcome ~ age * officer, data = mergeddata, 
    family = binomial)
[1] 85
summary(Question_5_INTERACTION)
[1] 86

Call:
glm(formula = outcome ~ age * officer, family = binomial, data = mergeddata)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.71789   0.05619   0.27293   0.52521   2.48308  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)   10.00789    2.17110   4.610 4.03e-06 ***
age           -0.16940    0.03771  -4.492 7.05e-06 ***
officerIT     -4.94343    2.73037  -1.811   0.0702 .  
officerNP     -5.12335    2.63172  -1.947   0.0516 .  
age:officerIT  0.09145    0.04924   1.857   0.0633 .  
age:officerNP  0.10183    0.04649   2.190   0.0285 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.51  on 214  degrees of freedom
Residual deviance: 137.24  on 209  degrees of freedom
  (27 observations deleted due to missingness)
AIC: 149.24

Number of Fisher Scoring iterations: 7

summary(Question_5_INTERACTION)
[1] 87

Call:
glm(formula = outcome ~ age * officer, family = binomial, data = mergeddata)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.71789   0.05619   0.27293   0.52521   2.48308  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)   10.00789    2.17110   4.610 4.03e-06 ***
age           -0.16940    0.03771  -4.492 7.05e-06 ***
officerIT     -4.94343    2.73037  -1.811   0.0702 .  
officerNP     -5.12335    2.63172  -1.947   0.0516 .  
age:officerIT  0.09145    0.04924   1.857   0.0633 .  
age:officerNP  0.10183    0.04649   2.190   0.0285 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.51  on 214  degrees of freedom
Residual deviance: 137.24  on 209  degrees of freedom
  (27 observations deleted due to missingness)
AIC: 149.24

Number of Fisher Scoring iterations: 7

contrasts(mergeddata$officer)
[1] 88
   IT NP
AS  0  0
IT  1  0
NP  0  1
contrasts(mergeddata$officer) <- cbind(ASvsITNP = c(2, -1, -1), 
    ITvsASNP = c(-5, 10, -5), NPvsASIT = c(-1.5, -1.5, 3))
[1] 89
