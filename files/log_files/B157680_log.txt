

	####### B157680 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(apaTables, quietly = T)
[1] 2
 [1] "apaTables" "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 4
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 5
drinkdriving$nighttime[drinkdriving$nighttime == "18:25" | drinkdriving$nighttime == 
    "2:05"] <- "night"
[1] 6
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 7
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60,CD60"] <- "CD60"
[1] 8
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60,CD10,DR80"] <- "DR80"
[1] 9
drinkdriving$prior_offence[drinkdriving$prior_offence == "TS70,DR50"] <- "DR50"
[1] 10
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 11
drinkdriving$prior_offence <- factor(drinkdriving$prior_offence, 
    levels = c("CD10", "CD60", "DR50", "DR80", "PL10", "SP50", 
        "SP60", "TS70", "N"), labels = c("CD", "CD", "DR50", 
        "DR80", "PL", "SP", "SP", "TS", "N"))
[1] 12
drinkdriving$speed[drinkdriving$speed > 100 & drinkdriving$speed < 
    5] <- NA
[1] 13
drinkdriving$bac[drinkdriving$bac > 50] <- NA
[1] 14
drinkdriving$outcome[drinkdriving$outcome == "FINE" | drinkdriving$outcome == 
    "Fine"] <- "fine"
[1] 15
drinkdriving$outcome[drinkdriving$outcome == "WARNING" | drinkdriving$outcome == 
    "Warning"] <- "warning"
[1] 16
drinkdriving$outcome <- factor(drinkdriving$outcome)
[1] 17
drinkdriving$incident_id <- as.factor(drinkdriving$incident_id)
[1] 18
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 19
summary(m1)
[1] 20

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

predict_50 <- coef(m1)[1] + 50 * coef(m1)[2]
[1] 21
par(mfrow = c(1, 2))
[1] 22
$mfrow
[1] 1 1

plot(density(resid(m1)))
[1] 23
plot(m1, which = 2)
[1] 24
m2 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 25
m3 <- lm(bac ~ age + speed, data = drinkdriving)
[1] 26
anova(m2)
[1] 27
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14  38.345 2.969e-09 ***
nighttime   1  721.4  721.42  23.783 2.096e-06 ***
Residuals 215 6521.7   30.33                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
anova(m3)
[1] 28
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14 34.6961 1.471e-08 ***
speed       1   35.5   35.50  1.0589    0.3046    
Residuals 215 7207.6   33.52                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m4 <- lm(bac ~ age + nighttime + speed, data = drinkdriving)
[1] 29
summary(m4)
[1] 30

Call:
lm(formula = bac ~ age + nighttime + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.7811  -4.6224   0.5195   3.7225  14.2190 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    22.99435    2.68293   8.571 2.06e-15 ***
age            -0.10600    0.03007  -3.525 0.000518 ***
nighttimenight  3.92649    0.80461   4.880 2.07e-06 ***
speed           0.04340    0.03992   1.087 0.278151    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

t.test(speed ~ nighttime, data = drinkdriving)
[1] 31

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.85812, df = 155.57, p-value = 0.3921
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.669084  2.235272
sample estimates:
  mean in group day mean in group night 
           39.30514            41.02205 

drinkdriving$fine <- ifelse(drinkdriving$outcome == "fine", 1, 
    0)
[1] 32
m5 <- glm(fine ~ speed + bac + nighttime + age, data = drinkdriving, 
    family = binomial)
[1] 33
summary(m5)
[1] 34

Call:
glm(formula = fine ~ speed + bac + nighttime + age, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.5357   0.0332   0.1529   0.3698   2.3290  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)    -4.82142    2.18300  -2.209 0.027201 *  
speed           0.13780    0.03365   4.095 4.23e-05 ***
bac             0.19513    0.05175   3.770 0.000163 ***
nighttimenight -0.09230    0.55790  -0.165 0.868592    
age            -0.04621    0.02018  -2.290 0.022021 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 216.50  on 217  degrees of freedom
Residual deviance: 106.28  on 213  degrees of freedom
  (32 observations deleted due to missingness)
AIC: 116.28

Number of Fisher Scoring iterations: 7

m6 <- glm(fine ~ scale(speed) + scale(bac), data = drinkdriving, 
    family = binomial)
[1] 35
summary(m6)
[1] 36

Call:
glm(formula = fine ~ scale(speed) + scale(bac), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0812   0.0489   0.1875   0.4458   1.9536  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    2.8061     0.3647   7.694 1.43e-14 ***
scale(speed)   2.1932     0.3850   5.697 1.22e-08 ***
scale(bac)     1.1486     0.2737   4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 130.13  on 240  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 6

drinkdriving$drink_offence <- ifelse(drinkdriving$prior_offence == 
    "DR50", 1, 0)
[1] 37
t.test(fine ~ drink_offence, data = drinkdriving)
[1] 38

	Welch Two Sample t-test

data:  fine by drink_offence
t = -2.2349, df = 84.204, p-value = 0.02807
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.22112689 -0.01289652
sample estimates:
mean in group 0 mean in group 1 
      0.7920792       0.9090909 

drinkdriving$pre_offence <- ifelse(drinkdriving$prior_offence == 
    "N", 0, 1)
[1] 39
t.test(fine ~ pre_offence, data = drinkdriving)
[1] 40

	Welch Two Sample t-test

data:  fine by pre_offence
t = -0.96328, df = 113.72, p-value = 0.3375
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.16034457  0.05542654
sample estimates:
mean in group 0 mean in group 1 
       0.800000        0.852459 

m7 <- glm(fine ~ speed + bac + nighttime + age + pre_offence, 
    data = drinkdriving, family = binomial)
[1] 41
summary(m7)
[1] 42

Call:
glm(formula = fine ~ speed + bac + nighttime + age + pre_offence, 
    family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.1790   0.0137   0.0864   0.2832   2.2988  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)    -4.85979    2.54061  -1.913 0.055769 .  
speed           0.15898    0.03986   3.989 6.65e-05 ***
bac             0.23352    0.06243   3.740 0.000184 ***
nighttimenight -0.06789    0.64366  -0.105 0.915997    
age            -0.07350    0.02529  -2.906 0.003662 ** 
pre_offence     1.10726    0.75808   1.461 0.144123    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.086  on 213  degrees of freedom
Residual deviance:  81.679  on 208  degrees of freedom
  (36 observations deleted due to missingness)
AIC: 93.679

Number of Fisher Scoring iterations: 7

predict_pro <- data.frame(age = 17:100)
[1] 43
for (i in 17:100) {
    condition <- with(drinkdriving, data.frame(nighttime = "day", 
        speed = 30, bac = 0, pre_offence = 0, age = i))
    predict_pro$fine[i - 16] <- predict(m7, newdata = condition, 
        type = "response")
}
[1] 44
NULL
par(mfrow = c(1, 1))
[1] 45
$mfrow
[1] 1 2

with(predict_pro, plot(fine ~ age, type = "l", ylab = "Probability of Fine", 
    xlab = "Age"))
[1] 46
table(officer_inc$officer)
[1] 47

 AS  IT  NP 
116  66  67 
officer_m <- merge(drinkdriving, officer_inc, all = T)
[1] 48
qplot(data = officer_m, officer, age, colour = fine)
[1] 49
m8 <- glm(fine ~ age * officer, data = officer_m, family = "binomial")
[1] 50
summary(m8)
[1] 51

Call:
glm(formula = fine ~ age * officer, family = "binomial", data = officer_m)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    9.56920    1.99554   4.795 1.62e-06 ***
age           -0.16122    0.03466  -4.652 3.29e-06 ***
officerIT     -5.04535    2.39610  -2.106   0.0352 *  
officerNP     -4.68465    2.48887  -1.882   0.0598 .  
age:officerIT  0.09612    0.04254   2.260   0.0238 *  
age:officerNP  0.09365    0.04405   2.126   0.0335 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

age_group <- cut(officer_m$age[officer_m$officer == "AS"], seq(10, 
    90, by = 5))
[1] 52
fine_proportion <- aggregate(officer_m$fine[officer_m$officer == 
    "AS"], list(age_group), mean)
[1] 53
plot(fine_proportion, xlab = "Age", ylab = "Proportion Fined")
[1] 54
