

	####### B151415 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(scatterplot3d, quietly = T)
[1] 2
 [1] "scatterplot3d" "ggplot2"       "readr"         "stats"         "graphics"      "grDevices"     "utils"        
 [8] "datasets"      "methods"       "base"         
library(forcats, quietly = T)
[1] 3
 [1] "forcats"       "scatterplot3d" "ggplot2"       "readr"         "stats"         "graphics"      "grDevices"    
 [8] "utils"         "datasets"      "methods"       "base"         
library(dplyr, quietly = T)
[1] 4
 [1] "dplyr"         "forcats"       "scatterplot3d" "ggplot2"       "readr"         "stats"         "graphics"     
 [8] "grDevices"     "utils"         "datasets"      "methods"       "base"         
load(url("https://edin.ac/2QCZNVu"))
[1] 5
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 6
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
summary(officer_inc)
[1] 7
 officer     incident_id 
 AS  :116   inc_1  :  1  
 IT  : 66   inc_10 :  1  
 NP  : 67   inc_100:  1  
 NA's:  1   inc_101:  1  
            inc_102:  1  
            inc_103:  1  
            (Other):244  
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 8
drinkdriving$outcome <- factor(drinkdriving$outcome)
[1] 9
drinkdriving$prior_offence <- factor(drinkdriving$prior_offence)
[1] 10
drinkdriving$incident_id <- factor(drinkdriving$incident_id)
[1] 11
drinkdriving$age[drinkdriving$age < 17 | drinkdriving$age > 150] <- NA
[1] 12
drinkdriving$speed[drinkdriving$speed > 100] <- NA
[1] 13
drinkdriving$bac[drinkdriving$bac > 50] <- NA
[1] 14
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60,CD10,DR80" | 
    drinkdriving$prior_offence == "CD60,CD60" | drinkdriving$prior_offence == 
    "DD20" | drinkdriving$prior_offence == "TS70,DR50"] <- NA
[1] 15
drinkdriving$nighttime[drinkdriving$nighttime == "18:25" | drinkdriving$nighttime == 
    "2:05"] <- "night"
[1] 16
drinkdriving$outcome[drinkdriving$outcome == "Fine" | drinkdriving$outcome == 
    "FINE"] <- "fine"
[1] 17
drinkdriving$outcome[drinkdriving$outcome == "Warning" | drinkdriving$outcome == 
    "WARNING"] <- "warning"
[1] 18
drinkdriving$nighttime <- droplevels(drinkdriving$nighttime)
[1] 19
drinkdriving$outcome <- droplevels(drinkdriving$outcome)
[1] 20
drinkdriving$prior_offence <- droplevels(drinkdriving$prior_offence)
[1] 21
officer_inc <- na.omit(officer_inc)
[1] 22
drinkdriving <- na.omit(drinkdriving)
[1] 23
final_data <- merge(drinkdriving, officer_inc, by = "incident_id")
[1] 24
sum(!complete.cases(final_data))
[1] 25
[1] 0
speed_bac <- ggplot(data = final_data, aes(x = speed, y = bac, 
    colour = outcome, shape = officer))
[1] 26
speed_bac + geom_point(size = 3) + theme_minimal() + facet_grid(. ~ 
    nighttime)
[1] 27
m1 <- lm(bac ~ age, data = final_data)
[1] 28
summary(m1)
[1] 29

Call:
lm(formula = bac ~ age, data = final_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.2082  -4.1942  -0.4251   4.2093  14.7755 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.24650    1.18495   23.84  < 2e-16 ***
age         -0.12856    0.02531   -5.08 8.52e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.886 on 203 degrees of freedom
Multiple R-squared:  0.1128,	Adjusted R-squared:  0.1084 
F-statistic: 25.81 on 1 and 203 DF,  p-value: 8.516e-07

with(final_data, plot(age, bac, xlab = "Age", ylab = "BAC", main = "Blood Alcohol COntent", 
    col = c("blue"), bty = "n", pch = 20))
[1] 30
abline(m1)
[1] 31
new_age <- data.frame(age = 50)
[1] 32
BAC50 <- predict(m1, newdata = new_age)
[1] 33
par(mfrow = c(2, 2))
[1] 34
$mfrow
[1] 2 2

plot(m1, which = c(1:4))
[1] 35
par(mfrow = c(1, 1))
[1] 36
$mfrow
[1] 2 2

m2 <- lm(bac ~ age + nighttime + speed, data = final_data)
[1] 37
anova(m2)
[1] 38
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1  894.1  894.08 28.3892 2.649e-07 ***
nighttime   1  677.0  676.96 21.4950 6.378e-06 ***
speed       1   24.8   24.77  0.7867    0.3762    
Residuals 201 6330.2   31.49                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2)
[1] 39

Call:
lm(formula = bac ~ age + nighttime + speed, data = final_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.9093  -4.6365   0.4171   3.7986  14.1980 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    22.95878    2.88916   7.947 1.35e-13 ***
age            -0.10140    0.03235  -3.134  0.00198 ** 
nighttimenight  3.88408    0.84128   4.617 6.94e-06 ***
speed           0.03843    0.04333   0.887  0.37617    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.612 on 201 degrees of freedom
Multiple R-squared:  0.2013,	Adjusted R-squared:  0.1894 
F-statistic: 16.89 on 3 and 201 DF,  p-value: 7.996e-10

par(mfrow = c(2, 2))
[1] 40
$mfrow
[1] 1 1

plot(m2, which = c(1:4))
[1] 41
par(mfrow = c(1, 1))
[1] 42
$mfrow
[1] 2 2

boxplot(final_data$speed ~ final_data$nighttime, main = "Boxplot For Driver's Speed By Time Of The Day", 
    col = c("red", "blue"))
[1] 43
final_data$outcome <- ifelse(final_data$outcome == "fine", 1, 
    0)
[1] 44
m3 <- glm(outcome ~ bac + speed, data = final_data, family = binomial)
[1] 45
anova(pred_outcome, test = "Chisq")
[1] 46
[1] "Error in anova(pred_outcome, test = \"Chisq\") : \n  object 'pred_outcome' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in anova(pred_outcome, test = "Chisq"): object 'pred_outcome' not found>


####################################################################################################

[1] "Error in anova(pred_outcome, test = \"Chisq\") : \n  object 'pred_outcome' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in anova(pred_outcome, test = "Chisq"): object 'pred_outcome' not found>
####################################################################################################


summary(pred_outcome)
[1] 47
[1] "Error in summary(pred_outcome) : object 'pred_outcome' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in summary(pred_outcome): object 'pred_outcome' not found>


####################################################################################################

[1] "Error in summary(pred_outcome) : object 'pred_outcome' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in summary(pred_outcome): object 'pred_outcome' not found>
####################################################################################################


m3.1 <- lm(outcome ~ bac + speed, data = final_data)
[1] 48
m3.s <- lm(scale(outcome) ~ scale(bac) + scale(speed), data = final_data)
[1] 49
summary(m3.s)
[1] 50

Call:
lm(formula = scale(outcome) ~ scale(bac) + scale(speed), data = final_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.7964 -0.3892  0.1434  0.5788  1.6291 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.981e-16  5.391e-02   0.000        1    
scale(bac)   3.084e-01  5.613e-02   5.494 1.17e-07 ***
scale(speed) 4.841e-01  5.613e-02   8.626 1.88e-15 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.7719 on 202 degrees of freedom
Multiple R-squared:   0.41,	Adjusted R-squared:  0.4042 
F-statistic: 70.19 on 2 and 202 DF,  p-value: < 2.2e-16

summary(final_data$prior_offence)
[1] 51
CD10 CD60 DR50 DR80    N PL10 SP50 SP60 TS70 
   2    1   36    4  155    2    2    1    2 
final_data$prior_offence <- fct_collapse(final_data$prior_offence, 
    D = c("DR50"), M = c("CD10", "CD60", "PL10", "SP50", "SP60", 
        "TS70"), O = c("DR80"))
[1] 52
final_data$is.d <- ifelse(final_data$prior_offence == "D", 1, 
    0)
[1] 53
final_data$is.m <- ifelse(final_data$prior_offence == "M", 1, 
    0)
[1] 54
final_data$is.o <- ifelse(final_data$prior_offence == "O", 1, 
    0)
[1] 55
m3.2 <- lm(outcome ~ is.d + is.m + is.o, data = final_data)
[1] 56
summary(m3.2)
[1] 57

Call:
lm(formula = outcome ~ is.d + is.m + is.o, data = final_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.91667  0.08333  0.21290  0.21290  0.30000 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.78710    0.03183  24.724   <2e-16 ***
is.d         0.12957    0.07333   1.767   0.0787 .  
is.m        -0.08710    0.12931  -0.674   0.5014    
is.o        -0.03710    0.20071  -0.185   0.8536    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3963 on 201 degrees of freedom
Multiple R-squared:  0.01929,	Adjusted R-squared:  0.004649 
F-statistic: 1.318 on 3 and 201 DF,  p-value: 0.2698

m4 <- glm(outcome ~ age + prior_offence + nighttime + speed + 
    bac, data = final_data, family = binomial)
[1] 58
new_data <- with(final_data, data.frame(age = 17:90, prior_offence = "N", 
    nighttime = "night", speed = 30, bac = 0))
[1] 59
pred_m4 <- predict(m4, new_data, type = "response", se.fit = TRUE)
[1] 60
predm4 <- pred_m4$fit
[1] 61
head(predm4)
[1] 62
        1         2         3         4         5         6 
0.3028096 0.2834442 0.2648469 0.2470490 0.2300729 0.2139318 
plot(17:90, predm4, type = "l", ylab = "Predicted Probability for Fine", 
    xlab = "Age", bty = "n", main = "Predicted Probability for Fine by Age")
[1] 63
bias <- table(final_data$age, final_data$officer, final_data$outcome)
[1] 64
print(bias)
[1] 65
, ,  = 0

    
     AS IT NP
  17  0  0  0
  19  0  0  0
  20  0  0  0
  21  0  0  0
  22  0  0  0
  23  0  0  0
  24  0  0  0
  25  0  0  0
  26  0  0  0
  27  0  0  0
  28  0  0  1
  29  0  0  0
  30  0  0  0
  31  0  1  0
  32  0  0  0
  33  0  0  0

 [ reached getOption("max.print") -- omitted 43 row(s) and 1 matrix slice(s) ]
, ,  = 0

    
     AS IT NP
  17  0  0  0
  19  0  0  0
  20  0  0  0
  21  0  0  0
  22  0  0  0
  23  0  0  0
  24  0  0  0
  25  0  0  0
  26  0  0  0
  27  0  0  0
  28  0  0  1
  29  0  0  0
  30  0  0  0
  31  0  1  0
  32  0  0  0
  33  0  0  0

 [ reached getOption("max.print") -- omitted 43 row(s) and 1 matrix slice(s) ]
