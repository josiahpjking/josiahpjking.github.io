

	####### B158099 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 2
[1] "drinkdriving" "officer_inc" 
library(plyr, quietly = T)
[1] 3
 [1] "plyr"      "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(doBy, quietly = T)
[1] 4
 [1] "doBy"      "plyr"      "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
library(car, quietly = T)
[1] 5
 [1] "car"       "carData"   "doBy"      "plyr"      "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"    
[11] "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 6
 [1] "psych"     "car"       "carData"   "doBy"      "plyr"      "ggplot2"   "readr"     "stats"     "graphics"  "grDevices"
[11] "utils"     "datasets"  "methods"   "base"     
library(lsr, quietly = T)
[1] 7
 [1] "lsr"       "psych"     "car"       "carData"   "doBy"      "plyr"      "ggplot2"   "readr"     "stats"     "graphics" 
[11] "grDevices" "utils"     "datasets"  "methods"   "base"     
library(ggplot2, quietly = T)
[1] 8
 [1] "lsr"       "psych"     "car"       "carData"   "doBy"      "plyr"      "ggplot2"   "readr"     "stats"     "graphics" 
[11] "grDevices" "utils"     "datasets"  "methods"   "base"     
summary(drinkdriving)
[1] 9
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
describe(drinkdriving)
[1] 10
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
outliers <- function(obs, x = 2.5) {
    return(abs(obs - mean(obs, na.rm = T)) > (sd(obs, na.rm = T) * 
        x))
}
[1] 11
drinkdriving$age[which(outliers(drinkdriving$age))] <- NA
[1] 12
drinkdriving$age[drinkdriving$age < 17] <- NA
[1] 13
drinkdriving$age <- as.integer(drinkdriving$age)
[1] 14
drinkdriving$speed[which(outliers(drinkdriving$speed))] <- NA
[1] 15
drinkdriving$speed <- round(drinkdriving$speed, 2)
[1] 16
drinkdriving$bac[which(outliers(drinkdriving$bac))] <- NA
[1] 17
drinkdriving$bac <- round(drinkdriving$bac)/100
[1] 18
table(drinkdriving$nighttime)
[1] 19

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- NA
[1] 20
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- NA
[1] 21
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 22
table(drinkdriving$prior_offence)
[1] 23

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 24
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 25
levels(drinkdriving$prior_offence)
[1] 26
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DR50"           "DR80"           "N"             
 [8] "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
drinkdriving$newoffence <- revalue(drinkdriving$prior_offence, 
    c(CD10 = "CD", CD60 = "CD", `CD60,CD10,DR80` = "CD,DR80", 
        `CD60,CD60` = "CD", PL10 = "PL", SP50 = "SP", SP60 = "SP", 
        TS70 = "TS", `TS70,DR50` = "TS,DR50"))
[1] 27
table(drinkdriving$outcome)
[1] 28

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 29
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 30
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 31
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 32
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 33
hist(drinkdriving$bac)
[1] 34
hist(drinkdriving$speed)
[1] 35
hist(drinkdriving$age)
[1] 36
plot(drinkdriving$age, drinkdriving$bac)
[1] 37
with(drinkdriving, plot(age, bac, col = as.numeric(outcome), 
    pch = ifelse(nighttime == "night", 2, 4)))
[1] 38
myplot <- ggplot(data = drinkdriving, aes(x = age, y = bac, colour = nighttime))
[1] 39
myplot + geom_point() + theme_minimal() + facet_grid(. ~ outcome)
[1] 40
myplot2 <- ggplot(data = data, aes(x = age, y = bac, colour = outcome))
[1] 41


####################################################################################################

[1] "Error : You're passing a function as global data.\nHave you misspelled the `data` argument in `ggplot()`\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError: You're passing a function as global data.
Have you misspelled the `data` argument in `ggplot()`>
####################################################################################################


myplot2 + geom_point() + theme_minimal() + facet_grid(. ~ officer)
[1] 42
[1] "Error in eval(script[[ll]]) : object 'myplot2' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in eval(script[[ll]]): object 'myplot2' not found>


####################################################################################################

[1] "Error in eval(script[[ll]]) : object 'myplot2' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in eval(script[[ll]]): object 'myplot2' not found>
####################################################################################################


m1 <- lm(bac ~ age, data = drinkdriving, na.action = na.omit)
[1] 43
summary(m1)
[1] 44

Call:
lm(formula = bac ~ age, data = drinkdriving, na.action = na.omit)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.156197 -0.039033 -0.005152  0.039418  0.147759 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2810497  0.0115573  24.318  < 2e-16 ***
age         -0.0012687  0.0002478  -5.121 6.92e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05831 on 208 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1119,	Adjusted R-squared:  0.1077 
F-statistic: 26.22 on 1 and 208 DF,  p-value: 6.923e-07

plot(drinkdriving$age, drinkdriving$bac, xlab = "Age", ylab = "Blood Alcohol Content")
[1] 45
abline(lm(drinkdriving$bac ~ drinkdriving$age), col = "red", 
    lwd = 2)
[1] 46
plot(m1, which = 1)
[1] 47
plot(m1, which = 2)
[1] 48
plot(m1, which = 3)
[1] 49
plot(m1, which = 4)
[1] 50
new_age <- data.frame(age = 50)
[1] 51
predict(m1, newdata = new_age)
[1] 52
        1 
0.2176149 
hist(x = residuals(m1))
[1] 53
plot(density(residuals(m1)))
[1] 54
plot(m1, which = 2)
[1] 55
shapiro.test(residuals(m1))
[1] 56

	Shapiro-Wilk normality test

data:  residuals(m1)
W = 0.99427, p-value = 0.6033

m2 <- lm(bac ~ age + speed, data = drinkdriving)
[1] 57
summary(m2)
[1] 58

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.14783 -0.03836 -0.00770  0.03818  0.14161 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2351880  0.0303156   7.758 4.12e-13 ***
age         -0.0009521  0.0003346  -2.845   0.0049 ** 
speed        0.0008108  0.0004776   1.698   0.0911 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05821 on 203 degrees of freedom
  (44 observations deleted due to missingness)
Multiple R-squared:  0.1311,	Adjusted R-squared:  0.1226 
F-statistic: 15.32 on 2 and 203 DF,  p-value: 6.369e-07

m3 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 59
summary(m3)
[1] 60

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.168330 -0.045961  0.004381  0.036231  0.141613 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2545312  0.0126355  20.144  < 2e-16 ***
age            -0.0012720  0.0002349  -5.414 1.71e-07 ***
nighttimenight  0.0388471  0.0081270   4.780 3.34e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05457 on 205 degrees of freedom
  (42 observations deleted due to missingness)
Multiple R-squared:  0.2175,	Adjusted R-squared:  0.2099 
F-statistic: 28.49 on 2 and 205 DF,  p-value: 1.21e-11

AIC(m2, m3)
[1] 61
   df       AIC
m2  4 -582.0520
m3  4 -614.5717
standardCoefs(m2)
[1] 62
                  b       beta
age   -0.0009520829 -0.2474100
speed  0.0008107802  0.1476236
standardCoefs(m3)
[1] 63
                          b       beta
age            -0.001271999 -0.3357233
nighttimenight  0.038847107  0.2963984
par(mfrow = c(2, 2))
[1] 64
$mfrow
[1] 2 2

plot(m2)
[1] 65
plot(m3)
[1] 66
shapiro.test(residuals(m3))
[1] 67

	Shapiro-Wilk normality test

data:  residuals(m3)
W = 0.99116, p-value = 0.2371

anova(m2)
[1] 68
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.09403 0.094030 27.7543 3.503e-07 ***
speed       1 0.00976 0.009763  2.8818   0.09112 .  
Residuals 203 0.68775 0.003388                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
anova(m3)
[1] 69
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.10164 0.101635  34.128 2.003e-08 ***
nighttime   1 0.06804 0.068045  22.849 3.340e-06 ***
Residuals 205 0.61050 0.002978                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
par(mfrow = c(2, 2))
[1] 70
$mfrow
[1] 2 2

plot(m2, which = 1:4)
[1] 71
par(mfrow = c(2, 2))
[1] 72
$mfrow
[1] 2 2

plot(m3, which = 1:4)
[1] 73
m4 <- lm(bac ~ age + speed + nighttime, data = drinkdriving)
[1] 74
summary(m4)
[1] 75

Call:
lm(formula = bac ~ age + speed + nighttime, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153778 -0.043540  0.003782  0.034378  0.140012 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2160790  0.0292137   7.396 3.77e-12 ***
age            -0.0009946  0.0003180  -3.128  0.00202 ** 
speed           0.0006985  0.0004529   1.542  0.12457    
nighttimenight  0.0372519  0.0081987   4.544 9.55e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05465 on 200 degrees of freedom
  (46 observations deleted due to missingness)
Multiple R-squared:  0.2294,	Adjusted R-squared:  0.2179 
F-statistic: 19.85 on 3 and 200 DF,  p-value: 2.65e-11

anova(m4)
[1] 76
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.10725 0.107249 35.9034 9.506e-09 ***
speed       1 0.00895 0.008952  2.9968   0.08497 .  
nighttime   1 0.06167 0.061668 20.6446 9.554e-06 ***
Residuals 200 0.59743 0.002987                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
plot(m4)
[1] 77
t.test(drinkdriving$speed ~ drinkdriving$nighttime, alternative = "greater")
[1] 78

	Welch Two Sample t-test

data:  drinkdriving$speed by drinkdriving$nighttime
t = -2, df = 180.57, p-value = 0.9765
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 -6.060657       Inf
sample estimates:
  mean in group day mean in group night 
           38.25299            41.57085 

summary(m6)
[1] 79
[1] "Error in summary(m6) : object 'm6' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in summary(m6): object 'm6' not found>


####################################################################################################

[1] "Error in summary(m6) : object 'm6' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in summary(m6): object 'm6' not found>
####################################################################################################


plot(m5)
[1] 80


####################################################################################################

[1] "Error in plot(m5) : object 'm5' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in plot(m5): object 'm5' not found>
####################################################################################################


glm1 <- glm(outcome ~ age + nighttime + speed + bac + newoffence, 
    data = drinkdriving, family = binomial)
[1] 81
anova(glm1, test = "Chisq")
[1] 82
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


           Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                         199    191.556              
age         1   70.294       198    121.263 < 2.2e-16 ***
nighttime   1    2.243       197    119.020  0.134207    
speed       1   17.229       196    101.790 3.313e-05 ***
bac         1   18.830       195     82.960 1.429e-05 ***
newoffence  6   20.200       189     62.761  0.002551 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(glm1)
[1] 83

Call:
glm(formula = outcome ~ age + nighttime + speed + bac + newoffence, 
    family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8090  -0.2220  -0.0466  -0.0051   4.3172  

Coefficients:
                 Estimate Std. Error z value Pr(>|z|)    
(Intercept)      -2.50440    3.59244  -0.697 0.485722    
age               0.14291    0.03834   3.727 0.000194 ***
nighttimenight    0.41767    0.75177   0.556 0.578498    
speed            -0.13286    0.05060  -2.625 0.008655 ** 
bac             -29.46424    7.70393  -3.825 0.000131 ***
newoffenceDR50    1.27525    2.18154   0.585 0.558842    
newoffenceDR80    8.33820    2.95731   2.820 0.004810 ** 
newoffenceN       3.72330    1.91891   1.940 0.052341 .  
newoffencePL      1.69734   46.67700   0.036 0.970992    
newoffenceSP      8.81994    2.89717   3.044 0.002332 ** 
 [ reached getOption("max.print") -- omitted 1 row ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 191.556  on 199  degrees of freedom
Residual deviance:  62.761  on 189  degrees of freedom
  (50 observations deleted due to missingness)
AIC: 84.761

Number of Fisher Scoring iterations: 15

glm2 <- glm(outcome ~ scale(bac), family = binomial, data = drinkdriving)
[1] 84
summary(glm2)
[1] 85

Call:
glm(formula = outcome ~ scale(bac), family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.6238  -0.6603  -0.4127  -0.2071   2.9826  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  -1.8845     0.2221  -8.486  < 2e-16 ***
scale(bac)   -1.3198     0.2222  -5.940 2.86e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 235.39  on 241  degrees of freedom
Residual deviance: 185.72  on 240  degrees of freedom
  (8 observations deleted due to missingness)
AIC: 189.72

Number of Fisher Scoring iterations: 5

anova(glm2, test = "Chisq")
[1] 86
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


           Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                         241     235.39              
scale(bac)  1   49.667       240     185.72 1.822e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
logLik(glm2)
[1] 87
'log Lik.' -92.86133 (df=2)
glm3 <- glm(outcome ~ scale(speed), family = binomial, data = drinkdriving)
[1] 88
summary(glm3)
[1] 89

Call:
glm(formula = outcome ~ scale(speed), family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8321  -0.5255  -0.2572  -0.0921   3.4655  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.4804     0.3108  -7.981 1.45e-15 ***
scale(speed)  -2.0541     0.3156  -6.509 7.55e-11 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 230.28  on 243  degrees of freedom
Residual deviance: 153.22  on 242  degrees of freedom
  (6 observations deleted due to missingness)
AIC: 157.22

Number of Fisher Scoring iterations: 6

anova(glm3, test = "Chisq")
[1] 90
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


             Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                           243     230.28              
scale(speed)  1   77.061       242     153.22 < 2.2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
logLik(glm3)
[1] 91
'log Lik.' -76.61097 (df=2)
drinkdriving$newoutcome <- ifelse(drinkdriving$outcome == "fine", 
    1, 0)
[1] 92
drinkdriving$newoutcome <- as.factor(drinkdriving$newoutcome)
[1] 93
drinkdriving$new <- rep(drinkdriving$prior_offence)
[1] 94
drinkdriving$new <- as.character(drinkdriving$new)
[1] 95
drinkdriving$new[which(drinkdriving$new == "N")] <- NA
[1] 96
drinkdriving$new[which(drinkdriving$new != "DR50")] <- "Non"
[1] 97
drinkdriving$new <- as.factor(drinkdriving$new)
[1] 98
chisq.test(drinkdriving$new, drinkdriving$newoutcome)
[1] 99

	Pearson's Chi-squared test with Yates' continuity correction

data:  drinkdriving$new and drinkdriving$newoutcome
X-squared = 5.0692, df = 1, p-value = 0.02435

modeldrinkoffence <- glm(newoutcome ~ relevel(new, "Non"), data = drinkdriving, 
    family = binomial)
[1] 100
summary(modeldrinkoffence)
[1] 101

Call:
glm(formula = newoutcome ~ relevel(new, "Non"), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3076   0.3803   0.3803   0.3803   0.9005  

Coefficients:
                        Estimate Std. Error z value Pr(>|z|)  
(Intercept)               0.6931     0.5000   1.386    0.166  
relevel(new, "Non")DR50   1.8971     0.7800   2.432    0.015 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 51.047  on 60  degrees of freedom
Residual deviance: 44.676  on 59  degrees of freedom
  (189 observations deleted due to missingness)
AIC: 48.676

Number of Fisher Scoring iterations: 5

anova(modeldrinkoffence, test = "Chisq")
[1] 102
Analysis of Deviance Table

Model: binomial, link: logit

Response: newoutcome

Terms added sequentially (first to last)


                    Df Deviance Resid. Df Resid. Dev Pr(>Chi)  
NULL                                   60     51.047           
relevel(new, "Non")  1   6.3715        59     44.676   0.0116 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
exp(1.89)
[1] 103
[1] 6.619369
with(drinkdriving, plot(new, outcome))
[1] 104
drinkdriving$noffence <- ifelse(drinkdriving$prior_offence == 
    "N", 0, 1)
[1] 105
drinkdriving$noffence <- as.factor(drinkdriving$noffence)
[1] 106
modelnoffence <- glm(newoutcome ~ noffence, data = drinkdriving, 
    family = binomial)
[1] 107
summary(modelnoffence)
[1] 108

Call:
glm(formula = newoutcome ~ noffence, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9564   0.5650   0.6681   0.6681   0.6681  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)   1.3863     0.1838   7.542 4.62e-14 ***
noffence1     0.3677     0.4051   0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

anova(modelnoffence, test = "Chisq")
[1] 109
Analysis of Deviance Table

Model: binomial, link: logit

Response: newoutcome

Terms added sequentially (first to last)


         Df Deviance Resid. Df Resid. Dev Pr(>Chi)
NULL                       245     237.06         
noffence  1  0.86504       244     236.20   0.3523
df <- data.frame(age = sort(unique(drinkdriving$age)), nighttime = as.factor("day"), 
    speed = 30, bac = 0, prior_offence = as.factor("N"))
[1] 110
newdfmodel <- glm(newoutcome ~ age + nighttime + bac + speed + 
    prior_offence, data = drinkdriving, family = binomial)
[1] 111
summary(newdfmodel)
[1] 112

Call:
glm(formula = newoutcome ~ age + nighttime + bac + speed + prior_offence, 
    family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.8025   0.0001   0.0053   0.0546   2.0309  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)         26.88847 4240.87588   0.006 0.994941    
age                 -0.26324    0.07594  -3.467 0.000527 ***
nighttimenight      -0.37877    1.03091  -0.367 0.713314    
bac                 50.13826   13.17465   3.806 0.000141 ***
speed                0.16948    0.06846   2.475 0.013305 *  
prior_offenceCD60  -55.05604 7780.09251  -0.007 0.994354    
prior_offenceDR50  -23.01869 4240.87367  -0.005 0.995669    
prior_offenceDR80  -34.43125 4240.87550  -0.008 0.993522    
prior_offenceN     -26.55065 4240.87363  -0.006 0.995005    
prior_offencePL10  -22.71966 4316.91469  -0.005 0.995801    
 [ reached getOption("max.print") -- omitted 3 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 191.556  on 199  degrees of freedom
Residual deviance:  34.008  on 187  degrees of freedom
  (50 observations deleted due to missingness)
AIC: 60.008

Number of Fisher Scoring iterations: 17

df$model_prediction <- predict(newdfmodel, newdata = df, type = "response")
[1] 113
with(df, plot(age, model_prediction, ylab = "Predicted Probability for Fine", 
    xlab = "Age", bty = "n", lty = , lwd = 1, type = "p", col = "purple"))
[1] 114
table(officer_inc$officer)
[1] 115

 AS  IT  NP 
116  66  67 
data <- merge(drinkdriving, officer_inc, by = "incident_id", 
    all = T)
[1] 116
modelofficers <- glm(newoutcome ~ officer * age, data = data, 
    family = binomial)
[1] 117
summary(modelofficers)
[1] 118

Call:
glm(formula = newoutcome ~ officer * age, family = binomial, 
    data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0757   0.3183   0.5638   2.4075  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    9.55712    2.00043   4.778 1.77e-06 ***
officerIT     -5.14843    2.41761  -2.130   0.0332 *  
officerNP     -4.67258    2.49279  -1.874   0.0609 .  
age           -0.16102    0.03474  -4.635 3.57e-06 ***
officerIT:age  0.09792    0.04290   2.283   0.0225 *  
officerNP:age  0.09345    0.04412   2.118   0.0342 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 218.83  on 216  degrees of freedom
Residual deviance: 146.22  on 211  degrees of freedom
  (33 observations deleted due to missingness)
AIC: 158.22

Number of Fisher Scoring iterations: 6

plot(data$officer, data$newoutcome)
[1] 119
exp(-0.16)
[1] 120
[1] 0.8521438
-0.16 + 0.09
[1] 121
[1] -0.07
exp(-0.07)
[1] 122
[1] 0.9323938
-0.16 + 0.09
[1] 123
[1] -0.07
exp(-0.07)
[1] 124
[1] 0.9323938
data <- data[complete.cases(data), ]
[1] 125
results <- summaryBy(age ~ outcome + officer, data = data, FUN = mean, 
    keep.names = TRUE)
[1] 126
ggplot(results, aes(x = officer, y = age, fill = outcome)) + 
    geom_bar(stat = "identity", position = "dodge") + geom_label(aes(label = round(results$age, 
    2)))
[1] 127
