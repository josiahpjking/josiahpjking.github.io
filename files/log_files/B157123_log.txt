

	####### B157123 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 2
[1] "drinkdriving" "officer_inc" 
df1 <- data.frame(drinkdriving["age"], drinkdriving["bac"])
[1] 3
df1$age[df1$age <= 16] <- NA
[1] 4
df1$age[df1$age >= 90] <- NA
[1] 5
df1$bac[df1$bac >= 40] <- NA
[1] 6
na.omit(df1)
[1] 7
   age      bac
1   39 17.71374
2   28 22.13440
3   38 32.78940
4   51 20.47576
5   56 29.36736
6   36 19.12717
7   81 21.37720
8   49 26.79802
9   32 23.79414
10  60 24.41937
11  28 28.49106
12  41 26.45774
13  23 15.98962
14  35 30.77619
15  39 20.38158
16  47 27.21842
18  43 19.61390
19  34 30.06943
20  48 20.91227
21  33 25.30412
23  65 17.67302
24  21 20.94909
25  46 20.70656
27  53 24.52610
28  52 20.68700
 [ reached 'max' / getOption("max.print") -- omitted 184 rows ]
m1 <- lm(bac ~ age, data = df1)
[1] 8
plot(df1$age, df1$bac, sub = "Figure 1.1 Association between bac and age", 
    xlab = "age", ylab = "bac")
[1] 9
abline(m1)
[1] 10
summary(m1)
[1] 11

Call:
lm(formula = bac ~ age, data = df1)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.384  -4.136  -0.775   4.022  14.479 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 27.77719    1.16533  23.836  < 2e-16 ***
age         -0.11763    0.02515  -4.678 5.23e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.802 on 207 degrees of freedom
  (41 observations deleted due to missingness)
Multiple R-squared:  0.09561,	Adjusted R-squared:  0.09124 
F-statistic: 21.88 on 1 and 207 DF,  p-value: 5.228e-06

a <- data.frame(age = 50)
[1] 12
result <- predict(m1, a)
[1] 13
print(result)
[1] 14
       1 
21.89567 
       1 
21.89567 
plot(density(residuals(m1)), sub = "Figure 1.2 Model residuals")
[1] 15
shapiro.test(residuals(m1))
[1] 16

	Shapiro-Wilk normality test

data:  residuals(m1)
W = 0.99349, p-value = 0.4913

qqnorm(residuals(m1), sub = "Figure 1.3 Q-Q plot")
[1] 17
$x
 [1] -0.95473264 -0.30447564  1.59797812 -0.16870497  1.26536190 -0.77997312  0.52715476  0.81291300  0.06000317  0.59740168
[11]  0.64098704  0.58312581 -1.51731726  1.16499964 -0.43292154  0.88160504 -0.49978726  1.03336011 -0.08405292  0.20532198
[21] -0.35513556 -0.76381738 -0.25458576  0.49978726 -0.02398917 -0.97382479 -1.38039807 -2.82118307  0.10815140  0.39373066
[31]  0.73208804 -1.09680356 -1.07517441  1.05403689  1.07517441 -0.24221646  0.22988412  1.51731726  0.54098671  0.19308813
[41] -0.48624389 -0.34239000  0.29193682 -0.82971743  0.61180035  0.14442172 -0.18088311  0.99327868  1.18897435  0.62632700
 [ reached getOption("max.print") -- omitted 159 entries ]

$y
          1           2           3           4           5           6           7           8           9          10          11 
 -5.4758719  -2.3491421   9.4821577  -1.3022793   8.1774699  -4.4153275   3.1280668   4.7847216  -0.2188806   3.6999993   4.0075185 
         12          13          14          15          16          18          19          20          21          23          24 
  3.5033900  -9.0820779   7.1160651  -2.8080278   4.9698574  -3.1051888   6.2916708  -1.2186667   1.4087310  -2.4581985  -4.3578621 
         25          27          28          29          30          31          32          33          34          35          36 
 -1.6596302   2.9833165  -0.9734113  -5.5260605  -8.1958707 -15.3840480   0.4632344   2.4010340   4.3151791  -6.0021673  -5.8976650 
         37          38          39          40          41          42          43          44          45          46          47 
  6.3282610   6.3684300  -1.6496621   1.5601249   9.3687058   3.2537562   1.3194636  -3.0536510  -2.4115272   2.0437834  -4.7721673 
         48          49          52          53          56          57 
  3.7167408   0.8458292  -1.3753929   5.9085996   7.1408412   3.8868375 
 [ reached getOption("max.print") -- omitted 159 entries ]

df2 <- data.frame(drinkdriving["nighttime"], drinkdriving["speed"], 
    drinkdriving["age"], drinkdriving["bac"])
[1] 18
df2$nighttime[df2$nighttime == "2:05"] <- "night"
[1] 19
df2$nighttime[df2$nighttime == "18:25"] <- "night"
[1] 20
df2$nighttime[df2$nighttime == "night"] <- 1
[1] 21
df2$nighttime[df2$nighttime == "day"] <- 0
[1] 22
df2$nighttime <- as.numeric(df2$nighttime)
[1] 23
df2 <- na.omit(df2)
[1] 24
m2 <- lm(bac ~ nighttime + speed + age, data = df2)
[1] 25
coef(m2)
[1] 26
(Intercept)   nighttime       speed         age 
 15.0197278   3.6929362   0.1896706  -0.0416868 
shapiro.test(residuals(m2))
[1] 27

	Shapiro-Wilk normality test

data:  residuals(m2)
W = 0.95956, p-value = 6.003e-06

m2age <- lm(bac ~ age, data = df2)
[1] 28
m2speed <- lm(bac ~ speed, data = df2)
[1] 29
m2time <- lm(bac ~ nighttime, data = df2)
[1] 30
summary(m2age)
[1] 31

Call:
lm(formula = bac ~ age, data = df2)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.404  -4.058  -0.887   3.855  42.638 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.84806    0.78120  34.368  < 2e-16 ***
age         -0.08460    0.01371  -6.169 3.23e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.875 on 221 degrees of freedom
Multiple R-squared:  0.1469,	Adjusted R-squared:  0.1431 
F-statistic: 38.06 on 1 and 221 DF,  p-value: 3.23e-09

summary(m2speed)
[1] 32

Call:
lm(formula = bac ~ speed, data = df2)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.746  -4.444  -0.540   4.448  32.652 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  13.6373     1.2879  10.589  < 2e-16 ***
speed         0.2403     0.0312   7.704 4.41e-13 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.609 on 221 degrees of freedom
Multiple R-squared:  0.2117,	Adjusted R-squared:  0.2081 
F-statistic: 59.35 on 1 and 221 DF,  p-value: 4.413e-13

summary(m2time)
[1] 33

Call:
lm(formula = bac ~ nighttime, data = df2)

Residuals:
    Min      1Q  Median      3Q     Max 
-20.348  -4.053   0.254   3.725  41.429 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  20.0598     0.8447  23.747  < 2e-16 ***
nighttime     4.2748     1.0266   4.164 4.48e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 7.168 on 221 degrees of freedom
Multiple R-squared:  0.07276,	Adjusted R-squared:  0.06856 
F-statistic: 17.34 on 1 and 221 DF,  p-value: 4.48e-05

m2.3 <- lm(speed ~ nighttime, data = df2)
[1] 34
summary(m2.3)
[1] 35

Call:
lm(formula = speed ~ nighttime, data = df2)

Residuals:
    Min      1Q  Median      3Q     Max 
-39.174  -9.059   0.401   7.946  82.427 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)   37.910      1.678   22.59   <2e-16 ***
nighttime      1.264      2.039    0.62    0.536    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.24 on 221 degrees of freedom
Multiple R-squared:  0.001737,	Adjusted R-squared:  -0.00278 
F-statistic: 0.3845 on 1 and 221 DF,  p-value: 0.5359

df3 <- data.frame(drinkdriving["prior_offence"], drinkdriving["bac"], 
    drinkdriving["speed"], drinkdriving["outcome"])
[1] 36
df3$outcome[df3$outcome == "FINE"] <- "fine"
[1] 37
df3$outcome[df3$outcome == "Fine"] <- "fine"
[1] 38
df3$outcome[df3$outcome == "WARNING"] <- "warning"
[1] 39
df3$outcome[df3$outcome == "Warning"] <- "warning"
[1] 40
df3$outcome[df3$outcome == "fine"] <- 1
[1] 41
df3$outcome[df3$outcome == "warning"] <- 0
[1] 42
df3[is.na(df3)] <- mean(df3$bac, na.rm = TRUE)
[1] 43
as.numeric(df3$outcome)
[1] 44
 [1] 1 1 1 0 0 1 0 1 1 0 0 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 0 0 0 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 0 1
 [ reached getOption("max.print") -- omitted 200 entries ]
df3.2 <- data.frame(df3["prior_offence"], df3["outcome"])
[1] 45
as.numeric(df3.2$outcome)
[1] 46
 [1] 1 1 1 0 0 1 0 1 1 0 0 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 0 0 0 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 0 1
 [ reached getOption("max.print") -- omitted 200 entries ]
df3.2$prior_offence[df3.2$prior_offence == "N"] <- NA
[1] 47
df3.2 <- na.omit(df3.2)
[1] 48
df3.2$prior_offence[df3.2$prior_offence == "DR50"] <- "Related"
[1] 49
df3.2$prior_offence[df3.2$prior_offence != "Related"] <- "Non-related"
[1] 50
m3 <- lm(outcome ~ speed * bac, data = df3)
[1] 51
summary(m3)
[1] 52

Call:
lm(formula = outcome ~ speed * bac, data = df3)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.14097 -0.10961  0.04911  0.19918  0.70963 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept) -7.260e-01  1.268e-01  -5.727 2.97e-08 ***
speed        3.043e-02  2.894e-03  10.516  < 2e-16 ***
bac          4.287e-02  5.096e-03   8.413 3.30e-15 ***
speed:bac   -7.026e-04  9.118e-05  -7.705 3.21e-13 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.2971 on 246 degrees of freedom
Multiple R-squared:   0.44,	Adjusted R-squared:  0.4332 
F-statistic: 64.42 on 3 and 246 DF,  p-value: < 2.2e-16

coef(m3)
[1] 53
  (Intercept)         speed           bac     speed:bac 
-0.7259879049  0.0304344300  0.0428700350 -0.0007025538 
mean(df3$speed)
[1] 54
[1] 40.48637
mean(df3$bac)
[1] 55
[1] 23.60454
sd(df3$speed)
[1] 56
[1] 14.91462
sd(df3$bac)
[1] 57
[1] 7.410047
df3.2.1 <- data.frame(Related = c(40, 3), `Non-related` = c(13, 
    8))
[1] 58
row.names(df3.2.1) <- c("Fine", "Warning")
[1] 59
fisher.test(df3.2.1)
[1] 60

	Fisher's Exact Test for Count Data

data:  df3.2.1
p-value = 0.003755
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
  1.60038 53.02513
sample estimates:
odds ratio 
  7.883108 

df3.3 <- data.frame(df3["prior_offence"], df3["outcome"])
[1] 61
df3.3$prior_offence[df3.3$prior_offence == "N"] <- "No prior offence"
[1] 62
df3.3$prior_offence[df3.3$prior_offence != "No prior offence"] <- "Prior offence"
[1] 63
df3.3$outcome <- as.numeric(df3.3$outcome)
[1] 64
df3.3.1 <- data.frame(`Prior offence` = c(54, 11), `No prior offence` = c(148, 
    37))
[1] 65
row.names(df3.3.1) <- c("Fine", "Warning")
[1] 66
fisher.test(df3.3.1)
[1] 67

	Fisher's Exact Test for Count Data

data:  df3.3.1
p-value = 0.7149
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
 0.5623255 2.8611110
sample estimates:
odds ratio 
  1.226253 

df4.1 <- data.frame(age = c(17:22), nighttime = "day", speed = 30, 
    bac = 0, prior_offence = "None")
[1] 68
df4 <- as.data.frame(drinkdriving)
[1] 69
df4$nighttime[df4$nighttime == "2:05"] <- "night"
[1] 70
df4$nighttime[df4$nighttime == "18:25"] <- "night"
[1] 71
df4$age[df4$age <= 16] <- NA
[1] 72
df4$age[df4$age >= 90] <- NA
[1] 73
df4[is.na(df4)] <- mean(df4$age, na.rm = TRUE)
[1] 74
df4$prior_offence[df4$prior_offence != "N"] <- "Yes"
[1] 75
df4$prior_offence[df4$prior_offence == "N"] <- "None"
[1] 76
as.factor(df4$prior_offence)
[1] 77
 [1] None None Yes  None None None None None None None Yes  None None None None None None None None None None None None None None Yes 
[27] Yes  None Yes  None Yes  None None None None None None None None None None None None None Yes  Yes  None None None Yes 
 [ reached getOption("max.print") -- omitted 200 entries ]
Levels: None Yes
df4$outcome[df4$outcome == "FINE"] <- "fine"
[1] 78
df4$outcome[df4$outcome == "Fine"] <- "fine"
[1] 79
df4$outcome[df4$outcome == "WARNING"] <- "warning"
[1] 80
df4$outcome[df4$outcome == "Warning"] <- "warning"
[1] 81
df4$outcome[df4$outcome == "fine"] <- 1
[1] 82
df4$outcome[df4$outcome == "warning"] <- 0
[1] 83
df4$outcome <- as.numeric(df4$outcome)
[1] 84
m4 <- glm(outcome ~ age + nighttime + speed + bac + prior_offence, 
    data = df4, family = binomial)
[1] 85
df4.1$prob <- predict(m4, newdata = df4.1, type = "response")
[1] 86
df4.1

  age nighttime speed bac prior_offence      prob
1  17       day    30   0          None 0.3900206
2  18       day    30   0          None 0.3791810
3  19       day    30   0          None 0.3684606
4  20       day    30   0          None 0.3578687
5  21       day    30   0          None 0.3474137
6  22       day    30   0          None 0.3371039


lines(df4.1$age, df4.1$prob)
[1] 88
plot(df4.1$age, df4.1$prob, sub = "Figure 4 Predicted probabilities", 
    xlab = "Age", ylab = "Probability")
[1] 89
df5 <- data.frame(drinkdriving["age"], drinkdriving["outcome"])
[1] 90
df5 <- cbind(df5, officer_inc$officer)
[1] 91
df5$outcome[df5$outcome == "FINE"] <- "fine"
[1] 92
df5$outcome[df5$outcome == "Fine"] <- "fine"
[1] 93
df5$outcome[df5$outcome == "WARNING"] <- "warning"
[1] 94
df5$outcome[df5$outcome == "Warning"] <- "warning"
[1] 95
df5$outcome[df5$outcome == "fine"] <- 1
[1] 96
df5$outcome[df5$outcome == "warning"] <- 0
[1] 97
df5$outcome <- as.numeric(df5$outcome)
[1] 98
df5$age[df5$age <= 16] <- NA
[1] 99
df5$age[df5$age >= 90] <- NA
[1] 100
df5[is.na(df5)] <- mean(df5$age, na.rm = TRUE)
[1] 101
df5.1 <- df5[officer_inc$officer == "AS", ]
[1] 102
df5.1 <- na.omit(df5.1)
[1] 103
df5.2 <- df5[officer_inc$officer == "IT", ]
[1] 104
df5.3 <- df5[officer_inc$officer == "NP", ]
[1] 105
m5 <- glm(outcome ~ age, data = df5, family = binomial)
[1] 106
m5.1 <- glm(outcome ~ age, data = df5.1, family = binomial)
[1] 107
m5.2 <- glm(outcome ~ age, data = df5.2, family = binomial)
[1] 108
m5.3 <- glm(outcome ~ age, data = df5.3, family = binomial)
[1] 109
summary(m5)
[1] 110

Call:
glm(formula = outcome ~ age, family = binomial, data = df5)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.9871   0.1851   0.3458   0.5139   2.1477  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  6.21050    0.81026   7.665 1.79e-14 ***
age         -0.09781    0.01504  -6.505 7.79e-11 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 182.99  on 248  degrees of freedom
AIC: 186.99

Number of Fisher Scoring iterations: 5

summary(m5.1)
[1] 111

Call:
glm(formula = outcome ~ age, family = binomial, data = df5.1)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.9982   0.1812   0.4017   0.5332   1.6903  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  6.20345    1.20507   5.148 2.64e-07 ***
age         -0.09556    0.02214  -4.316 1.59e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 112.69  on 115  degrees of freedom
Residual deviance:  86.01  on 114  degrees of freedom
AIC: 90.01

Number of Fisher Scoring iterations: 5

summary(m5.2)
[1] 112

Call:
glm(formula = outcome ~ age, family = binomial, data = df5.2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.0160   0.1482   0.2817   0.4624   2.4543  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  7.44007    1.90808   3.899 9.65e-05 ***
age         -0.12095    0.03585  -3.374 0.000742 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 59.474  on 65  degrees of freedom
Residual deviance: 40.783  on 64  degrees of freedom
  (1 observation deleted due to missingness)
AIC: 44.783

Number of Fisher Scoring iterations: 6

summary(m5.3)
[1] 113

Call:
glm(formula = outcome ~ age, family = binomial, data = df5.3)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4641   0.2160   0.3733   0.6056   1.5161  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  5.48994    1.33251   4.120 3.79e-05 ***
age         -0.08940    0.02512  -3.559 0.000372 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 71.258  on 66  degrees of freedom
Residual deviance: 53.642  on 65  degrees of freedom
  (1 observation deleted due to missingness)
AIC: 57.642

Number of Fisher Scoring iterations: 5

