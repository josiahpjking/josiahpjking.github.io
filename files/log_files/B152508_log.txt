

	####### B152508 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 2
[1] "drinkdriving" "officer_inc" 
drinkdriving$age[drinkdriving$age > 80] <- NA
[1] 3
is.na(drinkdriving$age)
[1] 4
 [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
[22]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[43] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 200 entries ]
drinkdriving$age[is.na(drinkdriving$age)] <- mean(drinkdriving$age, 
    na.rm = T)
[1] 5
drinkdriving$age <- as.integer(drinkdriving$age)
[1] 6
is.na(drinkdriving$nighttime)
[1] 7
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[22] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[43] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 200 entries ]
table(drinkdriving$nighttime)
[1] 8

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "night"
[1] 9
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 10
is.na(drinkdriving$prior_offence)
[1] 11
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[22] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[43] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 200 entries ]
is.na(drinkdriving$speed)
[1] 12
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[22] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[43] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 200 entries ]
is.na(drinkdriving$bac)
[1] 13
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[22] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[43] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 200 entries ]
drinkdriving$bac[is.na(drinkdriving$bac)] <- mean(drinkdriving$bac, 
    na.rm = T)
[1] 14
drinkdriving$bac <- drinkdriving$bac/100
[1] 15
is.na(drinkdriving$outcome)
[1] 16
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[22] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[43] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 200 entries ]
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 17
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 18
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 19
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 20
drinkdriving$outcome[drinkdriving$outcome == "fine"] <- 1
[1] 21
drinkdriving$outcome[drinkdriving$outcome == "warning"] <- 0
[1] 22
drinkdriving$outcome <- as.numeric(drinkdriving$outcome)
[1] 23
is.na(drinkdriving$incident_id)
[1] 24
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[22] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[43] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 200 entries ]
is.na(officer_inc$officer)
[1] 25
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[22] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[43] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 200 entries ]
officer_inc$officer[is.na(officer_inc$officer)] <- sample(c("AS", 
    "IT", "NP"), size = 1)
[1] 26
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 27
summary(m1)
[1] 28

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.19723 -0.04521 -0.00032  0.04200  0.42456 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.292053   0.013484  21.660  < 2e-16 ***
age         -0.001340   0.000304  -4.409 1.55e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.0715 on 248 degrees of freedom
Multiple R-squared:  0.07269,	Adjusted R-squared:  0.06895 
F-statistic: 19.44 on 1 and 248 DF,  p-value: 1.548e-05

plot(m1)
[1] 29
par(mfrow = c(2, 2))
[1] 30
$mfrow
[1] 1 3

predbac <- data.frame(age = 50)
[1] 31
predict(m1, newdata = predbac)
[1] 32
       1 
0.225039 
m1$coefficients[1] - 0.067
[1] 33
(Intercept) 
  0.2250532 
plot(m1, which = 2)
[1] 34
m2 <- lm(bac ~ age + nighttime + speed, data = drinkdriving)
[1] 35
summary(m2)
[1] 36

Call:
lm(formula = bac ~ age + nighttime + speed, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.170235 -0.043616  0.001804  0.041084  0.311101 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     1.109e-01  2.321e-02   4.777 3.06e-06 ***
age            -1.147e-05  3.087e-04  -0.037     0.97    
nighttimenight  4.059e-02  8.436e-03   4.812 2.61e-06 ***
speed           2.414e-03  3.086e-04   7.820 1.55e-13 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.0617 on 246 degrees of freedom
Multiple R-squared:  0.3151,	Adjusted R-squared:  0.3068 
F-statistic: 37.73 on 3 and 246 DF,  p-value: < 2.2e-16

m2fitted <- lm(bac ~ nighttime + speed, data = drinkdriving)
[1] 37
summary(m2fitted)
[1] 38

Call:
lm(formula = bac ~ nighttime + speed, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.170132 -0.043718  0.001742  0.041068  0.310829 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    0.110149   0.012436   8.858  < 2e-16 ***
nighttimenight 0.040597   0.008417   4.823 2.47e-06 ***
speed          0.002420   0.000262   9.236  < 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.06157 on 247 degrees of freedom
Multiple R-squared:  0.3151,	Adjusted R-squared:  0.3096 
F-statistic: 56.82 on 2 and 247 DF,  p-value: < 2.2e-16

m2 <- lm(bac ~ age + nighttime + speed, data = drinkdriving)
[1] 39
summary(m2)
[1] 40

Call:
lm(formula = bac ~ age + nighttime + speed, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.170235 -0.043616  0.001804  0.041084  0.311101 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     1.109e-01  2.321e-02   4.777 3.06e-06 ***
age            -1.147e-05  3.087e-04  -0.037     0.97    
nighttimenight  4.059e-02  8.436e-03   4.812 2.61e-06 ***
speed           2.414e-03  3.086e-04   7.820 1.55e-13 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.0617 on 246 degrees of freedom
Multiple R-squared:  0.3151,	Adjusted R-squared:  0.3068 
F-statistic: 37.73 on 3 and 246 DF,  p-value: < 2.2e-16

par(mfrow = c(2, 2))
[1] 41
$mfrow
[1] 2 2

plot(m2, which = c(1:4))
[1] 42
t.test(speed ~ nighttime, data = drinkdriving)
[1] 43

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.85812, df = 155.57, p-value = 0.3921
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.669084  2.235272
sample estimates:
  mean in group day mean in group night 
           39.30514            41.02205 

m3 <- glm(outcome ~ age + nighttime + prior_offence + speed + 
    bac, data = drinkdriving, family = binomial)
[1] 44
summary(m3)
[1] 45

Call:
glm(formula = outcome ~ age + nighttime + prior_offence + speed + 
    bac, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.7117   0.0067   0.0473   0.2171   2.8071  

Coefficients:
                              Estimate Std. Error z value Pr(>|z|)    
(Intercept)                   19.14348 2658.07375   0.007 0.994254    
age                           -0.11550    0.03005  -3.844 0.000121 ***
nighttimenight                -0.41790    0.67461  -0.619 0.535607    
prior_offenceCD60            -43.38610 4766.20570  -0.009 0.992737    
prior_offenceCD60,CD10,DR80  -23.87641 4766.20731  -0.005 0.996003    
prior_offenceCD60,CD60       -28.58022 4766.20789  -0.006 0.995216    
prior_offenceDD20            -26.23233 2658.07380  -0.010 0.992126    
prior_offenceDR50            -19.14765 2658.07307  -0.007 0.994252    
prior_offenceDR80            -25.01573 2658.07380  -0.009 0.992491    
prior_offenceN               -21.20330 2658.07298  -0.008 0.993635    
 [ reached getOption("max.print") -- omitted 7 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.555  on 249  degrees of freedom
Residual deviance:  82.553  on 233  degrees of freedom
AIC: 116.55

Number of Fisher Scoring iterations: 16

noprioroffenseset <- drinkdriving[which(drinkdriving$prior_offence != 
    "N"), ]
[1] 46
noprioroffenseset$prior_offence[noprioroffenseset$prior_offence == 
    "DR50"] <- 1
[1] 47
noprioroffenseset$prior_offence[noprioroffenseset$prior_offence != 
    1] <- 0
[1] 48
t.test(outcome ~ prior_offence, data = noprioroffenseset)
[1] 49

	Welch Two Sample t-test

data:  outcome by prior_offence
t = -2.6217, df = 27.037, p-value = 0.01419
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.52384719 -0.06389066
sample estimates:
mean in group 0 mean in group 1 
      0.6363636       0.9302326 

noprioroffenseset2 <- drinkdriving
[1] 50
noprioroffenseset2$prior_offence[noprioroffenseset2$prior_offence == 
    "N"] <- 1
[1] 51
noprioroffenseset2$prior_offence[noprioroffenseset2$prior_offence != 
    1] <- 0
[1] 52
t.test(outcome ~ prior_offence, data = noprioroffenseset2)
[1] 53

	Welch Two Sample t-test

data:  outcome by prior_offence
t = 0.55566, df = 118.25, p-value = 0.5795
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.0788845  0.1404230
sample estimates:
mean in group 0 mean in group 1 
      0.8307692       0.8000000 

n = 1:250
[1] 54
drinkdriving$fit2 = coef(m3)[1] * 1 + coef(m3)[["age"]] * n + 
    coef(m3)[["speed"]] * 30 + coef(m3)[["bac"]] * 0 + coef(m3)[["nighttimenight"]] * 
    0 + coef(m3)[["prior_offenceN"]] * 1
[1] 55
drinkdriving$predicted_probs <- exp(drinkdriving$fit2)/(1 + exp(drinkdriving$fit2))
[1] 56
ggplot(data = drinkdriving[1:100, ], aes(1:100, predicted_probs)) + 
    geom_jitter() + theme_classic() + xlab("Drivers' Age") + 
    ylab("Predicted Probabilities")
[1] 57
biasedofficers <- xtabs(~drinkdriving$outcome + drinkdriving$age)
[1] 58
addmargins(biasedofficers)
[1] 59
                    drinkdriving$age
drinkdriving$outcome  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41
                    drinkdriving$age
drinkdriving$outcome  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  68  69  70
                    drinkdriving$age
drinkdriving$outcome  73  77  80 Sum
 [ reached getOption("max.print") -- omitted 3 rows ]
t.test(biasedofficers)
[1] 60

	One Sample t-test

data:  biasedofficers
t = 7.2032, df = 117, p-value = 6.164e-11
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 1.536148 2.701140
sample estimates:
mean of x 
 2.118644 

plot(outcome ~ age, data = drinkdriving, main = "Biased Officers")
[1] 61
newbiased <- merge(drinkdriving, officer_inc, by = "incident_id")
[1] 62
AS <- newbiased[which(newbiased$officer == "AS"), ]
[1] 63
plot(outcome ~ age, data = AS, main = "AS officer")
[1] 64
IT <- newbiased[which(newbiased$office == "IT"), ]
[1] 65
plot(outcome ~ age, data = IT, main = "IT officer")
[1] 66
NP <- newbiased[which(newbiased$office == "NP"), ]
[1] 67
plot(outcome ~ age, data = NP, main = "NP officer")
[1] 68
biasedofficers2 <- xtabs(~AS$outcome + AS$age)
[1] 69
t.test(biasedofficers2)
[1] 70

	One Sample t-test

data:  biasedofficers2
t = 7.5332, df = 97, p-value = 2.598e-11
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 0.871819 1.495528
sample estimates:
mean of x 
 1.183673 

biasedofficers3 <- xtabs(~IT$outcome + IT$age)
[1] 71
t.test(biasedofficers3)
[1] 72

	One Sample t-test

data:  biasedofficers3
t = 6.0463, df = 71, p-value = 6.232e-08
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 0.6143679 1.2189654
sample estimates:
mean of x 
0.9166667 

biasedofficers4 <- xtabs(~NP$outcome + NP$age)
[1] 73
t.test(biasedofficers4)
[1] 74

	One Sample t-test

data:  biasedofficers4
t = 5.5235, df = 73, p-value = 4.85e-07
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 0.5873532 1.2504846
sample estimates:
mean of x 
0.9189189 

