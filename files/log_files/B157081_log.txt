

	####### B157081 R script #######

load(url("https://edin.ac/2QCZNVu"))
[1] 1
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 2
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
drinkdriving$age[drinkdriving$age > 110] <- NA
[1] 3
sum(is.na(drinkdriving$age))
[1] 4
[1] 25
table(drinkdriving$nighttime)
[1] 5

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "night"
[1] 6
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 7
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 8
table(drinkdriving$prior_offence)
[1] 9

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N 
             2              1              1              1              4             43              4            185 
          PL10           SP50           SP60           TS70      TS70,DR50 
             2              2              1              3              1 
drinkdriving$offence <- drinkdriving$prior_offence
[1] 10
drinkdriving$offence[drinkdriving$offence %in% c("DR50", "TS70,DR50")] <- "drink"
[1] 11
drinkdriving$offence[drinkdriving$offence %in% c("CD10", "CD60", 
    "CD60,CD10,DR80", "CD60,CD60", "DD20", "DR80", "PL10", "SP50", 
    "SP60", "TS70")] <- "non_drink"
[1] 12
table(drinkdriving$offence)
[1] 13

    drink         N non_drink 
       44       185        21 
drinkdriving$offence <- factor(drinkdriving$offence, levels = c("non_drink", 
    "drink", "N"))
[1] 14
plot(drinkdriving$speed)
[1] 15
cutoff_speed <- with(drinkdriving, mean(speed, na.rm = T) + (3 * 
    sd(speed, na.rm = T)))
[1] 16
drinkdriving$speed[drinkdriving$speed > cutoff_speed] <- NA
[1] 17
sum(is.na(drinkdriving$speed))
[1] 18
[1] 1
drinkdriving$bac <- drinkdriving$bac/100
[1] 19
plot(drinkdriving$bac)
[1] 20
cutoff_bac <- with(drinkdriving, mean(bac, na.rm = T) + (3 * 
    sd(bac, na.rm = T)))
[1] 21
drinkdriving$bac[drinkdriving$bac > cutoff_bac] <- NA
[1] 22
sum(is.na(drinkdriving$bac))
[1] 23
[1] 7
table(drinkdriving$outcome)
[1] 24

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome %in% c("Fine", "FINE")] <- "fine"
[1] 25
drinkdriving$outcome[drinkdriving$outcome %in% c("Warning", "WARNING")] <- "warning"
[1] 26
drinkdriving$outcome <- factor(drinkdriving$outcome, levels = c("warning", 
    "fine"))
[1] 27
data <- merge(drinkdriving, officer_inc, all = T)
[1] 28
data$incident_id <- factor(data$incident_id)
[1] 29
summary(data)
[1] 30
  incident_id       age        nighttime   prior_offence          speed            bac             outcome         offence   
 inc_1  :  1   Min.   :14.00   day  : 78   Length:250         Min.   : 0.00   Min.   :0.03987   warning: 48   non_drink: 21  
 inc_10 :  1   1st Qu.:30.00   night:172   Class :character   1st Qu.:30.73   1st Qu.:0.19215   fine   :202   drink    : 44  
 inc_100:  1   Median :40.00               Mode  :character   Median :40.60   Median :0.23504                 N        :185  
 inc_101:  1   Mean   :42.68                                  Mean   :40.17   Mean   :0.23292                                
 inc_102:  1   3rd Qu.:55.00                                  3rd Qu.:48.70   3rd Qu.:0.27789                                
 officer   
 AS  :116  
 IT  : 66  
 NP  : 67  
 NA's:  1  
           
 [ reached getOption("max.print") -- omitted 2 rows ]
m1 <- lm(bac ~ age, data = data)
[1] 31
summary(m1)
[1] 32

Call:
lm(formula = bac ~ age, data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2868503  0.0106949   26.82  < 2e-16 ***
age         -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

with(data, plot(bac ~ age))
[1] 33
abline(m1)
[1] 34
m1_s <- lm(bac ~ I(age - mean(age, na.rm = T)), data = data)
[1] 35
summary(m1_s)
[1] 36

Call:
lm(formula = bac ~ I(age - mean(age, na.rm = T)), data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
                                Estimate Std. Error t value Pr(>|t|)    
(Intercept)                    0.2282551  0.0039220   58.20  < 2e-16 ***
I(age - mean(age, na.rm = T)) -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

new_age <- data.frame(age = 50)
[1] 37
predict(m1, newdata = new_age)
[1] 38
        1 
0.2181983 
par(mfrow = c(1, 3))
[1] 39
$mfrow
[1] 1 1

hist(residuals(m1), main = "", breaks = 25, xlab = "Residuals")
[1] 40
plot(density(residuals(m1)), main = "")
[1] 41
plot(m1, which = 2)
[1] 42
m2 <- lm(bac ~ age + nighttime, data = data)
[1] 43
anova(m2)
[1] 44
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.11631 0.116314  38.345 2.969e-09 ***
nighttime   1 0.07214 0.072142  23.783 2.096e-06 ***
Residuals 215 0.65217 0.003033                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2)
[1] 45

Call:
lm(formula = bac ~ age + nighttime, data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.165254 -0.046056  0.003152  0.037847  0.143450 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2560505  0.0119731  21.386  < 2e-16 ***
age            -0.0012800  0.0002225  -5.752 3.01e-08 ***
nighttimenight  0.0392560  0.0080496   4.877 2.10e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05508 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2242,	Adjusted R-squared:  0.217 
F-statistic: 31.06 on 2 and 215 DF,  p-value: 1.409e-12

m3 <- lm(bac ~ age + speed, data = data)
[1] 46
anova(m3)
[1] 47
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.11631 0.116314 34.6961 1.471e-08 ***
speed       1 0.00355 0.003550  1.0589    0.3046    
Residuals 215 0.72076 0.003352                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m3)
[1] 48

Call:
lm(formula = bac ~ age + speed, data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.154118 -0.038926 -0.006094  0.041298  0.144229 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2608699  0.0274183   9.514  < 2e-16 ***
age         -0.0011540  0.0003156  -3.656 0.000322 ***
speed        0.0004320  0.0004198   1.029 0.304616    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.0579 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.574e-08

m4 <- lm(bac ~ age + speed + nighttime, data = data)
[1] 49
anova(m4)
[1] 50
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.11631 0.116314 38.3777 2.948e-09 ***
speed       1 0.00355 0.003550  1.1713    0.2804    
nighttime   1 0.07218 0.072175 23.8141 2.071e-06 ***
Residuals 214 0.64859 0.003031                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m4)
[1] 51

Call:
lm(formula = bac ~ age + speed + nighttime, data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.157811 -0.046224  0.005195  0.037225  0.142190 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2299435  0.0268293   8.571 2.06e-15 ***
age            -0.0010600  0.0003007  -3.525 0.000518 ***
speed           0.0004340  0.0003992   1.087 0.278151    
nighttimenight  0.0392649  0.0080461   4.880 2.07e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

t.test(speed ~ nighttime, data)
[1] 52

	Welch Two Sample t-test

data:  speed by nighttime
t = -1.616, df = 194.92, p-value = 0.1077
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -6.1490286  0.6104941
sample estimates:
  mean in group day mean in group night 
           38.25278            41.02205 

m5 <- glm(outcome ~ age + nighttime + speed + bac + offence, 
    data = data, family = binomial)
[1] 53
anova(m5, test = "Chisq")
[1] 54
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


          Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                        217    216.502              
age        1   66.496       216    150.005 3.506e-16 ***
nighttime  1    0.834       215    149.171   0.36107    
speed      1   24.864       214    124.307 6.151e-07 ***
bac        1   18.026       213    106.281 2.179e-05 ***
offence    2    7.858       211     98.422   0.01966 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m5)
[1] 55

Call:
glm(formula = outcome ~ age + nighttime + speed + bac + offence, 
    family = binomial, data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.1882   0.0264   0.1271   0.3729   2.9352  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)    -6.51660    2.42944  -2.682  0.00731 ** 
age            -0.05061    0.02178  -2.324  0.02014 *  
nighttimenight -0.36373    0.60056  -0.606  0.54474    
speed           0.14171    0.03458   4.098 4.17e-05 ***
bac            22.04639    5.64297   3.907 9.35e-05 ***
offencedrink    3.15926    1.23618   2.556  0.01060 *  
offenceN        1.36801    0.85176   1.606  0.10825    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 216.502  on 217  degrees of freedom
Residual deviance:  98.422  on 211  degrees of freedom
  (32 observations deleted due to missingness)
AIC: 112.42

Number of Fisher Scoring iterations: 7

m6_s <- glm(outcome ~ scale(speed) + scale(bac), data = data, 
    family = binomial)
[1] 56
summary(m6_s)
[1] 57

Call:
glm(formula = outcome ~ scale(speed) + scale(bac), family = binomial, 
    data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0812   0.0489   0.1875   0.4458   1.9536  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    2.7590     0.3589   7.687 1.51e-14 ***
scale(speed)   2.0667     0.3628   5.697 1.22e-08 ***
scale(bac)     1.1486     0.2737   4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 130.13  on 240  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 6

m7 <- glm(outcome ~ offence, data = data, family = binomial)
[1] 58
summary(m7)
[1] 59

Call:
glm(formula = outcome ~ offence, family = binomial, data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1899   0.4366   0.6681   0.6681   0.9005  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)  
(Intercept)    0.6931     0.4629   1.497   0.1343  
offencedrink   1.6094     0.6994   2.301   0.0214 *
offenceN       0.6931     0.4981   1.392   0.1640  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 238.69  on 247  degrees of freedom
AIC: 244.69

Number of Fisher Scoring iterations: 4

data$has.offence <- factor(ifelse(data$offence == "N", 0, 1))
[1] 60
m8 <- glm(outcome ~ has.offence, data = data, family = binomial)
[1] 61
summary(m8)
[1] 62

Call:
glm(formula = outcome ~ has.offence, family = binomial, data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8849   0.6089   0.6681   0.6681   0.6681  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    1.3863     0.1838   7.542 4.62e-14 ***
has.offence1   0.2048     0.3784   0.541    0.588    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 244.26  on 248  degrees of freedom
AIC: 248.26

Number of Fisher Scoring iterations: 4

m9 <- glm(outcome ~ age + nighttime + speed + bac + offence, 
    data = data, family = binomial)
[1] 63
diff_age <- data.frame(age = c(17:100), nighttime = c(rep("day", 
    84)), speed = c(rep(30, 84)), bac = c(rep(0, 84)), offence = c(rep("N", 
    84)))
[1] 64
diff_age$p_fine <- predict(m9, newdata = diff_age, type = "response")
[1] 65
with(diff_age, plot(p_fine ~ age, xlab = "Age", ylab = "P(fine)", 
    main = "Probabilities of receiving fines for drivers of different ages"))
[1] 66
m10 <- glm(outcome ~ age * relevel(officer, "IT"), data = data, 
    family = binomial)
[1] 67
anova(m10)
[1] 68
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


                           Df Deviance Resid. Df Resid. Dev
NULL                                         224     222.38
age                         1   67.728       223     154.65
relevel(officer, "IT")      2    0.861       221     153.79
age:relevel(officer, "IT")  2    7.383       219     146.41
summary(m10)
[1] 69

Call:
glm(formula = outcome ~ age * relevel(officer, "IT"), family = binomial, 
    data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
                             Estimate Std. Error z value Pr(>|z|)    
(Intercept)                   4.52384    1.32631   3.411 0.000648 ***
age                          -0.06510    0.02467  -2.639 0.008308 ** 
relevel(officer, "IT")AS      5.04535    2.39610   2.106 0.035234 *  
relevel(officer, "IT")NP      0.36070    1.99283   0.181 0.856369    
age:relevel(officer, "IT")AS -0.09612    0.04254  -2.260 0.023841 *  
age:relevel(officer, "IT")NP -0.00247    0.03671  -0.067 0.946370    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

