

	####### B153301 R script #######

install.packages("psych")
[1] 1
install.packages("car")
[1] 2
library(psych, quietly = T)
[1] 3
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 4
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 5
[1] "drinkdriving" "officer_inc" 
head(drinkdriving)
[1] 6
# A tibble: 6 x 7
    age nighttime prior_offence speed   bac outcome incident_id
  <dbl> <chr>     <chr>         <dbl> <dbl> <chr>   <chr>      
1    39 night     N             48.0   17.7 fine    inc_1      
2    28 day       N             43.8   22.1 fine    inc_2      
3    38 night     DR50          47.3   32.8 fine    inc_3      
4    51 night     N             17.2   20.5 warning inc_4      
5    56 night     N              1.95  29.4 warning inc_5      
6    36 day       N             41.4   19.1 fine    inc_6      
head(officer_inc)
[1] 7
  officer incident_id
1      AS     inc_189
2      IT      inc_50
3      IT     inc_159
4      AS     inc_178
5      IT     inc_184
6      AS     inc_198
describe(drinkdriving)
[1] 8
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
table(drinkdriving$nighttime)
[1] 9

18:25  2:05   day night 
    1     2    78   169 
table(drinkdriving$prior_offence)
[1] 10

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
table(drinkdriving$outcome)
[1] 11

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$age[drinkdriving$age > 200] <- NA
[1] 12
drinkdriving$nighttime[drinkdriving$nighttime != "day" & drinkdriving$nighttime != 
    "night"] <- NA
[1] 13
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 14
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 15
drinkdriving1 <- na.omit(drinkdriving)
[1] 16
table(drinkdriving1$nighttime)
[1] 17

  day night 
   69   145 
table(drinkdriving1$prior_offence)
[1] 18

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DR50           DR80              N           PL10           SP50 
             2              1              1              1             37              4            160              2              2 
          SP60           TS70      TS70,DR50 
             1              2              1 
table(drinkdriving1$outcome)
[1] 19

   fine warning 
    173      41 
class(drinkdriving1$nighttime)
[1] 20
[1] "character"
class(drinkdriving1$outcome)
[1] 21
[1] "character"
drinkdriving1$nighttime <- factor(drinkdriving1$nighttime)
[1] 22
drinkdriving1$outcome <- factor(drinkdriving1$outcome)
[1] 23
boxplot(drinkdriving1$age)
[1] 24
boxplot(drinkdriving1$speed)
[1] 25
boxplot(drinkdriving1$bac)
[1] 26
describe(drinkdriving1)
[1] 27
               vars   n  mean    sd median trimmed   mad min  max range  skew kurtosis   se
age               1 214 42.79 16.75     40   42.05 17.79  14   90    76  0.40    -0.48 1.14
nighttime*        2 214  1.68  0.47      2    1.72  0.00   1    2     1 -0.75    -1.44 0.03
prior_offence*    3 214   NaN    NA     NA     NaN    NA Inf -Inf  -Inf    NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
m1 <- lm(bac ~ age, data = drinkdriving1)
[1] 28
summary(m1)
[1] 29

Call:
lm(formula = bac ~ age, data = drinkdriving1)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.839  -4.561  -0.467   4.006  42.764 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 29.80497    1.27662  23.347  < 2e-16 ***
age         -0.15467    0.02779  -5.565 7.87e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.793 on 212 degrees of freedom
Multiple R-squared:  0.1275,	Adjusted R-squared:  0.1233 
F-statistic: 30.97 on 1 and 212 DF,  p-value: 7.873e-08

with(drinkdriving1, plot(age, bac, xlab = "Age", ylab = "Blood alcohol content", 
    main = "Age and blood alcohol content", col = c("#ff9a9e"), 
    bty = "n", pch = 20))
[1] 30
abline(m1)
[1] 31
agepredict = data.frame(age = 50)
[1] 32
predict(m1, newdata = agepredict)
[1] 33
       1 
22.07155 
par(mfrow = c(2, 2))
[1] 34
$mfrow
[1] 1 1

plot(m1, which = c(1:4))
[1] 35
par(mfrow = c(1, 1))
[1] 36
$mfrow
[1] 2 2

hist(resid(m1))
[1] 37
drinkdriving1$nighttime <- as.numeric(drinkdriving1$nighttime)
[1] 38
m2 <- lm(bac ~ age + nighttime, data = drinkdriving1)
[1] 39
anova(m2)
[1] 40
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1429.1 1429.07  32.903 3.331e-08 ***
nighttime   1  618.8  618.79  14.247 0.0002084 ***
Residuals 211 9164.5   43.43                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2)
[1] 41

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving1)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.519  -4.708   0.243   3.584  41.580 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 23.37887    2.10534  11.105  < 2e-16 ***
age         -0.14747    0.02703  -5.456 1.36e-07 ***
nighttime    3.64713    0.96626   3.774 0.000208 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.59 on 211 degrees of freedom
Multiple R-squared:  0.1826,	Adjusted R-squared:  0.1749 
F-statistic: 23.57 on 2 and 211 DF,  p-value: 5.747e-10

par(mfrow = c(1, 1))
[1] 42
$mfrow
[1] 1 1

with(drinkdriving1, plot(nighttime, bac, xlab = "Day or night (1=day, 2=night)", 
    ylab = "Blood alcohol content", main = "Time of the day and blood alcohol content", 
    col = c("#ff9a9e"), bty = "n", pch = 20))
[1] 43
abline(m2)
[1] 44
hist(resid(m2))
[1] 45
par(mfrow = c(2, 2))
[1] 46
$mfrow
[1] 1 1

plot(m2, which = c(1:4))
[1] 47
vif(m2)
[1] 48
      age nighttime 
 1.004996  1.004996 
m3 <- lm(bac ~ age + speed, data = drinkdriving1)
[1] 49
anova(m3)
[1] 50
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1429.1 1429.07  34.108 1.951e-08 ***
speed       1  942.8  942.84  22.503 3.862e-06 ***
Residuals 211 8840.4   41.90                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m3)
[1] 51

Call:
lm(formula = bac ~ age + speed, data = drinkdriving1)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.079  -4.375  -0.680   4.154  34.625 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 18.04900    2.76063   6.538 4.62e-10 ***
age         -0.05349    0.03400  -1.573    0.117    
speed        0.19060    0.04018   4.744 3.86e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.473 on 211 degrees of freedom
Multiple R-squared:  0.2115,	Adjusted R-squared:  0.2041 
F-statistic: 28.31 on 2 and 211 DF,  p-value: 1.288e-11

par(mfrow = c(1, 1))
[1] 52
$mfrow
[1] 2 2

with(drinkdriving1, plot(speed, bac, xlab = "Speed", ylab = "Blood alcohol content", 
    main = "Driving speed and blood alcohol content", col = c("#ff9a9e"), 
    bty = "n", pch = 20))
[1] 53
abline(m3)
[1] 54
hist(resid(m3))
[1] 55
par(mfrow = c(2, 2))
[1] 56
$mfrow
[1] 1 1

plot(m3, which = c(1:4))
[1] 57
vif(m3)
[1] 58
     age    speed 
1.648607 1.648607 
t.test(speed ~ nighttime, data = drinkdriving1)
[1] 59

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.22629, df = 140.04, p-value = 0.8213
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -4.496605  3.572991
sample estimates:
mean in group 1 mean in group 2 
       38.65477        39.11657 

drinkdriving1$outcome <- as.numeric(drinkdriving1$outcome)
[1] 60
drinkdriving1$outcome[drinkdriving1$outcome == 2] <- 0
[1] 61
drinkdriving1$outcome <- as.numeric(drinkdriving1$outcome)
[1] 62
mfine <- glm(outcome ~ age + nighttime + speed + bac, data = drinkdriving1, 
    family = binomial)
[1] 63
summary(mfine)
[1] 64

Call:
glm(formula = outcome ~ age + nighttime + speed + bac, family = binomial, 
    data = drinkdriving1)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.9441   0.0127   0.0857   0.2853   2.6163  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept) -4.98288    2.63481  -1.891 0.058601 .  
age         -0.06885    0.02380  -2.893 0.003822 ** 
nighttime    0.09994    0.62297   0.160 0.872550    
speed        0.16265    0.04020   4.046 5.21e-05 ***
bac          0.22281    0.06026   3.697 0.000218 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.086  on 213  degrees of freedom
Residual deviance:  83.965  on 209  degrees of freedom
AIC: 93.965

Number of Fisher Scoring iterations: 7

drinkdriving1$p_fine <- predict(mfine, type = "response")
[1] 65
exp(coef(mfine))
[1] 66
(Intercept)         age   nighttime       speed         bac 
0.006854293 0.933462207 1.105100608 1.176624765 1.249578961 
drinkdriving1$drink_offence <- drinkdriving1$prior_offence
[1] 67
table(drinkdriving1$drink_offence)
[1] 68

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DR50           DR80              N           PL10           SP50 
             2              1              1              1             37              4            160              2              2 
          SP60           TS70      TS70,DR50 
             1              2              1 
drinkdriving1$drink_offence[drinkdriving1$drink_offence != "DR50" & 
    drinkdriving1$drink_offence != "TS70,DR50"] <- 1
[1] 69
drinkdriving1$drink_offence[drinkdriving1$drink_offence == "DR50" | 
    drinkdriving1$drink_offence == "TS70,DR50"] <- 2
[1] 70
table(drinkdriving1$drink_offence)
[1] 71

  1   2 
176  38 
drinkdriving1$drink_offence <- as.numeric(drinkdriving1$drink_offence)
[1] 72
mdrink <- glm(outcome ~ drink_offence, data = drinkdriving1, 
    family = binomial)
[1] 73
summary(mdrink)
[1] 74

Call:
glm(formula = outcome ~ drink_offence, family = binomial, data = drinkdriving1)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1219   0.4717   0.6870   0.6870   0.6870  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)
(Intercept)     0.5070     0.6452   0.786    0.432
drink_offence   0.8165     0.5600   1.458    0.145

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.09  on 213  degrees of freedom
Residual deviance: 206.59  on 212  degrees of freedom
AIC: 210.59

Number of Fisher Scoring iterations: 4

t.test(outcome ~ drink_offence, data = drinkdriving1)
[1] 75

	Welch Two Sample t-test

data:  outcome by drink_offence
t = -1.7757, df = 67.732, p-value = 0.08028
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.2229288  0.0130006
sample estimates:
mean in group 1 mean in group 2 
      0.7897727       0.8947368 

drinkdriving1$offence <- drinkdriving1$prior_offence
[1] 76
drinkdriving1$offence[drinkdriving1$offence != "N"] <- 2
[1] 77
drinkdriving1$offence[drinkdriving1$offence == "N"] <- 1
[1] 78
drinkdriving1$offence <- as.numeric(drinkdriving1$offence)
[1] 79
moffence <- glm(outcome ~ offence, data = drinkdriving1, family = binomial)
[1] 80
summary(moffence)
[1] 81

Call:
glm(formula = outcome ~ offence, family = binomial, data = drinkdriving1)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9543   0.5663   0.6797   0.6797   0.6797  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)  
(Intercept)   0.9462     0.5472   1.729   0.0838 .
offence       0.4015     0.4300   0.934   0.3504  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.09  on 213  degrees of freedom
Residual deviance: 208.17  on 212  degrees of freedom
AIC: 212.17

Number of Fisher Scoring iterations: 4

mydata <- data.frame(age = c(17:100))
[1] 82
mydata$nighttime <- "day"
[1] 83
mydata$nighttime <- as.numeric(factor(mydata$nighttime))
[1] 84
mydata$prior_offence <- "N"
[1] 85
mydata$speed <- 30
[1] 86
mydata$bac <- 0
[1] 87
mydata$outcome <- NA
[1] 88
mydata$incident_id <- NA
[1] 89
mydata$p_fine <- NA
[1] 90
mydata$drink_offence <- 1
[1] 91
mydata$offence <- 1
[1] 92
mydata$p_fine <- predict(mfine, newdata = mydata, type = "response")
[1] 93
par(mfrow = c(1, 1))
[1] 94
$mfrow
[1] 2 2

with(mydata, plot(age, p_fine, xlab = "Age", ylab = "Probability of receiving a fine", 
    main = "Different ages and predicted probabilities of receiving a fine", 
    col = c("#ff9a9e"), bty = "n", pch = 20))
[1] 95
for (m in drinkdriving1$incident_id) {
    for (n in officer_inc$incident_id) {
        if (m == n) {
            drinkdriving1$officer[drinkdriving1$incident_id == 
                m] <- officer_inc$officer[officer_inc$incident_id == 
                n]
        }
    }
}
[1] 96
NULL
class(drinkdriving1$officer)
[1] 97
[1] "integer"
officerdata1 <- data.frame(drinkdriving1[drinkdriving1$officer == 
    1, ])
[1] 98
officerdata2 <- data.frame(drinkdriving1[drinkdriving1$officer == 
    2, ])
[1] 99
officerdata3 <- data.frame(drinkdriving1[drinkdriving1$officer == 
    3, ])
[1] 100
mofficer1 <- glm(outcome ~ age, data = officerdata1, family = binomial)
[1] 101
mofficer2 <- glm(outcome ~ age, data = officerdata2, family = binomial)
[1] 102
mofficer3 <- glm(outcome ~ age, data = officerdata3, family = binomial)
[1] 103
exp(coef(mofficer1))
[1] 104
 (Intercept)          age 
2.263518e+04 8.438778e-01 
exp(coef(mofficer2))
[1] 105
(Intercept)         age 
253.8828059   0.9209567 
exp(coef(mofficer3))
[1] 106
 (Intercept)          age 
1429.1567577    0.8955596 
drinkdriving1$officer <- factor(drinkdriving$officer)
[1] 107


####################################################################################################

[1] "Error in `$<-.data.frame`(`*tmp*`, officer, value = structure(integer(0), .Label = character(0), class = \"factor\")) : \n  replacement has 0 rows, data has 214\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in `$<-.data.frame`(`*tmp*`, officer, value = structure(integer(0), .Label = character(0), class = "factor")): replacement has 0 rows, data has 214>
####################################################################################################


mofficer <- lm(outcome ~ age * officer, data = drinkdriving1)
[1] 108
summary(mofficer)
[1] 109

Call:
lm(formula = outcome ~ age * officer, data = drinkdriving1)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.01528 -0.11967  0.05845  0.20159  0.75780 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.492716   0.136297  10.952  < 2e-16 ***
age         -0.017909   0.003038  -5.894 1.48e-08 ***
officer     -0.060845   0.075323  -0.808    0.420    
age:officer  0.002459   0.001650   1.490    0.138    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3203 on 210 degrees of freedom
Multiple R-squared:  0.3501,	Adjusted R-squared:  0.3409 
F-statistic: 37.71 on 3 and 210 DF,  p-value: < 2.2e-16

