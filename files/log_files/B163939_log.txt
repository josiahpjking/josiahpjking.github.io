

	####### B163939 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 2
 [1] "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(plyr, quietly = T)
[1] 3
 [1] "plyr"      "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
describe(drinkdriving)
[1] 5
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 6
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 7
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- NA
[1] 8
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- NA
[1] 9
drinkdriving$nighttime <- as.character(drinkdriving$nighttime)
[1] 10
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 11
levels(drinkdriving$prior_offence)
[1] 12
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 13
drinkdriving$prior_offence <- as.character(drinkdriving$prior_offence)
[1] 14
drinkdriving$speed[drinkdriving$speed <= 3] <- NA
[1] 15
drinkdriving$bac[drinkdriving$bac > 50] <- NA
[1] 16
drinkdriving$outcome[drinkdriving$outcome %in% c("Warning", "WARNING")] <- "warning"
[1] 17
drinkdriving$outcome[drinkdriving$outcome %in% c("Fine", "FINE")] <- "fine"
[1] 18
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 19
plot(m1)
[1] 20
summary(m1)
[1] 21

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

with(drinkdriving, plot(bac ~ age))
[1] 22
abline(m1, col = "red")
[1] 23
anova(m1)
[1] 24
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14  34.687 1.469e-08 ***
Residuals 216 7243.1   33.53                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
bac50 <- 28.68503 - (0.1373 * 50) + 0.02331
[1] 25
predict(m1)
[1] 26
       1        2        3        4        5        6        7        8        9       10       11       12       13       14       15 
23.33018 24.84052 23.46748 21.68253 20.99601 23.74209 17.56341 21.95714 24.29130 20.44680 24.84052 23.05557 25.52704 23.87939 23.33018 
      16       18       19       20       21       23       24       25       26       27       28       29       30       31       32 
22.23175 22.78096 24.01670 22.09444 24.15400 19.76028 25.80165 22.36905 26.48817 21.40792 21.54523 21.81983 19.62297 20.58410 19.21106 
      33       34       35       36       37       38       39       40       41       42       43       44       45       46       47 
23.05557 21.40792 24.01670 19.62297 24.84052 19.07376 22.23175 21.13331 21.54523 21.27062 23.33018 20.85871 24.42861 23.33018 25.52704 
      48       49       50       52       53 
24.84052 21.13331 26.62547 23.87939 25.66434 
 [ reached getOption("max.print") -- omitted 168 entries ]
qqnorm(resid(m1), main = "Figure 2: m1 QQ-norm")
[1] 27
$x
 [1] -1.001647727 -0.382844772  1.538799668 -0.132618105  1.344152486 -0.763854208  0.631791795  0.779339391  0.005749179  0.660123917
[11]  0.617815071  0.576584484 -1.662910885  1.144796229 -0.445493297  0.826965033 -0.523081655  1.020820585 -0.121026905  0.179177710
[21] -0.297538989 -0.893555746 -0.237941322  1.040376237  0.523081655 -0.028749697 -0.946219392 -1.316299930 -2.463430222  0.121026905
[31]  0.358213579  0.748550062 -1.080731619 -0.964366153  0.982836177  1.122928435 -0.226129222  0.261667263  1.618733633  0.590215963
[41]  0.190874584 -0.432830912 -0.395247080  0.273584861 -0.928378997  0.549636371  0.144227152  1.213939986 -0.202597632  0.910829301
 [ reached getOption("max.print") -- omitted 168 entries ]

$y
          1           2           3           4           5           6           7           8           9          10          11 
 -5.6164416  -2.7061199   9.3219145  -1.2067674   8.3713491  -4.6149176   3.8137826   4.8408865  -0.4971646   3.9725724   3.6505407 
         12          13          14          15          16          18          19          20          21          23          24 
  3.4021673  -9.5374231   6.8968016  -2.9485975   4.9866754  -3.1670646   6.0527338  -1.1821753   1.1501205  -2.0872582  -4.8525541 
         25          26          27          28          29          30          31          32          33          34          35 
 -1.6624856   6.0653929   3.1181753  -0.8582260  -5.4502221  -7.8052568 -15.1311484   0.9128686   2.2998112   4.4500379  -6.2411043 
         36          37          38          39          40          41          42          43          44          45          46 
 -5.5070512   5.9712832   6.8377377  -1.6328441   1.7343306   9.4838911   3.4082885   1.1788939  -2.8400983  -2.7094846   1.9032137 
         47          48          49          50          52          53 
 -5.2275125   3.3597630   1.0200350   7.7311460  -1.5946564   5.4335810 
 [ reached getOption("max.print") -- omitted 168 entries ]

qqline(resid(m1), col = "red")
[1] 28
drinkdriving$is.n <- ifelse(drinkdriving$nighttime == "night", 
    1, 0)
[1] 29
m4 <- lm(bac ~ age * nighttime, data = drinkdriving)
[1] 30
summary(m4)
[1] 31

Call:
lm(formula = bac ~ age * nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.7525  -4.3369   0.2656   3.5178  14.6941 

Coefficients:
                   Estimate Std. Error t value Pr(>|t|)    
(Intercept)        27.77618    1.74106  15.954  < 2e-16 ***
age                -0.17647    0.03605  -4.895 1.94e-06 ***
nighttimenight      1.11301    2.13853   0.520    0.603    
age:nighttimenight  0.06319    0.04555   1.387    0.167    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.406 on 212 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.249,	Adjusted R-squared:  0.2383 
F-statistic: 23.43 on 3 and 212 DF,  p-value: 3.895e-13

anova(m4)
[1] 32
Analysis of Variance Table

Response: bac
               Df Sum Sq Mean Sq F value    Pr(>F)    
age             1 1300.0 1299.99 44.4906 2.185e-10 ***
nighttime       1  697.3  697.27 23.8633 2.036e-06 ***
age:nighttime   1   56.2   56.22  1.9242    0.1669    
Residuals     212 6194.5   29.22                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m5 <- lm(bac ~ age * speed, data = drinkdriving)
[1] 33
summary(m5)
[1] 34

Call:
lm(formula = bac ~ age * speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.6045  -3.8673  -0.6397   3.7462  13.8996 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) 27.101802   4.165343   6.506 5.54e-10 ***
age         -0.180107   0.077148  -2.335   0.0205 *  
speed       -0.001419   0.090868  -0.016   0.9876    
age:speed    0.002204   0.002012   1.095   0.2746    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.765 on 210 degrees of freedom
  (36 observations deleted due to missingness)
Multiple R-squared:  0.1648,	Adjusted R-squared:  0.1529 
F-statistic: 13.81 on 3 and 210 DF,  p-value: 2.954e-08

anova(m5)
[1] 35
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1224.1 1224.12 36.8257 5.949e-09 ***
speed       1  113.5  113.52  3.4150   0.06601 .  
age:speed   1   39.9   39.88  1.1997   0.27464    
Residuals 210 6980.6   33.24                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m6 <- lm(bac ~ age * nighttime * speed, data = drinkdriving)
[1] 36
summary(m6)
[1] 37

Call:
lm(formula = bac ~ age * nighttime * speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3442  -4.1385   0.3395   3.5515  14.8915 

Coefficients:
                           Estimate Std. Error t value Pr(>|t|)  
(Intercept)               38.303066  21.598485   1.773   0.0777 .
age                       -0.289033   0.202936  -1.424   0.1559  
nighttimenight           -14.415077  22.104859  -0.652   0.5151  
speed                     -0.194146   0.366628  -0.530   0.5970  
age:nighttimenight         0.222304   0.224489   0.990   0.3232  
age:speed                  0.001181   0.003418   0.345   0.7301  
nighttimenight:speed       0.289214   0.381086   0.759   0.4488  
age:nighttimenight:speed  -0.001695   0.004189  -0.405   0.6862  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.441 on 204 degrees of freedom
  (38 observations deleted due to missingness)
Multiple R-squared:  0.2634,	Adjusted R-squared:  0.2382 
F-statistic: 10.42 on 7 and 204 DF,  p-value: 3.593e-11

anova(m6)
[1] 38
Analysis of Variance Table

Response: bac
                     Df Sum Sq Mean Sq F value    Pr(>F)    
age                   1 1368.9 1368.89 46.2378 1.134e-10 ***
nighttime             1  649.1  649.14 21.9263 5.164e-06 ***
speed                 1   85.7   85.67  2.8938   0.09045 .  
age:nighttime         1   38.3   38.28  1.2931   0.25682    
age:speed             1    0.2    0.17  0.0058   0.93930    
nighttime:speed       1   13.0   13.01  0.4394   0.50817    
age:nighttime:speed   1    4.8    4.84  0.1636   0.68624    
Residuals           204 6039.5   29.61                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
Time_speed <- aggregate(drinkdriving[, 4], list(drinkdriving$nighttime), 
    mean)
[1] 39
Time_speed2 <- ddply(drinkdriving, ~nighttime, summarise, mean = mean(speed))
[1] 40
drinkdriving$is.f <- ifelse(drinkdriving$outcome == "fine", 1, 
    0)
[1] 41
m7 <- glm(is.f ~ bac + speed + prior_offence + age, data = drinkdriving, 
    family = binomial)
[1] 42
with(drinkdriving, plot(is.f ~ bac, axes = F))
[1] 43
axis(2, at = c(0, 1), labels = c("warning", "fine"))
[1] 44
[1] 0 1
axis(1)
[1] 45
[1]  5 10 15 20 25 30 35
summary(m7)
[1] 46

Call:
glm(formula = is.f ~ bac + speed + prior_offence + age, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.9075   0.0001   0.0043   0.0473   1.9574  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)         26.51107 4258.17467   0.006 0.995032    
bac                  0.48279    0.12560   3.844 0.000121 ***
speed                0.17792    0.06764   2.631 0.008524 ** 
prior_offenceCD60  -54.83603 7789.53546  -0.007 0.994383    
prior_offenceDR50  -23.26652 4258.17248  -0.005 0.995640    
prior_offenceDR80  -34.30202 4258.17428  -0.008 0.993573    
prior_offenceN     -26.57000 4258.17251  -0.006 0.995021    
prior_offencePL10  -22.65091 4311.50368  -0.005 0.995808    
prior_offenceSP50  -20.07095 5977.22063  -0.003 0.997321    
prior_offenceSP60  -51.36730 7789.53496  -0.007 0.994738    
 [ reached getOption("max.print") -- omitted 2 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 195.538  on 209  degrees of freedom
Residual deviance:  35.106  on 198  degrees of freedom
  (40 observations deleted due to missingness)
AIC: 59.106

Number of Fisher Scoring iterations: 17

anova(m7, test = "Chisq")
[1] 47
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.f

Terms added sequentially (first to last)


              Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                            209    195.538              
bac            1   50.627       208    144.911 1.117e-12 ***
speed          1   51.118       207     93.794 8.700e-13 ***
prior_offence  8   27.653       199     66.140 0.0005449 ***
age            1   31.034       198     35.106 2.535e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m7S <- glm(is.f ~ I(log(bac) - mean(log(bac))) + I(log(speed) - 
    mean(log(speed))), data = drinkdriving, family = binomial)
[1] 48


####################################################################################################

[1] "Error in family$linkfun(mustart) : \n  Argument mu must be a nonempty numeric vector\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in family$linkfun(mustart): Argument mu must be a nonempty numeric vector>
####################################################################################################


summary(m7S)
[1] 49
[1] "Error in summary(m7S) : object 'm7S' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in summary(m7S): object 'm7S' not found>


####################################################################################################

[1] "Error in summary(m7S) : object 'm7S' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in summary(m7S): object 'm7S' not found>
####################################################################################################


drinkdriving$prior.dr50 <- ifelse(drinkdriving$prior_offence == 
    "DR50", 1, 0)
[1] 50
m8 <- glm(is.f ~ prior.dr50, data = drinkdriving, family = binomial)
[1] 51
anova(m8, test = "Chisq")
[1] 52
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.f

Terms added sequentially (first to last)


           Df Deviance Resid. Df Resid. Dev Pr(>Chi)  
NULL                         245     237.06           
prior.dr50  1   5.6572       244     231.40  0.01738 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
anova(m7, test = "Chisq")
[1] 53
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.f

Terms added sequentially (first to last)


              Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                            209    195.538              
bac            1   50.627       208    144.911 1.117e-12 ***
speed          1   51.118       207     93.794 8.700e-13 ***
prior_offence  8   27.653       199     66.140 0.0005449 ***
age            1   31.034       198     35.106 2.535e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m7)
[1] 54

Call:
glm(formula = is.f ~ bac + speed + prior_offence + age, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.9075   0.0001   0.0043   0.0473   1.9574  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)         26.51107 4258.17467   0.006 0.995032    
bac                  0.48279    0.12560   3.844 0.000121 ***
speed                0.17792    0.06764   2.631 0.008524 ** 
prior_offenceCD60  -54.83603 7789.53546  -0.007 0.994383    
prior_offenceDR50  -23.26652 4258.17248  -0.005 0.995640    
prior_offenceDR80  -34.30202 4258.17428  -0.008 0.993573    
prior_offenceN     -26.57000 4258.17251  -0.006 0.995021    
prior_offencePL10  -22.65091 4311.50368  -0.005 0.995808    
prior_offenceSP50  -20.07095 5977.22063  -0.003 0.997321    
prior_offenceSP60  -51.36730 7789.53496  -0.007 0.994738    
 [ reached getOption("max.print") -- omitted 2 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 195.538  on 209  degrees of freedom
Residual deviance:  35.106  on 198  degrees of freedom
  (40 observations deleted due to missingness)
AIC: 59.106

Number of Fisher Scoring iterations: 17

m9 <- glm(is.f ~ age + bac + speed + prior_offence + is.n, data = drinkdriving, 
    family = binomial)
[1] 55
newdata = data.frame(age = 17:100, is.n = 1, speed = 30, bac = 0, 
    prior_offence = "N")
[1] 56
newdata$predictions <- predict(m9, newdata)
[1] 57
new_prediction <- with(newdata, plot(predictions ~ age, ylab = "fine likelihood", 
    main = "Figure 3: Likelihood of fine by stable predictors per year of age"))
[1] 58
