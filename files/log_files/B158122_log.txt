

	####### B158122 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(lsr, quietly = T)
[1] 2
 [1] "lsr"       "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 3
 [1] "psych"     "lsr"       "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 5
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
summary(officer_inc)
[1] 6
 officer     incident_id 
 AS  :116   inc_1  :  1  
 IT  : 66   inc_10 :  1  
 NP  : 67   inc_100:  1  
 NA's:  1   inc_101:  1  
            inc_102:  1  
            inc_103:  1  
            (Other):244  
table(drinkdriving$nighttime)
[1] 7

18:25  2:05   day night 
    1     2    78   169 
plot(drinkdriving$age, drinkdriving$bac, ylab = "Blood Alcohol Content", 
    xlab = "Age")
[1] 8
drinkdriving$age[drinkdriving$age > 90] <- NA
[1] 9
drinkdriving$age[drinkdriving$age < 17] <- NA
[1] 10
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "night"
[1] 11
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 12
drinkdriving$bac[drinkdriving$bac > 40] <- NA
[1] 13
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 14
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 15
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 16
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 17
drinkdriving$prior_offence <- droplevels(drinkdriving$prior_offence)
[1] 18
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "Fine"
[1] 19
drinkdriving$outcome[drinkdriving$outcome == "fine"] <- "Fine"
[1] 20
drinkdriving$outcome[drinkdriving$outcome == "warning"] <- "Warning"
[1] 21
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "Warning"
[1] 22
drinkdriving$outcome <- droplevels(drinkdriving$outcome)
[1] 23
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 24
summary(m1)
[1] 25

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.1959  -4.1261  -0.8169   4.0809  14.7662 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.11832    1.15626  24.318  < 2e-16 ***
age         -0.12660    0.02479  -5.107 7.37e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.834 on 208 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1114,	Adjusted R-squared:  0.1072 
F-statistic: 26.09 on 1 and 208 DF,  p-value: 7.366e-07

plot(m1, which = c(1:5))
[1] 26
age50 <- data.frame(age = 50)
[1] 27
bac_age_prediction <- predict(m1, age50)
[1] 28
bac_age_prediction

       1 
21.78828 


plot(m1, which = 4)
[1] 30
hist(resid(m1), main = "Histogram of Residuals", xlab = "Residuals")
[1] 31
shapiro.test(resid(m1))
[1] 32

	Shapiro-Wilk normality test

data:  resid(m1)
W = 0.99315, p-value = 0.4415

drinkdriving$nighttime.codes <- ifelse(drinkdriving$nighttime == 
    "day", 1, 0)
[1] 33
with(drinkdriving, cor.test(bac, age))
[1] 34

	Pearson's product-moment correlation

data:  bac and age
t = -5.1075, df = 208, p-value = 7.366e-07
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.4489240 -0.2078259
sample estimates:
       cor 
-0.3338234 

with(drinkdriving, cor.test(bac, speed))
[1] 35

	Pearson's product-moment correlation

data:  bac and speed
t = 7.1966, df = 241, p-value = 7.789e-12
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.3112075 0.5189576
sample estimates:
      cor 
0.4205805 

with(drinkdriving, cor.test(bac, nighttime.codes))
[1] 36

	Pearson's product-moment correlation

data:  bac and nighttime.codes
t = -5.5025, df = 241, p-value = 9.552e-08
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.4413706 -0.2173771
sample estimates:
       cor 
-0.3340824 

m2.bac_age <- lm(bac ~ age, data = drinkdriving)
[1] 37
m2.bac_nighttime <- lm(bac ~ nighttime.codes, data = drinkdriving)
[1] 38
m2.bac.speed <- lm(bac ~ speed, data = drinkdriving)
[1] 39
summary(m2.bac_age)
[1] 40

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.1959  -4.1261  -0.8169   4.0809  14.7662 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.11832    1.15626  24.318  < 2e-16 ***
age         -0.12660    0.02479  -5.107 7.37e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.834 on 208 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1114,	Adjusted R-squared:  0.1072 
F-statistic: 26.09 on 1 and 208 DF,  p-value: 7.366e-07

summary(m2.bac_nighttime)
[1] 41

Call:
lm(formula = bac ~ nighttime.codes, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-20.8033  -4.2060   0.3691   4.4487  13.2929 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)      24.7901     0.4868  50.929  < 2e-16 ***
nighttime.codes  -4.7893     0.8704  -5.503 9.55e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.29 on 241 degrees of freedom
  (7 observations deleted due to missingness)
Multiple R-squared:  0.1116,	Adjusted R-squared:  0.1079 
F-statistic: 30.28 on 1 and 241 DF,  p-value: 9.552e-08

summary(m2.bac.speed)
[1] 42

Call:
lm(formula = bac ~ speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.1525  -3.9441  -0.3248   4.2172  13.8120 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 15.15965    1.19495  12.686  < 2e-16 ***
speed        0.20335    0.02826   7.197 7.79e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.055 on 241 degrees of freedom
  (7 observations deleted due to missingness)
Multiple R-squared:  0.1769,	Adjusted R-squared:  0.1735 
F-statistic: 51.79 on 1 and 241 DF,  p-value: 7.789e-12

anova(m2.bac_age)
[1] 43
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1  887.8  887.77  26.086 7.366e-07 ***
Residuals 208 7078.7   34.03                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
anova(m2.bac_nighttime)
[1] 44
Analysis of Variance Table

Response: bac
                 Df Sum Sq Mean Sq F value    Pr(>F)    
nighttime.codes   1 1198.0 1198.01  30.278 9.552e-08 ***
Residuals       241 9535.8   39.57                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
anova(m2.bac.speed)
[1] 45
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
speed       1 1898.7 1898.67  51.791 7.789e-12 ***
Residuals 241 8835.1   36.66                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
t.test.speed.time <- t.test(speed ~ nighttime, data = drinkdriving, 
    var.equal = FALSE, alternative = "greater")
[1] 46
t.test.speed.time


	Welch Two Sample t-test

data:  speed by nighttime
t = -0.85812, df = 155.57, p-value = 0.8039
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 -5.027592       Inf
sample estimates:
  mean in group day mean in group night 
           39.30514            41.02205 



drinkdriving$speed.wo.fast <- ifelse(drinkdriving$speed == "day", 
    1, 0)
[1] 48
drinkdriving$speed.wo.fast[drinkdriving$speed.wo.fast > 120] <- NA
[1] 49
t.test.speed.time.wo.fast <- t.test(speed.wo.fast ~ nighttime, 
    data = drinkdriving, var.equal = FALSE, alternative = "greater")
[1] 50
t.test.speed.time.wo.fast


	Welch Two Sample t-test

data:  speed.wo.fast by nighttime
t = NaN, df = NaN, p-value = NA
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 NaN NaN
sample estimates:
  mean in group day mean in group night 
                  0                   0 



m3.fine_warning <- glm(outcome == "Fine" ~ bac + speed + prior_offence + 
    nighttime + age, family = binomial, data = drinkdriving)
[1] 52
summary(m3.fine_warning)
[1] 53

Call:
glm(formula = outcome == "Fine" ~ bac + speed + prior_offence + 
    nighttime + age, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.9572   0.0001   0.0050   0.0577   2.0824  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)              25.23844 4248.49338   0.006 0.995260    
bac                       0.47639    0.12462   3.823 0.000132 ***
speed                     0.20475    0.06244   3.279 0.001041 ** 
prior_offenceCD60       -54.24535 7784.24747  -0.007 0.994440    
prior_offenceDR50       -23.18438 4248.49149  -0.005 0.995646    
prior_offenceDR80       -34.00417 4248.49330  -0.008 0.993614    
prior_offenceN          -26.39639 4248.49147  -0.006 0.995043    
prior_offencePL10       -22.60908 4303.94624  -0.005 0.995809    
prior_offenceSP50       -19.43877 5935.63073  -0.003 0.997387    
prior_offenceSP60       -51.33901 7784.24700  -0.007 0.994738    
 [ reached getOption("max.print") -- omitted 4 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 205.610  on 205  degrees of freedom
Residual deviance:  35.984  on 192  degrees of freedom
  (44 observations deleted due to missingness)
AIC: 63.984

Number of Fisher Scoring iterations: 17

m3.fine_speed <- glm(outcome == "Fine" ~ scale(speed), family = binomial, 
    data = drinkdriving)
[1] 54
m3.fine_bac <- glm(outcome == "Fine" ~ scale(bac), family = binomial, 
    data = drinkdriving)
[1] 55
summary(m3.fine_speed)
[1] 56

Call:
glm(formula = outcome == "Fine" ~ scale(speed), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.4793   0.0740   0.2415   0.5194   1.8448  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)     2.469      0.308   8.016 1.09e-15 ***
scale(speed)    2.376      0.356   6.673 2.50e-11 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 153.41  on 248  degrees of freedom
AIC: 157.41

Number of Fisher Scoring iterations: 6

summary(m3.fine_bac)
[1] 57

Call:
glm(formula = outcome == "Fine" ~ scale(bac), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.9866   0.2070   0.4045   0.6491   1.6648  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)   1.8655     0.2205   8.462  < 2e-16 ***
scale(bac)    1.3390     0.2225   6.018 1.77e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 187.04  on 241  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 191.04

Number of Fisher Scoring iterations: 5

m3.drinking_offence <- glm(outcome == "Fine" ~ prior_offence == 
    "DR50", family = binomial, data = drinkdriving)
[1] 58
m3.other_offences <- glm(outcome == "Fine" ~ prior_offence != 
    c("DR50", "N"), family = binomial, data = drinkdriving)
[1] 59
summary(m3.drinking_offence)
[1] 60

Call:
glm(formula = outcome == "Fine" ~ prior_offence == "DR50", family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3076   0.3803   0.6900   0.6900   0.6900  

Coefficients:
                            Estimate Std. Error z value Pr(>|z|)    
(Intercept)                   1.3140     0.1718   7.649 2.02e-14 ***
prior_offence == "DR50"TRUE   1.2763     0.6228   2.049   0.0404 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 231.40  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 235.4

Number of Fisher Scoring iterations: 5

summary(m3.other_offences)
[1] 61

Call:
glm(formula = outcome == "Fine" ~ prior_offence != c("DR50", 
    "N"), family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9048   0.5965   0.5965   0.6980   0.6980  

Coefficients:
                                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)                           1.2879     0.2306   5.586 2.33e-08 ***
prior_offence != c("DR50", "N")TRUE   0.3485     0.3278   1.063    0.288    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 235.93  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 239.93

Number of Fisher Scoring iterations: 4

m3.all_offences <- glm(outcome == "Fine" ~ prior_offence != "N", 
    family = binomial, data = drinkdriving)
[1] 62
m3.no_offences <- glm(outcome == "Fine" ~ prior_offence == "N", 
    family = binomial, data = drinkdriving)
[1] 63
summary(m3.all_offences)
[1] 64

Call:
glm(formula = outcome == "Fine" ~ prior_offence != "N", family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9564   0.5650   0.6681   0.6681   0.6681  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)                1.3863     0.1838   7.542 4.62e-14 ***
prior_offence != "N"TRUE   0.3677     0.4051   0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

summary(m3.no_offences)
[1] 65

Call:
glm(formula = outcome == "Fine" ~ prior_offence == "N", family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9564   0.5650   0.6681   0.6681   0.6681  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)                1.7540     0.3610   4.858 1.18e-06 ***
prior_offence == "N"TRUE  -0.3677     0.4051  -0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

m4 <- glm(outcome == "Fine" ~ age + prior_offence + nighttime + 
    speed + bac, family = binomial, data = drinkdriving)
[1] 66
pred <- data.frame(age = c(17:90), prior_offence = "N", nighttime = "day", 
    speed = 30, bac = 0, outcome = "Fine", stringsAsFactors = TRUE)
[1] 67
pred_fine_N_day_30_0 <- predict(m4, newdata = pred)
[1] 68
pred_fine_N_day_30_0

           1            2            3            4            5            6            7            8            9           10 
  0.75197966   0.50300789   0.25403612   0.00506435  -0.24390742  -0.49287919  -0.74185096  -0.99082273  -1.23979450  -1.48876628 
          11           12           13           14           15           16           17           18           19           20 
 -1.73773805  -1.98670982  -2.23568159  -2.48465336  -2.73362513  -2.98259690  -3.23156867  -3.48054044  -3.72951221  -3.97848399 
          21           22           23           24           25           26           27           28           29           30 
 -4.22745576  -4.47642753  -4.72539930  -4.97437107  -5.22334284  -5.47231461  -5.72128638  -5.97025815  -6.21922992  -6.46820169 
          31           32           33           34           35           36           37           38           39           40 
 -6.71717347  -6.96614524  -7.21511701  -7.46408878  -7.71306055  -7.96203232  -8.21100409  -8.45997586  -8.70894763  -8.95791940 
          41           42           43           44           45           46           47           48           49           50 
 -9.20689118  -9.45586295  -9.70483472  -9.95380649 -10.20277826 -10.45175003 -10.70072180 -10.94969357 -11.19866534 -11.44763711 
 [ reached getOption("max.print") -- omitted 24 entries ]


plot(pred_fine_N_day_30_0, main = "Predicted Fine Probability by Age", 
    xlab = "Age", ylab = "Probability of Fine")
[1] 70
drinkdriving <- merge(drinkdriving, officer_inc)
[1] 71
chisq.test(drinkdriving$officer, drinkdriving$outcome)
[1] 72

	Pearson's Chi-squared test

data:  drinkdriving$officer and drinkdriving$outcome
X-squared = 1.246, df = 2, p-value = 0.5363

m5 <- glm(outcome ~ officer:age, family = binomial, data = drinkdriving)
[1] 73
qplot(data = drinkdriving, age, officer, colour = outcome, main = "officer ID and outcome")
[1] 74
summary(m5)
[1] 75

Call:
glm(formula = outcome ~ officer:age, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0904  -0.5206  -0.3102  -0.1765   3.0670  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -6.37830    0.88305  -7.223 5.09e-13 ***
officerAS:age  0.10591    0.01653   6.409 1.46e-10 ***
officerIT:age  0.09818    0.01725   5.690 1.27e-08 ***
officerNP:age  0.09356    0.01669   5.606 2.08e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 218.83  on 216  degrees of freedom
Residual deviance: 152.45  on 213  degrees of freedom
  (33 observations deleted due to missingness)
AIC: 160.45

Number of Fisher Scoring iterations: 5

