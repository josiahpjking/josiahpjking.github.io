

	####### B153620 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 2
[1] "drinkdriving" "officer_inc" 
describe(officer_inc)
[1] 3
             vars   n  mean    sd median trimmed   mad min max range skew kurtosis   se
officer*        1 249   1.8  0.84    2.0    1.76  1.48   1   3     2 0.38    -1.47 0.05
incident_id*    2 250 125.5 72.31  125.5  125.50 92.66   1 250   249 0.00    -1.21 4.57
describe(drinkdriving)
[1] 4
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 5
table(drinkdriving$nighttime)
[1] 6

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "day"
[1] 7
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 8
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 9
table(drinkdriving$prior_offence)
[1] 10

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- "CD20"
[1] 11
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 12
boxplot(drinkdriving$speed)
[1] 13
drinkdriving$speed[drinkdriving$speed > 100] <- NA
[1] 14
boxplot(drinkdriving$bac)
[1] 15
drinkdriving$bac[drinkdriving$bac > 50] <- NA
[1] 16
table(drinkdriving$outcome)
[1] 17

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome == "Fine" | drinkdriving$outcome == 
    "FINE"] <- "fine"
[1] 18
drinkdriving$outcome[drinkdriving$outcome == "Warning" | drinkdriving$outcome == 
    "WARNING"] <- "warning"
[1] 19
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 20
class(drinkdriving$incident_id)
[1] 21
[1] "character"
class(officer_inc$incident_id)
[1] 22
[1] "factor"
drinkdriving$incident_id <- factor(drinkdriving$incident_id)
[1] 23
table(officer_inc$officer)
[1] 24

 AS  IT  NP 
116  66  67 
drinkdriving <- merge(drinkdriving, officer_inc, all = T)
[1] 25
describe(drinkdriving)
[1] 26
             vars   n   mean    sd median trimmed   mad min max range  skew kurtosis   se
incident_id*    1 250 125.50 72.31  125.5  125.50 92.66   1 250   249  0.00    -1.21 4.57
age             2 225  42.68 16.77   40.0   41.93 17.79  14  90    76  0.40    -0.52 1.12
nighttime*      3 250   1.68  0.47    2.0    1.73  0.00   1   2     1 -0.79    -1.39 0.03
 [ reached 'max' / getOption("max.print") -- omitted 5 rows ]
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 27
summary(m1)
[1] 28

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

pre_50 <- coef(m1)[1] + coef(m1)[2] * 50
[1] 29
pre_50

(Intercept) 
   21.81983 


hist(residuals(m1), main = "", breaks = 20)
[1] 31
plot(density(residuals(m1)), main = "")
[1] 32
plot(x = m1, which = 2)
[1] 33
m2_1 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 34
anova(m2_1)
[1] 35
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14  38.345 2.969e-09 ***
nighttime   1  721.4  721.42  23.783 2.096e-06 ***
Residuals 215 6521.7   30.33                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2_1)
[1] 36

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.5254  -4.6056   0.3152   3.7847  14.3450 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    25.60505    1.19731  21.386  < 2e-16 ***
age            -0.12800    0.02225  -5.752 3.01e-08 ***
nighttimenight  3.92560    0.80496   4.877 2.10e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.508 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2242,	Adjusted R-squared:  0.217 
F-statistic: 31.06 on 2 and 215 DF,  p-value: 1.409e-12

m2_2 <- lm(bac ~ age + speed, data = drinkdriving)
[1] 37
anova(m2_2)
[1] 38
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14 34.6961 1.471e-08 ***
speed       1   35.5   35.50  1.0589    0.3046    
Residuals 215 7207.6   33.52                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2_2)
[1] 39

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4118  -3.8926  -0.6094   4.1298  14.4229 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.08699    2.74183   9.514  < 2e-16 ***
age         -0.11540    0.03156  -3.656 0.000322 ***
speed        0.04320    0.04198   1.029 0.304616    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.79 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.574e-08

m2_3 <- lm(bac ~ age + speed + nighttime, data = drinkdriving)
[1] 40
summary(m2_3)
[1] 41

Call:
lm(formula = bac ~ age + speed + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.7811  -4.6224   0.5195   3.7225  14.2190 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    22.99435    2.68293   8.571 2.06e-15 ***
age            -0.10600    0.03007  -3.525 0.000518 ***
speed           0.04340    0.03992   1.087 0.278151    
nighttimenight  3.92649    0.80461   4.880 2.07e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

m2_4 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 42
summary(m2_4)
[1] 43

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.5254  -4.6056   0.3152   3.7847  14.3450 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    25.60505    1.19731  21.386  < 2e-16 ***
age            -0.12800    0.02225  -5.752 3.01e-08 ***
nighttimenight  3.92560    0.80496   4.877 2.10e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.508 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2242,	Adjusted R-squared:  0.217 
F-statistic: 31.06 on 2 and 215 DF,  p-value: 1.409e-12

speednighttime <- lm(speed ~ nighttime, data = drinkdriving)
[1] 44
summary(speednighttime)
[1] 45

Call:
lm(formula = speed ~ nighttime, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-40.938  -8.767   0.072   8.132  40.090 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      38.473      1.589  24.208   <2e-16 ***
nighttimenight    2.464      1.918   1.285      0.2    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.04 on 247 degrees of freedom
  (1 observation deleted due to missingness)
Multiple R-squared:  0.006641,	Adjusted R-squared:  0.002619 
F-statistic: 1.651 on 1 and 247 DF,  p-value: 0.2

t.test(speed ~ nighttime, data = drinkdriving)
[1] 46

	Welch Two Sample t-test

data:  speed by nighttime
t = -1.4342, df = 196.74, p-value = 0.1531
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.853122  0.924347
sample estimates:
  mean in group day mean in group night 
           38.47328            40.93767 

m3_1 <- glm(outcome ~ prior_offence + speed + bac + age + nighttime + 
    officer, data = drinkdriving, family = binomial)
[1] 47
summary(m3_1)
[1] 48

Call:
glm(formula = outcome ~ prior_offence + speed + bac + age + nighttime + 
    officer, family = binomial, data = drinkdriving)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.94941  -0.18989  -0.03708  -0.00202   3.11705  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)             -21.16449 4251.81841  -0.005 0.996028    
prior_offenceCD20        28.78105 4251.81803   0.007 0.994599    
prior_offenceCD60        46.76812 7786.06241   0.006 0.995207    
prior_offenceDR50        20.50668 4251.81745   0.005 0.996152    
prior_offenceDR80        27.71278 4251.81811   0.007 0.994800    
prior_offenceN           23.06834 4251.81734   0.005 0.995671    
prior_offencePL10        21.15316 4252.07988   0.005 0.996031    
prior_offenceSP50        11.53475 5992.89472   0.002 0.998464    
prior_offenceSP60        46.13033 7786.06239   0.006 0.995273    
prior_offenceTS70         3.10393 5717.08164   0.001 0.999567    
 [ reached getOption("max.print") -- omitted 7 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 216.502  on 217  degrees of freedom
Residual deviance:  61.835  on 201  degrees of freedom
  (32 observations deleted due to missingness)
AIC: 95.835

Number of Fisher Scoring iterations: 17

m3_1.s <- glm(outcome ~ scale(speed) + scale(bac), data = drinkdriving, 
    family = binomial)
[1] 49
summary(m3_1.s)
[1] 50

Call:
glm(formula = outcome ~ scale(speed) + scale(bac), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9536  -0.4458  -0.1875  -0.0489   4.0812  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.7590     0.3589  -7.687 1.51e-14 ***
scale(speed)  -2.0667     0.3628  -5.697 1.22e-08 ***
scale(bac)    -1.1486     0.2737  -4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 130.13  on 240  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 6

drinkoffence <- drinkdriving[drinkdriving$prior_offence != "N", 
    ]
[1] 51
drinkoffence$drink <- ifelse(drinkoffence$prior_offence == "DR50" | 
    drinkoffence$prior_offence == "TS70,DR50", 1, 0)
[1] 52
m3_2 <- glm(outcome ~ drink, data = drinkoffence, family = binomial)
[1] 53
summary(m3_2)
[1] 54

Call:
glm(formula = outcome ~ drink, family = binomial, data = drinkoffence)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.9005  -0.4366  -0.4366  -0.4366   2.1899  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)  
(Intercept)  -0.6931     0.4629  -1.497   0.1343  
drink        -1.6094     0.6995  -2.301   0.0214 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 59.106  on 64  degrees of freedom
Residual deviance: 53.542  on 63  degrees of freedom
AIC: 57.542

Number of Fisher Scoring iterations: 5

drinkdriving$prior <- ifelse(drinkdriving$prior_offence != "N", 
    1, 0)
[1] 55
m3_3 <- glm(outcome ~ prior, data = drinkdriving, family = binomial)
[1] 56
summary(m3_3)
[1] 57

Call:
glm(formula = outcome ~ prior, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.6681  -0.6681  -0.6681  -0.6089   1.8849  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  -1.3863     0.1838  -7.542 4.62e-14 ***
prior        -0.2048     0.3784  -0.541    0.588    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 244.26  on 248  degrees of freedom
AIC: 248.26

Number of Fisher Scoring iterations: 4

drinkdriving$fine <- ifelse(drinkdriving$outcome == "fine", 1, 
    0)
[1] 58
m4 <- glm(fine ~ speed + bac + age, data = drinkdriving, family = binomial)
[1] 59
summary(m4)
[1] 60

Call:
glm(formula = fine ~ speed + bac + age, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.5396   0.0329   0.1570   0.3674   2.3380  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept) -4.87364    2.16854  -2.247   0.0246 *  
speed        0.13857    0.03343   4.146 3.39e-05 ***
bac          0.19231    0.04880   3.941 8.12e-05 ***
age         -0.04566    0.01996  -2.287   0.0222 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 216.50  on 217  degrees of freedom
Residual deviance: 106.31  on 214  degrees of freedom
  (32 observations deleted due to missingness)
AIC: 114.31

Number of Fisher Scoring iterations: 7

pre_age <- c(1:100)
[1] 61
pre_odd <- exp(coef(m4)[1] + coef(m4)[2] * 30 + coef(m4)[3] * 
    0 + coef(m4)[4] * pre_age)
[1] 62
probability <- pre_odd/(1 + pre_odd)
[1] 63
plot(probability, main = "probabilities of receiving a fine", 
    xlab = "age")
[1] 64
contrasts(drinkdriving$officer)
[1] 65
   IT NP
AS  0  0
IT  1  0
NP  0  1
contrasts(drinkdriving$officer) <- cbind(ASvIT = c(1/2, -1/2, 
    0), ITvNP = c(0, 1/2, -1/2))
[1] 66
m5 <- glm(outcome ~ officer * age, data = drinkdriving, family = binomial)
[1] 67
summary(m5)
[1] 68

Call:
glm(formula = outcome ~ officer * age, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4089  -0.5454  -0.2741  -0.0642   2.7179  

Coefficients:
                 Estimate Std. Error z value Pr(>|z|)    
(Intercept)      -6.32586    0.94007  -6.729 1.71e-11 ***
officerASvIT     -6.48667    2.97397  -2.181   0.0292 *  
officerITvNP     -2.88264    2.54650  -1.132   0.2576    
age               0.09797    0.01683   5.821 5.84e-09 ***
officerASvIT:age  0.12652    0.05229   2.419   0.0155 *  
officerITvNP:age  0.06079    0.04603   1.321   0.1866    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

officer_odd <- exp(coef(m5)[2] + coef(m5)[5] * pre_age)
[1] 69
plot(officer_odd, main = "influence on odd", xlab = "age")
[1] 70
