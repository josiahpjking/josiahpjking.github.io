

	####### B157140 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(lsr, quietly = T)
[1] 2
 [1] "lsr"       "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 3
 [1] "car"       "carData"   "lsr"       "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
describe(drinkdriving)
[1] 5
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
drinkdriving$age[drinkdriving$age <= "16"] <- NA
[1] 6
drinkdriving$age[drinkdriving$age %in% c(297, 293)] <- NA
[1] 7
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 8
levels(drinkdriving$nighttime)[levels(drinkdriving$nighttime) == 
    "2:05"] <- "night"
[1] 9
levels(drinkdriving$nighttime)[levels(drinkdriving$nighttime) == 
    "18:25"] <- "day"
[1] 10
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 11
levels(drinkdriving$prior_offence)
[1] 12
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 13
drinkdriving$speed <- round(drinkdriving$speed)
[1] 14
drinkdriving$bac <- drinkdriving$bac/100
[1] 15
drinkdriving$bac <- round(drinkdriving$bac, digits = 2)
[1] 16
drinkdriving$bac[drinkdriving$bac >= 0.4] <- NA
[1] 17
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 18
levels(drinkdriving$outcome)[levels(drinkdriving$outcome) %in% 
    c("Fine", "FINE")] <- "fine"
[1] 19
levels(drinkdriving$outcome)[levels(drinkdriving$outcome) %in% 
    c("Warning", "WARNING")] <- "warning"
[1] 20
DrinkDriving2 <- merge.data.frame(drinkdriving, officer_inc, 
    by = "incident_id")
[1] 21
m1 <- lm(bac ~ age, data = DrinkDriving2)
[1] 22
summary(m1)
[1] 23

Call:
lm(formula = bac ~ age, data = DrinkDriving2)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.156197 -0.039033 -0.005152  0.039418  0.147759 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2810497  0.0115573  24.318  < 2e-16 ***
age         -0.0012687  0.0002478  -5.121 6.92e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05831 on 208 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1119,	Adjusted R-squared:  0.1077 
F-statistic: 26.22 on 1 and 208 DF,  p-value: 6.923e-07

par(mfrow = c(2, 2))
[1] 24
$mfrow
[1] 2 2

plot(m1, which = c(1:4))
[1] 25
new.ages <- data.frame(age = c(30, 40, 50, 60))
[1] 26
predict(m1, newdata = new.ages)
[1] 27
        1         2         3         4 
0.2429888 0.2303018 0.2176149 0.2049279 
hist(residuals(m1), col = "green")
[1] 28
m2 <- lm(bac ~ age + speed, data = DrinkDriving2)
[1] 29
m3 <- lm(bac ~ age + nighttime, data = DrinkDriving2)
[1] 30
summary(m2)
[1] 31

Call:
lm(formula = bac ~ age + speed, data = DrinkDriving2)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.149291 -0.037718 -0.007503  0.040150  0.142948 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2573608  0.0284102   9.059  < 2e-16 ***
age         -0.0010719  0.0003285  -3.263  0.00129 ** 
speed        0.0003980  0.0004360   0.913  0.36240    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05833 on 207 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1155,	Adjusted R-squared:  0.107 
F-statistic: 13.52 on 2 and 207 DF,  p-value: 3.039e-06

anova(m2)
[1] 32
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.08915 0.089154 26.1998 7.016e-07 ***
speed       1 0.00284 0.002835  0.8332    0.3624    
Residuals 207 0.70439 0.003403                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
vif(m2)
[1] 33
     age    speed 
1.756378 1.756378 
summary(m3)
[1] 34

Call:
lm(formula = bac ~ age + nighttime, data = DrinkDriving2)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.170204 -0.044865  0.004218  0.035556  0.141002 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2501133  0.0127526  19.613  < 2e-16 ***
age            -0.0011753  0.0002365  -4.970 1.40e-06 ***
nighttimenight  0.0394334  0.0082393   4.786 3.23e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05546 on 207 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.2004,	Adjusted R-squared:  0.1927 
F-statistic: 25.94 on 2 and 207 DF,  p-value: 8.828e-11

anova(m3)
[1] 35
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.08915 0.089154  28.982 1.972e-07 ***
nighttime   1 0.07046 0.070462  22.906 3.233e-06 ***
Residuals 207 0.63677 0.003076                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
vif(m3)
[1] 36
      age nighttime 
 1.006857  1.006857 
standardCoefs(m3)
[1] 37
                         b       beta
age            -0.00117530 -0.3099575
nighttimenight  0.03943343  0.2984693
m4 <- lm(speed ~ nighttime, data = DrinkDriving2)
[1] 38
summary(m4)
[1] 39

Call:
lm(formula = speed ~ nighttime, data = DrinkDriving2)

Residuals:
    Min      1Q  Median      3Q     Max 
-40.953  -8.953   0.047   8.047  80.494 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      39.506      1.675  23.587   <2e-16 ***
nighttimenight    1.447      2.025   0.714    0.476    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.89 on 248 degrees of freedom
Multiple R-squared:  0.002054,	Adjusted R-squared:  -0.00197 
F-statistic: 0.5104 on 1 and 248 DF,  p-value: 0.4756

m5 <- glm(outcome ~ nighttime + speed + age + bac + prior_offence + 
    officer, data = DrinkDriving2, family = binomial)
[1] 40
summary(m5)
[1] 41

Call:
glm(formula = outcome ~ nighttime + speed + age + bac + prior_offence + 
    officer, family = binomial, data = DrinkDriving2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1212  -0.0456  -0.0038  -0.0001   3.7168  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)             -27.24446 4186.98588  -0.007 0.994808    
nighttimenight            0.40828    1.10386   0.370 0.711482    
speed                    -0.20708    0.06379  -3.246 0.001170 ** 
age                       0.27035    0.08236   3.282 0.001029 ** 
bac                     -49.51100   13.27478  -3.730 0.000192 ***
prior_offenceCD60        55.35424 7750.84896   0.007 0.994302    
prior_offenceDR50        23.79815 4186.98317   0.006 0.995465    
prior_offenceDR80        35.78125 4186.98571   0.009 0.993182    
prior_offenceN           27.03424 4186.98314   0.006 0.994848    
prior_offencePL10        23.61801 4349.40845   0.005 0.995667    
 [ reached getOption("max.print") -- omitted 6 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 205.610  on 205  degrees of freedom
Residual deviance:  34.092  on 190  degrees of freedom
  (44 observations deleted due to missingness)
AIC: 66.092

Number of Fisher Scoring iterations: 17

anova(m5, test = "Chisq")
[1] 42
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


              Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                            205    205.610              
nighttime      1    3.186       204    202.424 0.0742772 .  
speed          1   87.819       203    114.605 < 2.2e-16 ***
age            1   12.205       202    102.400 0.0004765 ***
bac            1   19.111       201     83.289 1.233e-05 ***
prior_offence  9   48.586       192     34.702 1.984e-07 ***
officer        2    0.611       190     34.092 0.7368525    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m6 <- glm(outcome ~ prior_offence, data = DrinkDriving2, family = binomial)
[1] 43
summary(m6)
[1] 44

Call:
glm(formula = outcome ~ prior_offence, family = binomial, data = DrinkDriving2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.1774  -0.6681  -0.6681  -0.3803   2.3076  

Coefficients:
                              Estimate Std. Error z value Pr(>|z|)
(Intercept)                 -1.657e+01  1.697e+03  -0.010    0.992
prior_offenceCD60            3.313e+01  2.939e+03   0.011    0.991
prior_offenceCD60,CD10,DR80  1.591e-08  2.939e+03   0.000    1.000
prior_offenceCD60,CD60       1.586e-08  2.939e+03   0.000    1.000
prior_offenceDR50            1.398e+01  1.697e+03   0.008    0.993
prior_offenceDR80            1.547e+01  1.697e+03   0.009    0.993
prior_offenceN               1.518e+01  1.697e+03   0.009    0.993
prior_offencePL10            1.657e+01  1.697e+03   0.010    0.992
prior_offenceSP50            1.585e-08  2.400e+03   0.000    1.000
prior_offenceSP60            3.313e+01  2.939e+03   0.011    0.991
prior_offenceTS70            1.587e+01  1.697e+03   0.009    0.993
prior_offenceTS70,DR50       3.313e+01  2.939e+03   0.011    0.991

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 218.00  on 234  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 242

Number of Fisher Scoring iterations: 15

m7 <- glm(outcome ~ age + prior_offence + speed + nighttime + 
    bac, data = DrinkDriving2, family = binomial)
[1] 45
NewData <- with(DrinkDriving2, data.frame(age = 17:90, prior_offence = "N", 
    speed = 30, nighttime = "day", bac = 0))
[1] 46
pred_outcome <- predict(m7, NewData, type = "response", se.fit = T)
[1] 47
predf <- pred_outcome$fit
[1] 48
plot(17:90, predf, type = "l", ylab = "Pred.Prob of getting fined", 
    xlab = "Age", bty = "n", col = "red")
[1] 49
m8 <- glm(outcome ~ officer * age, data = DrinkDriving2, family = binomial)
[1] 50
summary(m8)
[1] 51

Call:
glm(formula = outcome ~ officer * age, family = binomial, data = DrinkDriving2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4075  -0.5638  -0.3183  -0.0757   2.7179  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -9.55712    2.00043  -4.778 1.77e-06 ***
officerIT      5.14843    2.41761   2.130   0.0332 *  
officerNP      4.67258    2.49279   1.874   0.0609 .  
age            0.16102    0.03474   4.635 3.57e-06 ***
officerIT:age -0.09792    0.04290  -2.283   0.0225 *  
officerNP:age -0.09345    0.04412  -2.118   0.0342 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 218.83  on 216  degrees of freedom
Residual deviance: 146.22  on 211  degrees of freedom
  (33 observations deleted due to missingness)
AIC: 158.22

Number of Fisher Scoring iterations: 6

