

	####### B156905 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 2
 [1] "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(lsr, quietly = T)
[1] 3
 [1] "lsr"       "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 5
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
drinkdriving$age[drinkdriving$age < 17 | drinkdriving$age > 100] <- NA
[1] 6
drinkdriving$speed[drinkdriving$speed > 100] <- NA
[1] 7
drinkdriving$bac[drinkdriving$bac > 50] <- NA
[1] 8
table(drinkdriving$nighttime)
[1] 9

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "18:25" | drinkdriving$nighttime == 
    "2:05"] <- "night"
[1] 10
table(drinkdriving$prior_offence)
[1] 11

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20" | 
    drinkdriving$prior_offence == "TS70,DR50"] <- NA
[1] 12
table(drinkdriving$outcome)
[1] 13

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome == "Fine" | drinkdriving$outcome == 
    "FINE"] <- "fine"
[1] 14
drinkdriving$outcome[drinkdriving$outcome == "Warning" | drinkdriving$outcome == 
    "WARNING"] <- "warning"
[1] 15
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 16
drinkdriving$prior_offence <- factor(drinkdriving$prior_offence)
[1] 17
drinkdriving$outcome <- factor(drinkdriving$outcome)
[1] 18
sum(!complete.cases(drinkdriving))
[1] 19
[1] 45
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 20
par(mfrow = c(2, 2))
[1] 21
$mfrow
[1] 2 2

plot(m1, which = c(1:4))
[1] 22
summary(m1)
[1] 23

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.1959  -4.1261  -0.8169   4.0809  14.7662 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.11832    1.15626  24.318  < 2e-16 ***
age         -0.12660    0.02479  -5.107 7.37e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.834 on 208 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1114,	Adjusted R-squared:  0.1072 
F-statistic: 26.09 on 1 and 208 DF,  p-value: 7.366e-07

bac_pred <- predict(m1, newdata = data.frame(age = 50))
[1] 24
bac_pred

       1 
21.78828 


m1_residuals <- residuals(object = m1)
[1] 26
shapiro.test(m1_residuals)
[1] 27

	Shapiro-Wilk normality test

data:  m1_residuals
W = 0.99315, p-value = 0.4415

m_nighttime <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 28
summary(m_nighttime)
[1] 29

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.5793  -4.7183   0.3282   3.7481  14.3344 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    25.06303    1.27764  19.617  < 2e-16 ***
age            -0.11738    0.02369  -4.954 1.50e-06 ***
nighttimenight  3.89448    0.82547   4.718 4.38e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.557 on 207 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1977,	Adjusted R-squared:   0.19 
F-statistic: 25.51 on 2 and 207 DF,  p-value: 1.254e-10

m_speed <- lm(bac ~ age + speed, data = drinkdriving)
[1] 30
summary(m_speed)
[1] 31

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.2141  -3.9350  -0.6521   4.1645  14.3229 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 25.91438    2.83820   9.131  < 2e-16 ***
age         -0.10824    0.03289  -3.291  0.00117 ** 
speed        0.03698    0.04349   0.850  0.39608    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.838 on 207 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1145,	Adjusted R-squared:  0.106 
F-statistic: 13.39 on 2 and 207 DF,  p-value: 3.407e-06

par(mfrow = c(2, 2))
[1] 32
$mfrow
[1] 2 2

plot(m_nighttime, which = c(1:4))
[1] 33
plot(m_speed, which = c(1:4))
[1] 34
t.test(speed ~ nighttime, drinkdriving)
[1] 35

	Welch Two Sample t-test

data:  speed by nighttime
t = -1.616, df = 194.92, p-value = 0.1077
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -6.1490286  0.6104941
sample estimates:
  mean in group day mean in group night 
           38.25278            41.02205 

cohensD(speed ~ nighttime, drinkdriving, method = "unequal")
[1] 36
[1] 0.2085293
drinkdriving$fine <- ifelse(drinkdriving$outcome == "fine", 1, 
    0)
[1] 37
m_outc <- glm(fine ~ age + speed + bac + nighttime + prior_offence, 
    drinkdriving, family = binomial)
[1] 38
anova(m_outc, test = "Chisq")
[1] 39
Analysis of Deviance Table

Model: binomial, link: logit

Response: fine

Terms added sequentially (first to last)


              Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                            204    202.362              
age            1   74.241       203    128.121 < 2.2e-16 ***
speed          1   21.750       202    106.371 3.106e-06 ***
bac            1   22.421       201     83.949 2.189e-06 ***
nighttime      1    0.027       200     83.923    0.8703    
prior_offence  8   47.939       192     35.984 1.015e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m_outc)
[1] 40

Call:
glm(formula = fine ~ age + speed + bac + nighttime + prior_offence, 
    family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.9572   0.0001   0.0052   0.0582   2.0824  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)         25.23844 4248.49337   0.006 0.995260    
age                 -0.24897    0.07275  -3.422 0.000621 ***
speed                0.20475    0.06244   3.279 0.001041 ** 
bac                  0.47639    0.12462   3.823 0.000132 ***
nighttimenight      -0.25410    1.00664  -0.252 0.800714    
prior_offenceCD60  -54.24535 7784.24746  -0.007 0.994440    
prior_offenceDR50  -23.18438 4248.49148  -0.005 0.995646    
prior_offenceDR80  -34.00417 4248.49329  -0.008 0.993614    
prior_offenceN     -26.39639 4248.49146  -0.006 0.995043    
prior_offencePL10  -22.60908 4303.94623  -0.005 0.995809    
 [ reached getOption("max.print") -- omitted 3 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 202.362  on 204  degrees of freedom
Residual deviance:  35.984  on 192  degrees of freedom
  (45 observations deleted due to missingness)
AIC: 61.984

Number of Fisher Scoring iterations: 17

m_biggest <- glm(fine ~ scale(speed) + scale(bac), drinkdriving, 
    family = binomial)
[1] 41
anova(m_biggest, test = "Chisq")
[1] 42
Analysis of Deviance Table

Model: binomial, link: logit

Response: fine

Terms added sequentially (first to last)


             Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                           242     238.69              
scale(speed)  1   86.025       241     152.67 < 2.2e-16 ***
scale(bac)    1   22.540       240     130.13 2.058e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m_biggest)
[1] 43

Call:
glm(formula = fine ~ scale(speed) + scale(bac), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0812   0.0489   0.1875   0.4458   1.9536  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    2.7590     0.3589   7.687 1.51e-14 ***
scale(speed)   2.0667     0.3628   5.697 1.22e-08 ***
scale(bac)     1.1486     0.2737   4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 130.13  on 240  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 6

drinkdriving$nondrink_off <- as.character(drinkdriving$prior_offence)
[1] 44
drinkdriving$nondrink_off[drinkdriving$nondrink_off == "N"] <- NA
[1] 45
drinkdriving$nondrink_off[drinkdriving$nondrink_off != "DR50"] <- "nondrink"
[1] 46
drinkdriving$nondrink_off <- as.factor(drinkdriving$nondrink_off)
[1] 47
m_drink <- glm(fine ~ relevel(nondrink_off, "nondrink"), drinkdriving, 
    family = binomial)
[1] 48
anova(m_drink, test = "Chisq")
[1] 49
Analysis of Deviance Table

Model: binomial, link: logit

Response: fine

Terms added sequentially (first to last)


                                  Df Deviance Resid. Df Resid. Dev Pr(>Chi)  
NULL                                                 59     47.121           
relevel(nondrink_off, "nondrink")  1   4.7626        58     42.358  0.02908 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m_drink)
[1] 50

Call:
glm(formula = fine ~ relevel(nondrink_off, "nondrink"), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3076   0.3803   0.3803   0.3803   0.8346  

Coefficients:
                                      Estimate Std. Error z value Pr(>|z|)  
(Intercept)                             0.8755     0.5323   1.645   0.1000  
relevel(nondrink_off, "nondrink")DR50   1.7148     0.8010   2.141   0.0323 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 47.121  on 59  degrees of freedom
Residual deviance: 42.358  on 58  degrees of freedom
  (190 observations deleted due to missingness)
AIC: 46.358

Number of Fisher Scoring iterations: 5

drinkdriving$motor_off <- ifelse(drinkdriving$prior_offence == 
    "N", 0, 1)
[1] 51
m_motoroff <- glm(fine ~ motor_off, drinkdriving, family = binomial)
[1] 52
exp(coef((m_motoroff)))
[1] 53
(Intercept)   motor_off 
      4.000       1.625 
predict_df <- data.frame(age = drinkdriving$age, prior_offence = rep("N", 
    length(drinkdriving$age)), nighttime = rep("day", length(drinkdriving$age)), 
    speed = rep(30, length(drinkdriving$age)), bac = rep(0, length(drinkdriving$age)))
[1] 54
predict_df$p_Fine <- 1/(1 + exp(-predict(m_outc, predict_df)))
[1] 55
ggplot(data = predict_df, aes(x = age, y = p_Fine)) + geom_point() + 
    theme_minimal()
[1] 56
data5 <- merge(drinkdriving, officer_inc, all = T)
[1] 57
ggplot(data = data5, aes(x = age, y = fine)) + geom_point() + 
    facet_grid(. ~ officer) + theme_minimal()
[1] 58
if_biased <- glm(fine ~ age * relevel(officer, "AS"), data5, 
    family = binomial)
[1] 59
anova(if_biased, test = "Chisq")
[1] 60
Analysis of Deviance Table

Model: binomial, link: logit

Response: fine

Terms added sequentially (first to last)


                           Df Deviance Resid. Df Resid. Dev Pr(>Chi)    
NULL                                         216     218.83             
age                         1   64.297       215     154.53 1.07e-15 ***
relevel(officer, "AS")      2    0.874       213     153.66   0.6461    
age:relevel(officer, "AS")  2    7.434       211     146.22   0.0243 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(if_biased)
[1] 61

Call:
glm(formula = fine ~ age * relevel(officer, "AS"), family = binomial, 
    data = data5)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0757   0.3183   0.5638   2.4075  

Coefficients:
                             Estimate Std. Error z value Pr(>|z|)    
(Intercept)                   9.55712    2.00043   4.778 1.77e-06 ***
age                          -0.16102    0.03474  -4.635 3.57e-06 ***
relevel(officer, "AS")IT     -5.14843    2.41761  -2.130   0.0332 *  
relevel(officer, "AS")NP     -4.67258    2.49279  -1.874   0.0609 .  
age:relevel(officer, "AS")IT  0.09792    0.04290   2.283   0.0225 *  
age:relevel(officer, "AS")NP  0.09345    0.04412   2.118   0.0342 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 218.83  on 216  degrees of freedom
Residual deviance: 146.22  on 211  degrees of freedom
  (33 observations deleted due to missingness)
AIC: 158.22

Number of Fisher Scoring iterations: 6

