

	####### B149305 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(dplyr, quietly = T)
[1] 2
 [1] "dplyr"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
head(drinkdriving)
[1] 4
# A tibble: 6 x 7
    age nighttime prior_offence speed   bac outcome incident_id
  <dbl> <chr>     <chr>         <dbl> <dbl> <chr>   <chr>      
1    39 night     N             48.0   17.7 fine    inc_1      
2    28 day       N             43.8   22.1 fine    inc_2      
3    38 night     DR50          47.3   32.8 fine    inc_3      
4    51 night     N             17.2   20.5 warning inc_4      
5    56 night     N              1.95  29.4 warning inc_5      
6    36 day       N             41.4   19.1 fine    inc_6      
head(officer_inc)
[1] 5
  officer incident_id
1      AS     inc_189
2      IT      inc_50
3      IT     inc_159
4      AS     inc_178
5      IT     inc_184
6      AS     inc_198
drinkdriving = drinkdriving %>% mutate(nighttime = ifelse(nighttime == 
    "18:25", "day", nighttime), nighttime = ifelse(nighttime == 
    "2:05", "night", nighttime), nighttime = factor(nighttime), 
    outcome = factor(outcome, levels = c("warning", "fine")), 
    prior_offence1 = factor(ifelse(prior_offence == "DR50", 1, 
        0), labels = c("N", "DR50")), prior_offence2 = factor(ifelse(prior_offence == 
        "N", 0, 1), labels = c("N", "Motoring offence"))) %>% 
    filter(age < 100)
[1] 6
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 7
summary(m1)
[1] 8

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.719  -4.516  -0.861   3.849  42.785 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 29.29455    1.25564  23.330  < 2e-16 ***
age         -0.14353    0.02741  -5.236 3.86e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.82 on 218 degrees of freedom
  (5 observations deleted due to missingness)
Multiple R-squared:  0.1117,	Adjusted R-squared:  0.1076 
F-statistic: 27.41 on 1 and 218 DF,  p-value: 3.863e-07

par(mfrow = c(2, 2))
[1] 9
$mfrow
[1] 2 2

plot(m1)
[1] 10
test = tibble(age = 50)
[1] 11
pre = predict(m1, test)
[1] 12
paste("The predicted blood alcohol content for a 50 year old driver who gets stopped by the Police is", 
    round(pre, 3), "%")
[1] 13
[1] "The predicted blood alcohol content for a 50 year old driver who gets stopped by the Police is 22.118 %"
par(mfrow = c(1, 1))
[1] 14
$mfrow
[1] 2 2

plot(m1, which = 2)
[1] 15
m2 <- lm(bac ~ age + speed + nighttime, data = drinkdriving)
[1] 16
summary(m2)
[1] 17

Call:
lm(formula = bac ~ age + speed + nighttime, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-13.291  -4.650   0.136   3.971  33.088 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    14.15205    2.74426   5.157 5.67e-07 ***
age            -0.03148    0.03233  -0.974    0.331    
speed           0.19824    0.03853   5.145 6.00e-07 ***
nighttimenight  3.84615    0.90937   4.229 3.46e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.258 on 216 degrees of freedom
  (5 observations deleted due to missingness)
Multiple R-squared:  0.2587,	Adjusted R-squared:  0.2484 
F-statistic: 25.13 on 3 and 216 DF,  p-value: 5.5e-14

par(mfrow = c(2, 2))
[1] 18
$mfrow
[1] 1 1

plot(m2)
[1] 19
m3 <- lm(bac ~ age + speed + nighttime, data = drinkdriving[-c(140, 
    101), ])
[1] 20
summary(m3)
[1] 21

Call:
lm(formula = bac ~ age + speed + nighttime, data = drinkdriving[-c(140, 
    101), ])

Residuals:
     Min       1Q   Median       3Q      Max 
-15.7811  -4.6224   0.5195   3.7225  14.2190 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    22.99435    2.68293   8.571 2.06e-15 ***
age            -0.10600    0.03007  -3.525 0.000518 ***
speed           0.04340    0.03992   1.087 0.278151    
nighttimenight  3.92649    0.80461   4.880 2.07e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.505 on 214 degrees of freedom
  (5 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

par(mfrow = c(2, 2))
[1] 22
$mfrow
[1] 2 2

plot(m3)
[1] 23
aov(m3)
[1] 24
Call:
   aov(formula = m3)

Terms:
                     age    speed nighttime Residuals
Sum of Squares  1163.144   35.499   721.752  6485.867
Deg. of Freedom        1        1         1       214

Residual standard error: 5.505251
Estimated effects may be unbalanced
5 observations deleted due to missingness
total = 1688.138 + 181.235 + 699.097 + 6635.68
[1] 25
age = 1688.138
[1] 26
speed = 181.235
[1] 27
nighttime = 699.097
[1] 28
paste("Variation in blood alcohol content is", round(age/total * 
    100, 3), "%", "accounted for by drivers?? ages")
[1] 29
[1] "Variation in blood alcohol content is 18.341 % accounted for by drivers?? ages"
paste("Variation in blood alcohol content is", round(speed/total * 
    100, 3), "%", "accounted for by drivers?? speeds")
[1] 30
[1] "Variation in blood alcohol content is 1.969 % accounted for by drivers?? speeds"
paste("Variation in blood alcohol content is", round(nighttime/total * 
    100, 3), "%", "accounted for by time of day of incidents")
[1] 31
[1] "Variation in blood alcohol content is 7.595 % accounted for by time of day of incidents"
m4 <- lm(speed ~ nighttime, data = drinkdriving)
[1] 32
summary(m4)
[1] 33

Call:
lm(formula = speed ~ nighttime, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-39.248  -8.708   0.437   8.057  81.572 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)     38.7652     1.6803  23.071   <2e-16 ***
nighttimenight   0.4829     2.0310   0.238    0.812    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.16 on 223 degrees of freedom
Multiple R-squared:  0.0002535,	Adjusted R-squared:  -0.00423 
F-statistic: 0.05654 on 1 and 223 DF,  p-value: 0.8123

m5 = glm(outcome ~ speed + bac + age + nighttime + prior_offence1, 
    data = drinkdriving, family = "binomial")
[1] 34
summary(m5)
[1] 35

Call:
glm(formula = outcome ~ speed + bac + age + nighttime + prior_offence1, 
    family = "binomial", data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.3523   0.0147   0.0953   0.2891   2.6158  

Coefficients:
                   Estimate Std. Error z value Pr(>|z|)    
(Intercept)        -6.10781    2.67150  -2.286   0.0222 *  
speed               0.16588    0.04249   3.904 9.45e-05 ***
bac                 0.27296    0.06760   4.038 5.39e-05 ***
age                -0.05969    0.02393  -2.494   0.0126 *  
nighttimenight     -0.90816    0.71210  -1.275   0.2022    
prior_offence1DR50  2.24889    1.16440   1.931   0.0534 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 199.50  on 204  degrees of freedom
Residual deviance:  76.25  on 199  degrees of freedom
  (20 observations deleted due to missingness)
AIC: 88.25

Number of Fisher Scoring iterations: 7

paste("1~SD increase in driving speed has", round(exp(summary(m5)$coefficients[2, 
    1] * sd(drinkdriving$speed)), 3), "effect on the likelihood of receiving a fine")
[1] 36
[1] "1~SD increase in driving speed has 10.42 effect on the likelihood of receiving a fine"
paste("1~SD increase in blood alcohol content has", round(exp(summary(m5)$coefficients[3, 
    1] * sd(drinkdriving$bac, na.rm = T)), 3), "effect on the likelihood of receiving a fine")
[1] 37
[1] "1~SD increase in blood alcohol content has 7.175 effect on the likelihood of receiving a fine"
m6 = glm(outcome ~ prior_offence1, data = drinkdriving, family = "binomial")
[1] 38
summary(m6)
[1] 39

Call:
glm(formula = outcome ~ prior_offence1, family = "binomial", 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.2649   0.4001   0.6899   0.6899   0.6899  

Coefficients:
                   Estimate Std. Error z value Pr(>|z|)    
(Intercept)          1.3143     0.1877   7.001 2.54e-12 ***
prior_offence1DR50   1.1706     0.6296   1.859    0.063 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 201.17  on 208  degrees of freedom
Residual deviance: 196.69  on 207  degrees of freedom
  (16 observations deleted due to missingness)
AIC: 200.69

Number of Fisher Scoring iterations: 5

m7 = glm(outcome ~ prior_offence2, data = drinkdriving, family = "binomial")
[1] 40
summary(m7)
[1] 41

Call:
glm(formula = outcome ~ prior_offence2, family = "binomial", 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9817   0.5500   0.6754   0.6754   0.6754  

Coefficients:
                               Estimate Std. Error z value Pr(>|z|)    
(Intercept)                      1.3618     0.2013   6.765 1.33e-11 ***
prior_offence2Motoring offence   0.4506     0.4312   1.045    0.296    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 201.17  on 208  degrees of freedom
Residual deviance: 200.01  on 207  degrees of freedom
  (16 observations deleted due to missingness)
AIC: 204.01

Number of Fisher Scoring iterations: 4

test = tibble(age = seq(min(drinkdriving$age), max(drinkdriving$age)), 
    prior_offence1 = "N", nighttime = "day", speed = 30, bac = 0)
[1] 42
test$model_prediction = predict(m5, test, type = c("response"))
[1] 43
ggplot(test, aes(age, model_prediction)) + geom_point() + labs(title = "Plotting predicted probabilities", 
    x = "Age", y = "Model prediction")
[1] 44
all = merge(drinkdriving, officer_inc, by = "incident_id")
[1] 45
all$officer = factor(all$officer, levels = c("AS", "IT", "NP"))
[1] 46
m8 = glm(outcome ~ age * officer, data = all, family = "binomial")
[1] 47
summary(m8)
[1] 48

Call:
glm(formula = outcome ~ age * officer, family = "binomial", data = all)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-3.02409   0.04627   0.23355   0.50449   2.43558  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)   10.99258    2.66413   4.126 3.69e-05 ***
age           -0.18059    0.04433  -4.074 4.62e-05 ***
officerIT     -6.40267    2.99427  -2.138   0.0325 *  
officerNP     -4.83842    3.25035  -1.489   0.1366    
age:officerIT  0.11607    0.05096   2.278   0.0227 *  
age:officerNP  0.09215    0.05503   1.675   0.0940 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 201.17  on 208  degrees of freedom
Residual deviance: 126.21  on 203  degrees of freedom
  (16 observations deleted due to missingness)
AIC: 138.21

Number of Fisher Scoring iterations: 7

all$officer = factor(all$officer, levels = c("IT", "AS", "NP"))
[1] 49
m9 = glm(outcome ~ age * officer, data = all, family = "binomial")
[1] 50
summary(m9)
[1] 51

Call:
glm(formula = outcome ~ age * officer, family = "binomial", data = all)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-3.02409   0.04627   0.23355   0.50449   2.43558  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    4.58992    1.36677   3.358 0.000784 ***
age           -0.06452    0.02514  -2.566 0.010274 *  
officerAS      6.40267    2.99427   2.138 0.032492 *  
officerNP      1.56425    2.30981   0.677 0.498267    
age:officerAS -0.11607    0.05096  -2.278 0.022741 *  
age:officerNP -0.02393    0.04117  -0.581 0.561182    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 201.17  on 208  degrees of freedom
Residual deviance: 126.21  on 203  degrees of freedom
  (16 observations deleted due to missingness)
AIC: 138.21

Number of Fisher Scoring iterations: 7

all$officer = factor(all$officer, levels = c("NP", "IT", "AS"))
[1] 52
m10 = glm(outcome ~ age * officer, data = all, family = "binomial")
[1] 53
summary(m10)
[1] 54

Call:
glm(formula = outcome ~ age * officer, family = "binomial", data = all)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-3.02409   0.04627   0.23355   0.50449   2.43558  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    6.15416    1.86204   3.305  0.00095 ***
age           -0.08844    0.03261  -2.712  0.00668 ** 
officerIT     -1.56425    2.30981  -0.677  0.49827    
officerAS      4.83842    3.25035   1.489  0.13660    
age:officerIT  0.02393    0.04117   0.581  0.56118    
age:officerAS -0.09215    0.05503  -1.675  0.09402 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 201.17  on 208  degrees of freedom
Residual deviance: 126.21  on 203  degrees of freedom
  (16 observations deleted due to missingness)
AIC: 138.21

Number of Fisher Scoring iterations: 7

paste("The estimate of age is", round(summary(m8)$coefficients[2, 
    1], 3), "when officer is AS")
[1] 55
[1] "The estimate of age is -0.181 when officer is AS"
paste("The estimate of age is", round(summary(m8)$coefficients[5, 
    1] + summary(m8)$coefficients[2, 1], 3), "when officer is IT")
[1] 56
[1] "The estimate of age is -0.065 when officer is IT"
paste("The estimate of age is", round(summary(m8)$coefficients[6, 
    1] + summary(m8)$coefficients[2, 1], 3), "when officer is NP")
[1] 57
[1] "The estimate of age is -0.088 when officer is NP"
