

	####### B081610 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 2
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
library(lsr, quietly = T)
[1] 3
 [1] "lsr"       "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
library(lmtest, quietly = T)
[1] 4
 [1] "lmtest"    "zoo"       "lsr"       "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices"
[11] "utils"     "datasets"  "methods"   "base"     
library(stats, quietly = T)
[1] 5
 [1] "lmtest"    "zoo"       "lsr"       "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices"
[11] "utils"     "datasets"  "methods"   "base"     
library(ggplot2, quietly = T)
[1] 6
 [1] "ggplot2"   "lmtest"    "zoo"       "lsr"       "car"       "carData"   "psych"     "readr"     "stats"     "graphics" 
[11] "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 7
[1] "drinkdriving" "officer_inc" 
describe(drinkdriving$age)
[1] 8
   vars   n mean    sd median trimmed   mad min max range skew kurtosis   se
X1    1 228   46 33.35   40.5   42.34 18.53  14 297   283  5.5    38.49 2.21
which(drinkdriving$age > 100)
[1] 9
[1]  51 114 224
drinkdriving$age[which(drinkdriving$age > 100)] <- NA
[1] 10
table(drinkdriving$nighttime)
[1] 11

18:25  2:05   day night 
    1     2    78   169 
which(!(drinkdriving$nighttime == "night" | drinkdriving$nighttime == 
    "day"))
[1] 12
[1]  54 241 246
drinkdriving$nighttime[which(!(drinkdriving$nighttime == "night" | 
    drinkdriving$nighttime == "day"))] <- NA
[1] 13
table(drinkdriving$prior_offence)
[1] 14

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
which(drinkdriving$prior_offence == "DD20")
[1] 15
[1]  29  85 118 233
drinkdriving$prior_offence[which(drinkdriving$prior_offence == 
    "DD20")] <- NA
[1] 16
describe(drinkdriving$speed)
[1] 17
   vars   n  mean    sd median trimmed   mad min    max  range skew kurtosis   se
X1    1 250 40.49 14.91  40.64    40.3 12.94   0 120.34 120.34  0.5     2.83 0.94
which(drinkdriving$speed < 1 | drinkdriving$speed > 100)
[1] 18
[1] 110 161
drinkdriving$speed[which(drinkdriving$speed < 1 | drinkdriving$speed > 
    100)] <- NA
[1] 19
describe(drinkdriving$bac)
[1] 20
   vars   n mean   sd median trimmed  mad  min   max range skew kurtosis   se
X1    1 245 23.6 7.49  23.61   23.62 6.44 3.99 65.76 61.78 0.77      4.7 0.48
drinkdriving$bac <- drinkdriving$bac/100
[1] 21
which(drinkdriving$bac > 0.4)
[1] 22
[1] 110 154
drinkdriving$bac[which(drinkdriving$bac > 0.4)] <- NA
[1] 23
table(drinkdriving$outcome)
[1] 24

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
which(drinkdriving$outcome == "Fine" | drinkdriving$outcome == 
    "FINE")
[1] 25
 [1]  12  24 110 141 152 159 166 170 178 220 234
drinkdriving$outcome[which(drinkdriving$outcome == "Fine" | drinkdriving$outcome == 
    "FINE")] <- "fine"
[1] 26
which(drinkdriving$outcome == "Warning" | drinkdriving$outcome == 
    "WARNING")
[1] 27
[1]  11  97 120 123 244
drinkdriving$outcome[which(drinkdriving$outcome == "Warning" | 
    drinkdriving$outcome == "WARNING")] <- "warning"
[1] 28
table(drinkdriving$incident_id)
[1] 29

  inc_1  inc_10 inc_100 inc_101 inc_102 inc_103 inc_104 inc_105 inc_106 inc_107 inc_108 inc_109  inc_11 inc_110 inc_111 inc_112 
      1       1       1       1       1       1       1       1       1       1       1       1       1       1       1       1 
inc_113 inc_114 inc_115 inc_116 inc_117 inc_118 inc_119  inc_12 inc_120 inc_121 inc_122 inc_123 inc_124 inc_125 inc_126 inc_127 
      1       1       1       1       1       1       1       1       1       1       1       1       1       1       1       1 
inc_128 inc_129  inc_13 inc_130 inc_131 inc_132 inc_133 inc_134 inc_135 inc_136 inc_137 inc_138 inc_139  inc_14 inc_140 inc_141 
      1       1       1       1       1       1       1       1       1       1       1       1       1       1       1       1 
inc_142 inc_143 
      1       1 
 [ reached getOption("max.print") -- omitted 200 entries ]
table(officer_inc$officer)
[1] 30

 AS  IT  NP 
116  66  67 
drinkdriving <- merge(drinkdriving, officer_inc, all = T)
[1] 31
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 32
drinkdriving$dummy_nighttime <- as.factor(as.numeric(drinkdriving$nighttime == 
    "night"))
[1] 33
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 34
drinkdriving$officer <- as.factor(drinkdriving$officer)
[1] 35
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 36
par(mfrow = c(2, 2))
[1] 37
$mfrow
[1] 1 1

plot(m1, which = c(1:4))
[1] 38
summary(m1)
[1] 39

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2868503  0.0106949   26.82  < 2e-16 ***
age         -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

standardCoefs(m1)
[1] 40
               b       beta
age -0.001373039 -0.3719763
-0.001373039 * 50 + 0.2868503
[1] 41
[1] 0.2181983
par(mfrow = c(1, 1))
[1] 42
$mfrow
[1] 2 2

qqPlot(m1)
[1] 43
drinkdriving$age_min <- drinkdriving$age - (min(drinkdriving$age, 
    na.rm = T))
[1] 44
m2 <- lm(bac ~ age_min + dummy_nighttime, data = drinkdriving)
[1] 45
summary(m2)
[1] 46

Call:
lm(formula = bac ~ age_min + dummy_nighttime, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.163421 -0.043987  0.002997  0.037390  0.144090 

Coefficients:
                   Estimate Std. Error t value Pr(>|t|)    
(Intercept)       0.2408689  0.0094231  25.562  < 2e-16 ***
age_min          -0.0013690  0.0002209  -6.199 2.91e-09 ***
dummy_nighttime1  0.0386857  0.0079364   4.874 2.13e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05417 on 213 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.2422,	Adjusted R-squared:  0.235 
F-statistic: 34.03 on 2 and 213 DF,  p-value: 1.498e-13

anova(m2)
[1] 47
Analysis of Variance Table

Response: bac
                 Df  Sum Sq  Mean Sq F value    Pr(>F)    
age_min           1 0.13000 0.129999  44.298 2.349e-10 ***
dummy_nighttime   1 0.06973 0.069727  23.760 2.131e-06 ***
Residuals       213 0.62508 0.002935                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
standardCoefs(m2)
[1] 48
                            b       beta
age_min          -0.001368982 -0.3711892
dummy_nighttime1  0.038685730  0.2918985
m3 <- lm(bac ~ age_min + speed, data = drinkdriving)
[1] 49
summary(m3)
[1] 50

Call:
lm(formula = bac ~ age_min + speed, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.154126 -0.039597 -0.005979  0.040894  0.143787 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2411824  0.0242263   9.955  < 2e-16 ***
age_min     -0.0011272  0.0003188  -3.536 0.000498 ***
speed        0.0004991  0.0004329   1.153 0.250202    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05798 on 214 degrees of freedom
  (33 observations deleted due to missingness)
Multiple R-squared:  0.1442,	Adjusted R-squared:  0.1362 
F-statistic: 18.03 on 2 and 214 DF,  p-value: 5.782e-08

anova(m3)
[1] 51
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age_min     1 0.11677 0.116770 34.7384 1.452e-08 ***
speed       1 0.00447 0.004469  1.3294    0.2502    
Residuals 214 0.71934 0.003361                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
standardCoefs(m3)
[1] 52
                    b        beta
age_min -0.0011271764 -0.30505812
speed    0.0004990934  0.09946571
par(mfrow = c(2, 2))
[1] 53
$mfrow
[1] 1 1

plot(m2, which = c(1:4))
[1] 54
shapiro.test(m2$residuals)
[1] 55

	Shapiro-Wilk normality test

data:  m2$residuals
W = 0.99085, p-value = 0.1914

par(mfrow = c(2, 2))
[1] 56
$mfrow
[1] 2 2

plot(m3, which = c(1:4))
[1] 57
par(mfrow = c(1, 1))
[1] 58
$mfrow
[1] 2 2

plot(drinkdriving$nighttime, drinkdriving$speed, xlab = "Time of Day", 
    ylab = "Speed", col = "pink")
[1] 59
t_test_time_speed <- t.test(speed ~ nighttime, data = drinkdriving, 
    alternative = "less")
[1] 60
t_test_time_speed


	Welch Two Sample t-test

data:  speed by nighttime
t = -1.6636, df = 192.84, p-value = 0.04891
alternative hypothesis: true difference in means is less than 0
95 percent confidence interval:
        -Inf -0.01846594
sample estimates:
  mean in group day mean in group night 
           38.25278            41.09606 



describe(drinkdriving$speed)
[1] 62
   vars   n  mean    sd median trimmed   mad  min   max range  skew kurtosis   se
X1    1 248 40.33 13.85  40.64    40.3 12.68 1.01 81.03 80.02 -0.01     0.15 0.88
leveneTest(y = drinkdriving$speed, group = drinkdriving$nighttime)
[1] 63
Levene's Test for Homogeneity of Variance (center = median)
       Df F value  Pr(>F)  
group   1   6.202 0.01343 *
      243                  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m4 <- glm(outcome ~ scale(speed) + scale(bac), data = drinkdriving, 
    family = binomial)
[1] 64
alt_model <- glm(outcome ~ scale(bac) + scale(speed), data = drinkdriving, 
    family = binomial)
[1] 65
summary(m4)
[1] 66

Call:
glm(formula = outcome ~ scale(speed) + scale(bac), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9505  -0.4478  -0.1902  -0.0515   4.0751  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.7771     0.3617  -7.677 1.62e-14 ***
scale(speed)  -2.0241     0.3605  -5.614 1.97e-08 ***
scale(bac)    -1.1490     0.2734  -4.203 2.64e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 235.39  on 241  degrees of freedom
Residual deviance: 130.04  on 239  degrees of freedom
  (8 observations deleted due to missingness)
AIC: 136.04

Number of Fisher Scoring iterations: 6

summary(alt_model)
[1] 67

Call:
glm(formula = outcome ~ scale(bac) + scale(speed), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9505  -0.4478  -0.1902  -0.0515   4.0751  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.7771     0.3617  -7.677 1.62e-14 ***
scale(bac)    -1.1490     0.2734  -4.203 2.64e-05 ***
scale(speed)  -2.0241     0.3605  -5.614 1.97e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 235.39  on 241  degrees of freedom
Residual deviance: 130.04  on 239  degrees of freedom
  (8 observations deleted due to missingness)
AIC: 136.04

Number of Fisher Scoring iterations: 6

anova(m4, test = "Chisq")
[1] 68
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


             Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                           241     235.39              
scale(speed)  1   82.762       240     152.63 < 2.2e-16 ***
scale(bac)    1   22.589       239     130.04 2.006e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
drinkdriving$drink_offence <- drinkdriving$prior_offence
[1] 69
drinkdriving$drink_offence[which(drinkdriving$drink_offence == 
    "DR50" | drinkdriving$drink_offence == "TS70,DR50")] <- "drink"
[1] 70
drinkdriving$drink_offence[which(drinkdriving$drink_offence == 
    "CD10" | drinkdriving$drink_offence == "CD60" | drinkdriving$drink_offence == 
    "CD60,CD10,DR80" | drinkdriving$drink_offence == "CD60,CD60" | 
    drinkdriving$drink_offence == "DR80" | drinkdriving$drink_offence == 
    "PL10" | drinkdriving$drink_offence == "SP50" | drinkdriving$drink_offence == 
    "SP60" | drinkdriving$drink_offence == "TS70")] <- "other"
[1] 71
drinkdriving$drink_offence[which(drinkdriving$drink_offence == 
    "N")] <- "none"
[1] 72
drinkdriving$drink_offence <- as.factor(drinkdriving$drink_offence)
[1] 73
m5 <- glm(outcome ~ drink_offence, data = drinkdriving, family = binomial)
[1] 74
summary(m5)
[1] 75

Call:
glm(formula = outcome ~ drink_offence, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.8346  -0.6681  -0.6681  -0.4366   2.1899  

Coefficients:
                   Estimate Std. Error z value Pr(>|z|)    
(Intercept)         -2.3026     0.5243  -4.392 1.12e-05 ***
drink_offencenone    0.9163     0.5556   1.649   0.0991 .  
drink_offenceother   1.4271     0.7471   1.910   0.0561 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 232.55  on 243  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 238.55

Number of Fisher Scoring iterations: 4

anova(m5, test = "Chisq")
[1] 76
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


              Df Deviance Resid. Df Resid. Dev Pr(>Chi)
NULL                            245     237.06         
drink_offence  2   4.5072       243     232.55    0.105
drinkdriving$any_offence <- ifelse(drinkdriving$prior_offence == 
    "N", 0, 1)
[1] 77
m6 <- glm(outcome ~ any_offence, data = drinkdriving, family = binomial)
[1] 78
summary(m6)
[1] 79

Call:
glm(formula = outcome ~ any_offence, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.6681  -0.6681  -0.6681  -0.5650   1.9564  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  -1.3863     0.1838  -7.542 4.62e-14 ***
any_offence  -0.3677     0.4051  -0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

anova(m6, test = "Chisq")
[1] 80
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


            Df Deviance Resid. Df Resid. Dev Pr(>Chi)
NULL                          245     237.06         
any_offence  1  0.86504       244     236.20   0.3523
prediction_model <- glm(outcome ~ speed + bac + any_offence + 
    nighttime + age, data = drinkdriving, family = binomial)
[1] 81
summary(prediction_model)
[1] 82

Call:
glm(formula = outcome ~ speed + bac + any_offence + nighttime + 
    age, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.2729  -0.2980  -0.0894  -0.0150   4.1717  

Coefficients:
                Estimate Std. Error z value Pr(>|z|)    
(Intercept)      4.61830    2.61190   1.768 0.077032 .  
speed           -0.15410    0.04151  -3.712 0.000205 ***
bac            -23.22736    6.23806  -3.723 0.000196 ***
any_offence     -1.15323    0.77696  -1.484 0.137733    
nighttimenight   0.07056    0.64111   0.110 0.912361    
age              0.07477    0.02561   2.919 0.003508 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 204.925  on 210  degrees of freedom
Residual deviance:  81.452  on 205  degrees of freedom
  (39 observations deleted due to missingness)
AIC: 93.452

Number of Fisher Scoring iterations: 7

anova(prediction_model, test = "Chisq")
[1] 83
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


            Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                          210    204.925              
speed        1   82.147       209    122.778 < 2.2e-16 ***
bac          1   28.811       208     93.967 7.981e-08 ***
any_offence  1    2.556       207     91.412  0.109908    
nighttime    1    0.441       206     90.970  0.506423    
age          1    9.518       205     81.452  0.002034 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
new_data <- data.frame(speed = 30, bac = 0, any_offence = 0, 
    nighttime = "day", age = 14:100)
[1] 84
predictions <- predict.glm(prediction_model, newdata = new_data, 
    type = "response")
[1] 85
plot(x = new_data$age, y = predictions, xlab = "Age", ylab = "Probability of fine versus warning", 
    main = "Predicted probabilities of  fines versus warnings", 
    col = "purple")
[1] 86
drinkdriving$officer <- as.factor(drinkdriving$officer)
[1] 87
contrasts(drinkdriving$officer)
[1] 88
   IT NP
AS  0  0
IT  1  0
NP  0  1
ggplot() + geom_col(drinkdriving, mapping = aes(x = outcome, 
    y = age, fill = officer), position = "dodge") + xlab("Outcome") + 
    ylab("Age") + labs(title = "Outcome by Age and Officer")
[1] 89
officer_model <- glm(outcome ~ age_min * officer, data = drinkdriving, 
    family = binomial)
[1] 90
summary(officer_model)
[1] 91

Call:
glm(formula = outcome ~ age_min * officer, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4089  -0.5454  -0.2741  -0.0642   2.7179  

Coefficients:
                  Estimate Std. Error z value Pr(>|z|)    
(Intercept)       -7.31207    1.52084  -4.808 1.53e-06 ***
age_min            0.16122    0.03466   4.652 3.29e-06 ***
officerIT          3.69964    1.81899   2.034   0.0420 *  
officerNP          3.37352    1.89046   1.784   0.0743 .  
age_min:officerIT -0.09612    0.04254  -2.260   0.0238 *  
age_min:officerNP -0.09365    0.04405  -2.126   0.0335 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

