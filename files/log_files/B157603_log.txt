

	####### B157603 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 2
 [1] "car"       "carData"   "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
library(lsr, quietly = T)
[1] 3
 [1] "lsr"       "car"       "carData"   "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
table(drinkdriving$nighttime)
[1] 5

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- NA
[1] 6
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- NA
[1] 7
table(drinkdriving$age)
[1] 8

14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 
 1  5  2  3  1  2  3  6  2  5  8  3  2  2  5  4  4  4  6  5  9  8  3  4  2 10  5  6  5  3  2  3  4  5  2  3  3  3  6  3  5  4  3  4  4 
59 60 61 62 63 
 1  5  3  3  2 
 [ reached getOption("max.print") -- omitted 15 entries ]
drinkdriving$age[drinkdriving$age > 100 | drinkdriving$age < 
    17] <- NA
[1] 9
table(drinkdriving$outcome)
[1] 10

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 11
class(drinkdriving$nighttime)
[1] 12
[1] "character"
class(drinkdriving$prior_offence)
[1] 13
[1] "character"
class(drinkdriving$outcome)
[1] 14
[1] "character"
class(drinkdriving$incident_id)
[1] 15
[1] "character"
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 16
drinkdriving$prior_offence <- factor(drinkdriving$prior_offence)
[1] 17
drinkdriving$outcome <- factor(drinkdriving$outcome, levels = c("warning", 
    "fine"))
[1] 18
drinkdriving$incident_id <- factor(drinkdriving$incident_id)
[1] 19
drinkdriving$speed[drinkdriving$speed > mean(drinkdriving$speed, 
    na.rm = TRUE) + 3 * sd(drinkdriving$speed, na.rm = TRUE)] <- NA
[1] 20
drinkdriving$speed[drinkdriving$speed < mean(drinkdriving$speed, 
    na.rm = TRUE) - 3 * sd(drinkdriving$speed, na.rm = TRUE)] <- NA
[1] 21
drinkdriving$bac[drinkdriving$bac > mean(drinkdriving$bac, na.rm = TRUE) + 
    3 * sd(drinkdriving$bac, na.rm = TRUE)] <- NA
[1] 22
drinkdriving$bac[drinkdriving$bac < mean(drinkdriving$bac, na.rm = TRUE) - 
    3 * sd(drinkdriving$bac, na.rm = TRUE)] <- NA
[1] 23
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 24
standardCoefs(m1)
[1] 25
             b       beta
age -0.1266009 -0.3338234
summary(m1)
[1] 26

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.1959  -4.1261  -0.8169   4.0809  14.7662 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.11832    1.15626  24.318  < 2e-16 ***
age         -0.12660    0.02479  -5.107 7.37e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.834 on 208 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1114,	Adjusted R-squared:  0.1072 
F-statistic: 26.09 on 1 and 208 DF,  p-value: 7.366e-07

par(mfrow = c(2, 2))
[1] 27
$mfrow
[1] 2 2

plot(x = m1, which = c(1, 2, 3, 4))
[1] 28
new_age <- data.frame(age = 50)
[1] 29
predict(m1, newdata = new_age)
[1] 30
       1 
21.78828 
par(mfrow = c(1, 1))
[1] 31
$mfrow
[1] 2 2

plot(x = m1, which = 2)
[1] 32
m2 <- lm(bac ~ age + nighttime + speed, data = drinkdriving)
[1] 33
standardCoefs(m2)
[1] 34
                         b        beta
age            -0.10976461 -0.28963828
nighttimenight  3.84112332  0.29300440
speed           0.03460276  0.06919742
summary(m2)
[1] 35

Call:
lm(formula = bac ~ age + nighttime + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.8025  -4.6305   0.3901   3.6552  14.2937 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    23.43823    2.76130   8.488 4.31e-15 ***
age            -0.10976    0.03123  -3.515 0.000542 ***
nighttimenight  3.84112    0.81499   4.713 4.51e-06 ***
speed           0.03460    0.04111   0.842 0.400888    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.472 on 204 degrees of freedom
  (42 observations deleted due to missingness)
Multiple R-squared:  0.2173,	Adjusted R-squared:  0.2058 
F-statistic: 18.88 on 3 and 204 DF,  p-value: 7.585e-11

anova(m2)
[1] 36
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1011.9 1011.85 33.7880 2.340e-08 ***
nighttime   1  663.2  663.20 22.1458 4.658e-06 ***
speed       1   21.2   21.22  0.7086    0.4009    
Residuals 204 6109.2   29.95                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m2 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 37
par(mfrow = c(2, 2))
[1] 38
$mfrow
[1] 1 1

plot(x = m2, which = c(1, 2, 3, 4))
[1] 39
summary(m2)
[1] 40

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3916  -4.7154   0.2886   3.6969  14.3952 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    25.50352    1.26617  20.142  < 2e-16 ***
age            -0.12702    0.02354  -5.395 1.88e-07 ***
nighttimenight  3.83516    0.81438   4.709 4.58e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.468 on 205 degrees of freedom
  (42 observations deleted due to missingness)
Multiple R-squared:  0.2146,	Adjusted R-squared:  0.2069 
F-statistic: 28.01 on 2 and 205 DF,  p-value: 1.765e-11

t.test(formula = speed ~ nighttime, data = drinkdriving)
[1] 41

	Welch Two Sample t-test

data:  speed by nighttime
t = -1.5101, df = 195.84, p-value = 0.1326
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.9957683  0.7955574
sample estimates:
  mean in group day mean in group night 
           38.25278            40.85289 

m3 <- glm(outcome ~ age + nighttime + prior_offence + speed + 
    bac, data = drinkdriving, family = "binomial")
[1] 42
summary(m3)
[1] 43

Call:
glm(formula = outcome ~ age + nighttime + prior_offence + speed + 
    bac, family = "binomial", data = drinkdriving)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-3.15020   0.00222   0.04038   0.22210   3.01248  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)              20.72331 4327.46319   0.005 0.996179    
age                      -0.13782    0.03775  -3.650 0.000262 ***
nighttimenight           -0.69681    0.77688  -0.897 0.369757    
prior_offenceCD60       -46.80119 7827.62717  -0.006 0.995229    
prior_offenceDD20       -28.74057 4327.46296  -0.007 0.994701    
prior_offenceDR50       -20.28411 4327.46238  -0.005 0.996260    
prior_offenceDR80       -27.37298 4327.46295  -0.006 0.994953    
prior_offenceN          -22.88043 4327.46228  -0.005 0.995781    
prior_offencePL10       -20.82269 4327.72434  -0.005 0.996161    
prior_offenceSP50       -11.17800 6032.73069  -0.002 0.998522    
 [ reached getOption("max.print") -- omitted 5 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 211.99  on 207  degrees of freedom
Residual deviance:  62.07  on 193  degrees of freedom
  (42 observations deleted due to missingness)
AIC: 92.07

Number of Fisher Scoring iterations: 17

drinkdriving$prior_offence_label <- ifelse(drinkdriving$prior_offence == 
    "N", "NONE", ifelse(drinkdriving$prior_offence %in% c("DR50", 
    "TS70,DR50"), "DRINK", "ELSE"))
[1] 44
drinkdriving$prior_offence_label <- factor(drinkdriving$prior_offence_label)
[1] 45
contrasts(drinkdriving$prior_offence_label) <- cbind(DRINKvELSE = c(1/2, 
    -1/2, 0), DRINKELSEvNONE = c(1/3, 1/3, -2/3))
[1] 46
table(drinkdriving$prior_offence)
[1] 47

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
m4 <- glm(outcome ~ prior_offence_label, data = drinkdriving, 
    family = "binomial")
[1] 48
summary(m4)
[1] 49

Call:
glm(formula = outcome ~ prior_offence_label, family = "binomial", 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1899   0.4366   0.6681   0.6681   0.9005  

Coefficients:
                                  Estimate Std. Error z value Pr(>|z|)    
(Intercept)                         1.4607     0.2411   6.060 1.36e-09 ***
prior_offence_labelDRINKvELSE       1.6094     0.6994   2.301   0.0214 *  
prior_offence_labelDRINKELSEvNONE   0.1116     0.3951   0.282   0.7776    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 238.69  on 247  degrees of freedom
AIC: 244.69

Number of Fisher Scoring iterations: 4

newxx <- data.frame(age = 17:100, nighttime = as.factor(rep("day", 
    84)), speed = rep(30, 84), bac = rep(0, 84), prior_offence = as.factor(rep("N", 
    84)))
[1] 50
predict(m3, newdata = newxx, type = "response")
[1] 51
           1            2            3            4            5            6            7            8            9           10 
0.4227908630 0.3895639592 0.3573317768 0.3263407451 0.2967962486 0.2688589981 0.2426440669 0.2182223008 0.1956236485 0.1748418730 
          11           12           13           14           15           16           17           18           19           20 
0.1558400929 0.1385566591 0.1229109517 0.1088087933 0.0961472752 0.0848188864 0.0747149119 0.0657281201 0.0577547989 0.0506962179 
          21           22           23           24           25           26           27           28           29           30 
0.0444596059 0.0389587311 0.0341141669 0.0298533165 0.0261102591 0.0228254704 0.0199454597 0.0174223564 0.0152134714 0.0132808535 
          31           32           33           34           35           36           37           38           39           40 
0.0115908529 0.0101137021 0.0088231206 0.0076959463 0.0067117960 0.0058527556 0.0051030987 0.0044490327 0.0038784717 0.0033808332 
          41           42           43           44           45           46           47           48           49           50 
0.0029468568 0.0025684436 0.0022385143 0.0019508832 0.0017001473 0.0014815893 0.0012910911 0.0011250590 0.0009803574 0.0008542509 
 [ reached getOption("max.print") -- omitted 34 entries ]
par(mfrow = c(1, 1))
[1] 52
$mfrow
[1] 2 2

plot(x = 17:100, y = predict(m3, newdata = newxx, type = "response"), 
    xlab = "Age", ylab = "Probability of receiving a fine")
[1] 53
drinkdriving$incident_id <- drinkdriving$incident_id[order(drinkdriving$incident_id)]
[1] 54
officer_inc$incident_id <- officer_inc$incident_id[order(officer_inc$incident_id)]
[1] 55
drinkdriving <- data.frame(drinkdriving, officer = officer_inc$officer)
[1] 56
m5 <- glm(outcome ~ age, data = drinkdriving[drinkdriving$officer == 
    "AS", ], family = "binomial")
[1] 57
m6 <- glm(outcome ~ age, data = drinkdriving[drinkdriving$officer == 
    "IT", ], family = "binomial")
[1] 58
m7 <- glm(outcome ~ age, data = drinkdriving[drinkdriving$officer == 
    "NP", ], family = "binomial")
[1] 59
summary(m5)
[1] 60

Call:
glm(formula = outcome ~ age, family = "binomial", data = drinkdriving[drinkdriving$officer == 
    "AS", ])

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.1481   0.1411   0.3117   0.5228   1.7388  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  6.84288    1.38998   4.923 8.52e-07 ***
age         -0.10526    0.02448  -4.300 1.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 100.963  on 101  degrees of freedom
Residual deviance:  69.965  on 100  degrees of freedom
  (15 observations deleted due to missingness)
AIC: 73.965

Number of Fisher Scoring iterations: 5

summary(m6)
[1] 61

Call:
glm(formula = outcome ~ age, family = "binomial", data = drinkdriving[drinkdriving$officer == 
    "IT", ])

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7991   0.1759   0.3130   0.4542   2.3537  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  6.45326    1.76566   3.655 0.000257 ***
age         -0.10649    0.03304  -3.223 0.001270 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 54.593  on 53  degrees of freedom
Residual deviance: 37.755  on 52  degrees of freedom
  (13 observations deleted due to missingness)
AIC: 41.755

Number of Fisher Scoring iterations: 5

summary(m7)
[1] 62

Call:
glm(formula = outcome ~ age, family = "binomial", data = drinkdriving[drinkdriving$officer == 
    "NP", ])

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.5587   0.1890   0.3197   0.5090   1.5064  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  5.88893    1.50158   3.922 8.79e-05 ***
age         -0.09479    0.02723  -3.481    5e-04 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 62.719  on 59  degrees of freedom
Residual deviance: 44.530  on 58  degrees of freedom
  (8 observations deleted due to missingness)
AIC: 48.53

Number of Fisher Scoring iterations: 5

