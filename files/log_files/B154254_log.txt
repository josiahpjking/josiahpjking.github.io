

	####### B154254 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(modelr, quietly = T)
[1] 2
 [1] "modelr"    "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
outliers <- function(obs, x = 3) {
    return(abs(obs - mean(obs, na.rm = T)) > (sd(obs, na.rm = T) * 
        x))
}
[1] 3
bundle_offs <- function(data) {
    if (grepl("N", data)) {
        return("none")
    }
    else if (grepl("DR50", data)) {
        return("drink")
    }
    else {
        return("other")
    }
}
[1] 4
load(url("https://edin.ac/2QCZNVu"))
[1] 5
[1] "drinkdriving" "officer_inc" 
drinkdriving$age[drinkdriving$age > 120] <- NA
[1] 6
drinkdriving$age[drinkdriving$age < 12] <- NA
[1] 7
drinkdriving$nighttime[drinkdriving$nighttime == "night"] <- TRUE
[1] 8
drinkdriving$nighttime[drinkdriving$nighttime == "day"] <- FALSE
[1] 9
drinkdriving$nighttime <- as.logical(drinkdriving$nighttime)
[1] 10
drinkdriving$prior_three <- sapply(drinkdriving$prior_offence, 
    bundle_offs)
[1] 11
drinkdriving$prior_three <- as.factor(drinkdriving$prior_three)
[1] 12
drinkdriving$prior_yesno <- ifelse(drinkdriving$prior_three == 
    "none", F, T)
[1] 13
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 14
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 15
drinkdriving$bac[which(outliers(drinkdriving$bac))] <- NA
[1] 16
drinkdriving$incident_id <- as.factor(drinkdriving$incident_id)
[1] 17
drinkdriving <- merge(drinkdriving, officer_inc)
[1] 18
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 19
summary(m1)
[1] 20

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

new_age <- data.frame(age = c(50))
[1] 21
predict(m1, newdata = new_age)
[1] 22
       1 
21.81983 
plot(m1, which = c(2))
[1] 23
q2_data <- na.omit(drinkdriving)
[1] 24
m2A <- lm(bac ~ age, data = q2_data)
[1] 25
m2B <- lm(bac ~ age + nighttime, data = q2_data)
[1] 26
anova(m2A, m2B)
[1] 27
Analysis of Variance Table

Model 1: bac ~ age
Model 2: bac ~ age + nighttime
  Res.Df    RSS Df Sum of Sq     F    Pr(>F)    
1    214 6948.0                                 
2    213 6250.8  1    697.27 23.76 2.131e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m2C <- lm(bac ~ age + scale(speed), data = q2_data)
[1] 28
anova(m2A, m2C)
[1] 29
Analysis of Variance Table

Model 1: bac ~ age
Model 2: bac ~ age + scale(speed)
  Res.Df    RSS Df Sum of Sq     F Pr(>F)
1    214 6948.0                          
2    213 6919.2  1    28.847 0.888 0.3471
summary(m2A)
[1] 30

Call:
lm(formula = bac ~ age, data = q2_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3651  -4.1773  -0.5542   4.1637  12.0745 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 29.04216    1.05998  27.399  < 2e-16 ***
age         -0.14642    0.02314  -6.328 1.44e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.698 on 214 degrees of freedom
Multiple R-squared:  0.1576,	Adjusted R-squared:  0.1537 
F-statistic: 40.04 on 1 and 214 DF,  p-value: 1.436e-09

summary(m2B)
[1] 31

Call:
lm(formula = bac ~ age + nighttime, data = q2_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3421  -4.3987   0.2997   3.7390  14.4090 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)   26.00346    1.18497  21.944  < 2e-16 ***
age           -0.13690    0.02209  -6.199 2.91e-09 ***
nighttimeTRUE  3.86857    0.79364   4.874 2.13e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.417 on 213 degrees of freedom
Multiple R-squared:  0.2422,	Adjusted R-squared:  0.235 
F-statistic: 34.03 on 2 and 213 DF,  p-value: 1.498e-13

summary(m2C)
[1] 32

Call:
lm(formula = bac ~ age + scale(speed), data = q2_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.446  -3.963  -0.632   3.973  12.218 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  28.19051    1.39317  20.235  < 2e-16 ***
age          -0.12644    0.03139  -4.029  7.8e-05 ***
scale(speed)  0.49670    0.52709   0.942    0.347    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.7 on 213 degrees of freedom
Multiple R-squared:  0.1611,	Adjusted R-squared:  0.1532 
F-statistic: 20.45 on 2 and 213 DF,  p-value: 7.492e-09

with(drinkdriving, t.test(speed ~ nighttime))
[1] 33

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.7709, df = 156.78, p-value = 0.4419
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.513418  2.417929
sample estimates:
mean in group FALSE  mean in group TRUE 
           39.30514            40.85289 

m3A <- glm(outcome ~ scale(age) + nighttime + scale(speed) + 
    scale(bac) + prior_three, data = drinkdriving, family = binomial)
[1] 34
summary(m3A)
[1] 35

Call:
glm(formula = outcome ~ scale(age) + nighttime + scale(speed) + 
    scale(bac) + prior_three, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.9338  -0.3760  -0.1300  -0.0261   3.1867  

Coefficients:
                 Estimate Std. Error z value Pr(>|z|)    
(Intercept)       -5.3485     1.2043  -4.441 8.95e-06 ***
scale(age)         0.8491     0.3653   2.325   0.0201 *  
nighttimeTRUE      0.3644     0.6004   0.607   0.5439    
scale(speed)      -2.1102     0.5164  -4.086 4.38e-05 ***
scale(bac)        -1.4668     0.3762  -3.899 9.66e-05 ***
prior_threenone    1.7872     0.9612   1.859   0.0630 .  
prior_threeother   3.1541     1.2368   2.550   0.0108 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 215.618  on 215  degrees of freedom
Residual deviance:  98.405  on 209  degrees of freedom
  (34 observations deleted due to missingness)
AIC: 112.4

Number of Fisher Scoring iterations: 7

q3_data <- drinkdriving[!drinkdriving$prior_three == "none", 
    ]
[1] 36
q3_data <- droplevels(q3_data)
[1] 37
tbl <- table(q3_data$outcome, q3_data$prior_three)
[1] 38
chisq.test(tbl)
[1] 39

	Pearson's Chi-squared test with Yates' continuity correction

data:  tbl
X-squared = 4.343, df = 1, p-value = 0.03716

tbl2 <- table(drinkdriving$outcome, drinkdriving$prior_yesno)
[1] 40
chisq.test(tbl2)
[1] 41

	Pearson's Chi-squared test with Yates' continuity correction

data:  tbl2
X-squared = 0.1287, df = 1, p-value = 0.7198

q4_data <- data.frame(age = c(17:90), nighttime = c(F), speed = c(30), 
    bac = c(0), prior_three = c("none"))
[1] 42
q4_data <- add_predictions(q4_data, m3A, var = "prediction", 
    type = "response")
[1] 43
ggplot(q4_data, aes(age, prediction)) + geom_point() + ggtitle("Fine prediction by age") + 
    xlab("Age (years)") + ylab("Likelihood (probability)")
[1] 44
offAS <- drinkdriving[drinkdriving$officer == "AS", ]
[1] 45
with(offAS, t.test(age ~ outcome))
[1] 46

	Welch Two Sample t-test

data:  age by outcome
t = -11.829, df = 44.619, p-value = 2.378e-15
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -35.02017 -24.82761
sample estimates:
   mean in group fine mean in group warning 
             34.84884              64.77273 

with(offAS, plot(outcome, age))
[1] 47
offIT <- drinkdriving[drinkdriving$officer == "IT", ]
[1] 48
with(offIT, t.test(age ~ outcome))
[1] 49

	Welch Two Sample t-test

data:  age by outcome
t = -2.8557, df = 15.362, p-value = 0.01181
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -27.272714  -3.988155
sample estimates:
   mean in group fine mean in group warning 
             41.36957              57.00000 

with(offIT, plot(outcome, age))
[1] 50
offNP <- drinkdriving[drinkdriving$officer == "NP", ]
[1] 51
with(offNP, t.test(age ~ outcome))
[1] 52

	Welch Two Sample t-test

data:  age by outcome
t = -2.2641, df = 10.985, p-value = 0.0448
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -27.9057938  -0.3921654
sample estimates:
   mean in group fine mean in group warning 
             41.55102              55.70000 

with(offNP, plot(outcome, age))
[1] 53
