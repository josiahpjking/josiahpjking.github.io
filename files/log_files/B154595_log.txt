

	####### B154595 R script #######

install.packages("stringr")
[1] 1
library(stringr, quietly = T)
[1] 2
[1] "stringr"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
logit_to_prob <- function(logit) {
    exp(logit)/(exp(logit) + 1)
}
[1] 3
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 5
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
plot(drinkdriving$age)
[1] 6
drinkdriving$age[drinkdriving$age > 200] <- NA
[1] 7
hist(drinkdriving$age, main = "Histogram of age", xlab = "Age")
[1] 8
table(drinkdriving$nighttime)
[1] 9

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[which(drinkdriving$nighttime == "18:25")] <- "day"
[1] 10
drinkdriving$nighttime[which(drinkdriving$nighttime == "2:05")] <- "night"
[1] 11
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 12
table(drinkdriving$prior_offence)
[1] 13

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 14
is.factor(drinkdriving$prior_offence)
[1] 15
[1] FALSE
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 16
plot(drinkdriving$speed, ylab = "speed", main = "Scatterplot of speed")
[1] 17
hist(drinkdriving$bac, xlab = "bac", main = "Histogram of bac")
[1] 18
drinkdriving$bac[drinkdriving$bac > 45] <- NA
[1] 19
table(drinkdriving$outcome)
[1] 20

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 21
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 22
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 23
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 24
is.factor(drinkdriving$outcome)
[1] 25
[1] FALSE
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 26
is.factor(drinkdriving$incident_id)
[1] 27
[1] FALSE
drinkdriving$incident_id <- as.factor(drinkdriving$incident_id)
[1] 28
is.factor(officer_inc$officer)
[1] 29
[1] TRUE
is.factor(officer_inc$incident_id)
[1] 30
[1] TRUE
table(officer_inc$officer)
[1] 31

 AS  IT  NP 
116  66  67 
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 32
summary(m1)
[1] 33

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

par(mfrow = c(2, 2))
[1] 34
$mfrow
[1] 1 1

plot(m1, which = 1)
[1] 35
plot(m1, which = 2)
[1] 36
plot(m1, which = 3)
[1] 37
plot(m1, which = 4)
[1] 38
new_data <- data.frame(age = 50)
[1] 39
predict(m1, newdata = new_data)
[1] 40
       1 
21.81983 
par(mfrow = c(1, 1))
[1] 41
$mfrow
[1] 2 2

plot(m1, which = 2)
[1] 42
m2.1.1 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 43
anova(m2.1.1)
[1] 44
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14  38.345 2.969e-09 ***
nighttime   1  721.4  721.42  23.783 2.096e-06 ***
Residuals 215 6521.7   30.33                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m2.1.2 <- lm(bac ~ age + speed, data = drinkdriving)
[1] 45
anova(m2.1.2)
[1] 46
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14 34.6961 1.471e-08 ***
speed       1   35.5   35.50  1.0589    0.3046    
Residuals 215 7207.6   33.52                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m2.2 <- lm(bac ~ age + nighttime + speed, data = drinkdriving)
[1] 47
summary(m2.2)
[1] 48

Call:
lm(formula = bac ~ age + nighttime + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.7811  -4.6224   0.5195   3.7225  14.2190 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    22.99435    2.68293   8.571 2.06e-15 ***
age            -0.10600    0.03007  -3.525 0.000518 ***
nighttimenight  3.92649    0.80461   4.880 2.07e-06 ***
speed           0.04340    0.03992   1.087 0.278151    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

m2.3 <- lm(speed ~ nighttime, data = drinkdriving)
[1] 49
summary(m2.3)
[1] 50

Call:
lm(formula = speed ~ nighttime, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-40.938  -9.368   0.072   8.291  80.827 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      39.510      1.680  23.521   <2e-16 ***
nighttimenight    1.428      2.031   0.703    0.483    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.93 on 248 degrees of freedom
Multiple R-squared:  0.00199,	Adjusted R-squared:  -0.002034 
F-statistic: 0.4944 on 1 and 248 DF,  p-value: 0.4826

anova(m2.3)
[1] 51
Analysis of Variance Table

Response: speed
           Df Sum Sq Mean Sq F value Pr(>F)
nighttime   1    110  110.21  0.4944 0.4826
Residuals 248  55279  222.90               
drinkdriving$fine <- ifelse(drinkdriving$outcome == "fine", 1, 
    0)
[1] 52
m3.1.1 <- glm(fine ~ age + nighttime + prior_offence + speed + 
    bac, data = drinkdriving, family = binomial)
[1] 53
summary(m3.1.1)
[1] 54

Call:
glm(formula = fine ~ age + nighttime + prior_offence + speed + 
    bac, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.9572   0.0001   0.0039   0.0533   2.0824  

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)              25.24283 4257.82868   0.006 0.995270    
age                      -0.24897    0.07275  -3.422 0.000621 ***
nighttimenight           -0.25410    1.00664  -0.252 0.800714    
prior_offenceCD60       -54.24974 7789.34642  -0.007 0.994443    
prior_offenceDR50       -23.18877 4257.82680  -0.005 0.995655    
prior_offenceDR80       -34.00856 4257.82860  -0.008 0.993627    
prior_offenceN          -26.40078 4257.82678  -0.006 0.995053    
prior_offencePL10       -22.61348 4313.16165  -0.005 0.995817    
prior_offenceSP50       -19.43586 5952.90477  -0.003 0.997395    
prior_offenceSP60       -51.34340 7789.34596  -0.007 0.994741    
 [ reached getOption("max.print") -- omitted 4 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.086  on 213  degrees of freedom
Residual deviance:  35.984  on 200  degrees of freedom
  (36 observations deleted due to missingness)
AIC: 63.984

Number of Fisher Scoring iterations: 17

m3.1.2 <- glm(fine ~ scale(speed) + scale(bac) + scale(age), 
    data = drinkdriving, family = binomial)
[1] 55
summary(m3.1.2)
[1] 56

Call:
glm(formula = fine ~ scale(speed) + scale(bac) + scale(age), 
    family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.5396   0.0329   0.1570   0.3674   2.3380  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    3.2675     0.4629   7.058 1.68e-12 ***
scale(speed)   2.0667     0.4985   4.146 3.39e-05 ***
scale(bac)     1.2808     0.3250   3.941 8.12e-05 ***
scale(age)    -0.7657     0.3348  -2.287   0.0222 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 216.50  on 217  degrees of freedom
Residual deviance: 106.31  on 214  degrees of freedom
  (32 observations deleted due to missingness)
AIC: 114.31

Number of Fisher Scoring iterations: 7

drinkdriving$drinkhistory <- ifelse(str_detect(drinkdriving$prior_offence, 
    "DR50"), 1, 0)
[1] 57
drinkdriving$drinkhistory[which(drinkdriving$drinkhistory == 
    "0")] <- ifelse(drinkdriving$prior_offence[which(drinkdriving$drinkhistory == 
    "0")] == "N", NA, 0)
[1] 58
m3.2 <- glm(fine ~ drinkhistory, data = drinkdriving, family = binomial)
[1] 59
summary(m3.2)
[1] 60

Call:
glm(formula = fine ~ drinkhistory, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1899   0.4366   0.4366   0.4366   0.8346  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)  
(Intercept)    0.8755     0.5323   1.645   0.1000  
drinkhistory   1.4271     0.7472   1.910   0.0561 .
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 51.047  on 60  degrees of freedom
Residual deviance: 47.405  on 59  degrees of freedom
  (189 observations deleted due to missingness)
AIC: 51.405

Number of Fisher Scoring iterations: 5

anova(m3.2, test = "Chisq")
[1] 61
Analysis of Deviance Table

Model: binomial, link: logit

Response: fine

Terms added sequentially (first to last)


             Df Deviance Resid. Df Resid. Dev Pr(>Chi)  
NULL                            60     51.047           
drinkhistory  1   3.6421        59     47.405  0.05633 .
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
drinkdriving$hasoffence <- ifelse(drinkdriving$prior_offence == 
    "N", 0, 1)
[1] 62
m3.3 <- glm(fine ~ hasoffence, data = drinkdriving, family = binomial)
[1] 63
summary(m3.3)
[1] 64

Call:
glm(formula = fine ~ hasoffence, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9564   0.5650   0.6681   0.6681   0.6681  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)   1.3863     0.1838   7.542 4.62e-14 ***
hasoffence    0.3677     0.4051   0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

anova(m3.3, test = "Chisq")
[1] 65
Analysis of Deviance Table

Model: binomial, link: logit

Response: fine

Terms added sequentially (first to last)


           Df Deviance Resid. Df Resid. Dev Pr(>Chi)
NULL                         245     237.06         
hasoffence  1  0.86504       244     236.20   0.3523
m4 <- glm(fine ~ age + hasoffence + nighttime + speed + bac, 
    data = drinkdriving, family = binomial)
[1] 66
agedata <- data.frame(age = 11:90, hasoffence = rep(0, time = 80), 
    nighttime = rep("day", time = 80), speed = rep(30, time = 80), 
    bac = rep(0, time = 80))
[1] 67
agedata$model_prediction <- predict(m4, newdata = agedata)
[1] 68
with(agedata, plot(logit_to_prob(model_prediction) ~ age, main = "probability of receiving a fine predicted by age", 
    xlab = "Age", ylab = "probability of receiving a fine", type = "l", 
    col = "red", lwd = 2))
[1] 69
combine <- merge(drinkdriving, officer_inc)
[1] 70
m5.1 <- glm(fine ~ age * officer, data = combine, family = binomial)
[1] 71
summary(m5.1)
[1] 72

Call:
glm(formula = fine ~ age * officer, family = binomial, data = combine)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    9.56920    1.99554   4.795 1.62e-06 ***
age           -0.16122    0.03466  -4.652 3.29e-06 ***
officerIT     -5.04535    2.39610  -2.106   0.0352 *  
officerNP     -4.68465    2.48887  -1.882   0.0598 .  
age:officerIT  0.09612    0.04254   2.260   0.0238 *  
age:officerNP  0.09365    0.04405   2.126   0.0335 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

m5.2 <- glm(fine ~ age * relevel(officer, "IT"), data = combine, 
    family = binomial)
[1] 73
summary(m5.2)
[1] 74

Call:
glm(formula = fine ~ age * relevel(officer, "IT"), family = binomial, 
    data = combine)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
                             Estimate Std. Error z value Pr(>|z|)    
(Intercept)                   4.52384    1.32631   3.411 0.000648 ***
age                          -0.06510    0.02467  -2.639 0.008308 ** 
relevel(officer, "IT")AS      5.04535    2.39610   2.106 0.035234 *  
relevel(officer, "IT")NP      0.36070    1.99283   0.181 0.856369    
age:relevel(officer, "IT")AS -0.09612    0.04254  -2.260 0.023841 *  
age:relevel(officer, "IT")NP -0.00247    0.03671  -0.067 0.946370    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

