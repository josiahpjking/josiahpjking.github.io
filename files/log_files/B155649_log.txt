

	####### B155649 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 2
 [1] "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 3
 [1] "car"       "carData"   "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
library(lsr, quietly = T)
[1] 4
 [1] "lsr"       "car"       "carData"   "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"    
[11] "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 5
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 6
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
describe(drinkdriving)
[1] 7
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
is.factor(drinkdriving$nighttime)
[1] 8
[1] FALSE
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 9
levels(drinkdriving$nighttime)
[1] 10
[1] "18:25" "2:05"  "day"   "night"
levels(drinkdriving$nighttime)[levels(drinkdriving$nighttime) == 
    "18:25"] <- NA
[1] 11
levels(drinkdriving$nighttime)[levels(drinkdriving$nighttime) == 
    "2:05"] <- NA
[1] 12
is.factor(drinkdriving$outcome)
[1] 13
[1] FALSE
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 14
levels(drinkdriving$outcome)
[1] 15
[1] "fine"    "Fine"    "FINE"    "warning" "Warning" "WARNING"
levels(drinkdriving$outcome)[levels(drinkdriving$outcome) == 
    "Fine"] <- "fine"
[1] 16
levels(drinkdriving$outcome)[levels(drinkdriving$outcome) == 
    "FINE"] <- "fine"
[1] 17
levels(drinkdriving$outcome)[levels(drinkdriving$outcome) == 
    "Warning"] <- "warning"
[1] 18
levels(drinkdriving$outcome)[levels(drinkdriving$outcome) == 
    "WARNING"] <- "warning"
[1] 19
is.factor(drinkdriving$prior_offence)
[1] 20
[1] FALSE
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 21
levels(drinkdriving$prior_offence)
[1] 22
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
is.factor(drinkdriving$incident_id)
[1] 23
[1] FALSE
drinkdriving$incident_id <- as.factor(drinkdriving$incident_id)
[1] 24
summary(drinkdriving$age)
[1] 25
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  14.00   30.00   40.50   46.00   55.25  297.00      22 
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 26
summary(drinkdriving$bac)
[1] 27
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  3.987  19.264  23.609  23.605  27.898  65.764       5 
hist(drinkdriving$bac, main = "", breaks = 20)
[1] 28
boxplot(drinkdriving$bac)
[1] 29
drinkdriving$bac[drinkdriving$bac > 40] <- NA
[1] 30
summary(drinkdriving$speed)
[1] 31
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00   30.92   40.64   40.49   48.84  120.34 
hist(drinkdriving$speed, main = "", breaks = 20)
[1] 32
boxplot(drinkdriving$speed ~ drinkdriving$nighttime, ylim = c(0, 
    120))
[1] 33
drinkdriving$speed[drinkdriving$speed > 100] <- NA
[1] 34
summary(officer_inc)
[1] 35
 officer     incident_id 
 AS  :116   inc_1  :  1  
 IT  : 66   inc_10 :  1  
 NP  : 67   inc_100:  1  
 NA's:  1   inc_101:  1  
            inc_102:  1  
            inc_103:  1  
            (Other):244  
describe(officer_inc)
[1] 36
             vars   n  mean    sd median trimmed   mad min max range skew kurtosis   se
officer*        1 249   1.8  0.84    2.0    1.76  1.48   1   3     2 0.38    -1.47 0.05
incident_id*    2 250 125.5 72.31  125.5  125.50 92.66   1 250   249 0.00    -1.21 4.57
is.factor(officer_inc$officer)
[1] 37
[1] TRUE
levels(officer_inc$officer)
[1] 38
[1] "AS" "IT" "NP"
is.factor(officer_inc$incident_id)
[1] 39
[1] TRUE
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 40
summary(m1)
[1] 41

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

plot(m1)
[1] 42
hist(residuals(m1), main = "", breaks = 20)
[1] 43
predict(m1, data.frame(age = 50))
[1] 44
       1 
21.81983 
plot(m1, which = 2)
[1] 45
m2.s <- lm(scale(bac) ~ scale(age) + scale(speed) + scale(as.numeric(nighttime)), 
    data = drinkdriving)
[1] 46
summary(m2.s)
[1] 47

Call:
lm(formula = scale(bac) ~ scale(age) + scale(speed) + scale(as.numeric(nighttime)), 
    data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.34923 -0.65702  0.08696  0.53547  2.14553 

Coefficients:
                             Estimate Std. Error t value Pr(>|t|)    
(Intercept)                  -0.06173    0.05633  -1.096 0.274409    
scale(age)                   -0.29198    0.07529  -3.878 0.000141 ***
scale(speed)                  0.08674    0.08353   1.038 0.300244    
scale(as.numeric(nighttime))  0.27111    0.05550   4.885 2.04e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.8133 on 212 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.246,	Adjusted R-squared:  0.2353 
F-statistic: 23.05 on 3 and 212 DF,  p-value: 5.894e-13

summary(m2.s)$r.squared
[1] 48
[1] 0.2459863
t.test(speed ~ nighttime, data = drinkdriving)
[1] 49

	Welch Two Sample t-test

data:  speed by nighttime
t = -1.5101, df = 195.84, p-value = 0.1326
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.9957683  0.7955574
sample estimates:
  mean in group day mean in group night 
           38.25278            40.85289 

outcome_p <- ifelse(drinkdriving$outcome == "fine", 1, 0)
[1] 50
offence_levels <- ifelse(drinkdriving$prior_offence == "DR50" | 
    drinkdriving$prior_offence == "TS70,DR50", "drink", ifelse(drinkdriving$prior_offence != 
    "N" & drinkdriving$prior_offence != "DR50" & drinkdriving$prior_offence != 
    "TS70,DR50", "non-drink", "None"))
[1] 51
m7 <- glm(outcome_p ~ age + nighttime + offence_levels + bac + 
    speed, data = drinkdriving, family = binomial)
[1] 52
summary(m7)
[1] 53

Call:
glm(formula = outcome_p ~ age + nighttime + offence_levels + 
    bac + speed, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.1867   0.0261   0.1300   0.3760   2.9338  

Coefficients:
                        Estimate Std. Error z value Pr(>|z|)    
(Intercept)             -3.34870    2.37785  -1.408   0.1590    
age                     -0.05064    0.02178  -2.325   0.0201 *  
nighttimenight          -0.36438    0.60039  -0.607   0.5439    
offence_levelsnon-drink -3.15406    1.23680  -2.550   0.0108 *  
offence_levelsNone      -1.78722    0.96116  -1.859   0.0630 .  
bac                      0.22024    0.05649   3.899 9.66e-05 ***
speed                    0.14148    0.03462   4.086 4.38e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 215.618  on 215  degrees of freedom
Residual deviance:  98.405  on 209  degrees of freedom
  (34 observations deleted due to missingness)
AIC: 112.4

Number of Fisher Scoring iterations: 7

standardCoefs(m7)
[1] 54
                                  b       beta
age                     -0.05063597 -2.1247193
nighttimenight          -0.36437988 -0.4254811
offence_levelsnon-drink -3.15405840 -2.1831386
offence_levelsNone      -1.78722159 -1.9614404
bac                      0.22024486  3.4084010
speed                    0.14148226  4.4737142
offence_is_none <- ifelse(drinkdriving$prior_offence == "N", 
    0, 1)
[1] 55
m_offence_none <- glm(outcome_p ~ age + nighttime + offence_is_none + 
    bac + speed, data = drinkdriving, family = binomial)
[1] 56
summary(m_offence_none)
[1] 57

Call:
glm(formula = outcome_p ~ age + nighttime + offence_is_none + 
    bac + speed, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.6056   0.0336   0.1439   0.3888   2.2047  

Coefficients:
                Estimate Std. Error z value Pr(>|z|)    
(Intercept)     -4.80581    2.21298  -2.172 0.029882 *  
age             -0.04682    0.02054  -2.280 0.022630 *  
nighttimenight  -0.14089    0.56396  -0.250 0.802727    
offence_is_none  0.37610    0.60754   0.619 0.535884    
bac              0.19644    0.05236   3.752 0.000176 ***
speed            0.13554    0.03361   4.033 5.51e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 215.62  on 215  degrees of freedom
Residual deviance: 105.82  on 210  degrees of freedom
  (34 observations deleted due to missingness)
AIC: 117.82

Number of Fisher Scoring iterations: 7

new_data <- data.frame(age = (17:100), nighttime = factor("day"), 
    speed = 30, bac = 0, offence_levels = "None")
[1] 58
new_data$model_prediction <- predict(m7, new_data, type = "response")
[1] 59
summary(new_data$model_prediction)
[1] 60
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.002586 0.007361 0.020768 0.037883 0.057176 0.147762 
ggplot(new_data, aes(x = age, y = model_prediction)) + geom_line(lwd = 2, 
    color = "tomato2") + ylim(0, 0.15) + labs(x = "age", y = "predicted probabilities of receiving a fine") + 
    theme(axis.title.x = element_text(size = 30), axis.title.y = element_text(size = 30), 
        axis.text.x = element_text(size = 20), axis.text.y = element_text(size = 20))
[1] 61
incidents <- merge(drinkdriving, officer_inc, all = T)
[1] 62
outcome_fine <- ifelse(incidents$outcome == "fine", 1, 0)
[1] 63
officer_age_mod <- glm(outcome_fine ~ age * officer, data = incidents, 
    family = binomial)
[1] 64
summary(officer_age_mod)
[1] 65

Call:
glm(formula = outcome_fine ~ age * officer, family = binomial, 
    data = incidents)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)    9.56920    1.99554   4.795 1.62e-06 ***
age           -0.16122    0.03466  -4.652 3.29e-06 ***
officerIT     -5.04535    2.39610  -2.106   0.0352 *  
officerNP     -4.68465    2.48887  -1.882   0.0598 .  
age:officerIT  0.09612    0.04254   2.260   0.0238 *  
age:officerNP  0.09365    0.04405   2.126   0.0335 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

contrasts(incidents$officer)
[1] 66
   IT NP
AS  0  0
IT  1  0
NP  0  1
officer_age_relev <- glm(outcome_fine ~ age * relevel(officer, 
    "IT"), data = incidents, family = binomial)
[1] 67
summary(officer_age_relev)
[1] 68

Call:
glm(formula = outcome_fine ~ age * relevel(officer, "IT"), family = binomial, 
    data = incidents)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
                             Estimate Std. Error z value Pr(>|z|)    
(Intercept)                   4.52384    1.32631   3.411 0.000648 ***
age                          -0.06510    0.02467  -2.639 0.008308 ** 
relevel(officer, "IT")AS      5.04535    2.39610   2.106 0.035234 *  
relevel(officer, "IT")NP      0.36070    1.99283   0.181 0.856369    
age:relevel(officer, "IT")AS -0.09612    0.04254  -2.260 0.023841 *  
age:relevel(officer, "IT")NP -0.00247    0.03671  -0.067 0.946370    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

