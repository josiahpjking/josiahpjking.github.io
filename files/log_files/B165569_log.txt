

	####### B165569 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 2
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 3
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
incidents <- merge(drinkdriving, officer_inc, all = T)
[1] 4
table(incidents$age)
[1] 5

14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 
 1  5  2  3  1  2  3  6  2  5  8  3  2  2  5  4  4  4  6  5  9  8  3  4  2 10  5  6  5  3  2  3  4  5  2  3  3  3  6  3  5  4  3  4  4 
59 60 61 62 63 
 1  5  3  3  2 
 [ reached getOption("max.print") -- omitted 15 entries ]
incidents$age[incidents$age == 293 | incidents$age == 297] <- NA
[1] 6
table(incidents$nighttime)
[1] 7

18:25  2:05   day night 
    1     2    78   169 
incidents$nighttime[incidents$nighttime == "18:25"] <- "night"
[1] 8
incidents$nighttime[incidents$nighttime == "2:05"] <- "night"
[1] 9
table(incidents$prior_offence)
[1] 10

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
incidents$prior_offence[incidents$prior_offence == "DD20"] <- NA
[1] 11
incidents$prior_offence[incidents$prior_offence == "CD10"] <- "CD"
[1] 12
incidents$prior_offence[incidents$prior_offence == "CD60"] <- "CD"
[1] 13
incidents$prior_offence[incidents$prior_offence == "PL10"] <- "PL"
[1] 14
incidents$prior_offence[incidents$prior_offence == "SP50"] <- "SP"
[1] 15
incidents$prior_offence[incidents$prior_offence == "SP60"] <- "SP"
[1] 16
incidents$prior_offence[incidents$prior_offence == "TS70"] <- "TS"
[1] 17
incidents$prior_offence[incidents$prior_offence == "CD60,CD60"] <- "CD"
[1] 18
incidents$prior_offence[incidents$prior_offence == "CD60,CD10,DR80"] <- "CD"
[1] 19
incidents$prior_offence[incidents$prior_offence == "TS70,DR50"] <- "TS"
[1] 20
table(incidents$speed)
[1] 21

               0 1.01214942316415 1.94581782932169 2.53346827328845  11.225704630299 12.2462058630265 12.8128465751594 
               1                1                1                1                1                1                1 
12.9030158165279 12.9155695510693 13.0698049123235 14.3668291368723 15.5710258293839 17.0590138838127  17.221097497513 
               1                1                1                1                1                1                1 
18.2934932399405 19.0089940620951 19.2697316282316 20.2107015627382 21.3069195145607 21.4908339004998 21.8064434744078 
               1                1                1                1                1                1                1 
 22.568562604335 22.5952898516689 22.6424298724575  23.182415928645 23.5805503449787 23.5994274112678 24.4877988273931 
               1                1                1                1                1                1                1 
24.5215840561896 24.5611037960359 24.8285320808304 24.9172566024629 24.9907200841348 25.0453443973611 25.0548611219096 
               1                1                1                1                1                1                1 
25.2710211226397 25.5417854203194 25.5936767268247 25.7485090547557 25.9105706027961   25.98459487588 26.2055631685057 
               1                1                1                1                1                1                1 
 26.414446768112 26.6813905027214 26.6979134850146 27.0661842358492 28.5530416886726 28.6993802422867 28.7242755318064 
               1                1                1                1                1                1                1 
28.8107670431613 
               1 
 [ reached getOption("max.print") -- omitted 200 entries ]
boxplot(incidents$speed)
[1] 22
which(incidents$speed > (mean(incidents$speed, na.rm = T) + 3 * 
    sd(incidents$speed, na.rm = T)))
[1] 23
[1] 14
incidents$speed[incidents$speed > mean(incidents$speed, na.rm = T) + 
    3 * sd(incidents$speed, na.rm = T)] <- NA
[1] 24
which(incidents$speed < (mean(incidents$speed, na.rm = T) - 3 * 
    sd(incidents$speed, na.rm = T)))
[1] 25
integer(0)
table(incidents$bac)
[1] 26

3.98678518191804 5.45295079276351 5.61849660215689 6.39815180420771 6.45232354218363 8.55241944417923 9.16715954067682 
               1                1                1                1                1                1                1 
9.25348198083096 9.49752435423211 9.81747807144744 10.0454646939566 10.2699286970084 10.4971185812798 10.6649017352481 
               1                1                1                1                1                1                1 
 11.199644560097 11.8177151563139  12.383382856562 12.7426098538045 13.5320753875597 13.8631845587114 14.1159208271656 
               1                1                1                1                1                1                1 
14.2071322668145 14.3140134442539  14.817899748919 14.9946701515397 15.2439189096081 15.5051277092158  15.989616149418 
               1                1                1                1                1                1                1 
16.0452635279057 16.0927774247029 16.1947203748598 16.2228619659442 16.3696120796151 16.4455909694064 16.6523626858628 
               1                1                1                1                1                1                1 
16.8576234110825 17.1063627259339 17.3301216655205 17.4520816674849 17.6730177261954 17.7137353516994 17.7755921387512 
               1                1                1                1                1                1                1 
17.8183606022586 17.8201747803163 17.8501485665444 17.9707079305316 17.9844835229676 18.0186086871637 18.0696136795774 
               1                1                1                1                1                1                1 
 18.247052539074 
               1 
 [ reached getOption("max.print") -- omitted 191 entries ]
incidents$bac <- incidents$bac/100
[1] 27
boxplot(incidents$bac)
[1] 28
which(incidents$bac > (mean(incidents$bac, na.rm = T) + 3 * sd(incidents$bac, 
    na.rm = T)))
[1] 29
[1] 14 62
incidents$bac[incidents$bac > mean(incidents$bac, na.rm = T) + 
    3 * sd(incidents$bac, na.rm = T)] <- NA
[1] 30
which(incidents$bac < (mean(incidents$bac, na.rm = T) - 3 * sd(incidents$bac, 
    na.rm = T)))
[1] 31
integer(0)
table(incidents$outcome)
[1] 32

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
incidents$outcome[incidents$outcome == "Fine"] <- "fine"
[1] 33
incidents$outcome[incidents$outcome == "FINE"] <- "fine"
[1] 34
incidents$outcome[incidents$outcome == "Warning"] <- "warning"
[1] 35
incidents$outcome[incidents$outcome == "WARNING"] <- "warning"
[1] 36
table(incidents$officer)
[1] 37

 AS  IT  NP 
116  66  67 
class(incidents$nighttime)
[1] 38
[1] "character"
class(incidents$prior_offence)
[1] 39
[1] "character"
class(incidents$outcome)
[1] 40
[1] "character"
class(incidents$incident_id)
[1] 41
[1] "character"
incidents$nighttime <- as.factor(incidents$nighttime)
[1] 42
incidents$prior_offence <- as.factor(incidents$prior_offence)
[1] 43
incidents$outcome <- as.factor(incidents$outcome)
[1] 44
incidents$incident_id <- as.factor(incidents$incident_id)
[1] 45
m1 <- lm(bac ~ age, data = incidents)
[1] 46
m1 <- lm(bac ~ I(age - mean(age, na.rm = T)), data = incidents)
[1] 47
par(mfrow = c(2, 2))
[1] 48
$mfrow
[1] 2 2

plot(m1, which = c(1:4))
[1] 49
summary(m1)
[1] 50

Call:
lm(formula = bac ~ I(age - mean(age, na.rm = T)), data = incidents)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
                                Estimate Std. Error t value Pr(>|t|)    
(Intercept)                    0.2282551  0.0039220   58.20  < 2e-16 ***
I(age - mean(age, na.rm = T)) -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

mean(incidents$age, na.rm = T)
[1] 51
[1] 42.67556
coef(m1)[1] + (50 - mean(incidents$age, na.rm = T)) * coef(m1)[2]
[1] 52
(Intercept) 
  0.2181983 
par(mfrow = c(1, 1))
[1] 53
$mfrow
[1] 2 2

hist(residuals(m1), ylim = c(0, 80), main = "", xlab = "Residuals (model m1)")
[1] 54
m2 <- lm(bac ~ age + nighttime, data = incidents)
[1] 55
summary(m2)
[1] 56

Call:
lm(formula = bac ~ age + nighttime, data = incidents)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.165254 -0.046056  0.003152  0.037847  0.143450 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2560505  0.0119731  21.386  < 2e-16 ***
age            -0.0012800  0.0002225  -5.752 3.01e-08 ***
nighttimenight  0.0392560  0.0080496   4.877 2.10e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05508 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2242,	Adjusted R-squared:  0.217 
F-statistic: 31.06 on 2 and 215 DF,  p-value: 1.409e-12

anova(m2)
[1] 57
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.11631 0.116314  38.345 2.969e-09 ***
nighttime   1 0.07214 0.072142  23.783 2.096e-06 ***
Residuals 215 0.65217 0.003033                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m3 <- lm(bac ~ age + speed, data = incidents)
[1] 58
summary(m3)
[1] 59

Call:
lm(formula = bac ~ age + speed, data = incidents)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.154118 -0.038926 -0.006094  0.041298  0.144229 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2608699  0.0274183   9.514  < 2e-16 ***
age         -0.0011540  0.0003156  -3.656 0.000322 ***
speed        0.0004320  0.0004198   1.029 0.304616    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.0579 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.574e-08

anova(m3)
[1] 60
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.11631 0.116314 34.6961 1.471e-08 ***
speed       1 0.00355 0.003550  1.0589    0.3046    
Residuals 215 0.72076 0.003352                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
par(mfrow = c(2, 2))
[1] 61
$mfrow
[1] 1 1

plot(m2, which = c(1:4))
[1] 62
plot(m3, which = c(1:4))
[1] 63
m4 <- lm(bac ~ age + nighttime + speed, data = incidents)
[1] 64
summary(m4)
[1] 65

Call:
lm(formula = bac ~ age + nighttime + speed, data = incidents)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.157811 -0.046224  0.005195  0.037225  0.142190 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2299435  0.0268293   8.571 2.06e-15 ***
age            -0.0010600  0.0003007  -3.525 0.000518 ***
nighttimenight  0.0392649  0.0080461   4.880 2.07e-06 ***
speed           0.0004340  0.0003992   1.087 0.278151    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

shapiro.test(incidents$speed)
[1] 66

	Shapiro-Wilk normality test

data:  incidents$speed
W = 0.99557, p-value = 0.6971

t.test(incidents$speed ~ incidents$nighttime, alternative = "less")
[1] 67

	Welch Two Sample t-test

data:  incidents$speed by incidents$nighttime
t = -1.616, df = 194.92, p-value = 0.05386
alternative hypothesis: true difference in means is less than 0
95 percent confidence interval:
       -Inf 0.06296809
sample estimates:
  mean in group day mean in group night 
           38.25278            41.02205 

incidents$outcome <- factor(incidents$outcome, levels = c("warning", 
    "fine"))
[1] 68
incidents$outcome
[1] 69
 [1] fine    warning warning fine    fine    fine    fine    fine    fine    fine    fine    fine    warning fine    fine    fine   
[17] fine    warning warning warning warning fine    fine    fine    warning fine    fine    warning fine    fine    fine    fine   
[33] fine    fine    fine    fine    fine    fine    fine    fine    fine    warning warning fine    fine    fine    fine    fine   
[49] fine    fine   
 [ reached getOption("max.print") -- omitted 200 entries ]
Levels: warning fine
incidents$prior_offence <- factor(incidents$prior_offence, levels = c("N", 
    "CD", "DR50", "DR80", "PL", "SP", "TS"))
[1] 70
incidents$prior_offence
[1] 71
 [1] N    N    N    N    N    N    DR50 N    N    TS   DR50 N    DR80 CD   N    N    N    N    PL   N    N    <NA> N    N    SP   N   
[27] N    N    N    N    DR50 DR50 N    N    N    N    DR80 N    N    N    N    N    CD   N    N    N    DR50 N    DR50 N   
 [ reached getOption("max.print") -- omitted 200 entries ]
Levels: N CD DR50 DR80 PL SP TS
logit_m1 <- glm(outcome ~ age + nighttime + prior_offence + scale(speed) + 
    scale(bac), data = incidents, family = binomial)
[1] 72
summary(logit_m1)
[1] 73

Call:
glm(formula = outcome ~ age + nighttime + prior_offence + scale(speed) + 
    scale(bac), family = binomial, data = incidents)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.1875   0.0038   0.0410   0.2010   1.9146  

Coefficients:
                  Estimate Std. Error z value Pr(>|z|)    
(Intercept)        10.2598     2.2302   4.600 4.22e-06 ***
age                -0.1244     0.0340  -3.659 0.000253 ***
nighttimenight     -0.3021     0.7510  -0.402 0.687508    
prior_offenceCD     3.6995     1.9347   1.912 0.055856 .  
prior_offenceDR50   2.2779     1.2131   1.878 0.060408 .  
prior_offenceDR80  -4.3347     2.1511  -2.015 0.043895 *  
prior_offencePL     2.0925    44.2223   0.047 0.962259    
prior_offenceSP    -4.8827     1.8174  -2.687 0.007217 ** 
prior_offenceTS     2.7204     1.7762   1.532 0.125625    
scale(speed)        2.4379     0.6271   3.887 0.000101 ***
 [ reached getOption("max.print") -- omitted 1 row ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.086  on 213  degrees of freedom
Residual deviance:  65.571  on 203  degrees of freedom
  (36 observations deleted due to missingness)
AIC: 87.571

Number of Fisher Scoring iterations: 8

incidents$dd_offence <- ifelse(incidents$prior_offence == "DR50", 
    "drink", "other")
[1] 74
incidents$dd_offence[incidents$prior_offence == "N"] <- "non"
[1] 75
incidents$dd_offence <- factor(incidents$dd_offence, levels = c("other", 
    "drink", "non"))
[1] 76
incidents$dd_offence
[1] 77
 [1] non   non   non   non   non   non   drink non   non   other drink non   other other non   non   non   non   other non   non  
[22] <NA>  non   non   other non   non   non   non   non   drink drink non   non   non   non   other non   non   non   non   non  
[43] other non   non   non   drink non   drink non  
 [ reached getOption("max.print") -- omitted 200 entries ]
Levels: other drink non
logit_m2 <- glm(outcome ~ dd_offence, data = incidents, family = binomial)
[1] 78
summary(logit_m2)
[1] 79

Call:
glm(formula = outcome ~ dd_offence, family = binomial, data = incidents)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3076   0.3803   0.6681   0.6681   0.9005  

Coefficients:
                Estimate Std. Error z value Pr(>|z|)  
(Intercept)       0.6931     0.5000   1.386    0.166  
dd_offencedrink   1.8971     0.7800   2.432    0.015 *
dd_offencenon     0.6931     0.5327   1.301    0.193  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 229.82  on 243  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 235.82

Number of Fisher Scoring iterations: 5

incidents$p_offence <- ifelse(incidents$prior_offence == "N", 
    "non", "offence")
[1] 80
incidents$p_offence <- factor(incidents$p_offence)
[1] 81
incidents$p_offence
[1] 82
 [1] non     non     non     non     non     non     offence non     non     offence offence non     offence offence non     non    
[17] non     non     offence non     non     <NA>    non     non     offence non     non     non     non     non     offence offence
[33] non     non     non     non     offence non     non     non     non     non     offence non     non     non     offence non    
[49] offence non    
 [ reached getOption("max.print") -- omitted 200 entries ]
Levels: non offence
logit_m3 <- glm(outcome ~ p_offence, data = incidents, family = binomial)
[1] 83
summary(logit_m3)
[1] 84

Call:
glm(formula = outcome ~ p_offence, family = binomial, data = incidents)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9564   0.5650   0.6681   0.6681   0.6681  

Coefficients:
                 Estimate Std. Error z value Pr(>|z|)    
(Intercept)        1.3863     0.1838   7.542 4.62e-14 ***
p_offenceoffence   0.3677     0.4051   0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

range(incidents$age, na.rm = T)
[1] 85
[1] 14 90
new <- data.frame(age = c(14:90), nighttime = "day", speed = 30, 
    bac = 0, prior_offence = "N")
[1] 86
new$model_prediction <- predict(logit_m1, newdata = new, type = "response")
[1] 87
p1 <- ggplot(new, aes(x = age)) + geom_point(aes(y = model_prediction)) + 
    theme_classic() + labs(x = "Age (years)", y = "Predicted Probability of Receiving Fine") + 
    scale_x_continuous(breaks = c(20, 30, 40, 50, 60, 70, 80, 
        90))
[1] 88
p1



incidents$officer <- factor(incidents$officer, levels = c("NP", 
    "AS", "IT"))
[1] 90
incidents$officer
[1] 91
 [1] AS AS AS NP AS NP NP AS NP IT IT NP NP AS IT IT NP AS AS AS AS IT AS AS AS IT NP IT IT IT IT AS NP AS AS AS IT NP IT AS IT IT IT
[44] AS AS NP AS AS IT AS
 [ reached getOption("max.print") -- omitted 200 entries ]
Levels: NP AS IT
logit_m4 <- glm(outcome ~ I(age - mean(age, na.rm = T)) * officer, 
    data = incidents, family = binomial)
[1] 92
summary(logit_m4)
[1] 93

Call:
glm(formula = outcome ~ I(age - mean(age, na.rm = T)) * officer, 
    family = binomial, data = incidents)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
                                        Estimate Std. Error z value Pr(>|z|)    
(Intercept)                              2.00092    0.46590   4.295 1.75e-05 ***
I(age - mean(age, na.rm = T))           -0.06757    0.02719  -2.485   0.0130 *  
officerAS                                0.68798    0.76211   0.903   0.3667    
officerIT                               -0.25531    0.62755  -0.407   0.6841    
I(age - mean(age, na.rm = T)):officerAS -0.09365    0.04405  -2.126   0.0335 *  
I(age - mean(age, na.rm = T)):officerIT  0.00247    0.03671   0.067   0.9464    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

anova(logit_m4, test = "Chisq")
[1] 94
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


                                      Df Deviance Resid. Df Resid. Dev Pr(>Chi)    
NULL                                                    224     222.38             
I(age - mean(age, na.rm = T))          1   67.728       223     154.65  < 2e-16 ***
officer                                2    0.861       221     153.79  0.65013    
I(age - mean(age, na.rm = T)):officer  2    7.383       219     146.41  0.02494 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
