

	####### B158646 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(ggplot2, quietly = T)
[1] 2
 [1] "ggplot2"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(lsr, quietly = T)
[1] 3
 [1] "lsr"       "ggplot2"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
dd <- drinkdriving
[1] 5
describe(dd)
[1] 6
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
dd$age[dd$age > 100 | dd$age < 17] <- NA
[1] 7
is.factor(dd$nighttime)
[1] 8
[1] FALSE
dd$nighttime <- as.factor(dd$nighttime)
[1] 9
levels(dd$nighttime)
[1] 10
[1] "18:25" "2:05"  "day"   "night"
levels(dd$nighttime) <- c("night", "night", "day", "night")
[1] 11
is.factor(dd$prior_offence)
[1] 12
[1] FALSE
dd$prior_offence <- as.factor(dd$prior_offence)
[1] 13
levels(dd$prior_offence)
[1] 14
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
dd$prior_offence[dd$prior_offence == "DD20"] <- NA
[1] 15
is.factor(dd$outcome)
[1] 16
[1] FALSE
dd$outcome <- as.factor(dd$outcome)
[1] 17
levels(dd$outcome)
[1] 18
[1] "fine"    "Fine"    "FINE"    "warning" "Warning" "WARNING"
levels(dd$outcome) <- c("fine", "fine", "fine", "warning", "warning", 
    "warning")
[1] 19
outliers <- function(obs, x = 2.5) {
    outlier <- abs(obs) > mean(obs, na.rm = T) + x * (sd(obs, 
        na.rm = T))
    return(outlier)
}
[1] 20
dd$speed[which(outliers(dd$speed))] <- NA
[1] 21
describe(officer_inc)
[1] 22
             vars   n  mean    sd median trimmed   mad min max range skew kurtosis   se
officer*        1 249   1.8  0.84    2.0    1.76  1.48   1   3     2 0.38    -1.47 0.05
incident_id*    2 250 125.5 72.31  125.5  125.50 92.66   1 250   249 0.00    -1.21 4.57
is.factor(officer_inc$officer)
[1] 23
[1] TRUE
levels(officer_inc$officer)
[1] 24
[1] "AS" "IT" "NP"
dd <- merge(dd, officer_inc, all = T)
[1] 25
m1 <- lm(bac ~ age, data = dd)
[1] 26
ggplot(dd, aes(x = age)) + geom_point(aes(y = bac)) + geom_smooth(aes(y = bac)) + 
    theme_minimal() + labs(x = "Age", y = "Blood Alcohol Content")
[1] 27
par(mfrow = c(2, 2))
[1] 28
$mfrow
[1] 2 2

plot(m1, which = 1:4)
[1] 29
summary(m1)
[1] 30

Call:
lm(formula = bac ~ age, data = dd)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.567  -4.490  -0.993   3.833  42.860 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.84428    1.36250  21.170  < 2e-16 ***
age         -0.13501    0.02926  -4.614 6.86e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.899 on 210 degrees of freedom
  (38 observations deleted due to missingness)
Multiple R-squared:  0.09205,	Adjusted R-squared:  0.08773 
F-statistic: 21.29 on 1 and 210 DF,  p-value: 6.86e-06

age_50 <- data.frame(age = 50)
[1] 31
predict(m1, age_50, interval = "confidence")
[1] 32
       fit      lwr      upr
1 22.09395 21.09081 23.09709
m2.1_t <- lm(bac ~ age + nighttime, data = dd)
[1] 33
anova(m2.1_t)
[1] 34
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1013.5 1013.51  22.560 3.781e-06 ***
nighttime   1  607.1  607.12  13.514  0.000301 ***
Residuals 209 9389.3   44.92                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2.1_t)
[1] 35

Call:
lm(formula = bac ~ age + nighttime, data = dd)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.714  -5.039  -0.057   3.459  41.691 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  29.66481    1.34232  22.100  < 2e-16 ***
age          -0.12709    0.02851  -4.458 1.35e-05 ***
nighttimeday -3.63591    0.98905  -3.676 0.000301 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.703 on 209 degrees of freedom
  (38 observations deleted due to missingness)
Multiple R-squared:  0.1472,	Adjusted R-squared:  0.139 
F-statistic: 18.04 on 2 and 209 DF,  p-value: 5.938e-08

m2.1_s <- lm(bac ~ age + speed, data = dd)
[1] 36
anova(m2.1_s)
[1] 37
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1  887.8  887.77 26.0514 7.512e-07 ***
speed       1   24.6   24.64  0.7232    0.3961    
Residuals 207 7054.1   34.08                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2.1_s)
[1] 38

Call:
lm(formula = bac ~ age + speed, data = dd)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.2141  -3.9350  -0.6521   4.1645  14.3229 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 25.91438    2.83820   9.131  < 2e-16 ***
age         -0.10824    0.03289  -3.291  0.00117 ** 
speed        0.03698    0.04349   0.850  0.39608    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.838 on 207 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1145,	Adjusted R-squared:  0.106 
F-statistic: 13.39 on 2 and 207 DF,  p-value: 3.407e-06

par(mfrow = c(2, 2))
[1] 39
$mfrow
[1] 2 2

plot(m2.1_t)
[1] 40
plot(m2.1_s)
[1] 41
m2.2_t <- lm(scale(bac) ~ scale(age) + nighttime, data = dd)
[1] 42
summary(m2.2_t)
[1] 43

Call:
lm(formula = scale(bac) ~ scale(age) + nighttime, data = dd)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.2328 -0.6732 -0.0076  0.4621  5.5695 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)   0.06781    0.07469   0.908 0.364973    
scale(age)   -0.27505    0.06169  -4.458 1.35e-05 ***
nighttimeday -0.48572    0.13213  -3.676 0.000301 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.8954 on 209 degrees of freedom
  (38 observations deleted due to missingness)
Multiple R-squared:  0.1472,	Adjusted R-squared:  0.139 
F-statistic: 18.04 on 2 and 209 DF,  p-value: 5.938e-08

m2.2_s <- lm(scale(bac) ~ scale(age) + scale(speed), data = dd)
[1] 44
summary(m2.2_s)
[1] 45

Call:
lm(formula = scale(bac) ~ scale(age) + scale(speed), data = dd)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.03245 -0.52568 -0.08711  0.55633  1.91340 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)   
(Intercept)  -0.12555    0.05518  -2.275  0.02391 * 
scale(age)   -0.23425    0.07118  -3.291  0.00117 **
scale(speed)  0.06837    0.08040   0.850  0.39608   
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.7798 on 207 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1145,	Adjusted R-squared:  0.106 
F-statistic: 13.39 on 2 and 207 DF,  p-value: 3.407e-06

dd$is.night <- ifelse(dd$nighttime == "night", 1, 0)
[1] 46
m2.3 <- lm(speed ~ is.night, data = dd)
[1] 47
summary(m2.3)
[1] 48

Call:
lm(formula = speed ~ is.night, data = dd)

Residuals:
    Min      1Q  Median      3Q     Max 
-40.788  -8.714   0.256   8.276  35.085 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)   38.253      1.575  24.292   <2e-16 ***
is.night       2.535      1.896   1.337    0.182    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 13.82 on 246 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.007213,	Adjusted R-squared:  0.003178 
F-statistic: 1.787 on 1 and 246 DF,  p-value: 0.1825

dd$is.fine <- ifelse(dd$outcome == "fine", 1, 0)
[1] 49
m3.1 <- glm(is.fine ~ scale(age) + is.night + scale(speed) + 
    prior_offence + scale(bac) + officer, data = dd, family = "binomial")
[1] 50
anova(m3.1, test = "Chisq")
[1] 51
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.fine

Terms added sequentially (first to last)


              Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                            205    205.610              
scale(age)     1   74.766       204    130.844 < 2.2e-16 ***
is.night       1    1.532       203    129.313    0.2159    
scale(speed)   1   26.650       202    102.663 2.439e-07 ***
prior_offence  9   35.043       193     67.620 5.854e-05 ***
scale(bac)     1   31.636       192     35.984 1.860e-08 ***
officer        2    0.691       190     35.293    0.7078    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m3.1)
[1] 52

Call:
glm(formula = is.fine ~ scale(age) + is.night + scale(speed) + 
    prior_offence + scale(bac) + officer, family = "binomial", 
    data = dd)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.7769   0.0001   0.0039   0.0446   2.1237  

Coefficients:
                        Estimate Std. Error z value Pr(>|z|)    
(Intercept)              35.2649  4197.0538   0.008 0.993296    
scale(age)               -4.3399     1.3142  -3.302 0.000959 ***
is.night                 -0.3967     1.0791  -0.368 0.713160    
scale(speed)              2.9079     0.8841   3.289 0.001005 ** 
prior_offenceCD60       -55.0594  7756.2929  -0.007 0.994336    
prior_offenceDR50       -23.7249  4197.0523  -0.006 0.995490    
prior_offenceDR80       -35.5496  4197.0547  -0.008 0.993242    
prior_offenceN          -26.9201  4197.0522  -0.006 0.994882    
prior_offencePL10       -23.5650  4313.3609  -0.005 0.995641    
prior_offenceSP50       -21.1384  5901.5405  -0.004 0.997142    
 [ reached getOption("max.print") -- omitted 6 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 205.610  on 205  degrees of freedom
Residual deviance:  35.293  on 190  degrees of freedom
  (44 observations deleted due to missingness)
AIC: 67.293

Number of Fisher Scoring iterations: 17

m3.1_b <- glm(is.fine ~ scale(speed) * scale(bac), data = dd, 
    family = "binomial")
[1] 53
anova(m3.1_b, test = "Chisq")
[1] 54
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.fine

Terms added sequentially (first to last)


                        Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                                      242     238.69              
scale(speed)             1   86.025       241     152.67 < 2.2e-16 ***
scale(bac)               1   22.540       240     130.13 2.058e-06 ***
scale(speed):scale(bac)  1   11.943       239     118.18 0.0005485 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m3.1_b)
[1] 55

Call:
glm(formula = is.fine ~ scale(speed) * scale(bac), family = "binomial", 
    data = dd)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.81073   0.09498   0.24210   0.38868   2.54865  

Coefficients:
                        Estimate Std. Error z value Pr(>|z|)    
(Intercept)               2.8402     0.3496   8.124 4.50e-16 ***
scale(speed)              2.1197     0.3834   5.529 3.22e-08 ***
scale(bac)                0.4234     0.3557   1.190 0.233925    
scale(speed):scale(bac)  -1.5297     0.4247  -3.601 0.000317 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 118.18  on 239  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 126.18

Number of Fisher Scoring iterations: 6

standardCoefs(m3.1_b)
[1] 56
                                 b       beta
scale(speed)             2.1197025  5.3302571
scale(bac)               0.4234478  0.9518672
scale(speed):scale(bac) -1.5296708 -3.8131133
levels(dd$prior_offence)
[1] 57
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
drink_offence <- data.frame(prior_offence = dd$prior_offence[dd$prior_offence != 
    "N"], is.drink_offence = ifelse(dd$prior_offence[dd$prior_offence != 
    "N"] == "DR50" | dd$prior_offence[dd$prior_offence != "N"] == 
    "TS70,DR50", 1, 0), is.fine = dd$is.fine[dd$prior_offence != 
    "N"])
[1] 58
m3.2 <- glm(is.fine ~ is.drink_offence, data = drink_offence, 
    family = "binomial")
[1] 59
anova(m3.2, test = "Chisq")
[1] 60
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.fine

Terms added sequentially (first to last)


                 Df Deviance Resid. Df Resid. Dev Pr(>Chi)  
NULL                                60     51.047           
is.drink_offence  1   3.6421        59     47.405  0.05633 .
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
dd$is.offence <- ifelse(dd$prior_offence == "N", 0, 1)
[1] 61
m3.3 <- glm(is.fine ~ is.offence, data = dd, family = "binomial")
[1] 62
anova(m3.3, test = "Chisq")
[1] 63
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.fine

Terms added sequentially (first to last)


           Df Deviance Resid. Df Resid. Dev Pr(>Chi)
NULL                         245     237.06         
is.offence  1  0.86504       244     236.20   0.3523
m4 <- glm(is.fine ~ scale(age) + is.night + scale(speed) + prior_offence + 
    scale(bac), data = dd, family = "binomial")
[1] 64
pred_fine <- data.frame(age = 17:90, prior_offence = "N", is.night = 0, 
    speed = 30, bac = 0)
[1] 65
log_odds <- predict(m4, newdata = pred_fine)
[1] 66
logit.to.p <- function(logits) {
    exp(logits)/(exp(logits) + 1)
}
[1] 67
pred_fine$p.fine <- logit.to.p(log_odds)
[1] 68
par(mfrow = c(1, 1))
[1] 69
$mfrow
[1] 2 2

ggplot(pred_fine, aes(x = age)) + geom_point(aes(y = p.fine), 
    col = "darkgreen") + theme_minimal() + labs(x = "Age", y = "Estimated Probability of Getting Fine")
[1] 70
ggplot(data = dd, aes(x = age)) + geom_point(aes(y = is.fine), 
    position = "jitter", col = "darkgreen") + theme_minimal() + 
    facet_grid(. ~ officer)
[1] 71
cop_AS <- na.omit(data.frame(age = dd$age[dd$officer == "AS"], 
    police = dd$officer[dd$officer == "AS"], is.fine = dd$is.fine[dd$officer == 
        "AS"]))
[1] 72
cop_IT <- na.omit(data.frame(age = dd$age[dd$officer == "IT"], 
    police = dd$officer[dd$officer == "IT"], is.fine = dd$is.fine[dd$officer == 
        "IT"]))
[1] 73
cop_NP <- na.omit(data.frame(age = dd$age[dd$officer == "NP"], 
    police = dd$officer[dd$officer == "NP"], is.fine = dd$is.fine[dd$officer == 
        "NP"]))
[1] 74
with(cop_AS, cor.test(age, is.fine))
[1] 75

	Pearson's product-moment correlation

data:  age and is.fine
t = -9.6219, df = 101, p-value = 6.111e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.7806111 -0.5749862
sample estimates:
       cor 
-0.6915584 

with(cop_IT, cor.test(age, is.fine))
[1] 76

	Pearson's product-moment correlation

data:  age and is.fine
t = -2.9507, df = 53, p-value = 0.004712
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.5828470 -0.1225483
sample estimates:
      cor 
-0.375633 

with(cop_NP, cor.test(age, is.fine))
[1] 77

	Pearson's product-moment correlation

data:  age and is.fine
t = -2.813, df = 57, p-value = 0.006721
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.5555568 -0.1022027
sample estimates:
      cor 
-0.349147 

m5_AS <- glm(is.fine ~ age, data = cop_AS, family = "binomial")
[1] 78
anova(m5_AS)
[1] 79
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.fine

Terms added sequentially (first to last)


     Df Deviance Resid. Df Resid. Dev
NULL                   102    106.848
age   1   56.809       101     50.039
m5_IT <- glm(is.fine ~ age, data = cop_IT, family = "binomial")
[1] 80
anova(m5_IT)
[1] 81
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.fine

Terms added sequentially (first to last)


     Df Deviance Resid. Df Resid. Dev
NULL                    54     57.706
age   1   7.7446        53     49.961
m5_NP <- glm(is.fine ~ age, data = cop_NP, family = "binomial")
[1] 82
anova(m5_NP)
[1] 83
Analysis of Deviance Table

Model: binomial, link: logit

Response: is.fine

Terms added sequentially (first to last)


     Df Deviance Resid. Df Resid. Dev
NULL                    58     53.699
age   1   7.4755        57     46.224
