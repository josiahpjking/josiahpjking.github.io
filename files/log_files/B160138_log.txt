

	####### B160138 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
require(lsr, quietly = T)
[1] 2
[1] TRUE
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
describe(drinkdriving)
[1] 4
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
table(drinkdriving$age)
[1] 5

14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 
 1  5  2  3  1  2  3  6  2  5  8  3  2  2  5  4  4  4  6  5  9  8  3  4  2 10  5  6  5  3  2  3  4  5  2  3  3  3  6  3  5  4  3  4  4 
59 60 61 62 63 
 1  5  3  3  2 
 [ reached getOption("max.print") -- omitted 15 entries ]
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 6
drinkdriving$age <- as.integer(drinkdriving$age)
[1] 7
table(drinkdriving$nighttime)
[1] 8

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "day"
[1] 9
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 10
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 11
table(drinkdriving$prior_offence)
[1] 12

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence <- factor(drinkdriving$prior_offence)
[1] 13
table(drinkdriving$bac)
[1] 14

3.98678518191804 5.45295079276351 5.61849660215689 6.39815180420771 6.45232354218363 8.55241944417923 9.16715954067682 
               1                1                1                1                1                1                1 
9.25348198083096 9.49752435423211 9.81747807144744 10.0454646939566 10.2699286970084 10.4971185812798 10.6649017352481 
               1                1                1                1                1                1                1 
 11.199644560097 11.8177151563139  12.383382856562 12.7426098538045 13.5320753875597 13.8631845587114 14.1159208271656 
               1                1                1                1                1                1                1 
14.2071322668145 14.3140134442539  14.817899748919 14.9946701515397 15.2439189096081 15.5051277092158  15.989616149418 
               1                1                1                1                1                1                1 
16.0452635279057 16.0927774247029 16.1947203748598 16.2228619659442 16.3696120796151 16.4455909694064 16.6523626858628 
               1                1                1                1                1                1                1 
16.8576234110825 17.1063627259339 17.3301216655205 17.4520816674849 17.6730177261954 17.7137353516994 17.7755921387512 
               1                1                1                1                1                1                1 
17.8183606022586 17.8201747803163 17.8501485665444 17.9707079305316 17.9844835229676 18.0186086871637 18.0696136795774 
               1                1                1                1                1                1                1 
 18.247052539074 
               1 
 [ reached getOption("max.print") -- omitted 191 entries ]
drinkdriving$bac[drinkdriving$bac > 55] <- NA
[1] 15
table(drinkdriving$outcome)
[1] 16

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 17
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 18
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 19
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 20
drinkdriving$outcome <- factor(drinkdriving$outcome)
[1] 21
drinkdriving$incident_id <- factor(drinkdriving$incident_id)
[1] 22
describe(drinkdriving)
[1] 23
               vars   n  mean    sd median trimmed   mad min max range  skew kurtosis   se
age               1 225 42.68 16.77     40   41.93 17.79  14  90    76  0.40    -0.52 1.12
nighttime*        2 250  1.68  0.47      2    1.73  0.00   1   2     1 -0.79    -1.39 0.03
prior_offence*    3 250  7.58  1.32      8    7.71  0.00   1  13    12 -1.07     7.48 0.08
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 24
summary(m1)
[1] 25

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

hist(resid(m1))
[1] 26
summary(drinkdriving)
[1] 27
      age        nighttime   prior_offence     speed             bac            outcome     incident_id 
 Min.   :14.00   day  : 79   N      :185   Min.   :  0.00   Min.   : 3.987   fine   :202   inc_1  :  1  
 1st Qu.:30.00   night:171   DR50   : 43   1st Qu.: 30.92   1st Qu.:19.215   warning: 48   inc_10 :  1  
 Median :40.00               DD20   :  4   Median : 40.64   Median :23.504                 inc_100:  1  
 Mean   :42.68               DR80   :  4   Mean   : 40.49   Mean   :23.292                 inc_101:  1  
 3rd Qu.:55.00               TS70   :  3   3rd Qu.: 48.84   3rd Qu.:27.789                 inc_102:  1  
 Max.   :90.00               CD10   :  2   Max.   :120.34   Max.   :36.138                 inc_103:  1  
 NA's   :25                  (Other):  9                    NA's   :7                      (Other):244  
with(drinkdriving, plot(bac ~ age))
[1] 28
abline(m1)
[1] 29
summary(drinkdriving$age)
[1] 30
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  14.00   30.00   40.00   42.68   55.00   90.00      25 
standardCoefs(m1)
[1] 31
             b       beta
age -0.1373039 -0.3719763
p_50y <- data.frame(age = c(50))
[1] 32
predict(m1, newdata = p_50y)
[1] 33
       1 
21.81983 
hist(resid(m1))
[1] 34
plot(m1)
[1] 35
model_time <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 36
anova(model_time)
[1] 37
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14  38.345 2.969e-09 ***
nighttime   1  721.4  721.42  23.783 2.096e-06 ***
Residuals 215 6521.7   30.33                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(model_time)
[1] 38

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.5254  -4.6056   0.3152   3.7847  14.3450 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    25.60505    1.19731  21.386  < 2e-16 ***
age            -0.12800    0.02225  -5.752 3.01e-08 ***
nighttimenight  3.92560    0.80496   4.877 2.10e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.508 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2242,	Adjusted R-squared:  0.217 
F-statistic: 31.06 on 2 and 215 DF,  p-value: 1.409e-12

standardCoefs(model_time)
[1] 39
                        b       beta
age            -0.1280045 -0.3467829
nighttimenight  3.9255993  0.2940316
model_speed <- lm(bac ~ age + speed, data = drinkdriving)
[1] 40
anova(model_speed)
[1] 41
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14 34.6961 1.471e-08 ***
speed       1   35.5   35.50  1.0589    0.3046    
Residuals 215 7207.6   33.52                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(model_speed)
[1] 42

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4118  -3.8926  -0.6094   4.1298  14.4229 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.08699    2.74183   9.514  < 2e-16 ***
age         -0.11540    0.03156  -3.656 0.000322 ***
speed        0.04320    0.04198   1.029 0.304616    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.79 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.574e-08

standardCoefs(model_speed)
[1] 43
                b        beta
age   -0.11540319 -0.31264411
speed  0.04320228  0.08799588
model_st <- lm(bac ~ age + speed + nighttime, data = drinkdriving)
[1] 44
anova(model_st)
[1] 45
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14 38.3777 2.948e-09 ***
speed       1   35.5   35.50  1.1713    0.2804    
nighttime   1  721.8  721.75 23.8141 2.071e-06 ***
Residuals 214 6485.9   30.31                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(model_st)
[1] 46

Call:
lm(formula = bac ~ age + speed + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.7811  -4.6224   0.5195   3.7225  14.2190 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    22.99435    2.68293   8.571 2.06e-15 ***
age            -0.10600    0.03007  -3.525 0.000518 ***
speed           0.04340    0.03992   1.087 0.278151    
nighttimenight  3.92649    0.80461   4.880 2.07e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

t.test(speed ~ nighttime, drinkdriving)
[1] 47

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.71535, df = 158.46, p-value = 0.4754
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.371172  2.514895
sample estimates:
  mean in group day mean in group night 
           39.50953            40.93767 

dd_fine <- drinkdriving
[1] 48
dd_fine$outcome <- as.character(dd_fine$outcome)
[1] 49
dd_fine$outcome[dd_fine$outcome == "fine"] <- "1"
[1] 50
dd_fine$outcome[dd_fine$outcome == "warning"] <- "0"
[1] 51
dd_fine$outcome <- as.numeric(dd_fine$outcome)
[1] 52
model_fine <- lm(outcome ~ speed + bac, data = dd_fine)
[1] 53
summary(model_fine)
[1] 54

Call:
lm(formula = outcome ~ speed + bac, data = dd_fine)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.29504 -0.15823  0.07909  0.23667  0.58921 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) -0.058490   0.081465  -0.718    0.473    
speed        0.012321   0.001644   7.494 1.28e-12 ***
bac          0.015984   0.003400   4.701 4.37e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3196 on 240 degrees of freedom
  (7 observations deleted due to missingness)
Multiple R-squared:  0.3532,	Adjusted R-squared:  0.3478 
F-statistic: 65.54 on 2 and 240 DF,  p-value: < 2.2e-16

dd_offence <- dd_fine
[1] 55
levels(dd_offence$prior_offence)
[1] 56
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
levels(dd_offence$prior_offence) <- c("N", "N", "N", "N", "N", 
    "DR50", "N", "N", "N", "N", "N", "N", "N")
[1] 57
levels(dd_offence$prior_offence)
[1] 58
[1] "N"    "DR50"
t.test(outcome ~ prior_offence, data = dd_offence)
[1] 59

	Welch Two Sample t-test

data:  outcome by prior_offence
t = -3.0317, df = 93.451, p-value = 0.003147
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.24431468 -0.05093304
sample estimates:
   mean in group N mean in group DR50 
         0.7826087          0.9302326 

drinkdriving_cleaned <- dd_fine
[1] 60
levels(drinkdriving_cleaned$prior_offence)
[1] 61
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
levels(drinkdriving_cleaned$prior_offence) <- c("O", "O", "O", 
    "O", "O", "O", "O", "N", "O", "O", "O", "O", "O")
[1] 62
levels(drinkdriving_cleaned$prior_offence)
[1] 63
[1] "O" "N"
t.test(outcome ~ prior_offence, data = drinkdriving_cleaned)
[1] 64

	Welch Two Sample t-test

data:  outcome by prior_offence
t = 0.55566, df = 118.25, p-value = 0.5795
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.0788845  0.1404230
sample estimates:
mean in group O mean in group N 
      0.8307692       0.8000000 

m_prediction <- glm(outcome ~ age, data = dd_fine, family = binomial, 
    na.action = na.exclude)
[1] 65
summary(m_prediction)
[1] 66

Call:
glm(formula = outcome ~ age, family = binomial, data = dd_fine, 
    na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.0363   0.1488   0.2993   0.5106   2.1778  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  6.41889    0.87727   7.317 2.54e-13 ***
age         -0.10107    0.01577  -6.408 1.48e-10 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 154.65  on 223  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.65

Number of Fisher Scoring iterations: 6

with(dd_fine, plot(fitted(m_prediction)[order(age)] ~ age[order(age)], 
    type = "l", xlab = "age", ylab = "outcome", main = "probability of getting a fine in different age", 
    col = "orange", lwd = 2))
[1] 67
dd_officer <- merge(dd_fine, officer_inc, by = "incident_id")
[1] 68
levels(dd_officer$officer) <- c("1", "2", "3")
[1] 69
m_officer <- glm(outcome ~ officer * age, data = dd_officer, 
    family = binomial)
[1] 70
anova(m_officer)
[1] 71
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


            Df Deviance Resid. Df Resid. Dev
NULL                          224     222.38
officer      2    0.356       222     222.03
age          1   68.233       221     153.79
officer:age  2    7.383       219     146.41
