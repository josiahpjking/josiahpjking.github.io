

	####### B157213 R script #######

load(url("https://edin.ac/2QCZNVu"))
[1] 1
[1] "drinkdriving" "officer_inc" 
library(psych, quietly = T)
[1] 2
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
describe(drinkdriving)
[1] 3
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
summary(drinkdriving)
[1] 4
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
drinkdriving$age[drinkdriving$age > 120] <- NA
[1] 5
levels(as.factor(drinkdriving$nighttime))
[1] 6
[1] "18:25" "2:05"  "day"   "night"
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "night"
[1] 7
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 8
levels(as.factor(drinkdriving$outcome))
[1] 9
[1] "fine"    "Fine"    "FINE"    "warning" "Warning" "WARNING"
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 10
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 11
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 12
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 13
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 14
summary(m1)
[1] 15

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.719  -4.516  -0.861   3.849  42.785 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 29.29455    1.25564  23.330  < 2e-16 ***
age         -0.14353    0.02741  -5.236 3.86e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.82 on 218 degrees of freedom
  (30 observations deleted due to missingness)
Multiple R-squared:  0.1117,	Adjusted R-squared:  0.1076 
F-statistic: 27.41 on 1 and 218 DF,  p-value: 3.863e-07

par(mfrow = c(2, 2))
[1] 16
$mfrow
[1] 1 1

plot(m1, which = c(1:4))
[1] 17
fif.alc <- coef(m1)[1] + 50 * coef(m1)[2]
[1] 18
print(fif.alc)
[1] 19
(Intercept) 
   22.11824 
(Intercept) 
   22.11824 
hist(resid(m1), main = "Histogram of residual", xlab = "value of residual")
[1] 20
m2 <- lm(bac ~ speed + nighttime + age, data = drinkdriving)
[1] 21
anova(m2)
[1] 22
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
speed       1 2182.4 2182.38 55.7177 2.028e-12 ***
nighttime   1  733.4  733.42 18.7247 2.309e-05 ***
age         1   37.1   37.14  0.9481    0.3313    
Residuals 216 8460.4   39.17                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2)
[1] 23

Call:
lm(formula = bac ~ speed + nighttime + age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-13.291  -4.650   0.136   3.971  33.088 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    14.15205    2.74426   5.157 5.67e-07 ***
speed           0.19824    0.03853   5.145 6.00e-07 ***
nighttimenight  3.84615    0.90937   4.229 3.46e-05 ***
age            -0.03148    0.03233  -0.974    0.331    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.258 on 216 degrees of freedom
  (30 observations deleted due to missingness)
Multiple R-squared:  0.2587,	Adjusted R-squared:  0.2484 
F-statistic: 25.13 on 3 and 216 DF,  p-value: 5.5e-14

par(mfrow = c(2, 2))
[1] 24
$mfrow
[1] 2 2

plot(m2, which = c(1:4))
[1] 25
library(car, quietly = T)
[1] 26
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
vif(m2)
[1] 27
    speed nighttime       age 
 1.641581  1.007653  1.651227 
sqrt(1.641581)
[1] 28
[1] 1.281242
sqrt(1.007653)
[1] 29
[1] 1.003819
sqrt(1.651227)
[1] 30
[1] 1.285001
t.test(speed ~ nighttime, data = drinkdriving)
[1] 31

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.85812, df = 155.57, p-value = 0.3921
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.669084  2.235272
sample estimates:
  mean in group day mean in group night 
           39.30514            41.02205 

drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 32
m3a <- glm(outcome ~ age + nighttime + speed + bac, data = drinkdriving, 
    family = binomial)
[1] 33
library(car, quietly = T)
[1] 34
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
anova(m3a)
[1] 35
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


          Df Deviance Resid. Df Resid. Dev
NULL                        219     217.38
age        1   67.049       218     150.33
nighttime  1    0.846       217     149.48
speed      1   25.173       216     124.31
bac        1   18.027       215     106.28
summary(m3a)
[1] 36

Call:
glm(formula = outcome ~ age + nighttime + speed + bac, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3290  -0.3674  -0.1510  -0.0312   3.5357  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)     4.82142    2.18300   2.209 0.027201 *  
age             0.04621    0.02018   2.290 0.022021 *  
nighttimenight  0.09230    0.55790   0.165 0.868592    
speed          -0.13780    0.03365  -4.095 4.23e-05 ***
bac            -0.19513    0.05175  -3.770 0.000163 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 217.38  on 219  degrees of freedom
Residual deviance: 106.28  on 215  degrees of freedom
  (30 observations deleted due to missingness)
AIC: 116.28

Number of Fisher Scoring iterations: 7

exp(coef(m3a))
[1] 37
   (Intercept)            age nighttimenight          speed            bac 
   124.1411418      1.0472932      1.0966970      0.8712745      0.8227285 
m3b <- glm(outcome ~ scale(speed) + scale(bac), data = drinkdriving, 
    family = binomial)
[1] 38
summary(m3b)
[1] 39

Call:
glm(formula = outcome ~ scale(speed) + scale(bac), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9536  -0.4434  -0.1852  -0.0436   4.0812  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.8600     0.3706  -7.717 1.19e-14 ***
scale(speed)  -2.1932     0.3850  -5.696 1.23e-08 ***
scale(bac)    -1.2910     0.3076  -4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 239.55  on 244  degrees of freedom
Residual deviance: 130.13  on 242  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 7

exp(coef(m3b))
[1] 40
 (Intercept) scale(speed)   scale(bac) 
  0.05726913   0.11155686   0.27500575 
levels(as.factor(drinkdriving$prior_offence))
[1] 41
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60,CD60"] <- "CD60"
[1] 42
drinkdriving$drinking_offence <- drinkdriving$prior_offence == 
    "DR50" | drinkdriving$prior_offence == "TS70,DR50"
[1] 43
m3c <- glm(outcome ~ drinking_offence, data = drinkdriving, family = binomial)
[1] 44
summary(m3c)
[1] 45

Call:
glm(formula = outcome ~ drinking_offence, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.6932  -0.6932  -0.6932  -0.4366   2.1899  

Coefficients:
                     Estimate Std. Error z value Pr(>|z|)    
(Intercept)           -1.3034     0.1700  -7.667 1.76e-14 ***
drinking_offenceTRUE  -0.9992     0.5512  -1.813   0.0699 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 240.50  on 248  degrees of freedom
AIC: 244.5

Number of Fisher Scoring iterations: 4

drinkdriving$motoring_offence <- drinkdriving$prior_offence != 
    "N"
[1] 46
m3d <- glm(outcome ~ motoring_offence, data = drinkdriving, family = binomial)
[1] 47
summary(m3d)
[1] 48

Call:
glm(formula = outcome ~ motoring_offence, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.6681  -0.6681  -0.6681  -0.6089   1.8849  

Coefficients:
                     Estimate Std. Error z value Pr(>|z|)    
(Intercept)           -1.3863     0.1838  -7.542 4.62e-14 ***
motoring_offenceTRUE  -0.2048     0.3784  -0.541    0.588    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 244.26  on 248  degrees of freedom
AIC: 248.26

Number of Fisher Scoring iterations: 4

pred.fine <- data.frame(age = c(0:100), speed = 30, bac = 0, 
    nighttime = "day", motoring_offence = F)
[1] 49
pf <- predict(m3a, pred.fine, type = "response")
[1] 50
library(ggplot2, quietly = T)
[1] 51
 [1] "ggplot2"   "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
pred.fine$model_prediction <- pf
[1] 52
ggplot(data = pred.fine) + aes(x = age, y = model_prediction) + 
    geom_point() + xlab("age of drivers") + ylab("predicted probabilities of being fining (%)")
[1] 53
bias <- merge(officer_inc, drinkdriving, by = "incident_id")
[1] 54
bias = bias[bias$outcome == "fine", ]
[1] 55
m5 <- aov(age ~ officer, data = bias)
[1] 56
summary(m5)
[1] 57
             Df Sum Sq Mean Sq F value  Pr(>F)   
officer       2   1976   987.8   5.141 0.00675 **
Residuals   178  34202   192.1                   
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
21 observations deleted due to missingness
ggplot(data = subset(bias, !is.na(age))) + aes(x = officer, y = age, 
    fill = officer) + geom_boxplot()
[1] 58
library(stats, quietly = T)
[1] 59
 [1] "ggplot2"   "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
TukeyHSD(m5)
[1] 60
  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = age ~ officer, data = bias)

$officer
           diff        lwr       upr     p adj
IT-AS 6.5207280  0.5362440 12.505212 0.0290292
NP-AS 6.7021832  0.8382704 12.566096 0.0205945
NP-IT 0.1814552 -6.5444808  6.907391 0.9977610

pairwise.t.test(x = bias$age, g = bias$officer, p.adjust.method = "BH")
[1] 61

	Pairwise comparisons using t tests with pooled SD 

data:  bias$age and bias$officer 

   AS    IT   
IT 0.016 -    
NP 0.016 0.949

P value adjustment method: BH 
