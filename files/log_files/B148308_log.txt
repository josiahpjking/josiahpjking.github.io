

	####### B148308 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 2
[1] "drinkdriving" "officer_inc" 
drinkdriving$age[drinkdriving$age >= 120] <- NA
[1] 3
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- NA
[1] 4
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- NA
[1] 5
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 6
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 7
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 8
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 9
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 10
drinkdriving$outcome.s <- 1
[1] 11
drinkdriving$outcome.s[drinkdriving$outcome == "warning"] <- 0
[1] 12
drinkdriving$outcome.s <- as.factor(drinkdriving$outcome.s)
[1] 13
drinkdriving$bac[drinkdriving$bac >= 45] <- NA
[1] 14
df <- merge(drinkdriving, officer_inc, all.x = T)
[1] 15
sum(!complete.cases(drinkdriving))
[1] 16
[1] 38
df$nighttime <- as.factor(df$nighttime)
[1] 17
df$prior_offence <- as.factor(df$prior_offence)
[1] 18
df$outcome <- as.factor(df$outcome)
[1] 19
m1 <- lm(bac ~ age, data = df)
[1] 20
summary(m1)
[1] 21

Call:
lm(formula = bac ~ age, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

plot(df$age, df$bac, main = "Scatterplot to compare Blood Alcohol Content \n against Age of Driver", 
    xlab = "Age of Driver", ylab = "Blood Alcohol Content (BAC)", 
    pch = 20)
[1] 22
abline(m1, col = "red")
[1] 23
predict(m1, data.frame(age = 50))
[1] 24
       1 
21.81983 
plot(m1, which = c(2))
[1] 25
bac_age_time <- lm(bac ~ age + nighttime, data = df)
[1] 26
summary(bac_age_time)
[1] 27

Call:
lm(formula = bac ~ age + nighttime, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3421  -4.3987   0.2997   3.7390  14.4090 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    26.00346    1.18497  21.944  < 2e-16 ***
age            -0.13690    0.02209  -6.199 2.91e-09 ***
nighttimenight  3.86857    0.79364   4.874 2.13e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.417 on 213 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.2422,	Adjusted R-squared:  0.235 
F-statistic: 34.03 on 2 and 213 DF,  p-value: 1.498e-13

bac_age_speed <- lm(bac ~ age + speed, data = df)
[1] 28
summary(bac_age_speed)
[1] 29

Call:
lm(formula = bac ~ age + speed, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4118  -3.8926  -0.6094   4.1298  14.4229 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.08699    2.74183   9.514  < 2e-16 ***
age         -0.11540    0.03156  -3.656 0.000322 ***
speed        0.04320    0.04198   1.029 0.304616    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.79 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.574e-08

par(mfrow = c(2, 2))
[1] 30
$mfrow
[1] 1 1

plot(bac_age_time, which = c(1:4))
[1] 31
plot(bac_age_speed, which = c(1:4))
[1] 32
bac_variation <- lm(bac ~ age + speed + nighttime + age:speed:nighttime, 
    data = df)
[1] 33
summary(bac_variation)
[1] 34

Call:
lm(formula = bac ~ age + speed + nighttime + age:speed:nighttime, 
    data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.8429  -4.6178   0.5341   3.5737  14.9804 

Coefficients:
                           Estimate Std. Error t value Pr(>|t|)    
(Intercept)              25.2786314  5.7497745   4.396 1.75e-05 ***
age                      -0.0969295  0.0677939  -1.430    0.154    
speed                     0.0548947  0.0852267   0.644    0.520    
nighttimenight            1.2581287  4.0250656   0.313    0.755    
age:speed:nighttimeday   -0.0020646  0.0027332  -0.755    0.451    
age:speed:nighttimenight -0.0003106  0.0017794  -0.175    0.862    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.434 on 210 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.2481,	Adjusted R-squared:  0.2302 
F-statistic: 13.86 on 5 and 210 DF,  p-value: 1.057e-11

par(mfrow = c(1, 1))
[1] 35
$mfrow
[1] 2 2

plot(df$nighttime, df$speed, main = "Speed of Drivers depending on the Time of Day", 
    xlab = "Time of Day", ylab = "Speed (mph)")
[1] 36
t.test(speed ~ nighttime, data = df, na.rm = T)
[1] 37

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.7709, df = 156.78, p-value = 0.4419
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.513418  2.417929
sample estimates:
  mean in group day mean in group night 
           39.30514            40.85289 

df$offence[df$prior_offence == "N"] <- "N"
[1] 38
df$offence[df$prior_offence != "N"] <- "Y"
[1] 39
df$offence <- as.factor(df$offence)
[1] 40
mthree_one <- glm(outcome.s ~ age + nighttime + offence + speed + 
    bac, family = binomial, data = df)
[1] 41
anova(mthree_one)
[1] 42
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome.s

Terms added sequentially (first to last)


          Df Deviance Resid. Df Resid. Dev
NULL                        211     208.23
age        1   79.883       210     128.35
nighttime  1    1.243       209     127.11
offence    1    1.891       208     125.22
speed      1   24.592       207     100.62
bac        1   18.962       206      81.66
anova(mthree_one, test = "Chisq")
[1] 43
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome.s

Terms added sequentially (first to last)


          Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                        211     208.23              
age        1   79.883       210     128.35 < 2.2e-16 ***
nighttime  1    1.243       209     127.11    0.2649    
offence    1    1.891       208     125.22    0.1691    
speed      1   24.592       207     100.62 7.083e-07 ***
bac        1   18.962       206      81.66 1.333e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
mthree_one.s <- glm(outcome ~ scale(speed) + scale(bac), data = df, 
    family = binomial)
[1] 44
summary(mthree_one.s)
[1] 45

Call:
glm(formula = outcome ~ scale(speed) + scale(bac), family = binomial, 
    data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9536  -0.4458  -0.1875  -0.0489   4.0812  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.8061     0.3647  -7.694 1.43e-14 ***
scale(speed)  -2.1932     0.3850  -5.697 1.22e-08 ***
scale(bac)    -1.1486     0.2737  -4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 130.13  on 240  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 6

df$drinkoffence[df$prior_offence != "N"] <- "N"
[1] 46
df$drinkoffence[df$prior_offence == "DR50"] <- "Y"
[1] 47
df$drinkoffence[df$prior_offence == "TS70,DR50"] <- "Y"
[1] 48
df$drinkoffence <- as.factor(df$drinkoffence)
[1] 49
chisq.test(df$drinkoffence, df$outcome)
[1] 50

	Pearson's Chi-squared test with Yates' continuity correction

data:  df$drinkoffence and df$outcome
X-squared = 2.5724, df = 1, p-value = 0.1087

table(df$drinkoffence)
[1] 51

 N  Y 
17 44 
chisq.test(df$offence, df$outcome)
[1] 52

	Pearson's Chi-squared test with Yates' continuity correction

data:  df$offence and df$outcome
X-squared = 0.52118, df = 1, p-value = 0.4703

df_4 <- data.frame(age = 14:100, offence = "N", nighttime = "day", 
    speed = 30, bac = 0)
[1] 53
df_4$model_pred <- predict(mthree_one, type = "response", newdata = df_4)
[1] 54
plot(df_4$age, df_4$model_pred, main = "Predicted outcome based on age of driver with \n other variables held constant", 
    xlab = "Age of Driver", ylab = "Probability of receving a fine", 
    type = "l", col = "red", lwd = 3)
[1] 55
qplot(data = df[!is.na(df$officer), ], x = officer, y = age, 
    fill = outcome, color = outcome, main = "Outcome of fine or warning according to age of driver \n for each officer", 
    xlab = "Officer", ylab = "Age of Driver")
[1] 56
contrasts(df$officer) <- cbind(ASvIT_NP = c(-2/3, 1/3, 1/3), 
    ITvNP = c(0, -1/2, 1/2))
[1] 57
contrasts(df$officer)
[1] 58
     ASvIT_NP ITvNP
AS -0.6666667   0.0
IT  0.3333333  -0.5
NP  0.3333333   0.5
m5_2 <- glm(outcome ~ officer * age, data = df, family = binomial)
[1] 59
summary(m5_2)
[1] 60

Call:
glm(formula = outcome ~ officer * age, family = binomial, data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4089  -0.5454  -0.2741  -0.0642   2.7179  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)         -6.32586    0.94007  -6.729 1.71e-11 ***
officerASvIT_NP      4.86500    2.23048   2.181   0.0292 *  
officerITvNP        -0.36070    1.99283  -0.181   0.8564    
age                  0.09796    0.01683   5.821 5.84e-09 ***
officerASvIT_NP:age -0.09489    0.03922  -2.419   0.0155 *  
officerITvNP:age     0.00247    0.03671   0.067   0.9464    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

