

	####### B150175 R script #######

install.packages("tidyverse")
[1] 1
library(tidyverse, quietly = T)
[1] 2
 [1] "forcats"   "stringr"   "dplyr"     "purrr"     "tidyr"     "tibble"    "ggplot2"   "tidyverse" "readr"     "stats"    
[11] "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
install.packages("ggplot2")
[1] 3
library(ggplot2, quietly = T)
[1] 4
 [1] "forcats"   "stringr"   "dplyr"     "purrr"     "tidyr"     "tibble"    "ggplot2"   "tidyverse" "readr"     "stats"    
[11] "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 5
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 6
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
summary(officer_inc)
[1] 7
 officer     incident_id 
 AS  :116   inc_1  :  1  
 IT  : 66   inc_10 :  1  
 NP  : 67   inc_100:  1  
 NA's:  1   inc_101:  1  
            inc_102:  1  
            inc_103:  1  
            (Other):244  
numeric_data <- drinkdriving %>% select(age, speed, bac) %>% 
    filter(!is.na(age) & !is.na(bac))
[1] 8
cor(numeric_data)
[1] 9
             age      speed        bac
age    1.0000000 -0.4621241 -0.3833073
speed -0.4621241  1.0000000  0.4600931
bac   -0.3833073  0.4600931  1.0000000
reg_test <- lm(bac ~ age + speed, data = drinkdriving)
[1] 10
summary(reg_test)
[1] 11

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.981  -4.392  -0.692   4.203  34.769 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 17.87310    1.80048   9.927  < 2e-16 ***
age         -0.04790    0.01454  -3.294  0.00115 ** 
speed        0.18795    0.03442   5.460 1.28e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.467 on 220 degrees of freedom
  (27 observations deleted due to missingness)
Multiple R-squared:  0.2487,	Adjusted R-squared:  0.2419 
F-statistic: 36.42 on 2 and 220 DF,  p-value: 2.175e-14

unique(drinkdriving$age)
[1] 12
 [1]  39  28  38  51  56  36  81  49  32  60  41  23  35  47  NA  43  34  48  33  65  21  46  16  53  52  50  66  59  69  70  55  54
[33]  57  31  15 293  22  77  20  45  42  24  68  40  62  58  27  30  26  86
 [ reached getOption("max.print") -- omitted 16 entries ]
unique(drinkdriving$speed)
[1] 13
 [1] 47.957110 43.826353 47.260707 17.221097  1.945818 41.399468  1.012149 34.377506 63.748159  2.533468 50.049472 47.658553 46.209515
[14] 35.044348 45.911152 41.971790 59.500756 38.544314 45.294085 33.660408 66.359756 59.538043 26.205563 49.692191 35.759413 48.880880
[27] 44.464566 34.639220 36.609294 24.917257 13.069805 19.008994 41.009485 36.335035 56.428161 30.141277 45.716490 41.609061 53.768251
[40] 46.424053 23.599427 52.982425 41.674665 38.867482 41.537199 32.599695 61.109335 39.685430 12.246206 64.659834
 [ reached getOption("max.print") -- omitted 200 entries ]
drinkdriving <- drinkdriving %>% filter(!is.na(age) & !is.na(bac))
[1] 14
outliers <- boxplot(numeric_data$age)$out
[1] 15
drinkdriving <- drinkdriving %>% filter(!(age %in% outliers))
[1] 16


####################################################################################################

[1] "Error in age %in% outliers : object 'outliers' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in age %in% outliers: object 'outliers' not found>
####################################################################################################


table(drinkdriving$outcome)
[1] 17

   fine    Fine    FINE warning Warning WARNING 
    166       2       9      42       1       3 
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 18
table(drinkdriving$nighttime)
[1] 19

 2:05   day night 
    2    72   149 
drinkdriving$nighttime <- ifelse(drinkdriving$nighttime == "day", 
    "day", "night")
[1] 20
unique(drinkdriving$prior_offence)
[1] 21
 [1] "N"              "DR50"           "DR80"           "DD20"           "PL10"           "CD10"           "SP50"          
 [8] "TS70"           "CD60,CD60"      "SP60"           "CD60"           "CD60,CD10,DR80" "TS70,DR50"     
summary(officer_inc)
[1] 22
 officer     incident_id 
 AS  :116   inc_1  :  1  
 IT  : 66   inc_10 :  1  
 NP  : 67   inc_100:  1  
 NA's:  1   inc_101:  1  
            inc_102:  1  
            inc_103:  1  
            (Other):244  
officer_inc <- officer_inc %>% filter(!is.na(officer))
[1] 23
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 24
summary(m1)
[1] 25

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.404  -4.058  -0.887   3.855  42.638 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.84806    0.78120  34.368  < 2e-16 ***
age         -0.08460    0.01371  -6.169 3.23e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.875 on 221 degrees of freedom
Multiple R-squared:  0.1469,	Adjusted R-squared:  0.1431 
F-statistic: 38.06 on 1 and 221 DF,  p-value: 3.23e-09

predict(m1, newdata = data.frame(age = 50))
[1] 26
       1 
22.61829 
hist(residuals(m1), main = "Histogram of residuals")
[1] 27
drinkdriving$night <- ifelse(drinkdriving$nighttime == "night", 
    1, 0)
[1] 28
m2 <- lm(bac ~ age + speed + night, data = drinkdriving)
[1] 29
summary(m2)
[1] 30

Call:
lm(formula = bac ~ age + speed + night, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-13.422  -4.636   0.166   4.005  33.517 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 15.01973    1.87307   8.019 6.37e-14 ***
age         -0.04169    0.01413  -2.951  0.00352 ** 
speed        0.18967    0.03325   5.704 3.76e-08 ***
night        3.69294    0.90050   4.101 5.80e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.246 on 219 degrees of freedom
Multiple R-squared:  0.3023,	Adjusted R-squared:  0.2928 
F-statistic: 31.63 on 3 and 219 DF,  p-value: < 2.2e-16

summary(m2)$r.square
[1] 31
[1] 0.3023102
m23 <- lm(speed ~ night, data = drinkdriving)
[1] 32
summary(m23)
[1] 33

Call:
lm(formula = speed ~ night, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-39.174  -9.059   0.401   7.946  82.427 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)   37.910      1.678   22.59   <2e-16 ***
night          1.264      2.039    0.62    0.536    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.24 on 221 degrees of freedom
Multiple R-squared:  0.001737,	Adjusted R-squared:  -0.00278 
F-statistic: 0.3845 on 1 and 221 DF,  p-value: 0.5359

drinkdriving$offence <- ifelse(drinkdriving$prior_offence == 
    "N", 0, 1)
[1] 34
drinkdriving$outcome <- ifelse(drinkdriving$outcome == "fine", 
    1, 0)
[1] 35
m3 <- glm(outcome ~ age + night + offence + speed + bac, data = drinkdriving)
[1] 36
summary(m3)
[1] 37

Call:
glm(formula = outcome ~ age + night + offence + speed + bac, 
    data = drinkdriving)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.01847  -0.10079   0.09683   0.22083   0.54477  

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.3002572  0.1118561   2.684 0.007829 ** 
age         -0.0027153  0.0007547  -3.598 0.000397 ***
night        0.0315422  0.0489300   0.645 0.519842    
offence      0.0034507  0.0499458   0.069 0.944982    
speed        0.0099750  0.0018658   5.346 2.27e-07 ***
bac          0.0091260  0.0035481   2.572 0.010775 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.1069386)

    Null deviance: 36.511  on 222  degrees of freedom
Residual deviance: 23.206  on 217  degrees of freedom
AIC: 142.25

Number of Fisher Scoring iterations: 2

m31 <- glm(outcome ~ scale(age) + scale(speed) + scale(bac), 
    data = drinkdriving)
[1] 38
anova(m31)
[1] 39
Analysis of Deviance Table

Model: gaussian, link: identity

Response: outcome

Terms added sequentially (first to last)


             Df Deviance Resid. Df Resid. Dev
NULL                           222     36.511
scale(age)    1   7.5724       221     28.939
scale(speed)  1   4.8126       220     24.126
scale(bac)    1   0.8754       219     23.251
summary(m31)
[1] 40

Call:
glm(formula = outcome ~ scale(age) + scale(speed) + scale(bac), 
    data = drinkdriving)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.00822  -0.09837   0.10375   0.22057   0.53289  

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)   0.79372    0.02182  36.377  < 2e-16 ***
scale(age)   -0.09224    0.02526  -3.652 0.000326 ***
scale(speed)  0.13996    0.02628   5.326 2.48e-07 ***
scale(bac)    0.07245    0.02523   2.871 0.004487 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.106168)

    Null deviance: 36.511  on 222  degrees of freedom
Residual deviance: 23.251  on 219  degrees of freedom
AIC: 138.68

Number of Fisher Scoring iterations: 2

drink_offence <- drinkdriving %>% filter(offence != 0) %>% mutate(drink_related = ifelse(grepl(pattern = "DR50", 
    x = prior_offence) == TRUE, 1, 0))
[1] 41
m32 <- glm(outcome ~ drink_related, data = drink_offence)
[1] 42
summary(m32)
[1] 43

Call:
glm(formula = outcome ~ drink_related, data = drink_offence)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.8974   0.1026   0.1026   0.1026   0.3000  

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)    0.70000    0.08266   8.468 1.15e-11 ***
drink_related  0.19744    0.10167   1.942   0.0571 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.1366622)

    Null deviance: 8.3051  on 58  degrees of freedom
Residual deviance: 7.7897  on 57  degrees of freedom
AIC: 53.976

Number of Fisher Scoring iterations: 2

m33 <- lm(outcome ~ offence, data = drinkdriving)
[1] 44
summary(m33)
[1] 45

Call:
lm(formula = outcome ~ offence, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.8305  0.1695  0.2195  0.2195  0.2195 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.78049    0.03169  24.627   <2e-16 ***
offence      0.05002    0.06161   0.812    0.418    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.4059 on 221 degrees of freedom
Multiple R-squared:  0.002973,	Adjusted R-squared:  -0.001538 
F-statistic: 0.6591 on 1 and 221 DF,  p-value: 0.4178

new_predict <- data.frame(age = seq(17, 66, 1), bac = rep(0, 
    50), speed = rep(30, 50))
[1] 46
predicted_fine <- predict(m31, newdata = new_predict)
[1] 47
plot(x = seq(17, 66, 1), y = predicted_fine, main = "Predicted probabilities of fine vs age", 
    xlab = "Age", ylab = "Predicted probability")
[1] 48
fine_cops <- left_join(drinkdriving, officer_inc, by = "incident_id")
[1] 49
summary(fine_cops)
[1] 50
      age          nighttime         prior_offence          speed             bac            outcome       incident_id       
 Min.   : 14.00   Length:223         Length:223         Min.   :  0.00   Min.   : 3.987   Min.   :0.0000   Length:223        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.11   1st Qu.:18.856   1st Qu.:1.0000   Class :character  
 Median : 40.00   Mode  :character   Mode  :character   Median : 38.87   Median :22.991   Median :1.0000   Mode  :character  
 Mean   : 46.03                                         Mean   : 38.77   Mean   :22.954   Mean   :0.7937                     
 3rd Qu.: 55.00                                         3rd Qu.: 46.87   3rd Qu.:26.954   3rd Qu.:1.0000                     
     night           offence       officer 
 Min.   :0.0000   Min.   :0.0000   AS:108  
 1st Qu.:0.0000   1st Qu.:0.0000   IT: 56  
 Median :1.0000   Median :0.0000   NP: 59  
 Mean   :0.6771   Mean   :0.2646           
 3rd Qu.:1.0000   3rd Qu.:1.0000           
 [ reached getOption("max.print") -- omitted 1 row ]
unique(fine_cops$officer)
[1] 51
[1] AS NP IT
Levels: AS IT NP
install.packages("ggthemes")
[1] 52
library(ggthemes, quietly = T)
[1] 53
 [1] "ggthemes"  "forcats"   "stringr"   "dplyr"     "purrr"     "tidyr"     "tibble"    "ggplot2"   "tidyverse" "readr"    
[11] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
bias_test <- ggplot(data = fine_cops, aes(x = age, y = outcome, 
    color = officer))
[1] 54
bias_test + theme_tufte() + geom_point() + facet_grid(. ~ officer)
[1] 55
contrasts(fine_cops$officer) <- cbind(ITNPvAS = c(2/3, -1/3, 
    -1/3), NPvIT = c(0, 1/2, -1/2))
[1] 56
m5 <- glm(outcome ~ age * officer, data = fine_cops)
[1] 57
summary(m5)
[1] 58

Call:
glm(formula = outcome ~ age * officer, data = fine_cops)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.05408   0.02675   0.12391   0.20135   0.60540  

Coefficients:
                     Estimate Std. Error t value Pr(>|t|)    
(Intercept)         1.1475208  0.0695740  16.494  < 2e-16 ***
age                -0.0077287  0.0014526  -5.321 2.57e-07 ***
officerITNPvAS     -0.1968882  0.1131631  -1.740   0.0833 .  
officerNPvIT        0.0079764  0.2025141   0.039   0.9686    
age:officerITNPvAS  0.0040840  0.0022782   1.793   0.0744 .  
age:officerNPvIT   -0.0009487  0.0042896  -0.221   0.8252    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.131119)

    Null deviance: 36.511  on 222  degrees of freedom
Residual deviance: 28.453  on 217  degrees of freedom
AIC: 187.71

Number of Fisher Scoring iterations: 2

