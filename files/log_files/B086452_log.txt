

	####### B086452 R script #######

library(dplyr, quietly = T)
[1] 1
[1] "dplyr"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(stringr, quietly = T)
[1] 2
 [1] "stringr"   "dplyr"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 3
 [1] "psych"     "stringr"   "dplyr"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 5
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
summary(officer_inc)
[1] 6
 officer     incident_id 
 AS  :116   inc_1  :  1  
 IT  : 66   inc_10 :  1  
 NP  : 67   inc_100:  1  
 NA's:  1   inc_101:  1  
            inc_102:  1  
            inc_103:  1  
            (Other):244  
drinkdriving <- na.omit(drinkdriving)
[1] 7
officer_inc <- na.omit(officer_inc)
[1] 8
drinkdriving <- drinkdriving[drinkdriving$age < 100, ]
[1] 9
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 10
describe(drinkdriving$age)
[1] 11
   vars   n  mean    sd median trimmed   mad min max range skew kurtosis   se
X1    1 220 42.62 16.81     40   41.85 17.79  14  90    76 0.41    -0.51 1.13
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 12
summary(m1)
[1] 13

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.719  -4.516  -0.861   3.849  42.785 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 29.29455    1.25564  23.330  < 2e-16 ***
age         -0.14353    0.02741  -5.236 3.86e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.82 on 218 degrees of freedom
Multiple R-squared:  0.1117,	Adjusted R-squared:  0.1076 
F-statistic: 27.41 on 1 and 218 DF,  p-value: 3.863e-07

pre1 <- predict(m1, newdata = data.frame(age = 50), interval = "prediction", 
    level = 0.95)
[1] 14
pre2 <- predict(m1, newdata = data.frame(age = 50), interval = "prediction", 
    level = 0.99)
[1] 15
pre3 <- predict(m1, newdata = data.frame(age = 50), interval = "prediction", 
    level = 0.9)
[1] 16
plot(m1, which = 2)
[1] 17
hist(residuals(m1), main = "", breaks = 100)
[1] 18
plot(density(residuals(m1)), main = "")
[1] 19
drinkdriving$nighttime <- ifelse(drinkdriving$nighttime == "night", 
    1, 0)
[1] 20
m2 <- lm(bac ~ drinkdriving$nighttime + age, data = drinkdriving)
[1] 21
summary(m2)
[1] 22

Call:
lm(formula = bac ~ drinkdriving$nighttime + age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.654  -4.782  -0.054   3.505  41.628 

Coefficients:
                       Estimate Std. Error t value Pr(>|t|)    
(Intercept)            26.58917    1.42806  18.619  < 2e-16 ***
drinkdriving$nighttime  3.49805    0.95662   3.657 0.000321 ***
age                    -0.13526    0.02676  -5.054 9.17e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.634 on 217 degrees of freedom
Multiple R-squared:  0.1633,	Adjusted R-squared:  0.1555 
F-statistic: 21.17 on 2 and 217 DF,  p-value: 3.993e-09

m3 <- lm(bac ~ speed + age, data = drinkdriving)
[1] 23
summary(m3)
[1] 24

Call:
lm(formula = bac ~ speed + age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.970  -4.446  -0.690   4.282  34.575 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 17.49660    2.72820   6.413 8.78e-10 ***
speed        0.19235    0.03998   4.812 2.80e-06 ***
age         -0.04303    0.03344  -1.287      0.2    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.497 on 217 degrees of freedom
Multiple R-squared:  0.1973,	Adjusted R-squared:  0.1899 
F-statistic: 26.68 on 2 and 217 DF,  p-value: 4.384e-11

m4 <- lm(bac ~ drinkdriving$nighttime + speed + age, data = drinkdriving)
[1] 25
summary(m4)
[1] 26

Call:
lm(formula = bac ~ drinkdriving$nighttime + speed + age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-13.382  -4.723   0.094   3.978  32.944 

Coefficients:
                       Estimate Std. Error t value Pr(>|t|)    
(Intercept)            14.02969    2.76005   5.083 8.03e-07 ***
drinkdriving$nighttime  3.76430    0.90506   4.159 4.61e-05 ***
speed                   0.20141    0.03862   5.216 4.28e-07 ***
age                    -0.02941    0.03242  -0.907    0.365    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.266 on 216 degrees of freedom
Multiple R-squared:  0.2569,	Adjusted R-squared:  0.2465 
F-statistic: 24.89 on 3 and 216 DF,  p-value: 7.198e-14

m5 <- lm(bac ~ drinkdriving$nighttime + speed + drinkdriving$nighttime * 
    speed + age, data = drinkdriving)
[1] 27
summary(m5)
[1] 28

Call:
lm(formula = bac ~ drinkdriving$nighttime + speed + drinkdriving$nighttime * 
    speed + age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-14.892  -4.313   0.011   3.455  35.032 

Coefficients:
                             Estimate Std. Error t value Pr(>|t|)    
(Intercept)                   6.92227    3.46828   1.996  0.04721 *  
drinkdriving$nighttime       12.08606    2.69785   4.480 1.21e-05 ***
speed                         0.36269    0.06218   5.833 1.98e-08 ***
age                          -0.01069    0.03223  -0.332  0.74042    
drinkdriving$nighttime:speed -0.21219    0.06498  -3.265  0.00127 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.131 on 215 degrees of freedom
Multiple R-squared:  0.292,	Adjusted R-squared:  0.2788 
F-statistic: 22.16 on 4 and 215 DF,  p-value: 2.46e-15

model <- lm(speed ~ nighttime, data = drinkdriving)
[1] 29
anova(model)
[1] 30
Analysis of Variance Table

Response: speed
           Df Sum Sq Mean Sq F value Pr(>F)
nighttime   1      3   3.378   0.017 0.8964
Residuals 218  43307 198.656               
summary(model)
[1] 31

Call:
lm(formula = speed ~ nighttime, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-39.153  -8.819   0.477   7.851  81.448 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  38.8888     1.6611   23.41   <2e-16 ***
nighttime     0.2641     2.0252    0.13    0.896    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.09 on 218 degrees of freedom
Multiple R-squared:  7.8e-05,	Adjusted R-squared:  -0.004509 
F-statistic: 0.01701 on 1 and 218 DF,  p-value: 0.8964

drinkdriving$outcome <- ifelse(drinkdriving$outcome == "fine", 
    1, 0)
[1] 32
drinkdriving$prior_offence3 <- drinkdriving$prior_offence
[1] 33
drinkdriving$prior_offence3[str_detect(drinkdriving$prior_offence, 
    "N")] <- 0
[1] 34
drinkdriving$prior_offence3 <- ifelse(drinkdriving$prior_offence3 == 
    0, 0, 1)
[1] 35
m6 <- glm(outcome ~ drinkdriving$nighttime + speed + bac + age + 
    prior_offence3, data = drinkdriving, family = binomial(link = "logit"))
[1] 36
summary(m6)
[1] 37

Call:
glm(formula = outcome ~ drinkdriving$nighttime + speed + bac + 
    age + prior_offence3, family = binomial(link = "logit"), 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.6099   0.0332   0.1425   0.3862   2.2046  

Coefficients:
                       Estimate Std. Error z value Pr(>|z|)    
(Intercept)            -4.83672    2.20602  -2.193 0.028343 *  
drinkdriving$nighttime -0.14726    0.56299  -0.262 0.793662    
speed                   0.13590    0.03358   4.047 5.18e-05 ***
bac                     0.19735    0.05207   3.790 0.000151 ***
age                    -0.04672    0.02054  -2.275 0.022910 *  
prior_offence3          0.38188    0.60670   0.629 0.529068    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 217.38  on 219  degrees of freedom
Residual deviance: 105.87  on 214  degrees of freedom
AIC: 117.87

Number of Fisher Scoring iterations: 7

drinkdriving$prior_offence4 <- drinkdriving$prior_offence
[1] 38
drinkdriving$prior_offence4[str_detect(drinkdriving$prior_offence, 
    "DR50")] <- 1
[1] 39
drinkdriving$prior_offence4 <- ifelse(drinkdriving$prior_offence4 == 
    1, 1, 0)
[1] 40
m7 <- glm(outcome ~ drinkdriving$nighttime + speed + bac + age + 
    prior_offence4, data = drinkdriving, family = binomial(link = "logit"))
[1] 41
summary(m7)
[1] 42

Call:
glm(formula = outcome ~ drinkdriving$nighttime + speed + bac + 
    age + prior_offence4, family = binomial(link = "logit"), 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.4974   0.0285   0.1361   0.3731   2.4469  

Coefficients:
                       Estimate Std. Error z value Pr(>|z|)    
(Intercept)            -5.30176    2.27568  -2.330 0.019819 *  
drinkdriving$nighttime -0.34487    0.59087  -0.584 0.559441    
speed                   0.13939    0.03378   4.127 3.68e-05 ***
bac                     0.21400    0.05520   3.877 0.000106 ***
age                    -0.04690    0.02098  -2.235 0.025430 *  
prior_offence4          1.90815    0.94904   2.011 0.044366 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 217.38  on 219  degrees of freedom
Residual deviance: 100.93  on 214  degrees of freedom
AIC: 112.93

Number of Fisher Scoring iterations: 7

data <- data.frame(age = c(17:70), nighttime = rep("day", times = 54), 
    speed = rep(30, times = 54), bac = rep(0, times = 54), piror_offence = rep("None", 
        times = 54))
[1] 43
data2 <- data
[1] 44
data2$prior_offence3 <- 0
[1] 45
data2$nighttime <- 0
[1] 46
m8 <- lm(outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = drinkdriving)
[1] 47
model_prediction <- predict(m8, newdata = data2)
[1] 48
data$model_prediction <- model_prediction
[1] 49
head(data)
[1] 50
  age nighttime speed bac piror_offence model_prediction
1  17       day    30   0          None        0.7078275
2  18       day    30   0          None        0.7001360
3  19       day    30   0          None        0.6924445
4  20       day    30   0          None        0.6847529
5  21       day    30   0          None        0.6770614
6  22       day    30   0          None        0.6693699
plot(data$age, data$model_prediction, xlab = "age", ylab = "model_prediction", 
    lwd = 5, type = "l")
[1] 51
dri_off <- merge(drinkdriving, officer_inc, by = "incident_id")
[1] 52
m9 <- lm(outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = dri_off)
[1] 53
summary(m9)
[1] 54

Call:
lm(formula = outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = dri_off)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.05317 -0.13131  0.08062  0.21551  0.62851 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.639497   0.149701   4.272 2.92e-05 ***
age            -0.007692   0.001664  -4.622 6.58e-06 ***
nighttime       0.019079   0.048190   0.396  0.69256    
speed           0.006636   0.002099   3.161  0.00180 ** 
bac             0.009416   0.003496   2.693  0.00764 ** 
prior_offence3  0.009548   0.049057   0.195  0.84588    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.321 on 214 degrees of freedom
Multiple R-squared:  0.3625,	Adjusted R-squared:  0.3476 
F-statistic: 24.33 on 5 and 214 DF,  p-value: < 2.2e-16

AS_off <- dri_off[dri_off$officer == "AS", ]
[1] 55
m10 <- lm(outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = AS_off)
[1] 56
summary(m10)
[1] 57

Call:
lm(formula = outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = AS_off)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.67021 -0.15246  0.02556  0.15443  0.59069 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.855406   0.176900   4.836 4.87e-06 ***
age            -0.012210   0.001954  -6.248 1.05e-08 ***
nighttime       0.106106   0.059438   1.785   0.0773 .  
speed           0.004464   0.002427   1.839   0.0689 .  
bac             0.008206   0.004487   1.829   0.0705 .  
prior_offence3  0.015641   0.062193   0.251   0.8020    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.2737 on 99 degrees of freedom
Multiple R-squared:  0.5585,	Adjusted R-squared:  0.5362 
F-statistic: 25.05 on 5 and 99 DF,  p-value: 3.087e-16

IT_off <- dri_off[dri_off$officer == "IT", ]
[1] 58
m11 <- lm(outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = IT_off)
[1] 59
summary(m11)
[1] 60

Call:
lm(formula = outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = IT_off)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.9851 -0.1953  0.1337  0.2736  0.5245 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)  
(Intercept)     0.390005   0.337959   1.154   0.2540  
age            -0.003655   0.003921  -0.932   0.3557  
nighttime       0.083842   0.121795   0.688   0.4944  
speed           0.008617   0.004879   1.766   0.0835 .
bac             0.005598   0.007284   0.769   0.4458  
prior_offence3  0.069257   0.107556   0.644   0.5226  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3741 on 50 degrees of freedom
Multiple R-squared:  0.258,	Adjusted R-squared:  0.1838 
F-statistic: 3.477 on 5 and 50 DF,  p-value: 0.008965

NP_off <- dri_off[dri_off$officer == "NP", ]
[1] 61
m12 <- lm(outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = NP_off)
[1] 62
summary(m12)
[1] 63

Call:
lm(formula = outcome ~ age + nighttime + speed + bac + prior_offence3, 
    data = NP_off)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.0318 -0.1055  0.1095  0.2124  0.4096 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)   
(Intercept)     0.0878021  0.3834391   0.229  0.81976   
age            -0.0006504  0.0039639  -0.164  0.87029   
nighttime      -0.1191459  0.0945740  -1.260  0.21325   
speed           0.0145476  0.0052954   2.747  0.00819 **
bac             0.0137016  0.0076872   1.782  0.08041 . 
prior_offence3 -0.0371279  0.1016074  -0.365  0.71626   
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3297 on 53 degrees of freedom
Multiple R-squared:  0.3064,	Adjusted R-squared:  0.2409 
F-statistic: 4.682 on 5 and 53 DF,  p-value: 0.001296

