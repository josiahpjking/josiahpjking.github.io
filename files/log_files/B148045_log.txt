

	####### B148045 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(ggplot2, quietly = T)
[1] 2
 [1] "ggplot2"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 3
 [1] "car"       "carData"   "ggplot2"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[11] "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 4
[1] "drinkdriving" "officer_inc" 
describe(drinkdriving)
[1] 5
               vars   n mean    sd median trimmed   mad min  max range skew kurtosis   se
age               1 228   46 33.35   40.5   42.34 18.53  14  297   283  5.5    38.49 2.21
nighttime*        2 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
prior_offence*    3 250  NaN    NA     NA     NaN    NA Inf -Inf  -Inf   NA       NA   NA
 [ reached 'max' / getOption("max.print") -- omitted 4 rows ]
is.numeric(drinkdriving$age)
[1] 6
[1] TRUE
plot(drinkdriving$age)
[1] 7
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 8
sum(!complete.cases(drinkdriving$age))
[1] 9
[1] 25
is.factor(drinkdriving$nighttime)
[1] 10
[1] FALSE
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 11
levels(drinkdriving$nighttime)
[1] 12
[1] "18:25" "2:05"  "day"   "night"
levels(drinkdriving$nighttime) <- c(NA, NA, "day", "night")
[1] 13
sum(!complete.cases(drinkdriving$nighttime))
[1] 14
[1] 3
table(drinkdriving$prior_offence)
[1] 15

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 16
sum(!complete.cases(drinkdriving$prior_offence))
[1] 17
[1] 4
is.factor(drinkdriving$prior_offence)
[1] 18
[1] FALSE
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 19
is.numeric(drinkdriving$speed)
[1] 20
[1] TRUE
plot(drinkdriving$speed)
[1] 21
is.numeric(drinkdriving$bac)
[1] 22
[1] TRUE
plot(drinkdriving$bac)
[1] 23
drinkdriving$bac[drinkdriving$bac > 45] <- NA
[1] 24
sum(!complete.cases(drinkdriving$bac))
[1] 25
[1] 7
table(drinkdriving$outcome)
[1] 26

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 27
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 28
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 29
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 30
is.factor(drinkdriving$outcome)
[1] 31
[1] FALSE
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 32
drinkdriving$outcome_new[drinkdriving$outcome == "warning"] <- 0
[1] 33
drinkdriving$outcome_new[drinkdriving$outcome == "fine"] <- 1
[1] 34
motor_offences <- merge(drinkdriving, officer_inc)
[1] 35
describe(motor_offences)
[1] 36
             vars   n  mean    sd median trimmed   mad min  max range  skew kurtosis   se
incident_id*    1 250   NaN    NA     NA     NaN    NA Inf -Inf  -Inf    NA       NA   NA
age             2 225 42.68 16.77     40   41.93 17.79  14   90    76  0.40    -0.52 1.12
nighttime*      3 247  1.68  0.47      2    1.73  0.00   1    2     1 -0.79    -1.38 0.03
 [ reached 'max' / getOption("max.print") -- omitted 6 rows ]
summary(motor_offences$officer)
[1] 37
  AS   IT   NP NA's 
 116   66   67    1 
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 38
summary(m1)
[1] 39

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

ggplot(m1, aes(age, bac)) + geom_point() + stat_smooth(method = lm, 
    se = FALSE) + geom_segment(aes(xend = age, yend = bac), size = 0.3) + 
    labs(title = "Association Between\nAge and Blood Alcohol Content", 
        x = "Age", y = "Blood Alcohol Content")
[1] 40
summary(m1)
[1] 41

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

pred50 <- data.frame(age = c(50))
[1] 42
predict(m1, newdata = pred50)
[1] 43
       1 
21.81983 
with(drinkdriving, plot(age, bac, xlab = "Age", ylab = "Blood Alcohol Content", 
    main = "Drink Driving", col = c("slateblue"), bty = "n", 
    pch = 20))
[1] 44
par(mfrow = c(2, 2))
[1] 45
$mfrow
[1] 1 1

plot(m1, which = c(1:4))
[1] 46
pred_day <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 47
par(mfrow = c(2, 2))
[1] 48
$mfrow
[1] 2 2

plot(pred_day, which = c(1:4))
[1] 49
summary(pred_day)
[1] 50

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3421  -4.3987   0.2997   3.7390  14.4090 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    26.00346    1.18497  21.944  < 2e-16 ***
age            -0.13690    0.02209  -6.199 2.91e-09 ***
nighttimenight  3.86857    0.79364   4.874 2.13e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.417 on 213 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.2422,	Adjusted R-squared:  0.235 
F-statistic: 34.03 on 2 and 213 DF,  p-value: 1.498e-13

anova(pred_day)
[1] 51
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1300.0 1299.99  44.298 2.349e-10 ***
nighttime   1  697.3  697.27  23.760 2.131e-06 ***
Residuals 213 6250.8   29.35                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
pred_speed <- lm(bac ~ age + speed, data = drinkdriving)
[1] 52
par(mfrow = c(2, 2))
[1] 53
$mfrow
[1] 2 2

plot(pred_speed, which = c(1:4))
[1] 54
summary(pred_speed)
[1] 55

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4118  -3.8926  -0.6094   4.1298  14.4229 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.08699    2.74183   9.514  < 2e-16 ***
age         -0.11540    0.03156  -3.656 0.000322 ***
speed        0.04320    0.04198   1.029 0.304616    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.79 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.574e-08

anova(pred_speed)
[1] 56
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14 34.6961 1.471e-08 ***
speed       1   35.5   35.50  1.0589    0.3046    
Residuals 215 7207.6   33.52                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
par(mfrow = c(2, 2))
[1] 57
$mfrow
[1] 2 2

plot(pred_day, which = c(1:4))
[1] 58
par(mfrow = c(2, 2))
[1] 59
$mfrow
[1] 2 2

plot(pred_speed, which = c(1:4))
[1] 60
pred_day <- lm(bac ~ age + speed + nighttime, data = drinkdriving)
[1] 61
summary(pred_day)
[1] 62

Call:
lm(formula = bac ~ age + speed + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.6457  -4.3757   0.5792   3.5662  14.2890 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    23.52651    2.66327   8.834 3.89e-16 ***
age            -0.11596    0.02990  -3.878 0.000141 ***
speed           0.04110    0.03958   1.038 0.300244    
nighttimenight  3.87648    0.79353   4.885 2.04e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.416 on 212 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.246,	Adjusted R-squared:  0.2353 
F-statistic: 23.05 on 3 and 212 DF,  p-value: 5.894e-13

plot.time_day <- ggplot(data = drinkdriving)
[1] 63
plot.time_day + geom_point(aes(x = nighttime, y = speed), position = "jitter", 
    alpha = 0.5) + geom_boxplot(aes(x = nighttime, y = speed))
[1] 64
t.test(speed ~ nighttime, data = drinkdriving, na.rm = T)
[1] 65

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.7709, df = 156.78, p-value = 0.4419
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.513418  2.417929
sample estimates:
  mean in group day mean in group night 
           39.30514            40.85289 

tapply(drinkdriving$speed, drinkdriving$nighttime, sd)
[1] 66
     day    night 
14.43278 15.16253 
drinkdriving$offences <- NA
[1] 67
drinkdriving$offences[drinkdriving$prior_offence == "N"] <- "N"
[1] 68
drinkdriving$offences[drinkdriving$prior_offence != "N"] <- "Y"
[1] 69
fine.v.warning <- glm(outcome_new ~ age + nighttime + offences + 
    speed + bac, data = drinkdriving, family = binomial, na.action = na.exclude)
[1] 70
summary(fine.v.warning)
[1] 71

Call:
glm(formula = outcome_new ~ age + nighttime + offences + speed + 
    bac, family = binomial, data = drinkdriving, na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.1762   0.0133   0.0866   0.2899   2.2983  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)    -4.84055    2.54609  -1.901 0.057279 .  
age            -0.07354    0.02529  -2.909 0.003631 ** 
nighttimenight -0.06794    0.64338  -0.106 0.915905    
offencesY       1.10337    0.75862   1.454 0.145823    
speed           0.15873    0.03990   3.978 6.94e-05 ***
bac             0.23307    0.06256   3.726 0.000195 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 208.23  on 211  degrees of freedom
Residual deviance:  81.66  on 206  degrees of freedom
  (38 observations deleted due to missingness)
AIC: 93.66

Number of Fisher Scoring iterations: 7

speed_bac.sd <- glm(outcome ~ scale(speed) + scale(bac), data = drinkdriving, 
    family = binomial)
[1] 72
summary(speed_bac.sd)
[1] 73

Call:
glm(formula = outcome ~ scale(speed) + scale(bac), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9536  -0.4458  -0.1875  -0.0489   4.0812  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.8061     0.3647  -7.694 1.43e-14 ***
scale(speed)  -2.1932     0.3850  -5.697 1.22e-08 ***
scale(bac)    -1.1486     0.2737  -4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 130.13  on 240  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 6

drinkdriving$drink_offences <- NA
[1] 74
drinkdriving$drink_offences[drinkdriving$prior_offence != "N"] <- "N"
[1] 75
drinkdriving$drink_offences[drinkdriving$prior_offence == "DR50"] <- "Y"
[1] 76
drinkdriving$drink_offences[drinkdriving$prior_offence == "TS70,DR50"] <- "Y"
[1] 77
is.factor(drinkdriving$drink_offences)
[1] 78
[1] FALSE
drinkdriving$drink_offences <- as.factor(drinkdriving$drink_offences)
[1] 79
chisq.test(drinkdriving$drink_offences, drinkdriving$outcome)
[1] 80

	Pearson's Chi-squared test with Yates' continuity correction

data:  drinkdriving$drink_offences and drinkdriving$outcome
X-squared = 2.5724, df = 1, p-value = 0.1087

table(drinkdriving$drink_offences, drinkdriving$outcome)
[1] 81
   
    fine warning
  N   12       5
  Y   40       4
chisq.test(drinkdriving$offences, drinkdriving$outcome)
[1] 82

	Pearson's Chi-squared test with Yates' continuity correction

data:  drinkdriving$offences and drinkdriving$outcome
X-squared = 0.52118, df = 1, p-value = 0.4703

table(drinkdriving$offences, drinkdriving$outcome)
[1] 83
   
    fine warning
  N  148      37
  Y   52       9
pred_prob <- data.frame(age = 14:100, nighttime = "day", speed = 30, 
    bac = 0, offences = "N")
[1] 84
pred_prob$new_prob <- predict(fine.v.warning, type = "response", 
    newdata = pred_prob)
[1] 85
par(mfrow = c(1, 1))
[1] 86
$mfrow
[1] 2 2

qplot(pred_prob$age, pred_prob$new_prob, main = "Predicted Probabilities\nof Age and Outcome", 
    xlab = expression("Age of Driver"), ylab = expression("Probability of receiving a Fine"), 
    geom = "line")
[1] 87
ggplot(data = na.omit(motor_offences), aes(x = officer, y = age, 
    col = outcome)) + geom_boxplot() + labs(title = "Officer outcome\nin relation to age", 
    x = "Officer", y = "Age")
[1] 88
table(motor_offences$officer, motor_offences$outcome_new)
[1] 89
    
      0  1
  AS 25 91
  IT 12 54
  NP 10 57
contrasts(motor_offences$officer) <- cbind(ASvITNP = c(2/3, -1/3, 
    -1/3), ITvNP = c(0, 1/2, -1/2))
[1] 90
contrasts(motor_offences$officer)
[1] 91
      ASvITNP ITvNP
AS  0.6666667   0.0
IT -0.3333333   0.5
NP -0.3333333  -0.5
bias_officer <- glm(outcome ~ officer * age, data = motor_offences, 
    family = binomial)
[1] 92
summary(bias_officer)
[1] 93

Call:
glm(formula = outcome ~ officer * age, family = binomial, data = motor_offences)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4089  -0.5454  -0.2741  -0.0642   2.7179  

Coefficients:
                   Estimate Std. Error z value Pr(>|z|)    
(Intercept)        -6.32586    0.94007  -6.729 1.71e-11 ***
officerASvITNP     -4.86500    2.23048  -2.181   0.0292 *  
officerITvNP        0.36070    1.99283   0.181   0.8564    
age                 0.09796    0.01683   5.821 5.84e-09 ***
officerASvITNP:age  0.09489    0.03922   2.419   0.0155 *  
officerITvNP:age   -0.00247    0.03671  -0.067   0.9464    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

anova(bias_officer)
[1] 94
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


            Df Deviance Resid. Df Resid. Dev
NULL                          224     222.38
officer      2    0.356       222     222.03
age          1   68.233       221     153.79
officer:age  2    7.383       219     146.41
