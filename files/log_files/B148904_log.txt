

	####### B148904 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 2
 [1] "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
d.d <- drinkdriving
[1] 4
off <- officer_inc
[1] 5
d.d$nighttime[d.d$nighttime == "18:25"] <- "night"
[1] 6
d.d$nighttime[d.d$nighttime == "2:05"] <- "night"
[1] 7
d.d$outcome <- toupper(d.d$outcome)
[1] 8
d.d$age[d.d$age >= 99] <- NA
[1] 9
d.d$speed <- round(d.d$speed, digits = 2)
[1] 10
d.d$bac <- round(d.d$bac, digits = 2)
[1] 11
off <- off[order(off$officer), ]
[1] 12
d.d$age <- as.integer(d.d$age)
[1] 13
d.d$nighttime <- factor(c("day", "night"))
[1] 14
d.d$outcome <- factor(c("FINE", "WARNING"))
[1] 15
off$officer <- factor(off$officer)
[1] 16
d.d$incident_id <- gsub("[^0-9]", "", d.d$incident_id)
[1] 17
off$incident_id <- gsub("[^0-9]", "", off$incident_id)
[1] 18
d.d$incident_id <- as.integer(d.d$incident_id)
[1] 19
off$incident_id <- as.integer(off$incident_id)
[1] 20
df <- merge(d.d, off)
[1] 21
df$bac[df$bac >= 50] <- NA
[1] 22
m1 <- lm(bac ~ age, data = df)
[1] 23
summary(m1)
[1] 24

Call:
lm(formula = bac ~ age, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3294  -4.1800  -0.5715   3.9995  14.9462 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68505    1.06950  26.821  < 2e-16 ***
age         -0.13730    0.02331  -5.889 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

age_50 <- data.frame(age = 50)
[1] 25
p.bac <- predict(m1, age_50)
[1] 26
p.bac

       1 
21.81988 


m1_resid <- resid(m1)
[1] 28
qqnorm(m1_resid)
[1] 29
$x
 [1] -1.001647727 -0.395247080  1.538799668 -0.132618105  1.344152486 -0.763854208  0.645893045  0.779339391  0.005749179  0.660123917
[11]  0.617815071  0.576584484 -1.662910885  1.144796229 -0.445493297  0.826965033 -0.523081655  1.020820585 -0.121026905  0.179177710
[21] -0.297538989 -0.893555746 -0.237941322  1.040376237  0.523081655 -0.028749697 -0.946219392 -1.316299930 -2.463430222  0.121026905
[31]  0.358213579  0.748550062 -1.080731619 -0.964366153  0.982836177  1.122928435 -0.226129222  0.261667263  1.618733633  0.590215963
[41]  0.190874584 -0.432830912 -0.382844772  0.273584861 -0.928378997  0.549636371  0.144227152  1.238322969 -0.202597632  0.910829301
 [ reached getOption("max.print") -- omitted 168 entries ]

$y
          1           2           3           4           5           6           7           8           9          10          11 
 -5.6202173  -2.7105554   9.3224792  -1.2025758   8.3739415  -4.6121277   3.8165281   4.8428173  -0.5013416   3.9731554   3.6494446 
         12          13          14          15          16          18          19          20          21          23          24 
  3.4043896  -9.5370727   6.9005688  -2.9502173   4.9882104  -3.1710035   6.0532654  -1.1844862   1.1459619  -2.0903273  -4.8516797 
         25          26          27          28          29          30          31          32          33          34          35 
 -1.6590931   6.0618030   3.1220312  -0.8552723  -5.4498792  -7.8030238 -15.1341481   0.9088866   2.3043896   4.4520312  -6.2367346 
         36          37          38          39          40          41          42          43          44          45          46 
 -5.5030238   5.9694446   6.8361900  -1.6317896   1.7366381   9.4847277   3.4093346   1.1797827  -2.8387550  -2.7086450   1.8997827 
         47          48          49          50          52          53 
 -5.2270727   3.3594446   1.0166381   7.7344996  -1.5994312   5.4356238 
 [ reached getOption("max.print") -- omitted 168 entries ]

qqline(m1_resid)
[1] 30
m2 <- lm(bac ~ age + speed, data = df)
[1] 31
m3 <- lm(bac ~ age + nighttime, data = df)
[1] 32
summary(m2)
[1] 33

Call:
lm(formula = bac ~ age + speed, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4144  -3.8947  -0.6106   4.1307  14.4206 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.08741    2.74188   9.514  < 2e-16 ***
age         -0.11541    0.03156  -3.656 0.000322 ***
speed        0.04320    0.04198   1.029 0.304697    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.79 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.578e-08

summary(m3)
[1] 34

Call:
lm(formula = bac ~ age + nighttime, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3675  -4.1639  -0.5679   4.0425  14.9823 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    28.71697    1.11693  25.711  < 2e-16 ***
age            -0.13713    0.02343  -5.853 1.79e-08 ***
nighttimenight -0.08022    0.78847  -0.102    0.919    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.804 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1304 
F-statistic: 17.27 on 2 and 215 DF,  p-value: 1.11e-07

plot(m2)
[1] 35
plot(m3)
[1] 36
mean(df$speed[df$nighttime == "night"])
[1] 37
[1] 39.8892
mean(df$speed[df$nighttime == "day"])
[1] 38
[1] 41.08368
df$fine <- ifelse(df$outcome == "FINE", 1, 0)
[1] 39
df$warning <- ifelse(df$outcome == "WARNING", 1, 0)
[1] 40
m4 <- lm(scale(fine) ~ scale(speed) + scale(bac) + (prior_offence), 
    data = df)
[1] 41
df$previous_drinking <- ifelse(df$prior_offence == "DR50", 1, 
    0)
[1] 42
df$offender <- ifelse(df$prior_offence != "N", 1, 0)
[1] 43
df$offender_ND <- ifelse(df$offender - df$previous_drinking, 
    1, 0)
[1] 44
m5 <- lm(fine ~ previous_drinking + offender, data = df)
[1] 45
m6 <- lm(fine ~ offender, data = df)
[1] 46
m.add <- lm(fine ~ prior_offence, data = df)
[1] 47
summary(m.add)
[1] 48

Call:
lm(formula = fine ~ prior_offence, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.7500 -0.4973  0.0000  0.5027  0.5814 

Coefficients:
                              Estimate Std. Error t value Pr(>|t|)  
(Intercept)                 -4.910e-15  3.504e-01   0.000   1.0000  
prior_offenceCD60            1.000e+00  6.070e-01   1.647   0.1008  
prior_offenceCD60,CD10,DR80  2.479e-15  6.070e-01   0.000   1.0000  
prior_offenceCD60,CD60       5.314e-15  6.070e-01   0.000   1.0000  
prior_offenceDD20            7.500e-01  4.292e-01   1.747   0.0819 .
prior_offenceDR50            4.186e-01  3.585e-01   1.168   0.2441  
prior_offenceDR80            7.500e-01  4.292e-01   1.747   0.0819 .
prior_offenceN               4.973e-01  3.523e-01   1.411   0.1594  
prior_offencePL10            1.000e+00  4.956e-01   2.018   0.0447 *
prior_offenceSP50            1.000e+00  4.956e-01   2.018   0.0447 *
 [ reached getOption("max.print") -- omitted 3 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.4956 on 237 degrees of freedom
Multiple R-squared:  0.06858,	Adjusted R-squared:  0.02142 
F-statistic: 1.454 on 12 and 237 DF,  p-value: 0.1426

df.new <- data.frame(id = factor(1:218))
[1] 49
df.new$speed <- runif(218, 30, 30)
[1] 50
df.new$bac <- runif(218, 0, 0)
[1] 51
df.new$nighttime <- "day"
[1] 52
df.new$prior_offence <- "N"
[1] 53
df.new$age <- sample(c(14:100), 218, replace = T)
[1] 54
m7 <- glm(fine ~ speed + bac + nighttime + prior_offence + age, 
    data = df)
[1] 55
pred.prob <- predict(m7, prior_offence = 0, nighttime = "day", 
    speed = 50, bac = 0)
[1] 56
plot(scale(df.new$age), scale(pred.prob), xlab = "Age of Driver", 
    ylab = "Fine Probability", main = "Probability of Fine by Age")
[1] 57
AS <- subset.data.frame(df, df$officer == "AS")
[1] 58
AS.fines <- lm(fine ~ age, data = AS)
[1] 59
AS.warnings <- lm(warning ~ age, data = AS)
[1] 60
IT <- subset.data.frame(df, df$officer == "IT")
[1] 61
IT.fines <- lm(fine ~ age, data = IT)
[1] 62
IT.warnings <- lm(warning ~ age, data = IT)
[1] 63
NP <- subset.data.frame(df, df$officer == "NP")
[1] 64
NP.fines <- lm(fine ~ age, data = NP)
[1] 65
NP.warnings <- lm(warning ~ age, data = NP)
[1] 66
