

	####### B150864 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(psych, quietly = T)
[1] 2
 [1] "psych"     "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
data <- load(url("https://edin.ac/2QCZNVu"))
[1] 3
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "day"
[1] 4
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "night"
[1] 5
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 6
drinkdriving$prior_offence[drinkdriving$prior_offence != "N"] <- 1
[1] 7
drinkdriving$prior_offence[drinkdriving$prior_offence == "N"] <- 0
[1] 8
drinkdriving$prior_offence <- as.integer(drinkdriving$prior_offence)
[1] 9
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 10
drinkdriving$outcome[drinkdriving$outcome == "fine"] <- 1
[1] 11
drinkdriving$outcome[drinkdriving$outcome == "warning"] <- 0
[1] 12
drinkdriving$outcome <- as.integer(drinkdriving$outcome)
[1] 13
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 14
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 15
summary(m1)
[1] 16

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.719  -4.516  -0.861   3.849  42.785 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 29.29455    1.25564  23.330  < 2e-16 ***
age         -0.14353    0.02741  -5.236 3.86e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.82 on 218 degrees of freedom
  (30 observations deleted due to missingness)
Multiple R-squared:  0.1117,	Adjusted R-squared:  0.1076 
F-statistic: 27.41 on 1 and 218 DF,  p-value: 3.863e-07

hist(resid(m1))
[1] 17
plot(m1)
[1] 18
m2 <- lm(bac ~ nighttime, data = drinkdriving)
[1] 19
m3 <- lm(bac ~ speed, data = drinkdriving)
[1] 20
summary(m2)
[1] 21

Call:
lm(formula = bac ~ nighttime, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-21.047  -4.464   0.125   4.308  40.730 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)     20.5444     0.8154  25.197  < 2e-16 ***
nighttimenight   4.4894     0.9876   4.546 8.63e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 7.201 on 243 degrees of freedom
  (5 observations deleted due to missingness)
Multiple R-squared:  0.07838,	Adjusted R-squared:  0.07458 
F-statistic: 20.66 on 1 and 243 DF,  p-value: 8.632e-06

summary(m3)
[1] 22

Call:
lm(formula = bac ~ speed, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.039  -4.348  -0.426   4.585  31.816 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 13.27396    1.19986   11.06   <2e-16 ***
speed        0.25515    0.02782    9.17   <2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.465 on 243 degrees of freedom
  (5 observations deleted due to missingness)
Multiple R-squared:  0.2571,	Adjusted R-squared:  0.254 
F-statistic: 84.09 on 1 and 243 DF,  p-value: < 2.2e-16

m4 <- lm(bac ~ age * speed * nighttime, data = drinkdriving)
[1] 23
anova(m1, m4)
[1] 24
Analysis of Variance Table

Model 1: bac ~ age
Model 2: bac ~ age * speed * nighttime
  Res.Df     RSS Df Sum of Sq      F    Pr(>F)    
1    218 10138.5                                  
2    212  7908.4  6    2230.2 9.9639 1.094e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m4)
[1] 25

Call:
lm(formula = bac ~ age * speed * nighttime, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.152  -4.215   0.263   3.654  36.045 

Coefficients:
                          Estimate Std. Error t value Pr(>|t|)   
(Intercept)               2.559217   6.200905   0.413  0.68023   
age                       0.008086   0.118041   0.069  0.94545   
speed                     0.397796   0.136772   2.908  0.00402 **
nighttimenight           17.737192   7.867893   2.254  0.02519 * 
age:speed                 0.001377   0.003834   0.359  0.71975   
age:nighttimenight       -0.030372   0.149106  -0.204  0.83879   
speed:nighttimenight     -0.257171   0.172528  -1.491  0.13755   
age:speed:nighttimenight -0.001655   0.004438  -0.373  0.70948   
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.108 on 212 degrees of freedom
  (30 observations deleted due to missingness)
Multiple R-squared:  0.3071,	Adjusted R-squared:  0.2842 
F-statistic: 13.42 on 7 and 212 DF,  p-value: 2.583e-14

t.test(speed ~ nighttime, drinkdriving)
[1] 26

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.71535, df = 158.46, p-value = 0.4754
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.371172  2.514895
sample estimates:
  mean in group day mean in group night 
           39.50953            40.93767 

m5 <- lm(scale(outcome) ~ scale(speed) + scale(bac) + speed:bac, 
    data = drinkdriving)
[1] 27
summary(m5)
[1] 28

Call:
lm(formula = scale(outcome) ~ scale(speed) + scale(bac) + speed:bac, 
    data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.8877 -0.2698  0.1321  0.4989  1.7929 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)   1.7953192  0.2400171   7.480 1.38e-12 ***
scale(speed)  1.1382750  0.1108157  10.272  < 2e-16 ***
scale(bac)    0.8156841  0.0970965   8.401 3.86e-15 ***
speed:bac    -0.0017739  0.0002323  -7.635 5.29e-13 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.7559 on 241 degrees of freedom
  (5 observations deleted due to missingness)
Multiple R-squared:  0.4354,	Adjusted R-squared:  0.4283 
F-statistic: 61.94 on 3 and 241 DF,  p-value: < 2.2e-16

anova(m5)
[1] 29
Analysis of Variance Table

Response: scale(outcome)
              Df  Sum Sq Mean Sq F value    Pr(>F)    
scale(speed)   1  64.807  64.807 113.430 < 2.2e-16 ***
scale(bac)     1   8.060   8.060  14.108 0.0002165 ***
speed:bac      1  33.302  33.302  58.287 5.286e-13 ***
Residuals    241 137.693   0.571                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
t.test(outcome == 1 ~ prior_offence, drinkdriving)
[1] 30

	Welch Two Sample t-test

data:  outcome == 1 by prior_offence
t = -0.55566, df = 118.25, p-value = 0.5795
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.1404230  0.0788845
sample estimates:
mean in group 0 mean in group 1 
      0.8000000       0.8307692 

exp(coef(m6))
[1] 31
[1] "Error in coef(m6) : object 'm6' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in coef(m6): object 'm6' not found>


####################################################################################################

[1] "Error in coef(m6) : object 'm6' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in coef(m6): object 'm6' not found>
####################################################################################################


m10 <- glm(outcome ~ age, data = drinkdriving, family = binomial)
[1] 32
newdata <- data.frame(outcome = drinkdriving$outcome, age = drinkdriving$age, 
    speed = 30, bac = 0, nighttime = "day")
[1] 33
p.m10 <- predict(m10, data = newdata, interval = "confidence")
[1] 34
m10_pred <- merge(newdata, p.m10, by = "row.names")
[1] 35
m10_ordered <- m10_pred[order(m10_pred$age), ]
[1] 36
head(m10_pred)
[1] 37
  Row.names outcome age speed bac nighttime          y
1         1       1  39    30   0       day  2.4769852
2        10       0  60    30   0       day  0.3544198
3       100       0  68    30   0       day -0.4541765
4       101       1  35    30   0       day  2.8812834
5       102       1  47    30   0       day  1.6683889
6       103       1  41    30   0       day  2.2748361
with(newdata, plot(outcome ~ age))
[1] 38
abline(lm(outcome ~ age, data = newdata))
[1] 39
levels(officer_inc$officer)
[1] 40
[1] "AS" "IT" "NP"
m15 <- lm(outcome ~ age, data = drinkdriving)
[1] 41
summary(m15)
[1] 42

Call:
lm(formula = outcome ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.11325 -0.10073  0.07447  0.21213  0.73774 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.338505   0.061798  21.659   <2e-16 ***
age         -0.012514   0.001348  -9.283   <2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3384 on 223 degrees of freedom
  (25 observations deleted due to missingness)
Multiple R-squared:  0.2787,	Adjusted R-squared:  0.2755 
F-statistic: 86.16 on 1 and 223 DF,  p-value: < 2.2e-16

drinkdriving$incident_id[match(officer_inc$incident_id, drinkdriving$incident_id)] <- officer_inc$officer
[1] 43
m16 <- glm(outcome ~ age, data = subset(drinkdriving, incident_id == 
    1))
[1] 44
summary(m16)
[1] 45

Call:
glm(formula = outcome ~ age, data = subset(drinkdriving, incident_id == 
    1))

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.71670  -0.14775   0.00778   0.18883   0.77134  

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.44091    0.07218  19.962  < 2e-16 ***
age         -0.01574    0.00162  -9.717 2.43e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.08740962)

    Null deviance: 17.5185  on 107  degrees of freedom
Residual deviance:  9.2654  on 106  degrees of freedom
  (8 observations deleted due to missingness)
AIC: 47.26

Number of Fisher Scoring iterations: 2

m17 <- glm(outcome ~ age, data = subset(drinkdriving, incident_id == 
    2))
[1] 46
summary(m17)
[1] 47

Call:
glm(formula = outcome ~ age, data = subset(drinkdriving, incident_id == 
    2))

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.99189  -0.07391   0.12389   0.22761   0.60631  

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.223458   0.145296   8.420 1.58e-11 ***
age         -0.009648   0.003060  -3.154  0.00259 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.1443206)

    Null deviance: 9.5172  on 57  degrees of freedom
Residual deviance: 8.0820  on 56  degrees of freedom
  (8 observations deleted due to missingness)
AIC: 56.29

Number of Fisher Scoring iterations: 2

m18 <- glm(outcome ~ age, data = subset(drinkdriving, incident_id == 
    3))
[1] 48
summary(m18)
[1] 49

Call:
glm(formula = outcome ~ age, data = subset(drinkdriving, incident_id == 
    3))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.0541  -0.0110   0.1010   0.2130   0.3939  

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.209162   0.142434   8.489 1.06e-11 ***
age         -0.008616   0.003063  -2.813  0.00672 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.1279415)

    Null deviance: 8.3051  on 58  degrees of freedom
Residual deviance: 7.2927  on 57  degrees of freedom
  (8 observations deleted due to missingness)
AIC: 50.085

Number of Fisher Scoring iterations: 2

data <- load(url("https://edin.ac/2QCZNVu"))
[1] 50
drinkdriving$prior_offence[drinkdriving$prior_offence != "DR50"] <- 0
[1] 51
drinkdriving$prior_offence[drinkdriving$prior_offence == "DR50"] <- 1
[1] 52
drinkdriving$prior_offence <- as.integer(drinkdriving$prior_offence)
[1] 53
drinkdriving$outcome <- tolower(drinkdriving$outcome)
[1] 54
drinkdriving$outcome[drinkdriving$outcome == "fine"] <- 1
[1] 55
drinkdriving$outcome[drinkdriving$outcome == "warning"] <- 0
[1] 56
drinkdriving$outcome <- as.integer(drinkdriving$outcome)
[1] 57
m6 <- glm(outcome ~ prior_offence, data = drinkdriving, family = binomial)
[1] 58
coef(m6)
[1] 59
  (Intercept) prior_offence 
     1.280934      1.309333 
with(drinkdriving, plot(outcome ~ prior_offence))
[1] 60
abline(glm(outcome ~ prior_offence, data = drinkdriving))
[1] 61
