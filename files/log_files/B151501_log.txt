

	####### B151501 R script #######

load(url("https://edin.ac/2QCZNVu"))
[1] 1
[1] "drinkdriving" "officer_inc" 
library(ggplot2, quietly = T)
[1] 2
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(tidyverse, quietly = T)
[1] 3
 [1] "forcats"   "stringr"   "dplyr"     "purrr"     "tidyr"     "tibble"    "tidyverse" "ggplot2"   "readr"     "stats"    
[11] "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(haven, quietly = T)
[1] 4
 [1] "haven"     "forcats"   "stringr"   "dplyr"     "purrr"     "tidyr"     "tibble"    "tidyverse" "ggplot2"   "readr"    
[11] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
summary(drinkdriving)
[1] 5
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
drinkdriving$age[drinkdriving$age < 16 | drinkdriving$age > 100] <- NA
[1] 6
drinkdriving$nighttime[drinkdriving$nighttime == "2:05" | drinkdriving$nighttime == 
    "18:25"] <- "night"
[1] 7
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 8
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD10"] <- "CD"
[1] 9
drinkdriving$prior_offence[drinkdriving$prior_offence == "CD60"] <- "CD"
[1] 10
drinkdriving$prior_offence[drinkdriving$prior_offence == "PL10"] <- "PL"
[1] 11
drinkdriving$prior_offence[drinkdriving$prior_offence == c("SP50", 
    "SP60")] <- "SP"
[1] 12
drinkdriving$prior_offence[drinkdriving$prior_offence == "TS70"] <- "TS"
[1] 13
drinkdriving$prior_offence[drinkdriving$prior_offence == c("CD60,CD60")] <- NA
[1] 14
drinkdriving$prior_offence[drinkdriving$prior_offence == c("TS70,DR50")] <- NA
[1] 15
drinkdriving$prior_offence[drinkdriving$prior_offence == c("CD60,CD10,DR80")] <- NA
[1] 16
drinkdriving$speed[drinkdriving$speed > 120] <- NA
[1] 17
drinkdriving$bac <- drinkdriving$bac/100
[1] 18
drinkdriving$bac[drinkdriving$bac > 0.4 | drinkdriving$bac < 
    0.05] <- NA
[1] 19
drinkdriving$outcome[drinkdriving$outcome == "Warning" | drinkdriving$outcome == 
    "WARNING"] <- "warning"
[1] 20
drinkdriving$outcome[drinkdriving$outcome == "Fine" | drinkdriving$outcome == 
    "FINE"] <- "fine"
[1] 21
ml <- lm(bac ~ age, data = drinkdriving)
[1] 22
summary(ml)
[1] 23

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.152189 -0.041385 -0.006514  0.040468  0.148434 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2836365  0.0113446  25.002  < 2e-16 ***
age         -0.0013121  0.0002442  -5.373 2.05e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05826 on 210 degrees of freedom
  (38 observations deleted due to missingness)
Multiple R-squared:  0.1208,	Adjusted R-squared:  0.1167 
F-statistic: 28.86 on 1 and 210 DF,  p-value: 2.054e-07

anova(ml)
[1] 24
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.09798 0.097979  28.864 2.054e-07 ***
Residuals 210 0.71284 0.003394                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
with(drinkdriving, plot(age, bac, xlab = "Age", ylab = "Blood Alcohol Level", 
    main = "BAC predicted by Age", col = c("slateblue"), bty = "n", 
    pch = 20))
[1] 25
abline(ml)
[1] 26
predict50 <- data.frame(age = c(50))
[1] 27
predict50_ml <- predict(ml, newdata = predict50)
[1] 28
predict50_ml

        1 
0.2180321 


plot(ml)
[1] 30
par(mfrow = c(2, 2))
[1] 31
$mfrow
[1] 1 1

plot(ml, which = c(1, 4))
[1] 32
outliers <- function(obs, x = 2.5) {
    return(abs(obs - mean(obs, na.rm = T)) > (sd(obs, na.rm = T) * 
        x))
}
[1] 33
drinkdriving$age[which(outliers(drinkdriving$age))]
[1] 34
[1] 86 90 87
model_time <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 35
anova(model_time)
[1] 36
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.09798 0.097979  31.873 5.325e-08 ***
nighttime   1 0.07036 0.070363  22.889 3.240e-06 ***
Residuals 209 0.64247 0.003074                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(model_time)
[1] 37

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.165728 -0.047987  0.003016  0.037146  0.143568 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2522517  0.0126327  19.968  < 2e-16 ***
age            -0.0012093  0.0002334  -5.181 5.18e-07 ***
nighttimenight  0.0393520  0.0082253   4.784 3.24e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05544 on 209 degrees of freedom
  (38 observations deleted due to missingness)
Multiple R-squared:  0.2076,	Adjusted R-squared:    0.2 
F-statistic: 27.38 on 2 and 209 DF,  p-value: 2.745e-11

par(mfrow = c(2, 2))
[1] 38
$mfrow
[1] 2 2

plot(model_time, which = c(1:4))
[1] 39
model_speed <- lm(bac ~ age + speed, data = drinkdriving)
[1] 40
anova(model_speed)
[1] 41
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.09798 0.097979 28.8086 2.115e-07 ***
speed       1 0.00202 0.002016  0.5929    0.4422    
Residuals 209 0.71082 0.003401                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(model_speed)
[1] 42

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.152952 -0.040678 -0.006164  0.041570  0.144495 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2639677  0.0279547   9.443  < 2e-16 ***
age         -0.0011497  0.0003228  -3.562 0.000456 ***
speed        0.0003325  0.0004319   0.770 0.442179    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05832 on 209 degrees of freedom
  (38 observations deleted due to missingness)
Multiple R-squared:  0.1233,	Adjusted R-squared:  0.1149 
F-statistic:  14.7 on 2 and 209 DF,  p-value: 1.063e-06

par(mfrow = c(2, 2))
[1] 43
$mfrow
[1] 2 2

plot(model_speed, which = c(1:4))
[1] 44
model3 <- lm(bac ~ speed + age + nighttime, data = drinkdriving)
[1] 45
summary(model3)
[1] 46

Call:
lm(formula = bac ~ speed + age + nighttime, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.159844 -0.046666  0.003525  0.036303  0.142588 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2320466  0.0274207   8.462 4.67e-15 ***
speed           0.0003412  0.0004109   0.830 0.407279    
age            -0.0010426  0.0003080  -3.386 0.000849 ***
nighttimenight  0.0393821  0.0082315   4.784 3.25e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05549 on 208 degrees of freedom
  (38 observations deleted due to missingness)
Multiple R-squared:  0.2102,	Adjusted R-squared:  0.1988 
F-statistic: 18.46 on 3 and 208 DF,  p-value: 1.178e-10

anova(model3)
[1] 47
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
speed       1 0.05685 0.056854  18.468 2.654e-05 ***
age         1 0.04314 0.043142  14.013 0.0002349 ***
nighttime   1 0.07047 0.070469  22.890 3.248e-06 ***
Residuals 208 0.64035 0.003079                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
drinkdriving[drinkdriving$nighttime == "night", ]$nighttime <- 0
[1] 48
drinkdriving[drinkdriving$nighttime == "day", ]$nighttime <- 1
[1] 49
drinkdriving$nighttime <- as.numeric(drinkdriving$nighttime)
[1] 50
class(drinkdriving$nighttime)
[1] 51
[1] "numeric"
model_faster <- lm(speed ~ nighttime, data = drinkdriving)
[1] 52
summary(model_faster)
[1] 53

Call:
lm(formula = speed ~ nighttime, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-41.022  -8.546   0.292   8.047  40.006 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)   41.022      1.069   38.36   <2e-16 ***
nighttime     -2.769      1.923   -1.44    0.151    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.02 on 247 degrees of freedom
  (1 observation deleted due to missingness)
Multiple R-squared:  0.008327,	Adjusted R-squared:  0.004312 
F-statistic: 2.074 on 1 and 247 DF,  p-value: 0.1511

drinkdriving[drinkdriving$outcome == "fine", ]$outcome <- 1
[1] 54
drinkdriving[drinkdriving$outcome == "warning", ]$outcome <- 0
[1] 55
drinkdriving$outcome <- as.numeric(drinkdriving$outcome)
[1] 56
class(drinkdriving$outcome)
[1] 57
[1] "numeric"
model_outcome <- glm(outcome ~ age + nighttime + prior_offence + 
    speed + bac, data = drinkdriving, family = binomial)
[1] 58
summary(model_outcome)
[1] 59

Call:
glm(formula = outcome ~ age + nighttime + prior_offence + speed + 
    bac, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.2519   0.0049   0.0441   0.2131   1.8522  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)          1.35840    3.50656   0.387 0.698469    
age                 -0.13793    0.03757  -3.671 0.000241 ***
nighttime            0.38031    0.75427   0.504 0.614116    
prior_offenceDR50   -1.33497    2.17269  -0.614 0.538929    
prior_offenceDR80   -8.25744    2.98841  -2.763 0.005725 ** 
prior_offenceN      -3.70793    1.92060  -1.931 0.053531 .  
prior_offencePL     -1.67950   45.40107  -0.037 0.970491    
prior_offenceSP     -8.79574    2.87956  -3.055 0.002254 ** 
prior_offenceTS     14.07160 1431.44510   0.010 0.992157    
speed                0.15145    0.04597   3.295 0.000985 ***
 [ reached getOption("max.print") -- omitted 1 row ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 203.225  on 206  degrees of freedom
Residual deviance:  63.946  on 196  degrees of freedom
  (43 observations deleted due to missingness)
AIC: 85.946

Number of Fisher Scoring iterations: 15

coef(model_outcome)
[1] 60
      (Intercept)               age         nighttime prior_offenceDR50 prior_offenceDR80    prior_offenceN   prior_offencePL 
        1.3583975        -0.1379280         0.3803074        -1.3349720        -8.2574447        -3.7079324        -1.6794968 
  prior_offenceSP   prior_offenceTS             speed               bac 
       -8.7957391        14.0715966         0.1514532        28.7668147 
MODEL_scaled <- lm(scale(outcome) ~ scale(bac) + scale(speed), 
    data = drinkdriving)
[1] 61
MODEL <- lm(outcome ~ bac + speed, data = drinkdriving)
[1] 62
summary(MODEL)
[1] 63

Call:
lm(formula = outcome ~ bac + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.28911 -0.14559  0.08017  0.23372  0.58033 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) -0.044011   0.082802  -0.532    0.596    
bac          1.540051   0.345259   4.461 1.26e-05 ***
speed        0.012332   0.001644   7.500 1.25e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3197 on 239 degrees of freedom
  (8 observations deleted due to missingness)
Multiple R-squared:  0.3445,	Adjusted R-squared:  0.339 
F-statistic: 62.81 on 2 and 239 DF,  p-value: < 2.2e-16

summary(MODEL_scaled)
[1] 64

Call:
lm(formula = scale(outcome) ~ scale(bac) + scale(speed), data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.2663 -0.3689  0.2031  0.5922  1.4704 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.008253   0.052067   0.159    0.874    
scale(bac)   0.255841   0.057356   4.461 1.26e-05 ***
scale(speed) 0.439163   0.058556   7.500 1.25e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.8099 on 239 degrees of freedom
  (8 observations deleted due to missingness)
Multiple R-squared:  0.3445,	Adjusted R-squared:  0.339 
F-statistic: 62.81 on 2 and 239 DF,  p-value: < 2.2e-16

plot(MODEL_scaled)
[1] 65
model_offence <- lm(outcome ~ prior_offence, data = drinkdriving)
[1] 66
predict_fine <- data.frame(prior_offence = c("DR50"))
[1] 67
predictfine <- predict(model_offence, newdata = predict_fine)
[1] 68
predictfine

        1 
0.9302326 


model_warning <- lm(outcome ~ prior_offence, data = drinkdriving)
[1] 70
predict_warning <- data.frame(prior_offence = c("DR80", "CD", 
    "PL", "SP", "TS"))
[1] 71
predictwarning <- predict(model_warning, newdata = predict_warning)
[1] 72
predictwarning

        1         2         3         4         5 
0.7500000 0.6666667 0.5000000 0.6666667 0.6666667 


plot(model_warning)
[1] 74
model_noprioroffense <- lm(outcome ~ prior_offence, data = drinkdriving)
[1] 75
predict_noprioroffence <- data.frame(prior_offence = c("N"))
[1] 76
predictnopriors <- predict(model_noprioroffense, newdata = predict_noprioroffence)
[1] 77
predictnopriors

  1 
0.8 


str(drinkdriving)
[1] 79
Classes ‘tbl_df’, ‘tbl’ and 'data.frame':	250 obs. of  7 variables:
 $ age          : num  39 28 38 51 56 36 81 49 32 60 ...
 $ nighttime    : num  0 1 0 0 0 1 0 1 0 0 ...
 $ prior_offence: chr  "N" "N" "DR50" "N" ...
 $ speed        : num  47.96 43.83 47.26 17.22 1.95 ...
 $ bac          : num  0.177 0.221 0.328 0.205 0.294 ...
 $ outcome      : num  1 1 1 0 0 1 0 1 1 0 ...
 $ incident_id  : chr  "inc_1" "inc_2" "inc_3" "inc_4" ...
NULL
model_age <- glm(outcome ~ age + prior_offence + speed + bac, 
    data = drinkdriving)
[1] 80
predict_age <- data.frame(age = c(16:90), nighttime = c(1), speed = c(30), 
    bac = c(0), prior_offence = c("N"), outcome = c(1))
[1] 81
predictage <- predict(model_age, newdata = predict_age)
[1] 82
predictage

        1         2         3         4         5         6         7         8         9        10        11        12        13 
0.5641008 0.5563276 0.5485544 0.5407812 0.5330080 0.5252348 0.5174616 0.5096884 0.5019152 0.4941420 0.4863688 0.4785956 0.4708224 
       14        15        16        17        18        19        20        21        22        23        24        25        26 
0.4630492 0.4552760 0.4475028 0.4397296 0.4319564 0.4241832 0.4164100 0.4086368 0.4008636 0.3930904 0.3853172 0.3775440 0.3697708 
       27        28        29        30        31        32        33        34        35        36        37        38        39 
0.3619976 0.3542244 0.3464512 0.3386780 0.3309048 0.3231316 0.3153584 0.3075852 0.2998120 0.2920388 0.2842656 0.2764924 0.2687192 
       40        41        42        43        44        45        46        47        48        49        50 
0.2609460 0.2531728 0.2453996 0.2376264 0.2298532 0.2220800 0.2143068 0.2065336 0.1987604 0.1909872 0.1832140 
 [ reached getOption("max.print") -- omitted 25 entries ]


predictage <- order(predictage)
[1] 84
ggplot(data = predict_age, aes(x = age, y = predictage, color = "red")) + 
    geom_point() + labs(title = "question 4")
[1] 85
pred <- merge(drinkdriving, predictage, by = "row.names")
[1] 86
pred_order <- pred[order(pred$age), ]
[1] 87
ggplot(data = pred_order, aes(x = age)) + geom_point(na.rm = T, 
    color = "slateblue", aes(y = predictage)) + theme_minimal() + 
    labs(title = "Predicted Probabilities ", subtitle = "for ages at daytime driving 30mph with 0 bac", 
        x = "Age", y = "Probabilities of Fine")
[1] 88
predictage

 [1] 75 74 73 72 71 70 69 68 67 66 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33
[44] 32 31 30 29 28 27 26
 [ reached getOption("max.print") -- omitted 25 entries ]


drinkdriving <- merge(drinkdriving, officer_inc)
[1] 90
drinkdriving$biasAS <- ifelse(drinkdriving$officer == "AS", 1, 
    0)
[1] 91
drinkdriving$biasNP <- ifelse(drinkdriving$officer == "NP", 1, 
    0)
[1] 92
drinkdriving$biasIT <- ifelse(drinkdriving$officer == "IT", 1, 
    0)
[1] 93
model_officer <- glm(outcome ~ officer * age, data = drinkdriving)
[1] 94
ggplot(data = drinkdriving, aes(x = age, y = outcome, col = officer, 
    fill = officer)) + geom_point(na.rm = T) + theme_minimal() + 
    labs(title = "Corrupt Cops?", subtitle = "Officer AS's bias towards giving fines to young people")
[1] 95
ggplot(data = drinkdriving, aes(x = age, col = officer, fill = officer)) + 
    geom_bar(na.rm = T) + theme_minimal() + labs(title = "Corrupt Cops?", 
    subtitle = "Officer AS's bias towards giving fines to young people")
[1] 96
ggplot(data = drinkdriving, aes(x = age, y = outcome, col = officer, 
    fill = officer)) + geom_jitter(na.rm = T) + theme_minimal() + 
    labs(title = "Corrupt Cops?", subtitle = "Officer AS's bias towards giving fines to young people")
[1] 97
ggplot(data = drinkdriving, aes(x = age, y = outcome, col = officer, 
    fill = officer)) + geom_smooth(method = "lm", se = T, na.rm = T) + 
    theme_minimal() + labs(title = "Corrupt Cops?", subtitle = "Officer AS's bias towards giving fines to young people")
[1] 98
