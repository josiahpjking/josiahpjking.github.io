

	####### B158571 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(ggplot2, quietly = T)
[1] 2
 [1] "ggplot2"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 4
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
drinkdriving <- drinkdriving[, c("incident_id", "age", "nighttime", 
    "prior_offence", "speed", "bac", "outcome")]
[1] 5
drinkdriving$incident_id <- as.factor(drinkdriving$incident_id)
[1] 6
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 7
table(drinkdriving$nighttime)
[1] 8

18:25  2:05   day night 
    1     2    78   169 
drinkdriving$nighttime[drinkdriving$nighttime == "day"] <- "no"
[1] 9
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "no"
[1] 10
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "yes"
[1] 11
drinkdriving$nighttime[drinkdriving$nighttime == "night"] <- "yes"
[1] 12
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 13
table(drinkdriving$prior_offence)
[1] 14

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 15
boxplot(drinkdriving$speed)
[1] 16
hist(drinkdriving$speed)
[1] 17
mean_speed <- mean(drinkdriving$speed)
[1] 18
sd_speed <- sd(drinkdriving$speed)
[1] 19
drinkdriving$speed[drinkdriving$speed < mean_speed - 2 * sd_speed] <- NA
[1] 20
drinkdriving$speed[drinkdriving$speed > mean_speed + 3 * sd_speed] <- NA
[1] 21
drinkdriving$bac <- drinkdriving$bac/100
[1] 22
boxplot(drinkdriving$bac)
[1] 23
hist(drinkdriving$speed)
[1] 24
drinkdriving$bac[drinkdriving$bac > 0.4] <- NA
[1] 25
table(drinkdriving$outcome)
[1] 26

   fine    Fine    FINE warning Warning WARNING 
    191       2       9      43       2       3 
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 27
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 28
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 29
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 30
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 31
summary(officer_inc)
[1] 32
 officer     incident_id 
 AS  :116   inc_1  :  1  
 IT  : 66   inc_10 :  1  
 NP  : 67   inc_100:  1  
 NA's:  1   inc_101:  1  
            inc_102:  1  
            inc_103:  1  
            (Other):244  
table(officer_inc$officer)
[1] 33

 AS  IT  NP 
116  66  67 
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 34
summary(m1)
[1] 35

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2868503  0.0106949   26.82  < 2e-16 ***
age         -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

with(drinkdriving, plot(age, bac, main = "m1: BAC ~ Age", xlab = "Age", 
    ylab = "Blood Alcohol Content", col = "slateblue", bty = "n", 
    pch = 20))
[1] 36
abline(m1)
[1] 37
m1_scaled <- lm(bac ~ scale(age), data = drinkdriving)
[1] 38
summary(m1_scaled)
[1] 39

Call:
lm(formula = bac ~ scale(age), data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.228255   0.003922   58.20  < 2e-16 ***
scale(age)  -0.023025   0.003909   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

with(drinkdriving, predict(m1, data.frame(age = 50)))
[1] 40
        1 
0.2181983 
hist(residuals(m1))
[1] 41
plot(m1)
[1] 42
m2 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 43
anova(m2)
[1] 44
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.11631 0.116314  38.345 2.969e-09 ***
nighttime   1 0.07214 0.072142  23.783 2.096e-06 ***
Residuals 215 0.65217 0.003033                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m3 <- lm(bac ~ age + speed, data = drinkdriving)
[1] 45
anova(m3)
[1] 46
Analysis of Variance Table

Response: bac
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
age         1 0.12241 0.122412 36.7909 6.001e-09 ***
speed       1 0.01135 0.011352  3.4118   0.06613 .  
Residuals 211 0.70205 0.003327                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m4 <- lm(bac ~ age + nighttime + speed, data = drinkdriving)
[1] 47
summary(m4)
[1] 48

Call:
lm(formula = bac ~ age + nighttime + speed, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.149677 -0.042936  0.003551  0.035986  0.141768 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)   0.2139236  0.0283494   7.546 1.34e-12 ***
age          -0.0009683  0.0003066  -3.159  0.00182 ** 
nighttimeyes  0.0375822  0.0081057   4.637 6.22e-06 ***
speed         0.0007522  0.0004376   1.719  0.08709 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05507 on 210 degrees of freedom
  (36 observations deleted due to missingness)
Multiple R-squared:  0.238,	Adjusted R-squared:  0.2272 
F-statistic: 21.87 on 3 and 210 DF,  p-value: 2.302e-12

m5 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 49
summary(m5)
[1] 50

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.165254 -0.046056  0.003152  0.037847  0.143450 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)   0.2560505  0.0119731  21.386  < 2e-16 ***
age          -0.0012800  0.0002225  -5.752 3.01e-08 ***
nighttimeyes  0.0392560  0.0080496   4.877 2.10e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05508 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2242,	Adjusted R-squared:  0.217 
F-statistic: 31.06 on 2 and 215 DF,  p-value: 1.409e-12

t.test(speed ~ nighttime, data = drinkdriving)
[1] 51

	Welch Two Sample t-test

data:  speed by nighttime
t = -2.044, df = 184.65, p-value = 0.04237
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -6.7053604 -0.1187343
sample estimates:
 mean in group no mean in group yes 
         38.47328          41.88533 

drinkdriving$fine <- as.character(drinkdriving$outcome)
[1] 52
drinkdriving$fine[drinkdriving$fine == "fine"] <- 1
[1] 53
drinkdriving$fine[drinkdriving$fine == "warning"] <- 0
[1] 54
drinkdriving$fine <- as.factor(drinkdriving$fine)
[1] 55
m5 <- glm(fine ~ age + nighttime + prior_offence + speed + bac, 
    data = drinkdriving, family = binomial)
[1] 56
summary(m5)
[1] 57

Call:
glm(formula = fine ~ age + nighttime + prior_offence + speed + 
    bac, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.8692   0.0001   0.0046   0.0482   2.0245  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)         26.52357 4249.17452   0.006 0.995020    
age                 -0.25847    0.07438  -3.475 0.000511 ***
nighttimeyes        -0.31602    1.00759  -0.314 0.753794    
prior_offenceCD60  -54.63666 7784.61916  -0.007 0.994400    
prior_offenceDR50  -23.03058 4249.17240  -0.005 0.995675    
prior_offenceDR80  -34.19399 4249.17417  -0.008 0.993579    
prior_offenceN     -26.44550 4249.17237  -0.006 0.995034    
prior_offencePL10  -22.67039 4303.35973  -0.005 0.995797    
prior_offenceSP50  -19.84994 5968.98480  -0.003 0.997347    
prior_offenceSP60  -51.44663 7784.61866  -0.007 0.994727    
 [ reached getOption("max.print") -- omitted 3 rows ]
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 195.538  on 209  degrees of freedom
Residual deviance:  35.007  on 197  degrees of freedom
  (40 observations deleted due to missingness)
AIC: 61.007

Number of Fisher Scoring iterations: 17

m6 <- glm(fine ~ scale(speed) + scale(bac) + scale(age), data = drinkdriving, 
    family = binomial)
[1] 58
summary(m6)
[1] 59

Call:
glm(formula = fine ~ scale(speed) + scale(bac) + scale(age), 
    family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.5027   0.0436   0.1665   0.3875   2.3242  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    3.2461     0.4677   6.941 3.89e-12 ***
scale(speed)   1.6818     0.4865   3.457 0.000546 ***
scale(bac)     1.2908     0.3250   3.972 7.14e-05 ***
scale(age)    -0.8054     0.3415  -2.359 0.018337 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 203.2  on 213  degrees of freedom
Residual deviance: 105.5  on 210  degrees of freedom
  (36 observations deleted due to missingness)
AIC: 113.5

Number of Fisher Scoring iterations: 7

table(drinkdriving$prior_offence)
[1] 60

          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DR50           DR80              N           PL10           SP50 
             2              1              1              1             43              4            185              2              2 
          SP60           TS70      TS70,DR50 
             1              3              1 
drinkdriving$offence_type <- drinkdriving$prior_offence
[1] 61
drinkdriving$offence_type[drinkdriving$offence_type == "DR50" | 
    drinkdriving$offence_type == "TS70,DR50"] <- "drink offence"
[1] 62
drinkdriving$offence_type[drinkdriving$offence_type != "N" & 
    drinkdriving$offence_type != "drink offence"] <- "nondrink offence"
[1] 63
drinkdriving$offence_type <- as.factor(drinkdriving$offence_type)
[1] 64
table(drinkdriving$offence_type)
[1] 65

   drink offence                N nondrink offence 
              44              185               17 
levels(drinkdriving$offence_type)
[1] 66
[1] "drink offence"    "N"                "nondrink offence"
contrasts(drinkdriving$offence_type) <- cbind(DNDvN = c(1/3, 
    -2/3, 1/3), DvND = c(1/2, 0, -1/2))
[1] 67
m7 <- glm(fine ~ offence_type, data = drinkdriving, family = binomial)
[1] 68
summary(m7)
[1] 69

Call:
glm(formula = fine ~ offence_type, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1899   0.4366   0.6681   0.6681   0.8346  

Coefficients:
                  Estimate Std. Error z value Pr(>|z|)    
(Intercept)         1.5214     0.2565   5.932 2.99e-09 ***
offence_typeDNDvN   0.2027     0.4163   0.487   0.6263    
offence_typeDvND    1.4271     0.7471   1.910   0.0561 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 232.55  on 243  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 238.55

Number of Fisher Scoring iterations: 4

m6_predition <- data.frame(age = rep(17:100), speed = rep(30, 
    84), bac = rep(0, 84), nighttime = "no", prior_offence = "N")
[1] 70
m6_predition$model_predition <- predict(m6, newdata = m6_predition, 
    type = "response")
[1] 71
head(m6_predition)
[1] 72
  age speed bac nighttime prior_offence model_predition
1  17    30   0        no             N       0.1969451
2  18    30   0        no             N       0.1894594
3  19    30   0        no             N       0.1821937
4  20    30   0        no             N       0.1751465
5  21    30   0        no             N       0.1683157
6  22    30   0        no             N       0.1616991
plot(model_predition ~ age, data = m6_predition, xlab = "Age", 
    ylab = "Predicted Probability", col = "slateblue", bty = "n")
[1] 73
drinkdriving_merge <- merge(drinkdriving, officer_inc)
[1] 74
contrasts(drinkdriving_merge$officer)
[1] 75
   IT NP
AS  0  0
IT  1  0
NP  0  1
contrasts(drinkdriving_merge$officer) <- cbind(ASvITNP = c(-2/3, 
    1/3, 1/3), ITvNP = c(0, -1/2, 1/2))
[1] 76
m8 <- glm(fine ~ age * officer, data = drinkdriving_merge, family = binomial)
[1] 77
summary(m8)
[1] 78

Call:
glm(formula = fine ~ age * officer, family = binomial, data = drinkdriving_merge)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
                   Estimate Std. Error z value Pr(>|z|)    
(Intercept)         6.32586    0.94007   6.729 1.71e-11 ***
age                -0.09796    0.01683  -5.821 5.84e-09 ***
officerASvITNP     -4.86500    2.23048  -2.181   0.0292 *  
officerITvNP        0.36070    1.99283   0.181   0.8564    
age:officerASvITNP  0.09489    0.03922   2.419   0.0155 *  
age:officerITvNP   -0.00247    0.03671  -0.067   0.9464    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

ggplot(data = drinkdriving_merge, aes(x = age, y = outcome, colour = outcome)) + 
    geom_jitter() + theme_minimal() + facet_grid(. ~ officer)
[1] 79
ggplot(data = drinkdriving_merge, aes(x = outcome, y = age, fill = outcome)) + 
    geom_boxplot() + theme_minimal() + facet_grid(. ~ officer)
[1] 80
