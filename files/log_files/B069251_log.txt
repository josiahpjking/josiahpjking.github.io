

	####### B069251 R script #######

load(url("https://edin.ac/2QCZNVu"))
[1] 1
[1] "drinkdriving" "officer_inc" 
install.packages("psych")
[1] 2
library(psych, quietly = T)
[1] 3
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
install.packages("car")
[1] 4
library(car, quietly = T)
[1] 5
 [1] "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[10] "methods"   "base"     
install.packages("ggplot2")
[1] 6
library(ggplot2, quietly = T)
[1] 7
 [1] "ggplot2"   "car"       "carData"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"    
[10] "datasets"  "methods"   "base"     
class(drinkdriving$age)
[1] 8
[1] "numeric"
describe(drinkdriving$age)
[1] 9
   vars   n mean    sd median trimmed   mad min max range skew kurtosis   se
X1    1 228   46 33.35   40.5   42.34 18.53  14 297   283  5.5    38.49 2.21
plot(drinkdriving$age)
[1] 10
drinkdriving$age[drinkdriving$age > 150] <- NA
[1] 11
plot(drinkdriving$age)
[1] 12
class(drinkdriving$nighttime)
[1] 13
[1] "character"
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 14
levels(drinkdriving$nighttime)
[1] 15
[1] "18:25" "2:05"  "day"   "night"
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- NA
[1] 16
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- NA
[1] 17
drinkdriving$nighttime <- droplevels(drinkdriving$nighttime)
[1] 18
class(drinkdriving$prior_offence)
[1] 19
[1] "character"
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 20
levels(drinkdriving$prior_offence)
[1] 21
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"          
 [7] "DR80"           "N"              "PL10"           "SP50"           "SP60"           "TS70"          
[13] "TS70,DR50"     
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 22
drinkdriving$prior_offence <- droplevels(drinkdriving$prior_offence)
[1] 23
class(drinkdriving$speed)
[1] 24
[1] "numeric"
describe(drinkdriving$speed)
[1] 25
   vars   n  mean    sd median trimmed   mad min    max  range skew kurtosis   se
X1    1 250 40.49 14.91  40.64    40.3 12.94   0 120.34 120.34  0.5     2.83 0.94
describe(drinkdriving$bac)
[1] 26
   vars   n mean   sd median trimmed  mad  min   max range skew kurtosis   se
X1    1 245 23.6 7.49  23.61   23.62 6.44 3.99 65.76 61.78 0.77      4.7 0.48
drinkdriving$bac[drinkdriving$bac > 45] <- NA
[1] 27
class(drinkdriving$outcome)
[1] 28
[1] "character"
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 29
levels(drinkdriving$outcome)
[1] 30
[1] "fine"    "Fine"    "FINE"    "warning" "Warning" "WARNING"
levels(drinkdriving$outcome) <- c("fine", "fine", "fine", "warning", 
    "warning", "warning")
[1] 31
levels(drinkdriving$outcome)
[1] 32
[1] "fine"    "warning"
class(drinkdriving$outcome)
[1] 33
[1] "factor"
class(officer_inc$officer)
[1] 34
[1] "factor"
levels(officer_inc$officer)
[1] 35
[1] "AS" "IT" "NP"
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 36
plot(m1, which = c(1:4))
[1] 37
summary(m1)
[1] 38

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.3270  -4.1824  -0.5698   3.9975  14.9487 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 28.68503    1.06949   26.82  < 2e-16 ***
age         -0.13730    0.02331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

with(drinkdriving, plot(bac, age, xlab = "Age", ylab = "Blood alcohol content (BAC)", 
    main = "Prediction of BAC by age", col = c("orange"), pch = 20))
[1] 39
abline(m1)
[1] 40
ageprediction <- data.frame(age = 50)
[1] 41
predict(m1, newdata = ageprediction)
[1] 42
       1 
21.81983 
plot(m1, which = c(2), col = "orange", pch = 20)
[1] 43
hist(residuals(m1), main = "residuals of model 1", breaks = 20)
[1] 44
plot(density(residuals(m1)), main = "density plot of residuals")
[1] 45
m2 <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 46
anova(m2)
[1] 47
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1300.0 1299.99  44.298 2.349e-10 ***
nighttime   1  697.3  697.27  23.760 2.131e-06 ***
Residuals 213 6250.8   29.35                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2)
[1] 48

Call:
lm(formula = bac ~ age + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3421  -4.3987   0.2997   3.7390  14.4090 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    26.00346    1.18497  21.944  < 2e-16 ***
age            -0.13690    0.02209  -6.199 2.91e-09 ***
nighttimenight  3.86857    0.79364   4.874 2.13e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.417 on 213 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.2422,	Adjusted R-squared:  0.235 
F-statistic: 34.03 on 2 and 213 DF,  p-value: 1.498e-13

plot(m2)
[1] 49
m3 <- lm(bac ~ age + speed, data = drinkdriving)
[1] 50
anova(m3)
[1] 51
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1163.1 1163.14 34.6961 1.471e-08 ***
speed       1   35.5   35.50  1.0589    0.3046    
Residuals 215 7207.6   33.52                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m3)
[1] 52

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.4118  -3.8926  -0.6094   4.1298  14.4229 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 26.08699    2.74183   9.514  < 2e-16 ***
age         -0.11540    0.03156  -3.656 0.000322 ***
speed        0.04320    0.04198   1.029 0.304616    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.79 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1426,	Adjusted R-squared:  0.1346 
F-statistic: 17.88 on 2 and 215 DF,  p-value: 6.574e-08

plot(m3)
[1] 53
plot(m2, which = c(1:4))
[1] 54
vif(m2)
[1] 55
      age nighttime 
 1.007883  1.007883 
plot(m3, which = c(1:4))
[1] 56
vif(m3)
[1] 57
    age   speed 
1.83361 1.83361 
m3scaled <- lm(scale(bac) ~ scale(age) + scale(speed), data = drinkdriving)
[1] 58
summary(m3)$r.squared
[1] 59
[1] 0.1425893
summary(m3scaled)$r.squared
[1] 60
[1] 0.1425893
m4 <- lm(bac ~ age + speed + nighttime, data = drinkdriving)
[1] 61
summary(m4)
[1] 62

Call:
lm(formula = bac ~ age + speed + nighttime, data = drinkdriving)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.6457  -4.3757   0.5792   3.5662  14.2890 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)    23.52651    2.66327   8.834 3.89e-16 ***
age            -0.11596    0.02990  -3.878 0.000141 ***
speed           0.04110    0.03958   1.038 0.300244    
nighttimenight  3.87648    0.79353   4.885 2.04e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.416 on 212 degrees of freedom
  (34 observations deleted due to missingness)
Multiple R-squared:  0.246,	Adjusted R-squared:  0.2353 
F-statistic: 23.05 on 3 and 212 DF,  p-value: 5.894e-13

summary(m4)$r.squared
[1] 63
[1] 0.2459863
boxplot(speed ~ nighttime, data = drinkdriving)
[1] 64
speedtest <- t.test(speed ~ nighttime, data = drinkdriving)
[1] 65
speedtest


	Welch Two Sample t-test

data:  speed by nighttime
t = -0.7709, df = 156.78, p-value = 0.4419
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.513418  2.417929
sample estimates:
  mean in group day mean in group night 
           39.30514            40.85289 



drinkdriving$anyoffences[drinkdriving$prior_offence != "N"] <- 1
[1] 67
drinkdriving$anyoffences[drinkdriving$prior_offence == "N"] <- 0
[1] 68
drinkdriving$fineoutcome[drinkdriving$outcome == "warning"] <- 0
[1] 69
drinkdriving$fineoutcome[drinkdriving$outcome == "fine"] <- 1
[1] 70
drinkdriving$drinkvsnodrink[drinkdriving$prior_offence != "N"] <- 0
[1] 71
drinkdriving$drinkvsnodrink[drinkdriving$prior_offence == "DR50"] <- 1
[1] 72
drinkdriving$drinkvsnodrink[drinkdriving$prior_offence == "TS70,DR50"] <- 1
[1] 73
m5 <- glm(fineoutcome ~ age + nighttime + speed + bac + anyoffences, 
    family = "binomial", data = drinkdriving)
[1] 74
summary(m5)
[1] 75

Call:
glm(formula = fineoutcome ~ age + nighttime + speed + bac + anyoffences, 
    family = "binomial", data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.1762   0.0133   0.0866   0.2899   2.2983  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)    -4.84055    2.54609  -1.901 0.057279 .  
age            -0.07354    0.02529  -2.909 0.003631 ** 
nighttimenight -0.06794    0.64338  -0.106 0.915905    
speed           0.15873    0.03990   3.978 6.94e-05 ***
bac             0.23307    0.06256   3.726 0.000195 ***
anyoffences     1.10337    0.75862   1.454 0.145823    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 208.23  on 211  degrees of freedom
Residual deviance:  81.66  on 206  degrees of freedom
  (38 observations deleted due to missingness)
AIC: 93.66

Number of Fisher Scoring iterations: 7

Anova(m5, type = 3)
[1] 76
Analysis of Deviance Table (Type III tests)

Response: fineoutcome
            LR Chisq Df Pr(>Chisq)    
age           9.3563  1   0.002222 ** 
nighttime     0.0112  1   0.915826    
speed        25.9792  1  3.451e-07 ***
bac          18.9621  1  1.333e-05 ***
anyoffences   2.3047  1   0.128985    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m5scaled <- glm(fineoutcome ~ scale(speed) + scale(bac), family = "binomial", 
    data = drinkdriving)
[1] 77
summary(m5scaled)
[1] 78

Call:
glm(formula = fineoutcome ~ scale(speed) + scale(bac), family = "binomial", 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0812   0.0489   0.1875   0.4458   1.9536  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)    2.8061     0.3647   7.694 1.43e-14 ***
scale(speed)   2.1932     0.3850   5.697 1.22e-08 ***
scale(bac)     1.1486     0.2737   4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 238.69  on 242  degrees of freedom
Residual deviance: 130.13  on 240  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 6

Anova(m5scaled, type = 3)
[1] 79
Analysis of Deviance Table (Type III tests)

Response: fineoutcome
             LR Chisq Df Pr(>Chisq)    
scale(speed)    56.91  1  4.563e-14 ***
scale(bac)      22.54  1  2.058e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
plot(m5scaled)
[1] 80
chisq1 <- chisq.test(drinkdriving$drinkvsnodrink, drinkdriving$fineoutcome)
[1] 81
chisq1


	Pearson's Chi-squared test with Yates' continuity correction

data:  drinkdriving$drinkvsnodrink and drinkdriving$fineoutcome
X-squared = 2.5724, df = 1, p-value = 0.1087



table(drinkdriving$drinkvsnodrink, drinkdriving$fineoutcome)
[1] 83
   
     0  1
  0  5 12
  1  4 40
chisq2 <- chisq.test(drinkdriving$anyoffences, drinkdriving$fineoutcome)
[1] 84
chisq2


	Pearson's Chi-squared test with Yates' continuity correction

data:  drinkdriving$anyoffences and drinkdriving$fineoutcome
X-squared = 0.52118, df = 1, p-value = 0.4703



table(drinkdriving$anyoffences, drinkdriving$fineoutcome)
[1] 86
   
      0   1
  0  37 148
  1   9  52
drinkplotdata <- data.frame(age = 14:90, anyoffences = 0, nighttime = "day", 
    speed = 30, bac = 0)
[1] 87
drinkplotdata$prediction <- predict(m5, newdata = drinkplotdata, 
    type = "response")
[1] 88
plot(drinkplotdata$age, drinkplotdata$prediction, ylab = "probability of receiving a fine", 
    xlab = "age", main = "plot of probability of receiving a fine by age", 
    col = "orange", pch = 20)
[1] 89
drinkdriving <- merge(drinkdriving, officer_inc, by = "incident_id")
[1] 90
officers <- glm(outcome ~ officer, data = drinkdriving, family = "binomial")
[1] 91
summary(officers)
[1] 92

Call:
glm(formula = outcome ~ officer, family = "binomial", data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.6967  -0.6967  -0.6335  -0.5686   1.9504  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  -1.2920     0.2258  -5.722 1.06e-08 ***
officerIT    -0.2121     0.3909  -0.543    0.587    
officerNP    -0.4485     0.4105  -1.092    0.275    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 241.24  on 248  degrees of freedom
Residual deviance: 239.97  on 246  degrees of freedom
  (1 observation deleted due to missingness)
AIC: 245.97

Number of Fisher Scoring iterations: 4

qplot(data = drinkdriving[!is.na(drinkdriving$officer), ], officer, 
    fill = outcome, col = outcome)
[1] 93
qplot(data = drinkdriving[!is.na(drinkdriving$officer), ], officer, 
    age, fill = outcome, col = outcome)
[1] 94
contrasts(drinkdriving$officer)
[1] 95
   IT NP
AS  0  0
IT  1  0
NP  0  1
contrasts(drinkdriving$officer) <- cbind(ASvITNP = c(2/3, -1/3, 
    -1/3), ITvNP = c(0, -1/2, 1/2))
[1] 96
m6 <- glm(outcome ~ officer * age, family = "binomial", data = drinkdriving)
[1] 97
summary(m6)
[1] 98

Call:
glm(formula = outcome ~ officer * age, family = "binomial", data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4089  -0.5454  -0.2741  -0.0642   2.7179  

Coefficients:
                   Estimate Std. Error z value Pr(>|z|)    
(Intercept)        -6.32586    0.94007  -6.729 1.71e-11 ***
officerASvITNP     -4.86500    2.23048  -2.181   0.0292 *  
officerITvNP       -0.36070    1.99283  -0.181   0.8564    
age                 0.09796    0.01683   5.821 5.84e-09 ***
officerASvITNP:age  0.09489    0.03922   2.419   0.0155 *  
officerITvNP:age    0.00247    0.03671   0.067   0.9464    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

