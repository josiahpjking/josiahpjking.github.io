

	####### B156638 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 2
 [1] "car"       "carData"   "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
drinkdriving$nighttime <- as.factor(drinkdriving$nighttime)
[1] 4
drinkdriving$prior_offence <- as.factor(drinkdriving$prior_offence)
[1] 5
drinkdriving$outcome <- as.factor(drinkdriving$outcome)
[1] 6
drinkdriving$incident_id <- as.factor(drinkdriving$incident_id)
[1] 7
summary(drinkdriving)
[1] 8
      age         nighttime   prior_offence     speed             bac            outcome     incident_id 
 Min.   : 14.00   18:25:  1   N      :185   Min.   :  0.00   Min.   : 3.987   fine   :191   inc_1  :  1  
 1st Qu.: 30.00   2:05 :  2   DR50   : 43   1st Qu.: 30.92   1st Qu.:19.264   Fine   :  2   inc_10 :  1  
 Median : 40.50   day  : 78   DD20   :  4   Median : 40.64   Median :23.609   FINE   :  9   inc_100:  1  
 Mean   : 46.00   night:169   DR80   :  4   Mean   : 40.49   Mean   :23.605   warning: 43   inc_101:  1  
 3rd Qu.: 55.25               TS70   :  3   3rd Qu.: 48.84   3rd Qu.:27.898   Warning:  2   inc_102:  1  
 Max.   :297.00               CD10   :  2   Max.   :120.34   Max.   :65.764   WARNING:  3   inc_103:  1  
 NA's   :22                   (Other):  9                    NA's   :5                      (Other):244  
summary(drinkdriving$prior_offence)
[1] 9
          CD10           CD60 CD60,CD10,DR80      CD60,CD60           DD20           DR50           DR80              N           PL10 
             2              1              1              1              4             43              4            185              2 
          SP50           SP60           TS70      TS70,DR50 
             2              1              3              1 
drinkdriving$age[drinkdriving$age > 100] <- NA
[1] 10
drinkdriving$nighttime[drinkdriving$nighttime == "18:25"] <- "night"
[1] 11
drinkdriving$nighttime[drinkdriving$nighttime == "2:05"] <- "day"
[1] 12
drinkdriving$nighttime <- droplevels(drinkdriving$nighttime)
[1] 13
drinkdriving$prior_offence[drinkdriving$prior_offence == "DD20"] <- NA
[1] 14
drinkdriving$prior_offence <- droplevels(drinkdriving$prior_offence)
[1] 15
drinkdriving$bac <- drinkdriving$bac/100
[1] 16
drinkdriving$bac[drinkdriving$bac >= 0.4] <- NA
[1] 17
drinkdriving$outcome[drinkdriving$outcome == "Fine"] <- "fine"
[1] 18
drinkdriving$outcome[drinkdriving$outcome == "FINE"] <- "fine"
[1] 19
drinkdriving$outcome[drinkdriving$outcome == "Warning"] <- "warning"
[1] 20
drinkdriving$outcome[drinkdriving$outcome == "WARNING"] <- "warning"
[1] 21
drinkdriving$outcome <- droplevels(drinkdriving$outcome)
[1] 22
m1 <- lm(bac ~ age, data = drinkdriving)
[1] 23
plot(m1)
[1] 24
summary(m1)
[1] 25

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2868503  0.0106949   26.82  < 2e-16 ***
age         -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

BAC_50 <- coef(m1)[1] + coef(m1)[2] * 50
[1] 26
BAC_50

(Intercept) 
  0.2181983 


plot(m1)
[1] 28
m2 <- lm(bac ~ scale(age) + nighttime + scale(speed), data = drinkdriving)
[1] 29
plot(m2)
[1] 30
summary(m2)
[1] 31

Call:
lm(formula = bac ~ scale(age) + nighttime + scale(speed), data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.156819 -0.045612  0.005132  0.036083  0.166342 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.203906   0.006611  30.843  < 2e-16 ***
scale(age)     -0.017343   0.005072  -3.420 0.000751 ***
nighttimenight  0.037525   0.008025   4.676 5.18e-06 ***
scale(speed)    0.007181   0.005980   1.201 0.231191    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05528 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2221,	Adjusted R-squared:  0.2112 
F-statistic: 20.36 on 3 and 214 DF,  p-value: 1.201e-11

anova(m2)
[1] 32
Analysis of Variance Table

Response: bac
              Df  Sum Sq  Mean Sq F value    Pr(>F)    
scale(age)     1 0.11631 0.116314 38.0631 3.380e-09 ***
nighttime      1 0.06596 0.065959 21.5845 5.912e-06 ***
scale(speed)   1 0.00441 0.004406  1.4417    0.2312    
Residuals    214 0.65395 0.003056                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m2_new <- lm(bac ~ scale(age) + nighttime, data = drinkdriving)
[1] 33
summary(m2_new)
[1] 34

Call:
lm(formula = bac ~ scale(age) + nighttime, data = drinkdriving)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.164986 -0.046294  0.002675  0.037100  0.172048 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.203123   0.006586  30.844  < 2e-16 ***
scale(age)     -0.021446   0.003751  -5.717 3.59e-08 ***
nighttimenight  0.037271   0.008030   4.641 6.02e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05534 on 215 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2168,	Adjusted R-squared:  0.2095 
F-statistic: 29.76 on 2 and 215 DF,  p-value: 3.886e-12

mean(drinkdriving$age, na.rm = T)
[1] 35
[1] 42.67556
mean(drinkdriving$speed, na.rm = T)
[1] 36
[1] 40.48637
t.test(speed ~ nighttime, data = drinkdriving)
[1] 37

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.71098, df = 161.97, p-value = 0.4781
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.340261  2.512840
sample estimates:
  mean in group day mean in group night 
           39.52505            40.93876 

drinkdriving$yesoffence <- ifelse(drinkdriving$prior_offence != 
    "N", 1, 0)
[1] 38
m3 <- glm(relevel(outcome, "warning") ~ scale(age) + scale(speed) + 
    scale(bac) + yesoffence + nighttime, data = drinkdriving, 
    family = binomial)
[1] 39
summary(m3)
[1] 40

Call:
glm(formula = relevel(outcome, "warning") ~ scale(age) + scale(speed) + 
    scale(bac) + yesoffence + nighttime, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.1789   0.0137   0.0864   0.2833   2.2983  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)     3.88165    0.76212   5.093 3.52e-07 ***
scale(age)     -1.23299    0.42417  -2.907 0.003651 ** 
scale(speed)    2.37059    0.59470   3.986 6.71e-05 ***
scale(bac)      1.55583    0.41522   3.747 0.000179 ***
yesoffence      1.10764    0.75773   1.462 0.143801    
nighttimenight -0.07143    0.64265  -0.111 0.911493    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.086  on 213  degrees of freedom
Residual deviance:  81.677  on 208  degrees of freedom
  (36 observations deleted due to missingness)
AIC: 93.677

Number of Fisher Scoring iterations: 7

anova(m3, test = "Chisq")
[1] 41
Analysis of Deviance Table

Model: binomial, link: logit

Response: relevel(outcome, "warning")

Terms added sequentially (first to last)


             Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                           213    209.086              
scale(age)    1   78.190       212    130.896 < 2.2e-16 ***
scale(speed)  1   24.406       211    106.490 7.802e-07 ***
scale(bac)    1   22.460       210     84.030 2.146e-06 ***
yesoffence    1    2.340       209     81.690    0.1261    
nighttime     1    0.012       208     81.677    0.9114    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
drinkdriving$drinkoffence <- ifelse(drinkdriving$prior_offence == 
    "DR50", 1, 0)
[1] 42
m3drink <- glm(relevel(outcome, "warning") ~ drinkoffence, data = subset(drinkdriving, 
    yesoffence == 1), family = binomial)
[1] 43
summary(m3drink)
[1] 44

Call:
glm(formula = relevel(outcome, "warning") ~ drinkoffence, family = binomial, 
    data = subset(drinkdriving, yesoffence == 1))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3076   0.3803   0.3803   0.3803   0.9005  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)  
(Intercept)    0.6931     0.5000   1.386    0.166  
drinkoffence   1.8971     0.7800   2.432    0.015 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 51.047  on 60  degrees of freedom
Residual deviance: 44.676  on 59  degrees of freedom
AIC: 48.676

Number of Fisher Scoring iterations: 5

m3offence <- glm(relevel(outcome, "warning") ~ yesoffence, data = drinkdriving, 
    family = binomial)
[1] 45
summary(m3offence)
[1] 46

Call:
glm(formula = relevel(outcome, "warning") ~ yesoffence, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9564   0.5650   0.6681   0.6681   0.6681  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)   1.3863     0.1838   7.542 4.62e-14 ***
yesoffence    0.3677     0.4051   0.908    0.364    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 237.06  on 245  degrees of freedom
Residual deviance: 236.20  on 244  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 240.2

Number of Fisher Scoring iterations: 4

new_age <- data.frame(age = 16:70, nighttime = "day", bac = 0, 
    speed = 30, yesoffence = 0)
[1] 47
new_age$predict <- predict(m3, type = "response", newdata = new_age)
[1] 48
plot(predict ~ age, data = new_age, main = "Predicted Probability of \nFine for Different Ages", 
    ylab = "P(Fine)", xlab = "Age")
[1] 49
officerdata <- merge(drinkdriving, officer_inc, by = "incident_id")
[1] 50
bias_prob <- ggplot(data = officerdata, aes(x = age, y = outcome, 
    colour = officer))
[1] 51
bias_prob + geom_point() + theme_minimal() + facet_grid(. ~ officer)
[1] 52
contrasts(officerdata$officer) <- cbind(ITNPvAS = c(2/3, -1/3, 
    -1/3), ITvNP = c(0, 1/2, -1/2))
[1] 53
m5_contrast <- glm(relevel(outcome, "warning") ~ officer * scale(age), 
    data = officerdata, family = binomial)
[1] 54
summary(m5_contrast)
[1] 55

Call:
glm(formula = relevel(outcome, "warning") ~ officer * scale(age), 
    family = binomial, data = officerdata)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7179   0.0642   0.2741   0.5454   2.4089  

Coefficients:
                          Estimate Std. Error z value Pr(>|z|)    
(Intercept)                2.14514    0.29013   7.394 1.43e-13 ***
officerITNPvAS             0.81563    0.67986   1.200   0.2303    
officerITvNP              -0.25531    0.62754  -0.407   0.6841    
scale(age)                -1.64279    0.28221  -5.821 5.84e-09 ***
officerITNPvAS:scale(age) -1.59117    0.65765  -2.419   0.0155 *  
officerITvNP:scale(age)    0.04141    0.61567   0.067   0.9464    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 222.38  on 224  degrees of freedom
Residual deviance: 146.41  on 219  degrees of freedom
  (25 observations deleted due to missingness)
AIC: 158.41

Number of Fisher Scoring iterations: 7

contrasts(officerdata$officer) <- cbind(IT = c(0, 1, 0), NP = c(0, 
    0, 1))
[1] 56
m5 <- glm(relevel(outcome, "warning") ~ scale(bac) + scale(speed) + 
    nighttime + yesoffence + officer * scale(age), data = officerdata, 
    family = binomial)
[1] 57
summary(m5)
[1] 58

Call:
glm(formula = relevel(outcome, "warning") ~ scale(bac) + scale(speed) + 
    nighttime + yesoffence + officer * scale(age), family = binomial, 
    data = officerdata)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.1686   0.0074   0.0617   0.2583   2.1432  

Coefficients:
                     Estimate Std. Error z value Pr(>|z|)    
(Intercept)            4.4687     1.1509   3.883 0.000103 ***
scale(bac)             1.5755     0.4218   3.735 0.000187 ***
scale(speed)           2.6425     0.6662   3.967 7.29e-05 ***
nighttimenight         0.2924     0.6859   0.426 0.669889    
yesoffence             1.0313     0.7675   1.344 0.179026    
officerIT             -1.4031     1.1665  -1.203 0.229053    
officerNP             -0.5347     1.1958  -0.447 0.654761    
scale(age)            -2.2938     0.8182  -2.803 0.005056 ** 
officerIT:scale(age)   2.0362     1.0839   1.879 0.060299 .  
officerNP:scale(age)   1.7151     1.1470   1.495 0.134847    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 209.09  on 213  degrees of freedom
Residual deviance:  75.90  on 204  degrees of freedom
  (36 observations deleted due to missingness)
AIC: 95.9

Number of Fisher Scoring iterations: 8

P_AS <- exp(coef(m5)[1])/(1 + exp(coef(m5)[1]))
[1] 59
