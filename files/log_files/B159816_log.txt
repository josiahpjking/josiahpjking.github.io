

	####### B159816 R script #######

library(lm.beta, quietly = T)
[1] 1
[1] "lm.beta"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(car, quietly = T)
[1] 2
 [1] "car"       "carData"   "lm.beta"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[11] "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
data <- drinkdriving
[1] 4
data <- merge(data, officer_inc)
[1] 5
raw_data <- data
[1] 6
summary(data)
[1] 7
 incident_id             age          nighttime         prior_offence          speed             bac           outcome         
 Length:250         Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250        
 Class :character   1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character  
 Mode  :character   Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character  
                    Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                     
                    3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                     
                    Max.   :297.00                                         Max.   :120.34   Max.   :65.764                     
 officer   
 AS  :116  
 IT  : 66  
 NP  : 67  
 NA's:  1  
           
           
 [ reached getOption("max.print") -- omitted 1 row ]
hist(data$age, breaks = 30)
[1] 8
data$age[data$age > 100] <- NA
[1] 9
data$bac <- data$bac/100
[1] 10
data$bac[data$bac > 0.4] <- NA
[1] 11
data$speed[data$speed == 0] <- NA
[1] 12
data$nighttime <- as.factor(data$nighttime)
[1] 13
levels(data$nighttime)
[1] 14
[1] "18:25" "2:05"  "day"   "night"
data$nighttime[data$nighttime == "18:25"] <- "day"
[1] 15
data$nighttime[data$nighttime == "2:05"] <- "night"
[1] 16
data$nighttime <- droplevels(data$nighttime)
[1] 17
data$outcome[data$outcome == "Fine" | data$outcome == "FINE"] <- "fine"
[1] 18
data$outcome[data$outcome == "Warning" | data$outcome == "WARNING"] <- "warning"
[1] 19
levels(as.factor(data$prior_offence))
[1] 20
 [1] "CD10"           "CD60"           "CD60,CD10,DR80" "CD60,CD60"      "DD20"           "DR50"           "DR80"          
 [8] "N"              "PL10"           "SP50"           "SP60"           "TS70"           "TS70,DR50"     
data$prior_offence[data$prior_offence == "DD20"] <- NA
[1] 21
m1 <- lm(bac ~ age, data = data)
[1] 22
summary(m1)
[1] 23

Call:
lm(formula = bac ~ age, data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2868503  0.0106949   26.82  < 2e-16 ***
age         -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

plot(m1, which = c(1:4))
[1] 24
clean_data <- data
[1] 25
clean_data$age[clean_data$age > mean(clean_data$age, na.rm = T) + 
    2.5 * sd(clean_data$age, na.rm = T) | clean_data$age < mean(clean_data$age, 
    na.rm = T) - 2.5 * sd(clean_data$age, na.rm = T)] <- NA
[1] 26
clean_data$bac[clean_data$bac > mean(clean_data$bac, na.rm = T) + 
    2.5 * sd(clean_data$bac, na.rm = T) | clean_data$bac < mean(clean_data$bac, 
    na.rm = T) - 2.5 * sd(clean_data$bac, na.rm = T)] <- NA
[1] 27
m1_clean <- lm(bac ~ age, data = clean_data)
[1] 28
summary(lm.beta(m1_clean))
[1] 29

Call:
lm(formula = bac ~ age, data = clean_data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153489 -0.041164 -0.006212  0.039529  0.144184 

Coefficients:
              Estimate Standardized Std. Error t value Pr(>|t|)    
(Intercept)  0.2819862    0.0000000  0.0107607  26.205  < 2e-16 ***
age         -0.0012278   -0.3321836  0.0002394  -5.128  6.6e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05628 on 212 degrees of freedom
  (36 observations deleted due to missingness)
Multiple R-squared:  0.1103,	Adjusted R-squared:  0.1061 
F-statistic: 26.29 on 1 and 212 DF,  p-value: 6.596e-07

plot(m1_clean, which = c(1:4))
[1] 30
with(clean_data, plot(bac ~ age, pch = 20, xlab = "Age", ylab = "BAC"))
[1] 31
abline(m1_clean, col = "red", lwd = 2)
[1] 32
prediction_data <- data.frame(age = 50)
[1] 33
prediction_50 <- predict(m1_clean, newdata = prediction_data)
[1] 34
print(prediction_50)
[1] 35
        1 
0.2205968 
        1 
0.2205968 
par(mfrow = c(1, 2))
[1] 36
$mfrow
[1] 1 3

plot(m1_clean, which = 2)
[1] 37
plot(density(residuals(m1_clean)), main = "Density of residuals")
[1] 38
clean_data$speed[clean_data$speed > mean(clean_data$speed, na.rm = T) + 
    2.5 * sd(clean_data$speed, na.rm = T) | clean_data$speed < 
    mean(clean_data$speed, na.rm = T) - 2.5 * sd(clean_data$speed, 
        na.rm = T)] <- NA
[1] 39
m2.1 <- lm(bac ~ age + speed, data = clean_data)
[1] 40
summary(lm.beta(m2.1))
[1] 41

Call:
lm(formula = bac ~ age + speed, data = clean_data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.154101 -0.036870 -0.008038  0.037799  0.140254 

Coefficients:
              Estimate Standardized Std. Error t value Pr(>|t|)    
(Intercept)  0.2478737    0.0000000  0.0290294   8.539 2.93e-15 ***
age         -0.0010027   -0.2665628  0.0003258  -3.077  0.00237 ** 
speed        0.0006052    0.1155495  0.0004537   1.334  0.18367    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05631 on 207 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.1251,	Adjusted R-squared:  0.1167 
F-statistic:  14.8 on 2 and 207 DF,  p-value: 9.815e-07

plot(m2.1, which = c(1:4))
[1] 42
vif(m2.1)
[1] 43
     age    speed 
1.775198 1.775198 
anova_m2.1 <- anova(m2.1)
[1] 44
m2.2 <- lm(bac ~ age + nighttime, data = clean_data)
[1] 45
summary(m2.2)
[1] 46

Call:
lm(formula = bac ~ age + nighttime, data = clean_data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.127032 -0.044192  0.002206  0.036595  0.140068 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2530890  0.0118991  21.270  < 2e-16 ***
age            -0.0011581  0.0002285  -5.069 8.73e-07 ***
nighttimenight  0.0378078  0.0079152   4.777 3.33e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05359 on 211 degrees of freedom
  (36 observations deleted due to missingness)
Multiple R-squared:  0.1972,	Adjusted R-squared:  0.1896 
F-statistic: 25.91 on 2 and 211 DF,  p-value: 8.677e-11

plot(m2.2, which = c(1:4))
[1] 47
anova_m2.2 <- anova(m2.2)
[1] 48
m2.1_r_squared <- summary(m2.1)$r.squared
[1] 49
m2.2_r_squared <- summary(m2.2)$r.squared
[1] 50
t.test_d.n_speed <- t.test(clean_data$speed[clean_data$nighttime == 
    "day"], clean_data$speed[clean_data$nighttime == "night"])
[1] 51
clean_data$outcome[clean_data$outcome == "fine"] <- 1
[1] 52
clean_data$outcome[clean_data$outcome == "warning"] <- 0
[1] 53
clean_data$outcome <- as.numeric(clean_data$outcome)
[1] 54
clean_data$prior_DR <- ifelse(clean_data$prior_offence == "DR50" | 
    clean_data$prior_offence == "TS70,DR50", 1, 0)
[1] 55
clean_data$prior_yn <- ifelse(clean_data$prior_offence == "N", 
    0, 1)
[1] 56
clean_data$prior_DR[clean_data$prior_yn == 0] <- NA
[1] 57
m3 <- glm(outcome ~ scale(speed) + scale(bac) + scale(age) + 
    prior_yn + nighttime, data = clean_data, family = binomial)
[1] 58
summary(m3)
[1] 59

Call:
glm(formula = outcome ~ scale(speed) + scale(bac) + scale(age) + 
    prior_yn + nighttime, family = binomial, data = clean_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.1063   0.0215   0.1011   0.2970   2.3199  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)      3.9754     0.7945   5.004 5.62e-07 ***
scale(speed)     1.8008     0.5785   3.113 0.001852 ** 
scale(bac)       1.4047     0.3875   3.625 0.000289 ***
scale(age)      -1.3491     0.4438  -3.039 0.002370 ** 
prior_yn         0.9899     0.7822   1.265 0.205716    
nighttimenight  -0.1120     0.6399  -0.175 0.861078    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 184.55  on 205  degrees of freedom
Residual deviance:  79.95  on 200  degrees of freedom
  (44 observations deleted due to missingness)
AIC: 91.95

Number of Fisher Scoring iterations: 7

anova(m3, test = "Chisq")
[1] 60
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


             Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                           205    184.554              
scale(speed)  1   63.146       204    121.408 1.919e-15 ***
scale(bac)    1   27.848       203     93.560 1.313e-07 ***
scale(age)    1   11.866       202     81.694 0.0005717 ***
prior_yn      1    1.714       201     79.981 0.1905285    
nighttime     1    0.031       200     79.950 0.8608315    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
m4 <- glm(outcome ~ bac + speed + age + prior_DR, data = clean_data, 
    family = binomial)
[1] 61
summary(m4)
[1] 62

Call:
glm(formula = outcome ~ bac + speed + age + prior_DR, family = binomial, 
    data = clean_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4154   0.2038   0.2334   0.2821   0.9809  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)  
(Intercept)  2.18934    4.39227   0.498   0.6182  
bac          2.66930   11.80416   0.226   0.8211  
speed       -0.02470    0.06336  -0.390   0.6967  
age         -0.01939    0.04310  -0.450   0.6528  
prior_DR     2.55355    1.25843   2.029   0.0424 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 27.536  on 47  degrees of freedom
Residual deviance: 22.270  on 43  degrees of freedom
  (202 observations deleted due to missingness)
AIC: 32.27

Number of Fisher Scoring iterations: 6

m3_coeff_prior_yn <- coef(m3)[5]
[1] 63
prediction_fine <- data.frame(age = c(14:80), speed = 30, bac = 0, 
    prior_yn = 0, nighttime = "day")
[1] 64
prob_from_logits <- function(logits) {
    exp(logits)/(1 + exp(logits))
}
[1] 65
par(mfrow = c(1, 1))
[1] 66
$mfrow
[1] 1 2

plot(prob_from_logits(predict(m3, newdata = prediction_fine)) ~ 
    prediction_fine$age, pch = 20, col = "red", ylab = "Predicted P(fine)", 
    xlab = "Age")
[1] 67
contrasts(clean_data$officer) <- cbind(ASvNP_IT = c(0.5, -0.25, 
    -0.25), NPvIT = c(0, 0.5, -0.5))
[1] 68
m5 <- glm(outcome ~ bac + speed + age * officer, data = clean_data, 
    family = binomial)
[1] 69
summary(m5)
[1] 70

Call:
glm(formula = outcome ~ bac + speed + age * officer, family = binomial, 
    data = clean_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.3264   0.0165   0.1066   0.3493   2.1834  

Coefficients:
                    Estimate Std. Error z value Pr(>|z|)    
(Intercept)         -5.22217    2.58795  -2.018 0.043604 *  
bac                 20.09636    5.19406   3.869 0.000109 ***
speed                0.14363    0.04117   3.488 0.000486 ***
age                 -0.04299    0.02348  -1.831 0.067056 .  
officerASvNP_IT      9.17992    3.92320   2.340 0.019289 *  
officerNPvIT         0.03327    2.50118   0.013 0.989386    
age:officerASvNP_IT -0.17101    0.06791  -2.518 0.011800 *  
age:officerNPvIT    -0.01106    0.04731  -0.234 0.815234    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 192.421  on 209  degrees of freedom
Residual deviance:  95.028  on 202  degrees of freedom
  (40 observations deleted due to missingness)
AIC: 111.03

Number of Fisher Scoring iterations: 7

anova_m5 <- anova(m5, test = "Chisq")
[1] 71
