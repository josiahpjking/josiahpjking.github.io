

	####### B116457 R script #######

library(ggplot2, quietly = T)
[1] 1
[1] "ggplot2"   "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
logit.to.p <- function(logits) {
    exp(logits)/(exp(logits) + 1)
}
[1] 2
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
summary(drinkdriving)
[1] 4
      age          nighttime         prior_offence          speed             bac           outcome          incident_id       
 Min.   : 14.00   Length:250         Length:250         Min.   :  0.00   Min.   : 3.987   Length:250         Length:250        
 1st Qu.: 30.00   Class :character   Class :character   1st Qu.: 30.92   1st Qu.:19.264   Class :character   Class :character  
 Median : 40.50   Mode  :character   Mode  :character   Median : 40.64   Median :23.609   Mode  :character   Mode  :character  
 Mean   : 46.00                                         Mean   : 40.49   Mean   :23.605                                        
 3rd Qu.: 55.25                                         3rd Qu.: 48.84   3rd Qu.:27.898                                        
 Max.   :297.00                                         Max.   :120.34   Max.   :65.764                                        
 NA's   :22                                                              NA's   :5                                             
drinkdriving <- merge(officer_inc, drinkdriving)
[1] 5
drinkdriving$nighttime <- factor(drinkdriving$nighttime)
[1] 6
drinkdriving$outcome <- factor(tolower(drinkdriving$outcome))
[1] 7
drinkdriving$officer <- factor(drinkdriving$officer)
[1] 8
drinkdriving$nighttime[drinkdriving$nighttime %in% c("2:05", 
    "18:25")] <- "night"
[1] 9
drinkdriving$nighttime <- droplevels(drinkdriving$nighttime)
[1] 10
ggplot(drinkdriving, aes(age)) + geom_histogram()
[1] 11
drinkdriving$age[drinkdriving$age > 200] <- NA
[1] 12
sum(is.na(drinkdriving$age))
[1] 13
[1] 25
ggplot(drinkdriving, aes(speed, bac)) + geom_point()
[1] 14
drinkdriving$prior_any <- ifelse(drinkdriving$prior_offence == 
    "N", 0, 1)
[1] 15
drinkdriving$prior_dr <- ifelse(grepl("DR", drinkdriving$prior_offence, 
    fixed = TRUE), 1, 0)
[1] 16
m.age <- lm(bac ~ age, data = drinkdriving)
[1] 17
summary(m.age)
[1] 18

Call:
lm(formula = bac ~ age, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.719  -4.516  -0.861   3.849  42.785 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 29.29455    1.25564  23.330  < 2e-16 ***
age         -0.14353    0.02741  -5.236 3.86e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.82 on 218 degrees of freedom
  (30 observations deleted due to missingness)
Multiple R-squared:  0.1117,	Adjusted R-squared:  0.1076 
F-statistic: 27.41 on 1 and 218 DF,  p-value: 3.863e-07

plot(m.age)
[1] 19
ggplot(drinkdriving, aes(x = age, y = bac)) + geom_point() + 
    geom_smooth(method = "lm")
[1] 20
m.agescaled <- lm(bac ~ I(age - mean(age)), data = drinkdriving[!is.na(drinkdriving$age), 
    ])
[1] 21
summary(m.agescaled)
[1] 22

Call:
lm(formula = bac ~ I(age - mean(age)), data = drinkdriving[!is.na(drinkdriving$age), 
    ])

Residuals:
    Min      1Q  Median      3Q     Max 
-15.719  -4.516  -0.861   3.849  42.785 

Coefficients:
                   Estimate Std. Error t value Pr(>|t|)    
(Intercept)        23.16949    0.45978  50.393  < 2e-16 ***
I(age - mean(age)) -0.14353    0.02741  -5.236 3.86e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.82 on 218 degrees of freedom
  (5 observations deleted due to missingness)
Multiple R-squared:  0.1117,	Adjusted R-squared:  0.1076 
F-statistic: 27.41 on 1 and 218 DF,  p-value: 3.863e-07

mean(drinkdriving[!is.na(drinkdriving$age), ]$age)
[1] 23
[1] 42.67556
plot(m.age, which = 2)
[1] 24
m.agespeed <- lm(bac ~ age + speed, data = drinkdriving)
[1] 25
summary(m.age)$adj.r.squared
[1] 26
[1] 0.1076219
summary(m.agespeed)$adj.r.squared
[1] 27
[1] 0.189939
anova(m.agespeed)
[1] 28
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1274.8 1274.83  30.197 1.089e-07 ***
speed       1  977.4  977.44  23.153 2.800e-06 ***
Residuals 217 9161.1   42.22                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m.agespeed)
[1] 29

Call:
lm(formula = bac ~ age + speed, data = drinkdriving)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.970  -4.446  -0.690   4.282  34.575 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 17.49660    2.72820   6.413 8.78e-10 ***
age         -0.04303    0.03344  -1.287      0.2    
speed        0.19235    0.03998   4.812 2.80e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 6.497 on 217 degrees of freedom
  (30 observations deleted due to missingness)
Multiple R-squared:  0.1973,	Adjusted R-squared:  0.1899 
F-statistic: 26.68 on 2 and 217 DF,  p-value: 4.384e-11

m.agenight <- lm(bac ~ age + nighttime, data = drinkdriving)
[1] 30
ggplot(drinkdriving, aes(x = age, y = bac, color = nighttime)) + 
    geom_point() + geom_smooth(data = drinkdriving[drinkdriving$nighttime == 
    "day", ], method = "lm") + geom_smooth(data = drinkdriving[drinkdriving$nighttime == 
    "night", ], method = "lm") + labs(x = "Age", y = "BAC", color = "Time of day")
[1] 31
summary(m.age)$adj.r.squared
[1] 32
[1] 0.1076219
summary(m.agenight)$adj.r.squared
[1] 33
[1] 0.1602173
anova(m.agenight)
[1] 34
Analysis of Variance Table

Response: bac
           Df Sum Sq Mean Sq F value    Pr(>F)    
age         1 1274.8 1274.83  29.128 1.769e-07 ***
nighttime   1  641.3  641.31  14.653  0.000169 ***
Residuals 217 9497.2   43.77                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
plot(m.agespeed)
[1] 35
m.agespeedDROP <- lm(bac ~ age + speed, data = drinkdriving[-c(14, 
    62), ])
[1] 36
plot(m.agespeedDROP)
[1] 37
summary(m.agespeed)$r.squared
[1] 38
[1] 0.1973368
summary(m.agespeedDROP)$r.squared
[1] 39
[1] 0.1425893
plot(m.agenight)
[1] 40
summary(m.agenight)$r.squared
[1] 41
[1] 0.1678866
t.test(speed ~ nighttime, drinkdriving)
[1] 42

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.85812, df = 155.57, p-value = 0.3921
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.669084  2.235272
sample estimates:
  mean in group day mean in group night 
           39.30514            41.02205 

ggplot(drinkdriving, aes(x = speed, group = nighttime, fill = nighttime)) + 
    geom_density(alpha = 0.5) + labs(x = "Speed", y = "Density", 
    fill = "Time of day")
[1] 43
m.outcomes <- glm(outcome ~ speed + bac + nighttime + age, data = drinkdriving, 
    family = binomial)
[1] 44
summary(m.outcomes)
[1] 45

Call:
glm(formula = outcome ~ speed + bac + nighttime + age, family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3290  -0.3674  -0.1510  -0.0312   3.5357  

Coefficients:
               Estimate Std. Error z value Pr(>|z|)    
(Intercept)     4.82142    2.18300   2.209 0.027201 *  
speed          -0.13780    0.03365  -4.095 4.23e-05 ***
bac            -0.19513    0.05175  -3.770 0.000163 ***
nighttimenight  0.09230    0.55790   0.165 0.868592    
age             0.04621    0.02018   2.290 0.022021 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 217.38  on 219  degrees of freedom
Residual deviance: 106.28  on 215  degrees of freedom
  (30 observations deleted due to missingness)
AIC: 116.28

Number of Fisher Scoring iterations: 7

anova(m.outcomes, test = "Chisq")
[1] 46
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


          Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    
NULL                        219     217.38              
speed      1   79.517       218     137.86 < 2.2e-16 ***
bac        1   26.067       217     111.79 3.298e-07 ***
nighttime  1    0.124       216     111.67   0.72487    
age        1    5.388       215     106.28   0.02028 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
ggplot(drinkdriving, aes(x = speed, y = bac, color = outcome)) + 
    geom_point()
[1] 47
ggplot(drinkdriving, aes(fill = outcome, x = nighttime)) + geom_bar(position = "stack")
[1] 48
m.outcomesST <- glm(outcome ~ scale(speed) + scale(bac), data = drinkdriving, 
    family = binomial)
[1] 49
summary(m.outcomesST)
[1] 50

Call:
glm(formula = outcome ~ scale(speed) + scale(bac), family = binomial, 
    data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9536  -0.4434  -0.1852  -0.0436   4.0812  

Coefficients:
             Estimate Std. Error z value Pr(>|z|)    
(Intercept)   -2.8600     0.3706  -7.717 1.19e-14 ***
scale(speed)  -2.1932     0.3850  -5.696 1.23e-08 ***
scale(bac)    -1.2910     0.3076  -4.197 2.71e-05 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 239.55  on 244  degrees of freedom
Residual deviance: 130.13  on 242  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 136.13

Number of Fisher Scoring iterations: 7

otherwarning <- nrow(drinkdriving[drinkdriving$prior_any == 1 & 
    drinkdriving$prior_dr == 0 & drinkdriving$outcome == "warning", 
    ])
[1] 51
otherfine <- nrow(drinkdriving[drinkdriving$prior_any == 1 & 
    drinkdriving$prior_dr == 0 & drinkdriving$outcome == "fine", 
    ])
[1] 52
drwarning <- nrow(drinkdriving[drinkdriving$prior_dr == 1 & drinkdriving$outcome == 
    "warning", ])
[1] 53
drfine <- nrow(drinkdriving[drinkdriving$prior_dr == 1 & drinkdriving$outcome == 
    "fine", ])
[1] 54
ctable <- cbind(c(otherwarning, otherfine), c(drwarning, drfine))
[1] 55
fisher.test(ctable)
[1] 56

	Fisher's Exact Test for Count Data

data:  ctable
p-value = 0.02005
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
  1.066975 26.049243
sample estimates:
odds ratio 
  5.107859 

drfine/(drwarning + drfine)
[1] 57
[1] 0.8979592
otherfine/(otherwarning + otherfine)
[1] 58
[1] 0.625
m.prior <- glm(outcome ~ prior_any, data = drinkdriving, family = binomial)
[1] 59
summary(m.prior)
[1] 60

Call:
glm(formula = outcome ~ prior_any, family = binomial, data = drinkdriving)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-0.6681  -0.6681  -0.6681  -0.6089   1.8849  

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  -1.3863     0.1838  -7.542 4.62e-14 ***
prior_any    -0.2048     0.3784  -0.541    0.588    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 244.56  on 249  degrees of freedom
Residual deviance: 244.26  on 248  degrees of freedom
AIC: 248.26

Number of Fisher Scoring iterations: 4

anova(m.prior, test = "Chisq")
[1] 61
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


          Df Deviance Resid. Df Resid. Dev Pr(>Chi)
NULL                        249     244.56         
prior_any  1  0.29974       248     244.25    0.584
df30 <- data.frame(age = 17:90, nighttime = as.factor("day"), 
    speed = 30, bac = 0, prior_any = 0)
[1] 62
m.all <- glm(outcome ~ speed + bac + prior_any + nighttime + 
    age, data = drinkdriving, family = binomial)
[1] 63
df30$model_prediction <- logit.to.p(predict(m.all, newdata = df30))
[1] 64
ggplot(df30, aes(x = age, y = model_prediction)) + geom_point() + 
    labs(x = "Age", y = "Model-predicted probability of warning")
[1] 65
ggplot(data = drinkdriving[!is.na(drinkdriving$officer), ], aes(x = age, 
    y = ifelse(outcome == "fine", 0, 1), col = officer, fill = officer)) + 
    geom_point() + stat_smooth(aes(x = age, y = ifelse(outcome == 
    "fine", 0, 1)), method = "glm", se = T, method.args = list(family = "binomial"), 
    alpha = 0.2) + labs(x = "Age", y = "p(Warning)")
[1] 66
m.bias <- glm(outcome ~ age * officer, data = drinkdriving, family = binomial)
[1] 67
anova(m.bias, test = "Chisq")
[1] 68
Analysis of Deviance Table

Model: binomial, link: logit

Response: outcome

Terms added sequentially (first to last)


            Df Deviance Resid. Df Resid. Dev Pr(>Chi)    
NULL                          224     222.38             
age          1   67.728       223     154.65  < 2e-16 ***
officer      2    0.861       221     153.79  0.65013    
age:officer  2    7.383       219     146.41  0.02494 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
