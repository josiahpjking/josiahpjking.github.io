

	####### B150094 R script #######

library(psych, quietly = T)
[1] 1
[1] "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
library(ggplot2, quietly = T)
[1] 2
 [1] "ggplot2"   "psych"     "readr"     "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"   "base"     
load(url("https://edin.ac/2QCZNVu"))
[1] 3
[1] "drinkdriving" "officer_inc" 
Final_Table2 <- merge(drinkdriving, officer_inc, all = T)
[1] 4
Final_Table2$age[Final_Table2$age > 90] <- NA
[1] 5
Final_Table2$bac[Final_Table2$bac > 40] <- NA
[1] 6
Final_Table2$nighttime <- as.factor(Final_Table2$nighttime)
[1] 7
Final_Table2$prior_offence <- as.factor(Final_Table2$prior_offence)
[1] 8
Final_Table2$outcome <- tolower(Final_Table2$outcome)
[1] 9
Final_Table2$nighttime[Final_Table2$nighttime == "18:25"] <- "day"
[1] 10
Final_Table2$nighttime[Final_Table2$nighttime == "2:05"] <- "night"
[1] 11
Final_Table2$prior_offence[Final_Table2$prior_offence == "DD20"] <- NA
[1] 12
Final_Table2$outcome <- as.factor(Final_Table2$outcome)
[1] 13
bac_2 <- c(Final_Table2$bac/100)
[1] 14
Final_Table2 <- cbind(Final_Table2, bac_2)
[1] 15
summary(Final_Table2)
[1] 16
 incident_id             age        nighttime   prior_offence     speed             bac            outcome    officer   
 Length:250         Min.   :14.00   18:25:  0   N      :185   Min.   :  0.00   Min.   : 3.987   fine   :202   AS  :116  
 Class :character   1st Qu.:30.00   2:05 :  0   DR50   : 43   1st Qu.: 30.92   1st Qu.:19.215   warning: 48   IT  : 66  
 Mode  :character   Median :40.00   day  : 79   DR80   :  4   Median : 40.64   Median :23.504                 NP  : 67  
                    Mean   :42.68   night:171   TS70   :  3   Mean   : 40.49   Mean   :23.292                 NA's:  1  
                    3rd Qu.:55.00               CD10   :  2   3rd Qu.: 48.84   3rd Qu.:27.789                           
     bac_2        
 Min.   :0.03987  
 1st Qu.:0.19215  
 Median :0.23504  
 Mean   :0.23292  
 3rd Qu.:0.27789  
 [ reached getOption("max.print") -- omitted 2 rows ]
m1 <- lm(formula = bac_2 ~ age, data = Final_Table2)
[1] 17
summary(m1)
[1] 18

Call:
lm(formula = bac_2 ~ age, data = Final_Table2)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2868503  0.0106949   26.82  < 2e-16 ***
age         -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

plot(m1)
[1] 19
age50 <- data.frame(age = c(50))
[1] 20
predict(m1, newdata = age50)
[1] 21
        1 
0.2181983 
plot(m1)
[1] 22
shapiro.test(Final_Table2$age)
[1] 23

	Shapiro-Wilk normality test

data:  Final_Table2$age
W = 0.97366, p-value = 0.0003304

shapiro.test(Final_Table2$bac_2)
[1] 24

	Shapiro-Wilk normality test

data:  Final_Table2$bac_2
W = 0.98518, p-value = 0.01255

summary(m1)
[1] 25

Call:
lm(formula = bac_2 ~ age, data = Final_Table2)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153270 -0.041824 -0.005698  0.039975  0.149487 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.2868503  0.0106949   26.82  < 2e-16 ***
age         -0.0013730  0.0002331   -5.89 1.47e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05791 on 216 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.1384,	Adjusted R-squared:  0.1344 
F-statistic: 34.69 on 1 and 216 DF,  p-value: 1.469e-08

par(mfrow = c(2, 2))
[1] 26
$mfrow
[1] 1 1

plot(m1, which = c(1:4))
[1] 27
m2 <- lm(bac_2 ~ nighttime + speed + age, data = Final_Table2)
[1] 28
anova(m2)
[1] 29
Analysis of Variance Table

Response: bac_2
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
nighttime   1 0.08811 0.088107  29.071 1.839e-07 ***
speed       1 0.06628 0.066280  21.869 5.167e-06 ***
age         1 0.03765 0.037652  12.423 0.0005185 ***
Residuals 214 0.64859 0.003031                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
summary(m2)
[1] 30

Call:
lm(formula = bac_2 ~ nighttime + speed + age, data = Final_Table2)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.157811 -0.046224  0.005195  0.037225  0.142190 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2299435  0.0268293   8.571 2.06e-15 ***
nighttimenight  0.0392649  0.0080461   4.880 2.07e-06 ***
speed           0.0004340  0.0003992   1.087 0.278151    
age            -0.0010600  0.0003007  -3.525 0.000518 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

plot(m2)
[1] 31
anova(m2)
[1] 32
Analysis of Variance Table

Response: bac_2
           Df  Sum Sq  Mean Sq F value    Pr(>F)    
nighttime   1 0.08811 0.088107  29.071 1.839e-07 ***
speed       1 0.06628 0.066280  21.869 5.167e-06 ***
age         1 0.03765 0.037652  12.423 0.0005185 ***
Residuals 214 0.64859 0.003031                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
aov(m2)
[1] 33
Call:
   aov(formula = m2)

Terms:
                nighttime     speed       age Residuals
Sum of Squares  0.0881066 0.0662804 0.0376524 0.6485867
Deg. of Freedom         1         1         1       214

Residual standard error: 0.05505251
Estimated effects may be unbalanced
32 observations deleted due to missingness
summary(m2)
[1] 34

Call:
lm(formula = bac_2 ~ nighttime + speed + age, data = Final_Table2)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.157811 -0.046224  0.005195  0.037225  0.142190 

Coefficients:
                 Estimate Std. Error t value Pr(>|t|)    
(Intercept)     0.2299435  0.0268293   8.571 2.06e-15 ***
nighttimenight  0.0392649  0.0080461   4.880 2.07e-06 ***
speed           0.0004340  0.0003992   1.087 0.278151    
age            -0.0010600  0.0003007  -3.525 0.000518 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.05505 on 214 degrees of freedom
  (32 observations deleted due to missingness)
Multiple R-squared:  0.2284,	Adjusted R-squared:  0.2176 
F-statistic: 21.12 on 3 and 214 DF,  p-value: 5.044e-12

m3 <- lm(speed ~ nighttime, data = Final_Table2)
[1] 35
plot(Final_Table2$speed, Final_Table2$nighttime)
[1] 36
t.test(speed ~ nighttime, data = Final_Table2)
[1] 37

	Welch Two Sample t-test

data:  speed by nighttime
t = -0.71535, df = 158.46, p-value = 0.4754
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -5.371172  2.514895
sample estimates:
  mean in group day mean in group night 
           39.50953            40.93767 

plot(m3)
[1] 38
summary(m3)
[1] 39

Call:
lm(formula = speed ~ nighttime, data = Final_Table2)

Residuals:
    Min      1Q  Median      3Q     Max 
-40.938  -9.368   0.072   8.291  80.827 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)      39.510      1.680  23.521   <2e-16 ***
nighttimenight    1.428      2.031   0.703    0.483    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.93 on 248 degrees of freedom
Multiple R-squared:  0.00199,	Adjusted R-squared:  -0.002034 
F-statistic: 0.4944 on 1 and 248 DF,  p-value: 0.4826

anova(m3)
[1] 40
Analysis of Variance Table

Response: speed
           Df Sum Sq Mean Sq F value Pr(>F)
nighttime   1    110  110.21  0.4944 0.4826
Residuals 248  55279  222.90               
plot(Final_Table2$nighttime, Final_Table2$speed)
[1] 41
summary(Final_Table2)
[1] 42
 incident_id             age        nighttime   prior_offence     speed             bac            outcome    officer   
 Length:250         Min.   :14.00   18:25:  0   N      :185   Min.   :  0.00   Min.   : 3.987   fine   :202   AS  :116  
 Class :character   1st Qu.:30.00   2:05 :  0   DR50   : 43   1st Qu.: 30.92   1st Qu.:19.215   warning: 48   IT  : 66  
 Mode  :character   Median :40.00   day  : 79   DR80   :  4   Median : 40.64   Median :23.504                 NP  : 67  
                    Mean   :42.68   night:171   TS70   :  3   Mean   : 40.49   Mean   :23.292                 NA's:  1  
                    3rd Qu.:55.00               CD10   :  2   3rd Qu.: 48.84   3rd Qu.:27.789                           
     bac_2        
 Min.   :0.03987  
 1st Qu.:0.19215  
 Median :0.23504  
 Mean   :0.23292  
 3rd Qu.:0.27789  
 [ reached getOption("max.print") -- omitted 2 rows ]
class(Final_Table2$prior_offence)
[1] 43
[1] "factor"
class(Fin)
[1] 44
[1] "Error in eval(script[[ll]]) : object 'Fin' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in eval(script[[ll]]): object 'Fin' not found>


####################################################################################################

[1] "Error in eval(script[[ll]]) : object 'Fin' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in eval(script[[ll]]): object 'Fin' not found>
####################################################################################################


levels(Final_Table2$prior_offence_new)
[1] 45
NULL
Final_Table2$outcome_new <- "0"
[1] 46
Final_Table2$outcome_new[Final_Table2$outcome == "fine"] <- "1"
[1] 47
Final_Table2$prior_offence_new[Final_Table2$prior_offence == 
    "N"] <- "0"
[1] 48
Final_Table2$prior_offence_new[Final_Table2$prior_offence_new != 
    "0"] <- "1"
[1] 49
Final_Table2$prior_offence_new <- as.factor(Final_Table2$prior_offence_new)
[1] 50
class(Final_Table2$prior_offence_new)
[1] 51
[1] "factor"
m4 <- lm(outcome_new ~ age + speed + bac_2 + nighttime + prior_offence_new, 
    data = Final_Table2)
[1] 52


####################################################################################################

[1] "Error in `contrasts<-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : \n  contrasts can be applied only to factors with 2 or more levels\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in `contrasts<-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels>
####################################################################################################


summary(m4)
[1] 53
[1] "Error in summary(m4) : object 'm4' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in summary(m4): object 'm4' not found>


####################################################################################################

[1] "Error in summary(m4) : object 'm4' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in summary(m4): object 'm4' not found>
####################################################################################################


anova(m4)
[1] 54
[1] "Error in anova(m4) : object 'm4' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in anova(m4): object 'm4' not found>


####################################################################################################

[1] "Error in anova(m4) : object 'm4' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in anova(m4): object 'm4' not found>
####################################################################################################


m5 <- lm(outcome_new ~ scale(speed) + scale(bac_2), data = Final_Table2)
[1] 55
summary(m5)
[1] 56

Call:
lm(formula = outcome_new ~ scale(speed) + scale(bac_2), data = Final_Table2)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.29504 -0.15823  0.07909  0.23667  0.58921 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)   0.81266    0.02052  39.603  < 2e-16 ***
scale(speed)  0.18377    0.02452   7.494 1.28e-12 ***
scale(bac_2)  0.10645    0.02265   4.701 4.37e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3196 on 240 degrees of freedom
  (7 observations deleted due to missingness)
Multiple R-squared:  0.3532,	Adjusted R-squared:  0.3478 
F-statistic: 65.54 on 2 and 240 DF,  p-value: < 2.2e-16

anova(m5)
[1] 57
Analysis of Variance Table

Response: outcome_new
              Df  Sum Sq Mean Sq F value    Pr(>F)    
scale(speed)   1 11.1334 11.1334 108.979 < 2.2e-16 ***
scale(bac_2)   1  2.2574  2.2574  22.096 4.373e-06 ***
Residuals    240 24.5187  0.1022                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
Final_Table2$DD_offences[Final_Table2$prior_offence == "DR50"] <- "1"
[1] 58
Final_Table2$DD_offences[Final_Table2$prior_offence != "DR50"] <- "2"
[1] 59
Final_Table2$DD_offences[Final_Table2$prior_offence == "N"] <- NA
[1] 60
summary(Final_Table2)
[1] 61
 incident_id             age        nighttime   prior_offence     speed             bac            outcome    officer   
 Length:250         Min.   :14.00   18:25:  0   N      :185   Min.   :  0.00   Min.   : 3.987   fine   :202   AS  :116  
 Class :character   1st Qu.:30.00   2:05 :  0   DR50   : 43   1st Qu.: 30.92   1st Qu.:19.215   warning: 48   IT  : 66  
 Mode  :character   Median :40.00   day  : 79   DR80   :  4   Median : 40.64   Median :23.504                 NP  : 67  
                    Mean   :42.68   night:171   TS70   :  3   Mean   : 40.49   Mean   :23.292                 NA's:  1  
     bac_2         outcome_new        prior_offence_new DD_offences       
 Min.   :0.03987   Length:250         0   :185          Length:250        
 1st Qu.:0.19215   Class :character   NA's: 65          Class :character  
 Median :0.23504   Mode  :character                     Mode  :character  
 Mean   :0.23292                                                          
 [ reached getOption("max.print") -- omitted 3 rows ]
Final_Table2$DD_offences <- as.factor(Final_Table2$DD_offences)
[1] 62
chisq.test(Final_Table2$outcome, Final_Table2$DD_offences)
[1] 63

	Pearson's Chi-squared test with Yates' continuity correction

data:  Final_Table2$outcome and Final_Table2$DD_offences
X-squared = 5.0692, df = 1, p-value = 0.02435

plot(Final_Table2$outcome, Final_Table2$DD_offences)
[1] 64
chisq.test(table(Final_Table2$DD_offences[Final_Table2$DD_offences == 
    "1"]))
[1] 65

	Chi-squared test for given probabilities

data:  table(Final_Table2$DD_offences[Final_Table2$DD_offences == "1"])
X-squared = 43, df = 1, p-value = 5.474e-11

plot(Final_Table2$DD_offences, main = "Previous offence and Outcome", 
    xlab = "previous offence: 1 drinking 2 motor", ylab = "amount of fines")
[1] 66
chisq.test(Final_Table2$outcome, Final_Table2$DD_offences)
[1] 67

	Pearson's Chi-squared test with Yates' continuity correction

data:  Final_Table2$outcome and Final_Table2$DD_offences
X-squared = 5.0692, df = 1, p-value = 0.02435

chisq.test(table(Final_Table2$outcome[Final_Table2$DD_offences == 
    "2"]))
[1] 68

	Chi-squared test for given probabilities

data:  table(Final_Table2$outcome[Final_Table2$DD_offences == "2"])
X-squared = 2, df = 1, p-value = 0.1573

chisq.test(table(Final_Table2$outcome[Final_Table2$DD_offences == 
    "1"]))
[1] 69

	Chi-squared test for given probabilities

data:  table(Final_Table2$outcome[Final_Table2$DD_offences == "1"])
X-squared = 31.837, df = 1, p-value = 1.677e-08

`?`(data.frame)
[1] 70
Prediction_Table <- data.frame(age = c(14:100), nighttime = factor(c("day")), 
    speed = c(30), bac_2 = c(0), prior_offence = factor(c("N")), 
    prior_offence_new = ("0"))
[1] 71
levels(Final_Table2$prior_offence_new)
[1] 72
[1] "0"
Prediction_Table$modelprediction <- predict(m4, newdata = Prediction_Table, 
    type = "response")
[1] 73


####################################################################################################

[1] "Error in predict(m4, newdata = Prediction_Table, type = \"response\") : \n  object 'm4' not found\n"
attr(,"class")
[1] "try-error"
attr(,"condition")
<simpleError in predict(m4, newdata = Prediction_Table, type = "response"): object 'm4' not found>
####################################################################################################


plot(Prediction_Table$age, Prediction_Table$modelprediction, 
    main = "Predicted probabilities", xlab = "Age(years)", ylab = "Probability of receiving a fine", 
    col = "red", type = "l", lwd = 2)
[1] 74
plot(Final_Table2$officer, Final_Table2$age, main = "Officer reported incidents by driver's age", 
    xlab = "Officer initials", ylab = "Age of drivers")
[1] 75
with(Final_Table2, plot(officer ~ age))
[1] 76
with(Final_Table2, plot(officer ~ outcome))
[1] 77
Categorical_officer <- dummy.code(Final_Table2$officer)
[1] 78
Final_Table2 <- cbind(Final_Table2, Categorical_officer)
[1] 79
m8 <- lm(outcome_new ~ AS + AS:age, data = Final_Table2)
[1] 80
summary(m8)
[1] 81

Call:
lm(formula = outcome_new ~ AS + AS:age, data = Final_Table2)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.8120 -0.1103  0.1880  0.1880  0.7713 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.811966   0.032318  25.124  < 2e-16 ***
AS           0.628940   0.091260   6.892 5.63e-11 ***
AS:age      -0.015744   0.001916  -8.218 1.71e-14 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3496 on 222 degrees of freedom
  (25 observations deleted due to missingness)
Multiple R-squared:  0.2336,	Adjusted R-squared:  0.2267 
F-statistic: 33.82 on 2 and 222 DF,  p-value: 1.504e-13

plot(m8)
[1] 82
m9 <- lm(outcome_new ~ IT + IT:age, data = Final_Table2)
[1] 83
summary(m9)
[1] 84

Call:
lm(formula = outcome_new ~ IT + IT:age, data = Final_Table2)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.9919  0.1046  0.1916  0.1916  0.6063 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.808383   0.030261  26.713  < 2e-16 ***
IT           0.415074   0.152597   2.720  0.00704 ** 
IT:age      -0.009648   0.003149  -3.064  0.00246 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3911 on 222 degrees of freedom
  (25 observations deleted due to missingness)
Multiple R-squared:  0.04083,	Adjusted R-squared:  0.03219 
F-statistic: 4.726 on 2 and 222 DF,  p-value: 0.009777

plot(m9)
[1] 85
m10 <- lm(outcome_new ~ NP + NP:age, data = Final_Table2)
[1] 86
summary(m10)
[1] 87

Call:
lm(formula = outcome_new ~ NP + NP:age, data = Final_Table2)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.05408  0.08377  0.20482  0.20482  0.39394 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  0.795181   0.030521  26.054   <2e-16 ***
NP           0.413981   0.159536   2.595   0.0101 *  
NP:age      -0.008616   0.003367  -2.559   0.0112 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3932 on 222 degrees of freedom
  (25 observations deleted due to missingness)
Multiple R-squared:  0.03014,	Adjusted R-squared:  0.0214 
F-statistic: 3.449 on 2 and 222 DF,  p-value: 0.03348

plot(m10)
[1] 88
